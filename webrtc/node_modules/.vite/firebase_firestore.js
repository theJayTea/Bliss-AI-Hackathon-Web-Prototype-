import {
  Component,
  LogLevel,
  Logger,
  __awaiter,
  __extends,
  __generator,
  index_esm_default
} from "./chunk.USVVCSSK.js";

// node_modules/tslib/tslib.es6.js
function __spreadArrays() {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++)
    s += arguments[i].length;
  for (var r2 = Array(s), k3 = 0, i = 0; i < il; i++)
    for (var a = arguments[i], j2 = 0, jl = a.length; j2 < jl; j2++, k3++)
      r2[k3] = a[j2];
  return r2;
}

// node_modules/@firebase/util/dist/index.esm.js
function getUA() {
  if (typeof navigator !== "undefined" && typeof navigator["userAgent"] === "string") {
    return navigator["userAgent"];
  } else {
    return "";
  }
}
function isMobileCordova() {
  return typeof window !== "undefined" && !!(window["cordova"] || window["phonegap"] || window["PhoneGap"]) && /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA());
}
function isBrowserExtension() {
  var runtime = typeof chrome === "object" ? chrome.runtime : typeof browser === "object" ? browser.runtime : void 0;
  return typeof runtime === "object" && runtime.id !== void 0;
}
function isReactNative() {
  return typeof navigator === "object" && navigator["product"] === "ReactNative";
}
function isElectron() {
  return getUA().indexOf("Electron/") >= 0;
}
function isIE() {
  var ua3 = getUA();
  return ua3.indexOf("MSIE ") >= 0 || ua3.indexOf("Trident/") >= 0;
}
function isUWP() {
  return getUA().indexOf("MSAppHost/") >= 0;
}

// node_modules/@firebase/webchannel-wrapper/dist/index.esm.js
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var extendStatics = function(d, b) {
  extendStatics = Object.setPrototypeOf || {__proto__: []} instanceof Array && function(d2, b2) {
    d2.__proto__ = b2;
  } || function(d2, b2) {
    for (var p2 in b2)
      if (Object.prototype.hasOwnProperty.call(b2, p2))
        d2[p2] = b2[p2];
  };
  return extendStatics(d, b);
};
function __extends2(d, b) {
  extendStatics(d, b);
  function __() {
    this.constructor = d;
  }
  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
function __values(o) {
  var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
  if (m)
    return m.call(o);
  if (o && typeof o.length === "number")
    return {
      next: function() {
        if (o && i >= o.length)
          o = void 0;
        return {value: o && o[i++], done: !o};
      }
    };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
var h;
var goog = goog || {};
var k = commonjsGlobal || self;
function aa() {
}
function ba(a) {
  var b = typeof a;
  b = b != "object" ? b : a ? Array.isArray(a) ? "array" : b : "null";
  return b == "array" || b == "object" && typeof a.length == "number";
}
function n(a) {
  var b = typeof a;
  return b == "object" && a != null || b == "function";
}
function ca(a) {
  return Object.prototype.hasOwnProperty.call(a, da) && a[da] || (a[da] = ++ea);
}
var da = "closure_uid_" + (1e9 * Math.random() >>> 0);
var ea = 0;
function fa(a, b, c) {
  return a.call.apply(a.bind, arguments);
}
function ha(a, b, c) {
  if (!a)
    throw Error();
  if (2 < arguments.length) {
    var d = Array.prototype.slice.call(arguments, 2);
    return function() {
      var e = Array.prototype.slice.call(arguments);
      Array.prototype.unshift.apply(e, d);
      return a.apply(b, e);
    };
  }
  return function() {
    return a.apply(b, arguments);
  };
}
function p(a, b, c) {
  Function.prototype.bind && Function.prototype.bind.toString().indexOf("native code") != -1 ? p = fa : p = ha;
  return p.apply(null, arguments);
}
function ja(a, b) {
  var c = Array.prototype.slice.call(arguments, 1);
  return function() {
    var d = c.slice();
    d.push.apply(d, arguments);
    return a.apply(this, d);
  };
}
function q() {
  return Date.now();
}
function r(a, b) {
  function c() {
  }
  c.prototype = b.prototype;
  a.X = b.prototype;
  a.prototype = new c();
  a.prototype.constructor = a;
  a.Kb = function(d, e, f) {
    for (var g = Array(arguments.length - 2), m = 2; m < arguments.length; m++)
      g[m - 2] = arguments[m];
    return b.prototype[e].apply(d, g);
  };
}
function t() {
  this.j = this.j;
  this.i = this.i;
}
var ka = 0;
t.prototype.j = false;
t.prototype.ja = function() {
  if (!this.j && (this.j = true, this.G(), ka != 0)) {
    var a = ca(this);
  }
};
t.prototype.G = function() {
  if (this.i)
    for (; this.i.length; )
      this.i.shift()();
};
var ma = Array.prototype.indexOf ? function(a, b) {
  return Array.prototype.indexOf.call(a, b, void 0);
} : function(a, b) {
  if (typeof a === "string")
    return typeof b !== "string" || b.length != 1 ? -1 : a.indexOf(b, 0);
  for (var c = 0; c < a.length; c++)
    if (c in a && a[c] === b)
      return c;
  return -1;
};
var na = Array.prototype.forEach ? function(a, b, c) {
  Array.prototype.forEach.call(a, b, c);
} : function(a, b, c) {
  for (var d = a.length, e = typeof a === "string" ? a.split("") : a, f = 0; f < d; f++)
    f in e && b.call(c, e[f], f, a);
};
function oa(a) {
  a: {
    var b = pa;
    for (var c = a.length, d = typeof a === "string" ? a.split("") : a, e = 0; e < c; e++)
      if (e in d && b.call(void 0, d[e], e, a)) {
        b = e;
        break a;
      }
    b = -1;
  }
  return 0 > b ? null : typeof a === "string" ? a.charAt(b) : a[b];
}
function qa(a) {
  return Array.prototype.concat.apply([], arguments);
}
function ra(a) {
  var b = a.length;
  if (0 < b) {
    for (var c = Array(b), d = 0; d < b; d++)
      c[d] = a[d];
    return c;
  }
  return [];
}
function sa(a) {
  return /^[\s\xa0]*$/.test(a);
}
var ta = String.prototype.trim ? function(a) {
  return a.trim();
} : function(a) {
  return /^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1];
};
function v(a, b) {
  return a.indexOf(b) != -1;
}
function ua(a, b) {
  return a < b ? -1 : a > b ? 1 : 0;
}
var w;
a: {
  va2 = k.navigator;
  if (va2) {
    wa2 = va2.userAgent;
    if (wa2) {
      w = wa2;
      break a;
    }
  }
  w = "";
}
var va2;
var wa2;
function za(a, b, c) {
  for (var d in a)
    b.call(c, a[d], d, a);
}
function Aa(a) {
  var b = {};
  for (var c in a)
    b[c] = a[c];
  return b;
}
var Ba = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Ca(a, b) {
  var c, d;
  for (var e = 1; e < arguments.length; e++) {
    d = arguments[e];
    for (c in d)
      a[c] = d[c];
    for (var f = 0; f < Ba.length; f++)
      c = Ba[f], Object.prototype.hasOwnProperty.call(d, c) && (a[c] = d[c]);
  }
}
function Da(a) {
  Da[" "](a);
  return a;
}
Da[" "] = aa;
function Ea(a, b) {
  var c = Fa;
  return Object.prototype.hasOwnProperty.call(c, a) ? c[a] : c[a] = b(a);
}
var Ga = v(w, "Opera");
var x = v(w, "Trident") || v(w, "MSIE");
var Ha = v(w, "Edge");
var Ia = Ha || x;
var Ja = v(w, "Gecko") && !(v(w.toLowerCase(), "webkit") && !v(w, "Edge")) && !(v(w, "Trident") || v(w, "MSIE")) && !v(w, "Edge");
var Ka = v(w.toLowerCase(), "webkit") && !v(w, "Edge");
function La() {
  var a = k.document;
  return a ? a.documentMode : void 0;
}
var Ma;
a: {
  Na2 = "", Oa2 = function() {
    var a = w;
    if (Ja)
      return /rv:([^\);]+)(\)|;)/.exec(a);
    if (Ha)
      return /Edge\/([\d\.]+)/.exec(a);
    if (x)
      return /\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);
    if (Ka)
      return /WebKit\/(\S+)/.exec(a);
    if (Ga)
      return /(?:Version)[ \/]?(\S+)/.exec(a);
  }();
  Oa2 && (Na2 = Oa2 ? Oa2[1] : "");
  if (x) {
    Pa2 = La();
    if (Pa2 != null && Pa2 > parseFloat(Na2)) {
      Ma = String(Pa2);
      break a;
    }
  }
  Ma = Na2;
}
var Na2;
var Oa2;
var Pa2;
var Fa = {};
function Qa(a) {
  return Ea(a, function() {
    {
      var b = 0;
      var e = ta(String(Ma)).split("."), f = ta(String(a)).split("."), g = Math.max(e.length, f.length);
      for (var m = 0; b == 0 && m < g; m++) {
        var c = e[m] || "", d = f[m] || "";
        do {
          c = /(\d*)(\D*)(.*)/.exec(c) || ["", "", "", ""];
          d = /(\d*)(\D*)(.*)/.exec(d) || ["", "", "", ""];
          if (c[0].length == 0 && d[0].length == 0)
            break;
          b = ua(c[1].length == 0 ? 0 : parseInt(c[1], 10), d[1].length == 0 ? 0 : parseInt(d[1], 10)) || ua(c[2].length == 0, d[2].length == 0) || ua(c[2], d[2]);
          c = c[3];
          d = d[3];
        } while (b == 0);
      }
    }
    return 0 <= b;
  });
}
var Ra;
if (k.document && x) {
  Sa2 = La();
  Ra = Sa2 ? Sa2 : parseInt(Ma, 10) || void 0;
} else
  Ra = void 0;
var Sa2;
var Ta = Ra;
var Ua = !x || 9 <= Number(Ta);
var Va = x && !Qa("9");
var Wa = function() {
  if (!k.addEventListener || !Object.defineProperty)
    return false;
  var a = false, b = Object.defineProperty({}, "passive", {get: function() {
    a = true;
  }});
  try {
    k.addEventListener("test", aa, b), k.removeEventListener("test", aa, b);
  } catch (c) {
  }
  return a;
}();
function y(a, b) {
  this.type = a;
  this.a = this.target = b;
  this.defaultPrevented = false;
}
y.prototype.b = function() {
  this.defaultPrevented = true;
};
function z(a, b) {
  y.call(this, a ? a.type : "");
  this.relatedTarget = this.a = this.target = null;
  this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;
  this.key = "";
  this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = false;
  this.pointerId = 0;
  this.pointerType = "";
  this.c = null;
  if (a) {
    var c = this.type = a.type, d = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;
    this.target = a.target || a.srcElement;
    this.a = b;
    if (b = a.relatedTarget) {
      if (Ja) {
        a: {
          try {
            Da(b.nodeName);
            var e = true;
            break a;
          } catch (f) {
          }
          e = false;
        }
        e || (b = null);
      }
    } else
      c == "mouseover" ? b = a.fromElement : c == "mouseout" && (b = a.toElement);
    this.relatedTarget = b;
    d ? (this.clientX = d.clientX !== void 0 ? d.clientX : d.pageX, this.clientY = d.clientY !== void 0 ? d.clientY : d.pageY, this.screenX = d.screenX || 0, this.screenY = d.screenY || 0) : (this.clientX = a.clientX !== void 0 ? a.clientX : a.pageX, this.clientY = a.clientY !== void 0 ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);
    this.button = a.button;
    this.key = a.key || "";
    this.ctrlKey = a.ctrlKey;
    this.altKey = a.altKey;
    this.shiftKey = a.shiftKey;
    this.metaKey = a.metaKey;
    this.pointerId = a.pointerId || 0;
    this.pointerType = typeof a.pointerType === "string" ? a.pointerType : Xa[a.pointerType] || "";
    this.c = a;
    a.defaultPrevented && this.b();
  }
}
r(z, y);
var Xa = {2: "touch", 3: "pen", 4: "mouse"};
z.prototype.b = function() {
  z.X.b.call(this);
  var a = this.c;
  if (a.preventDefault)
    a.preventDefault();
  else if (a.returnValue = false, Va)
    try {
      if (a.ctrlKey || 112 <= a.keyCode && 123 >= a.keyCode)
        a.keyCode = -1;
    } catch (b) {
    }
};
var A = "closure_listenable_" + (1e6 * Math.random() | 0);
var Ya = 0;
function Za(a, b, c, d, e) {
  this.listener = a;
  this.proxy = null;
  this.src = b;
  this.type = c;
  this.capture = !!d;
  this.ca = e;
  this.key = ++Ya;
  this.Y = this.Z = false;
}
function $a(a) {
  a.Y = true;
  a.listener = null;
  a.proxy = null;
  a.src = null;
  a.ca = null;
}
function ab(a) {
  this.src = a;
  this.a = {};
  this.b = 0;
}
ab.prototype.add = function(a, b, c, d, e) {
  var f = a.toString();
  a = this.a[f];
  a || (a = this.a[f] = [], this.b++);
  var g = bb(a, b, d, e);
  -1 < g ? (b = a[g], c || (b.Z = false)) : (b = new Za(b, this.src, f, !!d, e), b.Z = c, a.push(b));
  return b;
};
function cb(a, b) {
  var c = b.type;
  if (c in a.a) {
    var d = a.a[c], e = ma(d, b), f;
    (f = 0 <= e) && Array.prototype.splice.call(d, e, 1);
    f && ($a(b), a.a[c].length == 0 && (delete a.a[c], a.b--));
  }
}
function bb(a, b, c, d) {
  for (var e = 0; e < a.length; ++e) {
    var f = a[e];
    if (!f.Y && f.listener == b && f.capture == !!c && f.ca == d)
      return e;
  }
  return -1;
}
var db = "closure_lm_" + (1e6 * Math.random() | 0);
var eb = {};
function gb(a, b, c, d, e) {
  if (d && d.once)
    return hb(a, b, c, d, e);
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      gb(a, b[f], c, d, e);
    return null;
  }
  c = ib(c);
  return a && a[A] ? a.va(b, c, n(d) ? !!d.capture : !!d, e) : jb(a, b, c, false, d, e);
}
function jb(a, b, c, d, e, f) {
  if (!b)
    throw Error("Invalid event type");
  var g = n(e) ? !!e.capture : !!e;
  if (g && !Ua)
    return null;
  var m = kb(a);
  m || (a[db] = m = new ab(a));
  c = m.add(b, c, d, g, f);
  if (c.proxy)
    return c;
  d = lb();
  c.proxy = d;
  d.src = a;
  d.listener = c;
  if (a.addEventListener)
    Wa || (e = g), e === void 0 && (e = false), a.addEventListener(b.toString(), d, e);
  else if (a.attachEvent)
    a.attachEvent(mb(b.toString()), d);
  else if (a.addListener && a.removeListener)
    a.addListener(d);
  else
    throw Error("addEventListener and attachEvent are unavailable.");
  return c;
}
function lb() {
  var a = nb, b = Ua ? function(c) {
    return a.call(b.src, b.listener, c);
  } : function(c) {
    c = a.call(b.src, b.listener, c);
    if (!c)
      return c;
  };
  return b;
}
function hb(a, b, c, d, e) {
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      hb(a, b[f], c, d, e);
    return null;
  }
  c = ib(c);
  return a && a[A] ? a.wa(b, c, n(d) ? !!d.capture : !!d, e) : jb(a, b, c, true, d, e);
}
function ob(a, b, c, d, e) {
  if (Array.isArray(b))
    for (var f = 0; f < b.length; f++)
      ob(a, b[f], c, d, e);
  else
    (d = n(d) ? !!d.capture : !!d, c = ib(c), a && a[A]) ? (a = a.c, b = String(b).toString(), b in a.a && (f = a.a[b], c = bb(f, c, d, e), -1 < c && ($a(f[c]), Array.prototype.splice.call(f, c, 1), f.length == 0 && (delete a.a[b], a.b--)))) : a && (a = kb(a)) && (b = a.a[b.toString()], a = -1, b && (a = bb(b, c, d, e)), (c = -1 < a ? b[a] : null) && pb(c));
}
function pb(a) {
  if (typeof a !== "number" && a && !a.Y) {
    var b = a.src;
    if (b && b[A])
      cb(b.c, a);
    else {
      var c = a.type, d = a.proxy;
      b.removeEventListener ? b.removeEventListener(c, d, a.capture) : b.detachEvent ? b.detachEvent(mb(c), d) : b.addListener && b.removeListener && b.removeListener(d);
      (c = kb(b)) ? (cb(c, a), c.b == 0 && (c.src = null, b[db] = null)) : $a(a);
    }
  }
}
function mb(a) {
  return a in eb ? eb[a] : eb[a] = "on" + a;
}
function qb(a, b) {
  var c = a.listener, d = a.ca || a.src;
  a.Z && pb(a);
  return c.call(d, b);
}
function nb(a, b) {
  if (a.Y)
    return true;
  if (!Ua) {
    if (!b)
      a: {
        b = ["window", "event"];
        for (var c = k, d = 0; d < b.length; d++)
          if (c = c[b[d]], c == null) {
            b = null;
            break a;
          }
        b = c;
      }
    b = new z(b, this);
    return qb(a, b);
  }
  return qb(a, new z(b, this));
}
function kb(a) {
  a = a[db];
  return a instanceof ab ? a : null;
}
var sb = "__closure_events_fn_" + (1e9 * Math.random() >>> 0);
function ib(a) {
  if (typeof a === "function")
    return a;
  a[sb] || (a[sb] = function(b) {
    return a.handleEvent(b);
  });
  return a[sb];
}
function D() {
  t.call(this);
  this.c = new ab(this);
  this.J = this;
  this.C = null;
}
r(D, t);
D.prototype[A] = true;
h = D.prototype;
h.addEventListener = function(a, b, c, d) {
  gb(this, a, b, c, d);
};
h.removeEventListener = function(a, b, c, d) {
  ob(this, a, b, c, d);
};
function E(a, b) {
  var c, d = a.C;
  if (d)
    for (c = []; d; d = d.C)
      c.push(d);
  a = a.J;
  d = b.type || b;
  if (typeof b === "string")
    b = new y(b, a);
  else if (b instanceof y)
    b.target = b.target || a;
  else {
    var e = b;
    b = new y(d, a);
    Ca(b, e);
  }
  e = true;
  if (c)
    for (var f = c.length - 1; 0 <= f; f--) {
      var g = b.a = c[f];
      e = tb(g, d, true, b) && e;
    }
  g = b.a = a;
  e = tb(g, d, true, b) && e;
  e = tb(g, d, false, b) && e;
  if (c)
    for (f = 0; f < c.length; f++)
      g = b.a = c[f], e = tb(g, d, false, b) && e;
}
h.G = function() {
  D.X.G.call(this);
  if (this.c) {
    var a = this.c, c;
    for (c in a.a) {
      for (var d = a.a[c], e = 0; e < d.length; e++)
        $a(d[e]);
      delete a.a[c];
      a.b--;
    }
  }
  this.C = null;
};
h.va = function(a, b, c, d) {
  return this.c.add(String(a), b, false, c, d);
};
h.wa = function(a, b, c, d) {
  return this.c.add(String(a), b, true, c, d);
};
function tb(a, b, c, d) {
  b = a.c.a[String(b)];
  if (!b)
    return true;
  b = b.concat();
  for (var e = true, f = 0; f < b.length; ++f) {
    var g = b[f];
    if (g && !g.Y && g.capture == c) {
      var m = g.listener, l = g.ca || g.src;
      g.Z && cb(a.c, g);
      e = m.call(l, d) !== false && e;
    }
  }
  return e && !d.defaultPrevented;
}
var ub = k.JSON.stringify;
function vb() {
  this.b = this.a = null;
}
var xb = new (function() {
  function class_1(a, b) {
    this.c = a;
    this.f = b;
    this.b = 0;
    this.a = null;
  }
  class_1.prototype.get = function() {
    var a;
    0 < this.b ? (this.b--, a = this.a, this.a = a.next, a.next = null) : a = this.c();
    return a;
  };
  return class_1;
}())(function() {
  return new wb();
}, function(a) {
  a.reset();
});
vb.prototype.add = function(a, b) {
  var c = xb.get();
  c.set(a, b);
  this.b ? this.b.next = c : this.a = c;
  this.b = c;
};
function yb() {
  var a = zb, b = null;
  a.a && (b = a.a, a.a = a.a.next, a.a || (a.b = null), b.next = null);
  return b;
}
function wb() {
  this.next = this.b = this.a = null;
}
wb.prototype.set = function(a, b) {
  this.a = a;
  this.b = b;
  this.next = null;
};
wb.prototype.reset = function() {
  this.next = this.b = this.a = null;
};
function Ab(a) {
  k.setTimeout(function() {
    throw a;
  }, 0);
}
function Bb(a, b) {
  Cb || Db();
  Eb || (Cb(), Eb = true);
  zb.add(a, b);
}
var Cb;
function Db() {
  var a = k.Promise.resolve(void 0);
  Cb = function() {
    a.then(Fb);
  };
}
var Eb = false;
var zb = new vb();
function Fb() {
  for (var a; a = yb(); ) {
    try {
      a.a.call(a.b);
    } catch (c) {
      Ab(c);
    }
    var b = xb;
    b.f(a);
    100 > b.b && (b.b++, a.next = b.a, b.a = a);
  }
  Eb = false;
}
function Gb(a, b) {
  D.call(this);
  this.b = a || 1;
  this.a = b || k;
  this.f = p(this.Za, this);
  this.g = q();
}
r(Gb, D);
h = Gb.prototype;
h.aa = false;
h.M = null;
h.Za = function() {
  if (this.aa) {
    var a = q() - this.g;
    0 < a && a < 0.8 * this.b ? this.M = this.a.setTimeout(this.f, this.b - a) : (this.M && (this.a.clearTimeout(this.M), this.M = null), E(this, "tick"), this.aa && (Hb(this), this.start()));
  }
};
h.start = function() {
  this.aa = true;
  this.M || (this.M = this.a.setTimeout(this.f, this.b), this.g = q());
};
function Hb(a) {
  a.aa = false;
  a.M && (a.a.clearTimeout(a.M), a.M = null);
}
h.G = function() {
  Gb.X.G.call(this);
  Hb(this);
  delete this.a;
};
function Ib(a, b, c) {
  if (typeof a === "function")
    c && (a = p(a, c));
  else if (a && typeof a.handleEvent == "function")
    a = p(a.handleEvent, a);
  else
    throw Error("Invalid listener argument");
  return 2147483647 < Number(b) ? -1 : k.setTimeout(a, b || 0);
}
function Jb(a) {
  a.a = Ib(function() {
    a.a = null;
    a.c && (a.c = false, Jb(a));
  }, a.h);
  var b = a.b;
  a.b = null;
  a.g.apply(null, b);
}
var Kb = function(_super) {
  __extends2(Kb2, _super);
  function Kb2(a, b) {
    var _this = _super.call(this) || this;
    _this.g = a;
    _this.h = b;
    _this.b = null;
    _this.c = false;
    _this.a = null;
    return _this;
  }
  Kb2.prototype.f = function(a) {
    this.b = arguments;
    this.a ? this.c = true : Jb(this);
  };
  Kb2.prototype.G = function() {
    _super.prototype.G.call(this);
    this.a && (k.clearTimeout(this.a), this.a = null, this.c = false, this.b = null);
  };
  return Kb2;
}(t);
function F(a) {
  t.call(this);
  this.b = a;
  this.a = {};
}
r(F, t);
var Lb = [];
function Mb(a, b, c, d) {
  Array.isArray(c) || (c && (Lb[0] = c.toString()), c = Lb);
  for (var e = 0; e < c.length; e++) {
    var f = gb(b, c[e], d || a.handleEvent, false, a.b || a);
    if (!f)
      break;
    a.a[f.key] = f;
  }
}
function Nb(a) {
  za(a.a, function(b, c) {
    this.a.hasOwnProperty(c) && pb(b);
  }, a);
  a.a = {};
}
F.prototype.G = function() {
  F.X.G.call(this);
  Nb(this);
};
F.prototype.handleEvent = function() {
  throw Error("EventHandler.handleEvent not implemented");
};
function Ob() {
  this.a = true;
}
function Pb(a, b, c, d, e, f) {
  a.info(function() {
    if (a.a)
      if (f) {
        var g = "";
        for (var m = f.split("&"), l = 0; l < m.length; l++) {
          var u = m[l].split("=");
          if (1 < u.length) {
            var C2 = u[0];
            u = u[1];
            var B2 = C2.split("_");
            g = 2 <= B2.length && B2[1] == "type" ? g + (C2 + "=" + u + "&") : g + (C2 + "=redacted&");
          }
        }
      } else
        g = null;
    else
      g = f;
    return "XMLHTTP REQ (" + d + ") [attempt " + e + "]: " + b + "\n" + c + "\n" + g;
  });
}
function Qb(a, b, c, d, e, f, g) {
  a.info(function() {
    return "XMLHTTP RESP (" + d + ") [ attempt " + e + "]: " + b + "\n" + c + "\n" + f + " " + g;
  });
}
function G(a, b, c, d) {
  a.info(function() {
    return "XMLHTTP TEXT (" + b + "): " + Rb(a, c) + (d ? " " + d : "");
  });
}
function Sb(a, b) {
  a.info(function() {
    return "TIMEOUT: " + b;
  });
}
Ob.prototype.info = function() {
};
function Rb(a, b) {
  if (!a.a)
    return b;
  if (!b)
    return null;
  try {
    var c = JSON.parse(b);
    if (c) {
      for (a = 0; a < c.length; a++)
        if (Array.isArray(c[a])) {
          var d = c[a];
          if (!(2 > d.length)) {
            var e = d[1];
            if (Array.isArray(e) && !(1 > e.length)) {
              var f = e[0];
              if (f != "noop" && f != "stop" && f != "close")
                for (var g = 1; g < e.length; g++)
                  e[g] = "";
            }
          }
        }
    }
    return ub(c);
  } catch (m) {
    return b;
  }
}
var H = {};
var Tb = null;
function Ub() {
  return Tb = Tb || new D();
}
H.Fa = "serverreachability";
function Vb(a) {
  y.call(this, H.Fa, a);
}
r(Vb, y);
function I(a) {
  var b = Ub();
  E(b, new Vb(b, a));
}
H.STAT_EVENT = "statevent";
function Wb(a, b) {
  y.call(this, H.STAT_EVENT, a);
  this.stat = b;
}
r(Wb, y);
function J(a) {
  var b = Ub();
  E(b, new Wb(b, a));
}
H.Ga = "timingevent";
function Xb(a) {
  y.call(this, H.Ga, a);
}
r(Xb, y);
function K(a, b) {
  if (typeof a !== "function")
    throw Error("Fn must not be null and must be a function");
  return k.setTimeout(function() {
    a();
  }, b);
}
var Yb = {NO_ERROR: 0, $a: 1, nb: 2, mb: 3, hb: 4, lb: 5, ob: 6, Da: 7, TIMEOUT: 8, rb: 9};
var Zb = {fb: "complete", Bb: "success", Ea: "error", Da: "abort", tb: "ready", ub: "readystatechange", TIMEOUT: "timeout", pb: "incrementaldata", sb: "progress", ib: "downloadprogress", Jb: "uploadprogress"};
function $b() {
}
$b.prototype.a = null;
function ac(a) {
  var b;
  (b = a.a) || (b = a.a = {});
  return b;
}
function bc() {
}
var L = {OPEN: "a", eb: "b", Ea: "c", qb: "d"};
function cc() {
  y.call(this, "d");
}
r(cc, y);
function dc() {
  y.call(this, "c");
}
r(dc, y);
var ec;
function fc() {
}
r(fc, $b);
ec = new fc();
function M(a, b, c, d) {
  this.g = a;
  this.c = b;
  this.f = c;
  this.S = d || 1;
  this.J = new F(this);
  this.P = gc;
  a = Ia ? 125 : void 0;
  this.R = new Gb(a);
  this.B = null;
  this.b = false;
  this.j = this.l = this.i = this.H = this.u = this.T = this.o = null;
  this.s = [];
  this.a = null;
  this.D = 0;
  this.h = this.m = null;
  this.N = -1;
  this.A = false;
  this.O = 0;
  this.F = null;
  this.V = this.C = this.U = this.I = false;
}
var gc = 45e3;
var hc = {};
var ic = {};
h = M.prototype;
h.setTimeout = function(a) {
  this.P = a;
};
function jc(a, b, c) {
  a.H = 1;
  a.i = kc(N(b));
  a.j = c;
  a.I = true;
  lc(a, null);
}
function lc(a, b) {
  a.u = q();
  mc(a);
  a.l = N(a.i);
  var c = a.l, d = a.S;
  Array.isArray(d) || (d = [String(d)]);
  nc(c.b, "t", d);
  a.D = 0;
  a.a = oc(a.g, a.g.C ? b : null);
  0 < a.O && (a.F = new Kb(p(a.Ca, a, a.a), a.O));
  Mb(a.J, a.a, "readystatechange", a.Xa);
  b = a.B ? Aa(a.B) : {};
  a.j ? (a.m || (a.m = "POST"), b["Content-Type"] = "application/x-www-form-urlencoded", a.a.ba(a.l, a.m, a.j, b)) : (a.m = "GET", a.a.ba(a.l, a.m, null, b));
  I(1);
  Pb(a.c, a.m, a.l, a.f, a.S, a.j);
}
h.Xa = function(a) {
  a = a.target;
  var b = this.F;
  b && O(a) == 3 ? b.f() : this.Ca(a);
};
h.Ca = function(a) {
  try {
    if (a == this.a)
      a: {
        var b = O(this.a), c = this.a.ua(), d = this.a.W();
        if (!(3 > b || b == 3 && !Ia && !this.a.$())) {
          this.A || b != 4 || c == 7 || (c == 8 || 0 >= d ? I(3) : I(2));
          pc(this);
          var e = this.a.W();
          this.N = e;
          var f = this.a.$();
          this.b = e == 200;
          Qb(this.c, this.m, this.l, this.f, this.S, b, e);
          if (this.b) {
            if (this.U && !this.C) {
              b: {
                if (this.a) {
                  var g, m = this.a;
                  if ((g = m.a ? m.a.getResponseHeader("X-HTTP-Initial-Response") : null) && !sa(g)) {
                    var l = g;
                    break b;
                  }
                }
                l = null;
              }
              if (l)
                G(this.c, this.f, l, "Initial handshake response via X-HTTP-Initial-Response"), this.C = true, qc(this, l);
              else {
                this.b = false;
                this.h = 3;
                J(12);
                P(this);
                rc(this);
                break a;
              }
            }
            this.I ? (sc(this, b, f), Ia && this.b && b == 3 && (Mb(this.J, this.R, "tick", this.Wa), this.R.start())) : (G(this.c, this.f, f, null), qc(this, f));
            b == 4 && P(this);
            this.b && !this.A && (b == 4 ? uc(this.g, this) : (this.b = false, mc(this)));
          } else
            e == 400 && 0 < f.indexOf("Unknown SID") ? (this.h = 3, J(12)) : (this.h = 0, J(13)), P(this), rc(this);
        }
      }
  } catch (u) {
  } finally {
  }
};
function sc(a, b, c) {
  for (var d = true; !a.A && a.D < c.length; ) {
    var e = vc(a, c);
    if (e == ic) {
      b == 4 && (a.h = 4, J(14), d = false);
      G(a.c, a.f, null, "[Incomplete Response]");
      break;
    } else if (e == hc) {
      a.h = 4;
      J(15);
      G(a.c, a.f, c, "[Invalid Chunk]");
      d = false;
      break;
    } else
      G(a.c, a.f, e, null), qc(a, e);
  }
  b == 4 && c.length == 0 && (a.h = 1, J(16), d = false);
  a.b = a.b && d;
  d ? 0 < c.length && !a.V && (a.V = true, b = a.g, b.a == a && b.U && !b.F && (b.c.info("Great, no buffering proxy detected. Bytes received: " + c.length), wc(b), b.F = true, J(11))) : (G(a.c, a.f, c, "[Invalid Chunked Response]"), P(a), rc(a));
}
h.Wa = function() {
  if (this.a) {
    var a = O(this.a), b = this.a.$();
    this.D < b.length && (pc(this), sc(this, a, b), this.b && a != 4 && mc(this));
  }
};
function vc(a, b) {
  var c = a.D, d = b.indexOf("\n", c);
  if (d == -1)
    return ic;
  c = Number(b.substring(c, d));
  if (isNaN(c))
    return hc;
  d += 1;
  if (d + c > b.length)
    return ic;
  b = b.substr(d, c);
  a.D = d + c;
  return b;
}
h.cancel = function() {
  this.A = true;
  P(this);
};
function mc(a) {
  a.T = q() + a.P;
  yc(a, a.P);
}
function yc(a, b) {
  if (a.o != null)
    throw Error("WatchDog timer not null");
  a.o = K(p(a.Va, a), b);
}
function pc(a) {
  a.o && (k.clearTimeout(a.o), a.o = null);
}
h.Va = function() {
  this.o = null;
  var a = q();
  0 <= a - this.T ? (Sb(this.c, this.l), this.H != 2 && (I(3), J(17)), P(this), this.h = 2, rc(this)) : yc(this, this.T - a);
};
function rc(a) {
  a.g.v == 0 || a.A || uc(a.g, a);
}
function P(a) {
  pc(a);
  var b = a.F;
  b && typeof b.ja == "function" && b.ja();
  a.F = null;
  Hb(a.R);
  Nb(a.J);
  a.a && (b = a.a, a.a = null, b.abort(), b.ja());
}
function qc(a, b) {
  try {
    var c = a.g;
    if (c.v != 0 && (c.a == a || zc(c.b, a))) {
      if (c.I = a.N, !a.C && zc(c.b, a) && c.v == 3) {
        try {
          var d = c.ka.a.parse(b);
        } catch (tc2) {
          d = null;
        }
        if (Array.isArray(d) && d.length == 3) {
          var e = d;
          if (e[0] == 0)
            a: {
              if (!c.j) {
                if (c.a)
                  if (c.a.u + 3e3 < a.u)
                    Ac(c), Bc(c);
                  else
                    break a;
                Cc(c);
                J(18);
              }
            }
          else
            c.oa = e[1], 0 < c.oa - c.P && 37500 > e[2] && c.H && c.o == 0 && !c.m && (c.m = K(p(c.Sa, c), 6e3));
          if (1 >= Dc(c.b) && c.ea) {
            try {
              c.ea();
            } catch (tc2) {
            }
            c.ea = void 0;
          }
        } else
          Q(c, 11);
      } else if ((a.C || c.a == a) && Ac(c), !sa(b))
        for (b = d = c.ka.a.parse(b), d = 0; d < b.length; d++)
          if (e = b[d], c.P = e[0], e = e[1], c.v == 2)
            if (e[0] == "c") {
              c.J = e[1];
              c.ga = e[2];
              var f = e[3];
              f != null && (c.ha = f, c.c.info("VER=" + c.ha));
              var g = e[4];
              g != null && (c.pa = g, c.c.info("SVER=" + c.pa));
              var m = e[5];
              if (m != null && typeof m === "number" && 0 < m) {
                var l = 1.5 * m;
                c.D = l;
                c.c.info("backChannelRequestTimeoutMs_=" + l);
              }
              l = c;
              var u = a.a;
              if (u) {
                var C2 = u.a ? u.a.getResponseHeader("X-Client-Wire-Protocol") : null;
                if (C2) {
                  var B2 = l.b;
                  !B2.a && (v(C2, "spdy") || v(C2, "quic") || v(C2, "h2")) && (B2.f = B2.g, B2.a = new Set(), B2.b && (Ec(B2, B2.b), B2.b = null));
                }
                if (l.A) {
                  var rb = u.a ? u.a.getResponseHeader("X-HTTP-Session-Id") : null;
                  rb && (l.na = rb, R(l.B, l.A, rb));
                }
              }
              c.v = 3;
              c.f && c.f.ta();
              c.U && (c.N = q() - a.u, c.c.info("Handshake RTT: " + c.N + "ms"));
              l = c;
              var xa2 = a;
              l.la = Fc(l, l.C ? l.ga : null, l.fa);
              if (xa2.C) {
                Gc(l.b, xa2);
                var ya2 = xa2, xc2 = l.D;
                xc2 && ya2.setTimeout(xc2);
                ya2.o && (pc(ya2), mc(ya2));
                l.a = xa2;
              } else
                Hc(l);
              0 < c.g.length && Ic(c);
            } else
              e[0] != "stop" && e[0] != "close" || Q(c, 7);
          else
            c.v == 3 && (e[0] == "stop" || e[0] == "close" ? e[0] == "stop" ? Q(c, 7) : Jc(c) : e[0] != "noop" && c.f && c.f.sa(e), c.o = 0);
    }
    I(4);
  } catch (tc2) {
  }
}
function Kc(a) {
  if (a.K && typeof a.K == "function")
    return a.K();
  if (typeof a === "string")
    return a.split("");
  if (ba(a)) {
    for (var b = [], c = a.length, d = 0; d < c; d++)
      b.push(a[d]);
    return b;
  }
  b = [];
  c = 0;
  for (d in a)
    b[c++] = a[d];
  return a = b;
}
function Lc(a, b) {
  if (a.forEach && typeof a.forEach == "function")
    a.forEach(b, void 0);
  else if (ba(a) || typeof a === "string")
    na(a, b, void 0);
  else {
    if (a.L && typeof a.L == "function")
      var c = a.L();
    else if (a.K && typeof a.K == "function")
      c = void 0;
    else if (ba(a) || typeof a === "string") {
      c = [];
      for (var d = a.length, e = 0; e < d; e++)
        c.push(e);
    } else
      for (e in c = [], d = 0, a)
        c[d++] = e;
    d = Kc(a);
    e = d.length;
    for (var f = 0; f < e; f++)
      b.call(void 0, d[f], c && c[f], a);
  }
}
function S(a, b) {
  this.b = {};
  this.a = [];
  this.c = 0;
  var c = arguments.length;
  if (1 < c) {
    if (c % 2)
      throw Error("Uneven number of arguments");
    for (var d = 0; d < c; d += 2)
      this.set(arguments[d], arguments[d + 1]);
  } else if (a)
    if (a instanceof S)
      for (c = a.L(), d = 0; d < c.length; d++)
        this.set(c[d], a.get(c[d]));
    else
      for (d in a)
        this.set(d, a[d]);
}
h = S.prototype;
h.K = function() {
  Mc(this);
  for (var a = [], b = 0; b < this.a.length; b++)
    a.push(this.b[this.a[b]]);
  return a;
};
h.L = function() {
  Mc(this);
  return this.a.concat();
};
function Mc(a) {
  if (a.c != a.a.length) {
    for (var b = 0, c = 0; b < a.a.length; ) {
      var d = a.a[b];
      T(a.b, d) && (a.a[c++] = d);
      b++;
    }
    a.a.length = c;
  }
  if (a.c != a.a.length) {
    var e = {};
    for (c = b = 0; b < a.a.length; )
      d = a.a[b], T(e, d) || (a.a[c++] = d, e[d] = 1), b++;
    a.a.length = c;
  }
}
h.get = function(a, b) {
  return T(this.b, a) ? this.b[a] : b;
};
h.set = function(a, b) {
  T(this.b, a) || (this.c++, this.a.push(a));
  this.b[a] = b;
};
h.forEach = function(a, b) {
  for (var c = this.L(), d = 0; d < c.length; d++) {
    var e = c[d], f = this.get(e);
    a.call(b, f, e, this);
  }
};
function T(a, b) {
  return Object.prototype.hasOwnProperty.call(a, b);
}
var Nc = /^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;
function Oc(a, b) {
  if (a) {
    a = a.split("&");
    for (var c = 0; c < a.length; c++) {
      var d = a[c].indexOf("="), e = null;
      if (0 <= d) {
        var f = a[c].substring(0, d);
        e = a[c].substring(d + 1);
      } else
        f = a[c];
      b(f, e ? decodeURIComponent(e.replace(/\+/g, " ")) : "");
    }
  }
}
function U(a, b) {
  this.c = this.j = this.f = "";
  this.h = null;
  this.i = this.g = "";
  this.a = false;
  if (a instanceof U) {
    this.a = b !== void 0 ? b : a.a;
    Pc(this, a.f);
    this.j = a.j;
    Qc(this, a.c);
    Rc(this, a.h);
    this.g = a.g;
    b = a.b;
    var c = new Sc();
    c.c = b.c;
    b.a && (c.a = new S(b.a), c.b = b.b);
    Tc(this, c);
    this.i = a.i;
  } else
    a && (c = String(a).match(Nc)) ? (this.a = !!b, Pc(this, c[1] || "", true), this.j = Uc(c[2] || ""), Qc(this, c[3] || "", true), Rc(this, c[4]), this.g = Uc(c[5] || "", true), Tc(this, c[6] || "", true), this.i = Uc(c[7] || "")) : (this.a = !!b, this.b = new Sc(null, this.a));
}
U.prototype.toString = function() {
  var a = [], b = this.f;
  b && a.push(Vc(b, Wc, true), ":");
  var c = this.c;
  if (c || b == "file")
    a.push("//"), (b = this.j) && a.push(Vc(b, Wc, true), "@"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, "%$1")), c = this.h, c != null && a.push(":", String(c));
  if (c = this.g)
    this.c && c.charAt(0) != "/" && a.push("/"), a.push(Vc(c, c.charAt(0) == "/" ? Xc : Yc, true));
  (c = this.b.toString()) && a.push("?", c);
  (c = this.i) && a.push("#", Vc(c, Zc));
  return a.join("");
};
function N(a) {
  return new U(a);
}
function Pc(a, b, c) {
  a.f = c ? Uc(b, true) : b;
  a.f && (a.f = a.f.replace(/:$/, ""));
}
function Qc(a, b, c) {
  a.c = c ? Uc(b, true) : b;
}
function Rc(a, b) {
  if (b) {
    b = Number(b);
    if (isNaN(b) || 0 > b)
      throw Error("Bad port number " + b);
    a.h = b;
  } else
    a.h = null;
}
function Tc(a, b, c) {
  b instanceof Sc ? (a.b = b, $c(a.b, a.a)) : (c || (b = Vc(b, ad)), a.b = new Sc(b, a.a));
}
function R(a, b, c) {
  a.b.set(b, c);
}
function kc(a) {
  R(a, "zx", Math.floor(2147483648 * Math.random()).toString(36) + Math.abs(Math.floor(2147483648 * Math.random()) ^ q()).toString(36));
  return a;
}
function bd(a) {
  return a instanceof U ? N(a) : new U(a, void 0);
}
function cd(a, b, c, d) {
  var e = new U(null, void 0);
  a && Pc(e, a);
  b && Qc(e, b);
  c && Rc(e, c);
  d && (e.g = d);
  return e;
}
function Uc(a, b) {
  return a ? b ? decodeURI(a.replace(/%25/g, "%2525")) : decodeURIComponent(a) : "";
}
function Vc(a, b, c) {
  return typeof a === "string" ? (a = encodeURI(a).replace(b, dd), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
}
function dd(a) {
  a = a.charCodeAt(0);
  return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
}
var Wc = /[#\/\?@]/g;
var Yc = /[#\?:]/g;
var Xc = /[#\?]/g;
var ad = /[#\?@]/g;
var Zc = /#/g;
function Sc(a, b) {
  this.b = this.a = null;
  this.c = a || null;
  this.f = !!b;
}
function V(a) {
  a.a || (a.a = new S(), a.b = 0, a.c && Oc(a.c, function(b, c) {
    a.add(decodeURIComponent(b.replace(/\+/g, " ")), c);
  }));
}
h = Sc.prototype;
h.add = function(a, b) {
  V(this);
  this.c = null;
  a = W(this, a);
  var c = this.a.get(a);
  c || this.a.set(a, c = []);
  c.push(b);
  this.b += 1;
  return this;
};
function ed(a, b) {
  V(a);
  b = W(a, b);
  T(a.a.b, b) && (a.c = null, a.b -= a.a.get(b).length, a = a.a, T(a.b, b) && (delete a.b[b], a.c--, a.a.length > 2 * a.c && Mc(a)));
}
function fd(a, b) {
  V(a);
  b = W(a, b);
  return T(a.a.b, b);
}
h.forEach = function(a, b) {
  V(this);
  this.a.forEach(function(c, d) {
    na(c, function(e) {
      a.call(b, e, d, this);
    }, this);
  }, this);
};
h.L = function() {
  V(this);
  for (var a = this.a.K(), b = this.a.L(), c = [], d = 0; d < b.length; d++)
    for (var e = a[d], f = 0; f < e.length; f++)
      c.push(b[d]);
  return c;
};
h.K = function(a) {
  V(this);
  var b = [];
  if (typeof a === "string")
    fd(this, a) && (b = qa(b, this.a.get(W(this, a))));
  else {
    a = this.a.K();
    for (var c = 0; c < a.length; c++)
      b = qa(b, a[c]);
  }
  return b;
};
h.set = function(a, b) {
  V(this);
  this.c = null;
  a = W(this, a);
  fd(this, a) && (this.b -= this.a.get(a).length);
  this.a.set(a, [b]);
  this.b += 1;
  return this;
};
h.get = function(a, b) {
  if (!a)
    return b;
  a = this.K(a);
  return 0 < a.length ? String(a[0]) : b;
};
function nc(a, b, c) {
  ed(a, b);
  0 < c.length && (a.c = null, a.a.set(W(a, b), ra(c)), a.b += c.length);
}
h.toString = function() {
  if (this.c)
    return this.c;
  if (!this.a)
    return "";
  for (var a = [], b = this.a.L(), c = 0; c < b.length; c++) {
    var d = b[c], e = encodeURIComponent(String(d));
    d = this.K(d);
    for (var f = 0; f < d.length; f++) {
      var g = e;
      d[f] !== "" && (g += "=" + encodeURIComponent(String(d[f])));
      a.push(g);
    }
  }
  return this.c = a.join("&");
};
function W(a, b) {
  b = String(b);
  a.f && (b = b.toLowerCase());
  return b;
}
function $c(a, b) {
  b && !a.f && (V(a), a.c = null, a.a.forEach(function(c, d) {
    var e = d.toLowerCase();
    d != e && (ed(this, d), nc(this, e, c));
  }, a));
  a.f = b;
}
var gd = function() {
  function gd2(a, b) {
    this.b = a;
    this.a = b;
  }
  return gd2;
}();
function hd(a) {
  this.g = a || id;
  k.PerformanceNavigationTiming ? (a = k.performance.getEntriesByType("navigation"), a = 0 < a.length && (a[0].nextHopProtocol == "hq" || a[0].nextHopProtocol == "h2")) : a = !!(k.ia && k.ia.ya && k.ia.ya() && k.ia.ya().Lb);
  this.f = a ? this.g : 1;
  this.a = null;
  1 < this.f && (this.a = new Set());
  this.b = null;
  this.c = [];
}
var id = 10;
function jd(a) {
  return a.b ? true : a.a ? a.a.size >= a.f : false;
}
function Dc(a) {
  return a.b ? 1 : a.a ? a.a.size : 0;
}
function zc(a, b) {
  return a.b ? a.b == b : a.a ? a.a.has(b) : false;
}
function Ec(a, b) {
  a.a ? a.a.add(b) : a.b = b;
}
function Gc(a, b) {
  a.b && a.b == b ? a.b = null : a.a && a.a.has(b) && a.a.delete(b);
}
hd.prototype.cancel = function() {
  var e_1, _a2;
  this.c = kd(this);
  if (this.b)
    this.b.cancel(), this.b = null;
  else if (this.a && this.a.size !== 0) {
    try {
      for (var _b = __values(this.a.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var a = _c2.value;
        a.cancel();
      }
    } catch (e_1_1) {
      e_1 = {error: e_1_1};
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_1)
          throw e_1.error;
      }
    }
    this.a.clear();
  }
};
function kd(a) {
  var e_2, _a2;
  if (a.b != null)
    return a.c.concat(a.b.s);
  if (a.a != null && a.a.size !== 0) {
    var b = a.c;
    try {
      for (var _b = __values(a.a.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var c = _c2.value;
        b = b.concat(c.s);
      }
    } catch (e_2_1) {
      e_2 = {error: e_2_1};
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_2)
          throw e_2.error;
      }
    }
    return b;
  }
  return ra(a.c);
}
function ld() {
}
ld.prototype.stringify = function(a) {
  return k.JSON.stringify(a, void 0);
};
ld.prototype.parse = function(a) {
  return k.JSON.parse(a, void 0);
};
function md() {
  this.a = new ld();
}
function nd(a, b, c) {
  var d = c || "";
  try {
    Lc(a, function(e, f) {
      var g = e;
      n(e) && (g = ub(e));
      b.push(d + f + "=" + encodeURIComponent(g));
    });
  } catch (e) {
    throw b.push(d + "type=" + encodeURIComponent("_badmap")), e;
  }
}
function od(a, b) {
  var c = new Ob();
  if (k.Image) {
    var d = new Image();
    d.onload = ja(pd, c, d, "TestLoadImage: loaded", true, b);
    d.onerror = ja(pd, c, d, "TestLoadImage: error", false, b);
    d.onabort = ja(pd, c, d, "TestLoadImage: abort", false, b);
    d.ontimeout = ja(pd, c, d, "TestLoadImage: timeout", false, b);
    k.setTimeout(function() {
      if (d.ontimeout)
        d.ontimeout();
    }, 1e4);
    d.src = a;
  } else
    b(false);
}
function pd(a, b, c, d, e) {
  try {
    b.onload = null, b.onerror = null, b.onabort = null, b.ontimeout = null, e(d);
  } catch (f) {
  }
}
var qd = k.JSON.parse;
function X(a) {
  D.call(this);
  this.headers = new S();
  this.H = a || null;
  this.b = false;
  this.s = this.a = null;
  this.B = "";
  this.h = 0;
  this.f = "";
  this.g = this.A = this.l = this.u = false;
  this.o = 0;
  this.m = null;
  this.I = rd;
  this.D = this.F = false;
}
r(X, D);
var rd = "";
var sd = /^https?$/i;
var td = ["POST", "PUT"];
h = X.prototype;
h.ba = function(a, b, c, d) {
  if (this.a)
    throw Error("[goog.net.XhrIo] Object is active with another request=" + this.B + "; newUri=" + a);
  b = b ? b.toUpperCase() : "GET";
  this.B = a;
  this.f = "";
  this.h = 0;
  this.u = false;
  this.b = true;
  this.a = new XMLHttpRequest();
  this.s = this.H ? ac(this.H) : ac(ec);
  this.a.onreadystatechange = p(this.za, this);
  try {
    this.A = true, this.a.open(b, String(a), true), this.A = false;
  } catch (f) {
    ud(this, f);
    return;
  }
  a = c || "";
  var e = new S(this.headers);
  d && Lc(d, function(f, g) {
    e.set(g, f);
  });
  d = oa(e.L());
  c = k.FormData && a instanceof k.FormData;
  !(0 <= ma(td, b)) || d || c || e.set("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
  e.forEach(function(f, g) {
    this.a.setRequestHeader(g, f);
  }, this);
  this.I && (this.a.responseType = this.I);
  "withCredentials" in this.a && this.a.withCredentials !== this.F && (this.a.withCredentials = this.F);
  try {
    vd(this), 0 < this.o && ((this.D = wd(this.a)) ? (this.a.timeout = this.o, this.a.ontimeout = p(this.xa, this)) : this.m = Ib(this.xa, this.o, this)), this.l = true, this.a.send(a), this.l = false;
  } catch (f) {
    ud(this, f);
  }
};
function wd(a) {
  return x && Qa(9) && typeof a.timeout === "number" && a.ontimeout !== void 0;
}
function pa(a) {
  return a.toLowerCase() == "content-type";
}
h.xa = function() {
  typeof goog != "undefined" && this.a && (this.f = "Timed out after " + this.o + "ms, aborting", this.h = 8, E(this, "timeout"), this.abort(8));
};
function ud(a, b) {
  a.b = false;
  a.a && (a.g = true, a.a.abort(), a.g = false);
  a.f = b;
  a.h = 5;
  xd(a);
  yd(a);
}
function xd(a) {
  a.u || (a.u = true, E(a, "complete"), E(a, "error"));
}
h.abort = function(a) {
  this.a && this.b && (this.b = false, this.g = true, this.a.abort(), this.g = false, this.h = a || 7, E(this, "complete"), E(this, "abort"), yd(this));
};
h.G = function() {
  this.a && (this.b && (this.b = false, this.g = true, this.a.abort(), this.g = false), yd(this, true));
  X.X.G.call(this);
};
h.za = function() {
  this.j || (this.A || this.l || this.g ? zd(this) : this.Ua());
};
h.Ua = function() {
  zd(this);
};
function zd(a) {
  if (a.b && typeof goog != "undefined" && (!a.s[1] || O(a) != 4 || a.W() != 2)) {
    if (a.l && O(a) == 4)
      Ib(a.za, 0, a);
    else if (E(a, "readystatechange"), O(a) == 4) {
      a.b = false;
      try {
        {
          var l = a.W();
          a:
            switch (l) {
              case 200:
              case 201:
              case 202:
              case 204:
              case 206:
              case 304:
              case 1223:
                var b = true;
                break a;
              default:
                b = false;
            }
          var c;
          if (!(c = b)) {
            var d;
            if (d = l === 0) {
              var e = String(a.B).match(Nc)[1] || null;
              if (!e && k.self && k.self.location) {
                var f = k.self.location.protocol;
                e = f.substr(0, f.length - 1);
              }
              d = !sd.test(e ? e.toLowerCase() : "");
            }
            c = d;
          }
          var g = c;
        }
        if (g)
          E(a, "complete"), E(a, "success");
        else {
          a.h = 6;
          try {
            var m = 2 < O(a) ? a.a.statusText : "";
          } catch (l2) {
            m = "";
          }
          a.f = m + " [" + a.W() + "]";
          xd(a);
        }
      } finally {
        yd(a);
      }
    }
  }
}
function yd(a, b) {
  if (a.a) {
    vd(a);
    var c = a.a, d = a.s[0] ? aa : null;
    a.a = null;
    a.s = null;
    b || E(a, "ready");
    try {
      c.onreadystatechange = d;
    } catch (e) {
    }
  }
}
function vd(a) {
  a.a && a.D && (a.a.ontimeout = null);
  a.m && (k.clearTimeout(a.m), a.m = null);
}
function O(a) {
  return a.a ? a.a.readyState : 0;
}
h.W = function() {
  try {
    return 2 < O(this) ? this.a.status : -1;
  } catch (a) {
    return -1;
  }
};
h.$ = function() {
  try {
    return this.a ? this.a.responseText : "";
  } catch (a) {
    return "";
  }
};
h.Pa = function(a) {
  if (this.a) {
    var b = this.a.responseText;
    a && b.indexOf(a) == 0 && (b = b.substring(a.length));
    return qd(b);
  }
};
h.ua = function() {
  return this.h;
};
h.Qa = function() {
  return typeof this.f === "string" ? this.f : String(this.f);
};
function Ad(a) {
  var b = "";
  za(a, function(c, d) {
    b += d;
    b += ":";
    b += c;
    b += "\r\n";
  });
  return b;
}
function Bd(a, b, c) {
  a: {
    for (d in c) {
      var d = false;
      break a;
    }
    d = true;
  }
  d || (c = Ad(c), typeof a === "string" ? c != null && encodeURIComponent(String(c)) : R(a, b, c));
}
function Cd(a, b, c) {
  return c && c.internalChannelParams ? c.internalChannelParams[a] || b : b;
}
function Dd(a) {
  this.pa = 0;
  this.g = [];
  this.c = new Ob();
  this.ga = this.la = this.B = this.fa = this.a = this.na = this.A = this.V = this.i = this.O = this.l = null;
  this.Oa = this.R = 0;
  this.La = Cd("failFast", false, a);
  this.H = this.m = this.j = this.h = this.f = null;
  this.S = true;
  this.I = this.oa = this.P = -1;
  this.T = this.o = this.u = 0;
  this.Ha = Cd("baseRetryDelayMs", 5e3, a);
  this.Ra = Cd("retryDelaySeedMs", 1e4, a);
  this.Ma = Cd("forwardChannelMaxRetries", 2, a);
  this.ma = Cd("forwardChannelRequestTimeoutMs", 2e4, a);
  this.Na = a && a.g || void 0;
  this.D = void 0;
  this.C = a && a.supportsCrossDomainXhr || false;
  this.J = "";
  this.b = new hd(a && a.concurrentRequestLimit);
  this.ka = new md();
  this.da = a && a.fastHandshake || false;
  this.Ia = a && a.b || false;
  a && a.f && (this.c.a = false);
  a && a.forceLongPolling && (this.S = false);
  this.U = !this.da && this.S && a && a.detectBufferingProxy || false;
  this.ea = void 0;
  this.N = 0;
  this.F = false;
  this.s = null;
  (this.Ka = a && a.c || false) && this.c.info("Opt-in to enable Chrome Origin Trials.");
}
h = Dd.prototype;
h.ha = 8;
h.v = 1;
function Jc(a) {
  Ed(a);
  if (a.v == 3) {
    var b = a.R++, c = N(a.B);
    R(c, "SID", a.J);
    R(c, "RID", b);
    R(c, "TYPE", "terminate");
    Fd(a, c);
    b = new M(a, a.c, b, void 0);
    b.H = 2;
    b.i = kc(N(c));
    c = false;
    k.navigator && k.navigator.sendBeacon && (c = k.navigator.sendBeacon(b.i.toString(), ""));
    !c && k.Image && (new Image().src = b.i, c = true);
    c || (b.a = oc(b.g, null), b.a.ba(b.i));
    b.u = q();
    mc(b);
  }
  Gd(a);
}
function Bc(a) {
  a.a && (wc(a), a.a.cancel(), a.a = null);
}
function Ed(a) {
  Bc(a);
  a.j && (k.clearTimeout(a.j), a.j = null);
  Ac(a);
  a.b.cancel();
  a.h && (typeof a.h === "number" && k.clearTimeout(a.h), a.h = null);
}
function Hd(a, b) {
  a.g.push(new gd(a.Oa++, b));
  a.v == 3 && Ic(a);
}
function Ic(a) {
  jd(a.b) || a.h || (a.h = true, Bb(a.Ba, a), a.u = 0);
}
function Id(a, b) {
  if (Dc(a.b) >= a.b.f - (a.h ? 1 : 0))
    return false;
  if (a.h)
    return a.g = b.s.concat(a.g), true;
  if (a.v == 1 || a.v == 2 || a.u >= (a.La ? 0 : a.Ma))
    return false;
  a.h = K(p(a.Ba, a, b), Jd(a, a.u));
  a.u++;
  return true;
}
h.Ba = function(a) {
  if (this.h)
    if (this.h = null, this.v == 1) {
      if (!a) {
        this.R = Math.floor(1e5 * Math.random());
        a = this.R++;
        var b = new M(this, this.c, a, void 0), c = this.l;
        this.O && (c ? (c = Aa(c), Ca(c, this.O)) : c = this.O);
        this.i === null && (b.B = c);
        var d;
        if (this.da)
          a: {
            for (var e = d = 0; e < this.g.length; e++) {
              b: {
                var f = this.g[e];
                if ("__data__" in f.a && (f = f.a.__data__, typeof f === "string")) {
                  f = f.length;
                  break b;
                }
                f = void 0;
              }
              if (f === void 0)
                break;
              d += f;
              if (4096 < d) {
                d = e;
                break a;
              }
              if (d === 4096 || e === this.g.length - 1) {
                d = e + 1;
                break a;
              }
            }
            d = 1e3;
          }
        else
          d = 1e3;
        d = Kd(this, b, d);
        e = N(this.B);
        R(e, "RID", a);
        R(e, "CVER", 22);
        this.A && R(e, "X-HTTP-Session-Id", this.A);
        Fd(this, e);
        this.i && c && Bd(e, this.i, c);
        Ec(this.b, b);
        this.Ia && R(e, "TYPE", "init");
        this.da ? (R(e, "$req", d), R(e, "SID", "null"), b.U = true, jc(b, e, null)) : jc(b, e, d);
        this.v = 2;
      }
    } else
      this.v == 3 && (a ? Ld(this, a) : this.g.length == 0 || jd(this.b) || Ld(this));
};
function Ld(a, b) {
  var c;
  b ? c = b.f : c = a.R++;
  var d = N(a.B);
  R(d, "SID", a.J);
  R(d, "RID", c);
  R(d, "AID", a.P);
  Fd(a, d);
  a.i && a.l && Bd(d, a.i, a.l);
  c = new M(a, a.c, c, a.u + 1);
  a.i === null && (c.B = a.l);
  b && (a.g = b.s.concat(a.g));
  b = Kd(a, c, 1e3);
  c.setTimeout(Math.round(0.5 * a.ma) + Math.round(0.5 * a.ma * Math.random()));
  Ec(a.b, c);
  jc(c, d, b);
}
function Fd(a, b) {
  a.f && Lc({}, function(c, d) {
    R(b, d, c);
  });
}
function Kd(a, b, c) {
  c = Math.min(a.g.length, c);
  var d = a.f ? p(a.f.Ja, a.f, a) : null;
  a:
    for (var e = a.g, f = -1; ; ) {
      var g = ["count=" + c];
      f == -1 ? 0 < c ? (f = e[0].b, g.push("ofs=" + f)) : f = 0 : g.push("ofs=" + f);
      for (var m = true, l = 0; l < c; l++) {
        var u = e[l].b, C2 = e[l].a;
        u -= f;
        if (0 > u)
          f = Math.max(0, e[l].b - 100), m = false;
        else
          try {
            nd(C2, g, "req" + u + "_");
          } catch (B2) {
            d && d(C2);
          }
      }
      if (m) {
        d = g.join("&");
        break a;
      }
    }
  a = a.g.splice(0, c);
  b.s = a;
  return d;
}
function Hc(a) {
  a.a || a.j || (a.T = 1, Bb(a.Aa, a), a.o = 0);
}
function Cc(a) {
  if (a.a || a.j || 3 <= a.o)
    return false;
  a.T++;
  a.j = K(p(a.Aa, a), Jd(a, a.o));
  a.o++;
  return true;
}
h.Aa = function() {
  this.j = null;
  Md(this);
  if (this.U && !(this.F || this.a == null || 0 >= this.N)) {
    var a = 2 * this.N;
    this.c.info("BP detection timer enabled: " + a);
    this.s = K(p(this.Ta, this), a);
  }
};
h.Ta = function() {
  this.s && (this.s = null, this.c.info("BP detection timeout reached."), this.c.info("Buffering proxy detected and switch to long-polling!"), this.H = false, this.F = true, J(10), Bc(this), Md(this));
};
function wc(a) {
  a.s != null && (k.clearTimeout(a.s), a.s = null);
}
function Md(a) {
  a.a = new M(a, a.c, "rpc", a.T);
  a.i === null && (a.a.B = a.l);
  a.a.O = 0;
  var b = N(a.la);
  R(b, "RID", "rpc");
  R(b, "SID", a.J);
  R(b, "CI", a.H ? "0" : "1");
  R(b, "AID", a.P);
  Fd(a, b);
  R(b, "TYPE", "xmlhttp");
  a.i && a.l && Bd(b, a.i, a.l);
  a.D && a.a.setTimeout(a.D);
  var c = a.a;
  a = a.ga;
  c.H = 1;
  c.i = kc(N(b));
  c.j = null;
  c.I = true;
  lc(c, a);
}
h.Sa = function() {
  this.m != null && (this.m = null, Bc(this), Cc(this), J(19));
};
function Ac(a) {
  a.m != null && (k.clearTimeout(a.m), a.m = null);
}
function uc(a, b) {
  var c = null;
  if (a.a == b) {
    Ac(a);
    wc(a);
    a.a = null;
    var d = 2;
  } else if (zc(a.b, b))
    c = b.s, Gc(a.b, b), d = 1;
  else
    return;
  a.I = b.N;
  if (a.v != 0) {
    if (b.b)
      if (d == 1) {
        c = b.j ? b.j.length : 0;
        b = q() - b.u;
        var e = a.u;
        d = Ub();
        E(d, new Xb(d, c, b, e));
        Ic(a);
      } else
        Hc(a);
    else if (e = b.h, e == 3 || e == 0 && 0 < a.I || !(d == 1 && Id(a, b) || d == 2 && Cc(a)))
      switch (c && 0 < c.length && (b = a.b, b.c = b.c.concat(c)), e) {
        case 1:
          Q(a, 5);
          break;
        case 4:
          Q(a, 10);
          break;
        case 3:
          Q(a, 6);
          break;
        default:
          Q(a, 2);
      }
  }
}
function Jd(a, b) {
  var c = a.Ha + Math.floor(Math.random() * a.Ra);
  a.f || (c *= 2);
  return c * b;
}
function Q(a, b) {
  a.c.info("Error code " + b);
  if (b == 2) {
    var c = null;
    a.f && (c = null);
    var d = p(a.Ya, a);
    c || (c = new U("//www.google.com/images/cleardot.gif"), k.location && k.location.protocol == "http" || Pc(c, "https"), kc(c));
    od(c.toString(), d);
  } else
    J(2);
  a.v = 0;
  a.f && a.f.ra(b);
  Gd(a);
  Ed(a);
}
h.Ya = function(a) {
  a ? (this.c.info("Successfully pinged google.com"), J(2)) : (this.c.info("Failed to ping google.com"), J(1));
};
function Gd(a) {
  a.v = 0;
  a.I = -1;
  if (a.f) {
    if (kd(a.b).length != 0 || a.g.length != 0)
      a.b.c.length = 0, ra(a.g), a.g.length = 0;
    a.f.qa();
  }
}
function Fc(a, b, c) {
  var d = bd(c);
  if (d.c != "")
    b && Qc(d, b + "." + d.c), Rc(d, d.h);
  else {
    var e = k.location;
    d = cd(e.protocol, b ? b + "." + e.hostname : e.hostname, +e.port, c);
  }
  a.V && za(a.V, function(f, g) {
    R(d, g, f);
  });
  b = a.A;
  c = a.na;
  b && c && R(d, b, c);
  R(d, "VER", a.ha);
  Fd(a, d);
  return d;
}
function oc(a, b) {
  if (b && !a.C)
    throw Error("Can't create secondary domain capable XhrIo object.");
  b = new X(a.Na);
  b.F = a.C;
  return b;
}
function Nd() {
}
h = Nd.prototype;
h.ta = function() {
};
h.sa = function() {
};
h.ra = function() {
};
h.qa = function() {
};
h.Ja = function() {
};
function Od() {
  if (x && !(10 <= Number(Ta)))
    throw Error("Environmental error: no available transport.");
}
Od.prototype.a = function(a, b) {
  return new Y(a, b);
};
function Y(a, b) {
  D.call(this);
  this.a = new Dd(b);
  this.o = a;
  this.b = b && b.messageUrlParams || null;
  a = b && b.messageHeaders || null;
  b && b.clientProtocolHeaderRequired && (a ? a["X-Client-Protocol"] = "webchannel" : a = {"X-Client-Protocol": "webchannel"});
  this.a.l = a;
  a = b && b.initMessageHeaders || null;
  b && b.messageContentType && (a ? a["X-WebChannel-Content-Type"] = b.messageContentType : a = {"X-WebChannel-Content-Type": b.messageContentType});
  b && b.a && (a ? a["X-WebChannel-Client-Profile"] = b.a : a = {"X-WebChannel-Client-Profile": b.a});
  this.a.O = a;
  (a = b && b.httpHeadersOverwriteParam) && !sa(a) && (this.a.i = a);
  this.m = b && b.supportsCrossDomainXhr || false;
  this.l = b && b.sendRawJson || false;
  (b = b && b.httpSessionIdParam) && !sa(b) && (this.a.A = b, a = this.b, a !== null && b in a && (a = this.b, b in a && delete a[b]));
  this.f = new Z(this);
}
r(Y, D);
Y.prototype.g = function() {
  this.a.f = this.f;
  this.m && (this.a.C = true);
  var a = this.a, b = this.o, c = this.b || void 0;
  J(0);
  a.fa = b;
  a.V = c || {};
  a.H = a.S;
  a.B = Fc(a, null, a.fa);
  Ic(a);
};
Y.prototype.close = function() {
  Jc(this.a);
};
Y.prototype.h = function(a) {
  if (typeof a === "string") {
    var b = {};
    b.__data__ = a;
    Hd(this.a, b);
  } else
    this.l ? (b = {}, b.__data__ = ub(a), Hd(this.a, b)) : Hd(this.a, a);
};
Y.prototype.G = function() {
  this.a.f = null;
  delete this.f;
  Jc(this.a);
  delete this.a;
  Y.X.G.call(this);
};
function Pd(a) {
  cc.call(this);
  var b = a.__sm__;
  if (b) {
    a: {
      for (var c in b) {
        a = c;
        break a;
      }
      a = void 0;
    }
    (this.c = a) ? (a = this.c, this.data = b !== null && a in b ? b[a] : void 0) : this.data = b;
  } else
    this.data = a;
}
r(Pd, cc);
function Qd() {
  dc.call(this);
  this.status = 1;
}
r(Qd, dc);
function Z(a) {
  this.a = a;
}
r(Z, Nd);
Z.prototype.ta = function() {
  E(this.a, "a");
};
Z.prototype.sa = function(a) {
  E(this.a, new Pd(a));
};
Z.prototype.ra = function(a) {
  E(this.a, new Qd(a));
};
Z.prototype.qa = function() {
  E(this.a, "b");
};
Od.prototype.createWebChannel = Od.prototype.a;
Y.prototype.send = Y.prototype.h;
Y.prototype.open = Y.prototype.g;
Y.prototype.close = Y.prototype.close;
Yb.NO_ERROR = 0;
Yb.TIMEOUT = 8;
Yb.HTTP_ERROR = 6;
Zb.COMPLETE = "complete";
bc.EventType = L;
L.OPEN = "a";
L.CLOSE = "b";
L.ERROR = "c";
L.MESSAGE = "d";
D.prototype.listen = D.prototype.va;
X.prototype.listenOnce = X.prototype.wa;
X.prototype.getLastError = X.prototype.Qa;
X.prototype.getLastErrorCode = X.prototype.ua;
X.prototype.getStatus = X.prototype.W;
X.prototype.getResponseJson = X.prototype.Pa;
X.prototype.getResponseText = X.prototype.$;
X.prototype.send = X.prototype.ba;
var createWebChannelTransport = function() {
  return new Od();
};
var getStatEventTarget = function() {
  return Ub();
};
var ErrorCode = Yb;
var EventType = Zb;
var Event = H;
var Stat = {gb: 0, jb: 1, kb: 2, Db: 3, Ib: 4, Fb: 5, Gb: 6, Eb: 7, Cb: 8, Hb: 9, PROXY: 10, NOPROXY: 11, Ab: 12, wb: 13, xb: 14, vb: 15, yb: 16, zb: 17, bb: 18, ab: 19, cb: 20};
var WebChannel = bc;
var XhrIo = X;

// node_modules/@firebase/firestore/dist/esm5/prebuilt-67479dbf-318e5a2c.js
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _ = function(t2, e, n2, r2, i, o) {
  this.t = t2, this.persistenceKey = e, this.host = n2, this.ssl = r2, this.forceLongPolling = i, this.i = o;
};
var I2 = function() {
  function t2(t3, e) {
    this.projectId = t3, this.database = e || "(default)";
  }
  return Object.defineProperty(t2.prototype, "o", {
    get: function() {
      return this.database === "(default)";
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return e instanceof t2 && e.projectId === this.projectId && e.database === this.database;
  }, t2;
}();
var E2 = new Logger("@firebase/firestore");
function T2() {
  return E2.logLevel;
}
function N2(t2) {
  for (var n2 = [], r2 = 1; r2 < arguments.length; r2++)
    n2[r2 - 1] = arguments[r2];
  if (E2.logLevel <= LogLevel.DEBUG) {
    var i = n2.map(S2);
    E2.debug.apply(E2, __spreadArrays(["Firestore (8.2.9): " + t2], i));
  }
}
function A2(t2) {
  for (var n2 = [], r2 = 1; r2 < arguments.length; r2++)
    n2[r2 - 1] = arguments[r2];
  if (E2.logLevel <= LogLevel.ERROR) {
    var i = n2.map(S2);
    E2.error.apply(E2, __spreadArrays(["Firestore (8.2.9): " + t2], i));
  }
}
function D2(t2) {
  for (var n2 = [], r2 = 1; r2 < arguments.length; r2++)
    n2[r2 - 1] = arguments[r2];
  if (E2.logLevel <= LogLevel.WARN) {
    var i = n2.map(S2);
    E2.warn.apply(E2, __spreadArrays(["Firestore (8.2.9): " + t2], i));
  }
}
function S2(t2) {
  if (typeof t2 == "string")
    return t2;
  try {
    return e = t2, JSON.stringify(e);
  } catch (e2) {
    return t2;
  }
  /**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
  var e;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function x2(t2) {
  t2 === void 0 && (t2 = "Unexpected state");
  var e = "FIRESTORE (8.2.9) INTERNAL ASSERTION FAILED: " + t2;
  throw A2(e), new Error(e);
}
function k2(t2, e) {
  t2 || x2();
}
function O2(t2, e) {
  return t2;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function P2(t2) {
  var e = typeof self != "undefined" && (self.crypto || self.msCrypto), n2 = new Uint8Array(t2);
  if (e && typeof e.getRandomValues == "function")
    e.getRandomValues(n2);
  else
    for (var r2 = 0; r2 < t2; r2++)
      n2[r2] = Math.floor(256 * Math.random());
  return n2;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var V2 = function() {
  function t2() {
  }
  return t2.u = function() {
    for (var t3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", e = Math.floor(256 / t3.length) * t3.length, n2 = ""; n2.length < 20; )
      for (var r2 = P2(40), i = 0; i < r2.length; ++i)
        n2.length < 20 && r2[i] < e && (n2 += t3.charAt(r2[i] % t3.length));
    return n2;
  }, t2;
}();
function C(t2, e) {
  return t2 < e ? -1 : t2 > e ? 1 : 0;
}
function L2(t2, e, n2) {
  return t2.length === e.length && t2.every(function(t3, r2) {
    return n2(t3, e[r2]);
  });
}
function R2(t2) {
  return t2 + "\0";
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var U2 = function() {
  function t2(t3) {
    this.h = t3;
  }
  return t2.fromBase64String = function(e) {
    return new t2(atob(e));
  }, t2.fromUint8Array = function(e) {
    return new t2(function(t3) {
      for (var e2 = "", n2 = 0; n2 < t3.length; ++n2)
        e2 += String.fromCharCode(t3[n2]);
      return e2;
    }(e));
  }, t2.prototype.toBase64 = function() {
    return t3 = this.h, btoa(t3);
    var t3;
  }, t2.prototype.toUint8Array = function() {
    return function(t3) {
      for (var e = new Uint8Array(t3.length), n2 = 0; n2 < t3.length; n2++)
        e[n2] = t3.charCodeAt(n2);
      return e;
    }(this.h);
  }, t2.prototype.l = function() {
    return 2 * this.h.length;
  }, t2.prototype._ = function(t3) {
    return C(this.h, t3.h);
  }, t2.prototype.isEqual = function(t3) {
    return this.h === t3.h;
  }, t2;
}();
U2.T = new U2("");
var M2 = {
  OK: "ok",
  CANCELLED: "cancelled",
  UNKNOWN: "unknown",
  INVALID_ARGUMENT: "invalid-argument",
  DEADLINE_EXCEEDED: "deadline-exceeded",
  NOT_FOUND: "not-found",
  ALREADY_EXISTS: "already-exists",
  PERMISSION_DENIED: "permission-denied",
  UNAUTHENTICATED: "unauthenticated",
  RESOURCE_EXHAUSTED: "resource-exhausted",
  FAILED_PRECONDITION: "failed-precondition",
  ABORTED: "aborted",
  OUT_OF_RANGE: "out-of-range",
  UNIMPLEMENTED: "unimplemented",
  INTERNAL: "internal",
  UNAVAILABLE: "unavailable",
  DATA_LOSS: "data-loss"
};
var q2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).code = e2, r2.message = n2, r2.name = "FirebaseError", r2.toString = function() {
      return r2.name + ": [code=" + r2.code + "]: " + r2.message;
    }, r2;
  }
  return __extends(e, t2), e;
}(Error);
var F2 = function() {
  function t2(t3) {
    this.I = t3;
  }
  return t2.fromBase64String = function(e) {
    try {
      return new t2(U2.fromBase64String(e));
    } catch (e2) {
      throw new q2(M2.INVALID_ARGUMENT, "Failed to construct data from Base64 string: " + e2);
    }
  }, t2.fromUint8Array = function(e) {
    return new t2(U2.fromUint8Array(e));
  }, t2.prototype.toBase64 = function() {
    return this.I.toBase64();
  }, t2.prototype.toUint8Array = function() {
    return this.I.toUint8Array();
  }, t2.prototype.toString = function() {
    return "Bytes(base64: " + this.toBase64() + ")";
  }, t2.prototype.isEqual = function(t3) {
    return this.I.isEqual(t3.I);
  }, t2;
}();
var j = function() {
  function t2(t3) {
    this.uid = t3;
  }
  return t2.prototype.m = function() {
    return this.uid != null;
  }, t2.prototype.A = function() {
    return this.m() ? "uid:" + this.uid : "anonymous-user";
  }, t2.prototype.isEqual = function(t3) {
    return t3.uid === this.uid;
  }, t2;
}();
j.UNAUTHENTICATED = new j(null), j.R = new j("google-credentials-uid"), j.P = new j("first-party-uid");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var z2 = function(t2, e) {
  this.user = e, this.type = "OAuth", this.g = {}, this.g.Authorization = "Bearer " + t2;
};
var G2 = function() {
  function t2() {
    this.V = null;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(null);
  }, t2.prototype.p = function() {
  }, t2.prototype.v = function(t3) {
    this.V = t3, t3(j.UNAUTHENTICATED);
  }, t2.prototype.S = function() {
    this.V = null;
  }, t2;
}();
var B = function() {
  function t2(t3) {
    var e = this;
    this.D = null, this.currentUser = j.UNAUTHENTICATED, this.C = false, this.N = 0, this.V = null, this.forceRefresh = false, this.D = function() {
      e.N++, e.currentUser = e.$(), e.C = true, e.V && e.V(e.currentUser);
    }, this.N = 0, this.auth = t3.getImmediate({
      optional: true
    }), this.auth ? this.auth.addAuthTokenListener(this.D) : (this.D(null), t3.get().then(function(t4) {
      e.auth = t4, e.D && e.auth.addAuthTokenListener(e.D);
    }, function() {
    }));
  }
  return t2.prototype.getToken = function() {
    var t3 = this, e = this.N, n2 = this.forceRefresh;
    return this.forceRefresh = false, this.auth ? this.auth.getToken(n2).then(function(n3) {
      return t3.N !== e ? (N2("FirebaseCredentialsProvider", "getToken aborted due to token change."), t3.getToken()) : n3 ? (k2(typeof n3.accessToken == "string"), new z2(n3.accessToken, t3.currentUser)) : null;
    }) : Promise.resolve(null);
  }, t2.prototype.p = function() {
    this.forceRefresh = true;
  }, t2.prototype.v = function(t3) {
    this.V = t3, this.C && t3(this.currentUser);
  }, t2.prototype.S = function() {
    this.auth && this.auth.removeAuthTokenListener(this.D), this.D = null, this.V = null;
  }, t2.prototype.$ = function() {
    var t3 = this.auth && this.auth.getUid();
    return k2(t3 === null || typeof t3 == "string"), new j(t3);
  }, t2;
}();
var Q2 = function() {
  function t2(t3, e) {
    this.F = t3, this.O = e, this.type = "FirstParty", this.user = j.P;
  }
  return Object.defineProperty(t2.prototype, "g", {
    get: function() {
      var t3 = {
        "X-Goog-AuthUser": this.O
      }, e = this.F.auth.getAuthHeaderValueForFirstParty([]);
      return e && (t3.Authorization = e), t3;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var Y2 = function() {
  function t2(t3, e) {
    this.F = t3, this.O = e;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(new Q2(this.F, this.O));
  }, t2.prototype.v = function(t3) {
    t3(j.P);
  }, t2.prototype.S = function() {
  }, t2.prototype.p = function() {
  }, t2;
}();
var H2 = function() {
  function t2(t3, e) {
    var n2 = this;
    this.previousValue = t3, e && (e.k = function(t4) {
      return n2.M(t4);
    }, this.L = function(t4) {
      return e.B(t4);
    });
  }
  return t2.prototype.M = function(t3) {
    return this.previousValue = Math.max(t3, this.previousValue), this.previousValue;
  }, t2.prototype.next = function() {
    var t3 = ++this.previousValue;
    return this.L && this.L(t3), t3;
  }, t2;
}();
H2.q = -1;
var K2 = function() {
  function t2(t3, e) {
    if (this.seconds = t3, this.nanoseconds = e, e < 0)
      throw new q2(M2.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (e >= 1e9)
      throw new q2(M2.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (t3 < -62135596800)
      throw new q2(M2.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
    if (t3 >= 253402300800)
      throw new q2(M2.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
  }
  return t2.now = function() {
    return t2.fromMillis(Date.now());
  }, t2.fromDate = function(e) {
    return t2.fromMillis(e.getTime());
  }, t2.fromMillis = function(e) {
    var n2 = Math.floor(e / 1e3);
    return new t2(n2, 1e6 * (e - 1e3 * n2));
  }, t2.prototype.toDate = function() {
    return new Date(this.toMillis());
  }, t2.prototype.toMillis = function() {
    return 1e3 * this.seconds + this.nanoseconds / 1e6;
  }, t2.prototype.U = function(t3) {
    return this.seconds === t3.seconds ? C(this.nanoseconds, t3.nanoseconds) : C(this.seconds, t3.seconds);
  }, t2.prototype.isEqual = function(t3) {
    return t3.seconds === this.seconds && t3.nanoseconds === this.nanoseconds;
  }, t2.prototype.toString = function() {
    return "Timestamp(seconds=" + this.seconds + ", nanoseconds=" + this.nanoseconds + ")";
  }, t2.prototype.toJSON = function() {
    return {
      seconds: this.seconds,
      nanoseconds: this.nanoseconds
    };
  }, t2.prototype.valueOf = function() {
    var t3 = this.seconds - -62135596800;
    return String(t3).padStart(12, "0") + "." + String(this.nanoseconds).padStart(9, "0");
  }, t2;
}();
var X2 = function() {
  function t2(t3) {
    this.timestamp = t3;
  }
  return t2.K = function(e) {
    return new t2(e);
  }, t2.min = function() {
    return new t2(new K2(0, 0));
  }, t2.prototype._ = function(t3) {
    return this.timestamp.U(t3.timestamp);
  }, t2.prototype.isEqual = function(t3) {
    return this.timestamp.isEqual(t3.timestamp);
  }, t2.prototype.W = function() {
    return 1e6 * this.timestamp.seconds + this.timestamp.nanoseconds / 1e3;
  }, t2.prototype.toString = function() {
    return "SnapshotVersion(" + this.timestamp.toString() + ")";
  }, t2.prototype.j = function() {
    return this.timestamp;
  }, t2;
}();
var W2 = function() {
  function t2(t3, e, n2) {
    e === void 0 ? e = 0 : e > t3.length && x2(), n2 === void 0 ? n2 = t3.length - e : n2 > t3.length - e && x2(), this.segments = t3, this.offset = e, this.G = n2;
  }
  return Object.defineProperty(t2.prototype, "length", {
    get: function() {
      return this.G;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return t2.H(this, e) === 0;
  }, t2.prototype.child = function(e) {
    var n2 = this.segments.slice(this.offset, this.limit());
    return e instanceof t2 ? e.forEach(function(t3) {
      n2.push(t3);
    }) : n2.push(e), this.J(n2);
  }, t2.prototype.limit = function() {
    return this.offset + this.length;
  }, t2.prototype.Y = function(t3) {
    return t3 = t3 === void 0 ? 1 : t3, this.J(this.segments, this.offset + t3, this.length - t3);
  }, t2.prototype.X = function() {
    return this.J(this.segments, this.offset, this.length - 1);
  }, t2.prototype.Z = function() {
    return this.segments[this.offset];
  }, t2.prototype.tt = function() {
    return this.get(this.length - 1);
  }, t2.prototype.get = function(t3) {
    return this.segments[this.offset + t3];
  }, t2.prototype.et = function() {
    return this.length === 0;
  }, t2.prototype.nt = function(t3) {
    if (t3.length < this.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.st = function(t3) {
    if (this.length + 1 !== t3.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.forEach = function(t3) {
    for (var e = this.offset, n2 = this.limit(); e < n2; e++)
      t3(this.segments[e]);
  }, t2.prototype.it = function() {
    return this.segments.slice(this.offset, this.limit());
  }, t2.H = function(t3, e) {
    for (var n2 = Math.min(t3.length, e.length), r2 = 0; r2 < n2; r2++) {
      var i = t3.get(r2), o = e.get(r2);
      if (i < o)
        return -1;
      if (i > o)
        return 1;
    }
    return t3.length < e.length ? -1 : t3.length > e.length ? 1 : 0;
  }, t2;
}();
var Z2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.J = function(t3, n2, r2) {
    return new e(t3, n2, r2);
  }, e.prototype.rt = function() {
    return this.it().join("/");
  }, e.prototype.toString = function() {
    return this.rt();
  }, e.ot = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    for (var r2 = [], i = 0, o = t3; i < o.length; i++) {
      var u = o[i];
      if (u.indexOf("//") >= 0)
        throw new q2(M2.INVALID_ARGUMENT, "Invalid segment (" + u + "). Paths must not contain // in them.");
      r2.push.apply(r2, u.split("/").filter(function(t4) {
        return t4.length > 0;
      }));
    }
    return new e(r2);
  }, e.ct = function() {
    return new e([]);
  }, e;
}(W2);
var J2 = /^[_a-zA-Z][_a-zA-Z0-9]*$/;
var $ = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.J = function(t3, n2, r2) {
    return new e(t3, n2, r2);
  }, e.at = function(t3) {
    return J2.test(t3);
  }, e.prototype.rt = function() {
    return this.it().map(function(t3) {
      return t3 = t3.replace(/\\/g, "\\\\").replace(/`/g, "\\`"), e.at(t3) || (t3 = "`" + t3 + "`"), t3;
    }).join(".");
  }, e.prototype.toString = function() {
    return this.rt();
  }, e.prototype.ut = function() {
    return this.length === 1 && this.get(0) === "__name__";
  }, e.ht = function() {
    return new e(["__name__"]);
  }, e.lt = function(t3) {
    for (var n2 = [], r2 = "", i = 0, o = function() {
      if (r2.length === 0)
        throw new q2(M2.INVALID_ARGUMENT, "Invalid field path (" + t3 + "). Paths must not be empty, begin with '.', end with '.', or contain '..'");
      n2.push(r2), r2 = "";
    }, u = false; i < t3.length; ) {
      var s = t3[i];
      if (s === "\\") {
        if (i + 1 === t3.length)
          throw new q2(M2.INVALID_ARGUMENT, "Path has trailing escape character: " + t3);
        var a = t3[i + 1];
        if (a !== "\\" && a !== "." && a !== "`")
          throw new q2(M2.INVALID_ARGUMENT, "Path has invalid escape sequence: " + t3);
        r2 += a, i += 2;
      } else
        s === "`" ? (u = !u, i++) : s !== "." || u ? (r2 += s, i++) : (o(), i++);
    }
    if (o(), u)
      throw new q2(M2.INVALID_ARGUMENT, "Unterminated ` in path: " + t3);
    return new e(n2);
  }, e.ct = function() {
    return new e([]);
  }, e;
}(W2);
var tt = function() {
  function t2(t3) {
    this.path = t3;
  }
  return t2._t = function(e) {
    return new t2(Z2.ot(e));
  }, t2.ft = function(e) {
    return new t2(Z2.ot(e).Y(5));
  }, t2.prototype.dt = function(t3) {
    return this.path.length >= 2 && this.path.get(this.path.length - 2) === t3;
  }, t2.prototype.isEqual = function(t3) {
    return t3 !== null && Z2.H(this.path, t3.path) === 0;
  }, t2.prototype.toString = function() {
    return this.path.toString();
  }, t2.H = function(t3, e) {
    return Z2.H(t3.path, e.path);
  }, t2.wt = function(t3) {
    return t3.length % 2 == 0;
  }, t2.Et = function(e) {
    return new t2(new Z2(e.slice()));
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function et(t2) {
  var e = 0;
  for (var n2 in t2)
    Object.prototype.hasOwnProperty.call(t2, n2) && e++;
  return e;
}
function nt(t2, e) {
  for (var n2 in t2)
    Object.prototype.hasOwnProperty.call(t2, n2) && e(n2, t2[n2]);
}
function rt(t2) {
  for (var e in t2)
    if (Object.prototype.hasOwnProperty.call(t2, e))
      return false;
  return true;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var it = function() {
  function t2(t3) {
    this.fields = t3, t3.sort($.H);
  }
  return t2.prototype.Tt = function(t3) {
    for (var e = 0, n2 = this.fields; e < n2.length; e++) {
      if (n2[e].nt(t3))
        return true;
    }
    return false;
  }, t2.prototype.isEqual = function(t3) {
    return L2(this.fields, t3.fields, function(t4, e) {
      return t4.isEqual(e);
    });
  }, t2;
}();
var ot = new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ut(t2) {
  if (k2(!!t2), typeof t2 == "string") {
    var e = 0, n2 = ot.exec(t2);
    if (k2(!!n2), n2[1]) {
      var r2 = n2[1];
      r2 = (r2 + "000000000").substr(0, 9), e = Number(r2);
    }
    var i = new Date(t2);
    return {
      seconds: Math.floor(i.getTime() / 1e3),
      nanos: e
    };
  }
  return {
    seconds: st(t2.seconds),
    nanos: st(t2.nanos)
  };
}
function st(t2) {
  return typeof t2 == "number" ? t2 : typeof t2 == "string" ? Number(t2) : 0;
}
function at(t2) {
  return typeof t2 == "string" ? U2.fromBase64String(t2) : U2.fromUint8Array(t2);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ct(t2) {
  var e, n2;
  return ((n2 = (((e = t2 == null ? void 0 : t2.mapValue) === null || e === void 0 ? void 0 : e.fields) || {}).__type__) === null || n2 === void 0 ? void 0 : n2.stringValue) === "server_timestamp";
}
function ht(t2) {
  var e = t2.mapValue.fields.__previous_value__;
  return ct(e) ? ht(e) : e;
}
function ft(t2) {
  var e = ut(t2.mapValue.fields.__local_write_time__.timestampValue);
  return new K2(e.seconds, e.nanos);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function lt(t2) {
  return t2 == null;
}
function pt(t2) {
  return t2 === 0 && 1 / t2 == -1 / 0;
}
function dt(t2) {
  return typeof t2 == "number" && Number.isInteger(t2) && !pt(t2) && t2 <= Number.MAX_SAFE_INTEGER && t2 >= Number.MIN_SAFE_INTEGER;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function vt(t2) {
  return "nullValue" in t2 ? 0 : "booleanValue" in t2 ? 1 : "integerValue" in t2 || "doubleValue" in t2 ? 2 : "timestampValue" in t2 ? 3 : "stringValue" in t2 ? 5 : "bytesValue" in t2 ? 6 : "referenceValue" in t2 ? 7 : "geoPointValue" in t2 ? 8 : "arrayValue" in t2 ? 9 : "mapValue" in t2 ? ct(t2) ? 4 : 10 : x2();
}
function yt(t2, e) {
  var n2 = vt(t2);
  if (n2 !== vt(e))
    return false;
  switch (n2) {
    case 0:
      return true;
    case 1:
      return t2.booleanValue === e.booleanValue;
    case 4:
      return ft(t2).isEqual(ft(e));
    case 3:
      return function(t3, e2) {
        if (typeof t3.timestampValue == "string" && typeof e2.timestampValue == "string" && t3.timestampValue.length === e2.timestampValue.length)
          return t3.timestampValue === e2.timestampValue;
        var n3 = ut(t3.timestampValue), r2 = ut(e2.timestampValue);
        return n3.seconds === r2.seconds && n3.nanos === r2.nanos;
      }(t2, e);
    case 5:
      return t2.stringValue === e.stringValue;
    case 6:
      return function(t3, e2) {
        return at(t3.bytesValue).isEqual(at(e2.bytesValue));
      }(t2, e);
    case 7:
      return t2.referenceValue === e.referenceValue;
    case 8:
      return function(t3, e2) {
        return st(t3.geoPointValue.latitude) === st(e2.geoPointValue.latitude) && st(t3.geoPointValue.longitude) === st(e2.geoPointValue.longitude);
      }(t2, e);
    case 2:
      return function(t3, e2) {
        if ("integerValue" in t3 && "integerValue" in e2)
          return st(t3.integerValue) === st(e2.integerValue);
        if ("doubleValue" in t3 && "doubleValue" in e2) {
          var n3 = st(t3.doubleValue), r2 = st(e2.doubleValue);
          return n3 === r2 ? pt(n3) === pt(r2) : isNaN(n3) && isNaN(r2);
        }
        return false;
      }(t2, e);
    case 9:
      return L2(t2.arrayValue.values || [], e.arrayValue.values || [], yt);
    case 10:
      return function(t3, e2) {
        var n3 = t3.mapValue.fields || {}, r2 = e2.mapValue.fields || {};
        if (et(n3) !== et(r2))
          return false;
        for (var i in n3)
          if (n3.hasOwnProperty(i) && (r2[i] === void 0 || !yt(n3[i], r2[i])))
            return false;
        return true;
      }(t2, e);
    default:
      return x2();
  }
}
function mt(t2, e) {
  return (t2.values || []).find(function(t3) {
    return yt(t3, e);
  }) !== void 0;
}
function gt(t2, e) {
  var n2 = vt(t2), r2 = vt(e);
  if (n2 !== r2)
    return C(n2, r2);
  switch (n2) {
    case 0:
      return 0;
    case 1:
      return C(t2.booleanValue, e.booleanValue);
    case 2:
      return function(t3, e2) {
        var n3 = st(t3.integerValue || t3.doubleValue), r3 = st(e2.integerValue || e2.doubleValue);
        return n3 < r3 ? -1 : n3 > r3 ? 1 : n3 === r3 ? 0 : isNaN(n3) ? isNaN(r3) ? 0 : -1 : 1;
      }(t2, e);
    case 3:
      return wt(t2.timestampValue, e.timestampValue);
    case 4:
      return wt(ft(t2), ft(e));
    case 5:
      return C(t2.stringValue, e.stringValue);
    case 6:
      return function(t3, e2) {
        var n3 = at(t3), r3 = at(e2);
        return n3._(r3);
      }(t2.bytesValue, e.bytesValue);
    case 7:
      return function(t3, e2) {
        for (var n3 = t3.split("/"), r3 = e2.split("/"), i = 0; i < n3.length && i < r3.length; i++) {
          var o = C(n3[i], r3[i]);
          if (o !== 0)
            return o;
        }
        return C(n3.length, r3.length);
      }(t2.referenceValue, e.referenceValue);
    case 8:
      return function(t3, e2) {
        var n3 = C(st(t3.latitude), st(e2.latitude));
        return n3 !== 0 ? n3 : C(st(t3.longitude), st(e2.longitude));
      }(t2.geoPointValue, e.geoPointValue);
    case 9:
      return function(t3, e2) {
        for (var n3 = t3.values || [], r3 = e2.values || [], i = 0; i < n3.length && i < r3.length; ++i) {
          var o = gt(n3[i], r3[i]);
          if (o)
            return o;
        }
        return C(n3.length, r3.length);
      }(t2.arrayValue, e.arrayValue);
    case 10:
      return function(t3, e2) {
        var n3 = t3.fields || {}, r3 = Object.keys(n3), i = e2.fields || {}, o = Object.keys(i);
        r3.sort(), o.sort();
        for (var u = 0; u < r3.length && u < o.length; ++u) {
          var s = C(r3[u], o[u]);
          if (s !== 0)
            return s;
          var a = gt(n3[r3[u]], i[o[u]]);
          if (a !== 0)
            return a;
        }
        return C(r3.length, o.length);
      }(t2.mapValue, e.mapValue);
    default:
      throw x2();
  }
}
function wt(t2, e) {
  if (typeof t2 == "string" && typeof e == "string" && t2.length === e.length)
    return C(t2, e);
  var n2 = ut(t2), r2 = ut(e), i = C(n2.seconds, r2.seconds);
  return i !== 0 ? i : C(n2.nanos, r2.nanos);
}
function bt(t2) {
  return _t(t2);
}
function _t(t2) {
  return "nullValue" in t2 ? "null" : "booleanValue" in t2 ? "" + t2.booleanValue : "integerValue" in t2 ? "" + t2.integerValue : "doubleValue" in t2 ? "" + t2.doubleValue : "timestampValue" in t2 ? function(t3) {
    var e2 = ut(t3);
    return "time(" + e2.seconds + "," + e2.nanos + ")";
  }(t2.timestampValue) : "stringValue" in t2 ? t2.stringValue : "bytesValue" in t2 ? at(t2.bytesValue).toBase64() : "referenceValue" in t2 ? (n2 = t2.referenceValue, tt.ft(n2).toString()) : "geoPointValue" in t2 ? "geo(" + (e = t2.geoPointValue).latitude + "," + e.longitude + ")" : "arrayValue" in t2 ? function(t3) {
    for (var e2 = "[", n3 = true, r2 = 0, i = t3.values || []; r2 < i.length; r2++) {
      n3 ? n3 = false : e2 += ",", e2 += _t(i[r2]);
    }
    return e2 + "]";
  }(t2.arrayValue) : "mapValue" in t2 ? function(t3) {
    for (var e2 = "{", n3 = true, r2 = 0, i = Object.keys(t3.fields || {}).sort(); r2 < i.length; r2++) {
      var o = i[r2];
      n3 ? n3 = false : e2 += ",", e2 += o + ":" + _t(t3.fields[o]);
    }
    return e2 + "}";
  }(t2.mapValue) : x2();
  var e, n2;
}
function It(t2, e) {
  return {
    referenceValue: "projects/" + t2.projectId + "/databases/" + t2.database + "/documents/" + e.path.rt()
  };
}
function Et(t2) {
  return !!t2 && "integerValue" in t2;
}
function Tt(t2) {
  return !!t2 && "arrayValue" in t2;
}
function Nt(t2) {
  return !!t2 && "nullValue" in t2;
}
function At(t2) {
  return !!t2 && "doubleValue" in t2 && isNaN(Number(t2.doubleValue));
}
function Dt(t2) {
  return !!t2 && "mapValue" in t2;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var St = function() {
  function t2(t3) {
    this.proto = t3;
  }
  return t2.empty = function() {
    return new t2({
      mapValue: {}
    });
  }, t2.prototype.field = function(t3) {
    if (t3.et())
      return this.proto;
    for (var e = this.proto, n2 = 0; n2 < t3.length - 1; ++n2) {
      if (!e.mapValue.fields)
        return null;
      if (!Dt(e = e.mapValue.fields[t3.get(n2)]))
        return null;
    }
    return (e = (e.mapValue.fields || {})[t3.tt()]) || null;
  }, t2.prototype.isEqual = function(t3) {
    return yt(this.proto, t3.proto);
  }, t2;
}();
var xt = function() {
  function t2(t3) {
    t3 === void 0 && (t3 = St.empty()), this.It = t3, this.At = new Map();
  }
  return t2.prototype.set = function(t3, e) {
    return this.Rt(t3, e), this;
  }, t2.prototype.delete = function(t3) {
    return this.Rt(t3, null), this;
  }, t2.prototype.Rt = function(t3, e) {
    for (var n2 = this.At, r2 = 0; r2 < t3.length - 1; ++r2) {
      var i = t3.get(r2), o = n2.get(i);
      o instanceof Map ? n2 = o : o && vt(o) === 10 ? (o = new Map(Object.entries(o.mapValue.fields || {})), n2.set(i, o), n2 = o) : (o = new Map(), n2.set(i, o), n2 = o);
    }
    n2.set(t3.tt(), e);
  }, t2.prototype.Pt = function() {
    var t3 = this.yt($.ct(), this.At);
    return t3 != null ? new St(t3) : this.It;
  }, t2.prototype.yt = function(t3, e) {
    var n2 = this, r2 = false, i = this.It.field(t3), o = Dt(i) ? Object.assign({}, i.mapValue.fields) : {};
    return e.forEach(function(e2, i2) {
      if (e2 instanceof Map) {
        var u = n2.yt(t3.child(i2), e2);
        u != null && (o[i2] = u, r2 = true);
      } else
        e2 !== null ? (o[i2] = e2, r2 = true) : o.hasOwnProperty(i2) && (delete o[i2], r2 = true);
    }), r2 ? {
      mapValue: {
        fields: o
      }
    } : null;
  }, t2;
}();
function kt(t2) {
  var e = [];
  return nt(t2.fields || {}, function(t3, n2) {
    var r2 = new $([t3]);
    if (Dt(n2)) {
      var i = kt(n2.mapValue).fields;
      if (i.length === 0)
        e.push(r2);
      else
        for (var o = 0, u = i; o < u.length; o++) {
          var s = u[o];
          e.push(r2.child(s));
        }
    } else
      e.push(r2);
  }), new it(e);
}
var Ot = function(t2, e) {
  this.key = t2, this.version = e;
};
var Pt = function(t2) {
  function e(e2, n2, r2, i) {
    var o = this;
    return (o = t2.call(this, e2, n2) || this).gt = r2, o.Vt = !!i.Vt, o.hasCommittedMutations = !!i.hasCommittedMutations, o;
  }
  return __extends(e, t2), e.prototype.field = function(t3) {
    return this.gt.field(t3);
  }, e.prototype.data = function() {
    return this.gt;
  }, e.prototype.bt = function() {
    return this.gt.proto;
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e && this.key.isEqual(t3.key) && this.version.isEqual(t3.version) && this.Vt === t3.Vt && this.hasCommittedMutations === t3.hasCommittedMutations && this.gt.isEqual(t3.gt);
  }, e.prototype.toString = function() {
    return "Document(" + this.key + ", " + this.version + ", " + this.gt.toString() + ", {hasLocalMutations: " + this.Vt + "}), {hasCommittedMutations: " + this.hasCommittedMutations + "})";
  }, Object.defineProperty(e.prototype, "hasPendingWrites", {
    get: function() {
      return this.Vt || this.hasCommittedMutations;
    },
    enumerable: false,
    configurable: true
  }), e;
}(Ot);
var Vt = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2) || this).hasCommittedMutations = !(!r2 || !r2.hasCommittedMutations), i;
  }
  return __extends(e, t2), e.prototype.toString = function() {
    return "NoDocument(" + this.key + ", " + this.version + ")";
  }, Object.defineProperty(e.prototype, "hasPendingWrites", {
    get: function() {
      return this.hasCommittedMutations;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.isEqual = function(t3) {
    return t3 instanceof e && t3.hasCommittedMutations === this.hasCommittedMutations && t3.version.isEqual(this.version) && t3.key.isEqual(this.key);
  }, e;
}(Ot);
var Ct = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.toString = function() {
    return "UnknownDocument(" + this.key + ", " + this.version + ")";
  }, Object.defineProperty(e.prototype, "hasPendingWrites", {
    get: function() {
      return true;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.isEqual = function(t3) {
    return t3 instanceof e && t3.version.isEqual(this.version) && t3.key.isEqual(this.key);
  }, e;
}(Ot);
var Lt = function(t2, e, n2, r2, i, o, u) {
  e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = null), u === void 0 && (u = null), this.path = t2, this.collectionGroup = e, this.orderBy = n2, this.filters = r2, this.limit = i, this.startAt = o, this.endAt = u, this.vt = null;
};
function Rt(t2, e, n2, r2, i, o, u) {
  return e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = null), u === void 0 && (u = null), new Lt(t2, e, n2, r2, i, o, u);
}
function Ut(t2) {
  var e = O2(t2);
  if (e.vt === null) {
    var n2 = e.path.rt();
    e.collectionGroup !== null && (n2 += "|cg:" + e.collectionGroup), n2 += "|f:", n2 += e.filters.map(function(t3) {
      return function(t4) {
        return t4.field.rt() + t4.op.toString() + bt(t4.value);
      }(t3);
    }).join(","), n2 += "|ob:", n2 += e.orderBy.map(function(t3) {
      return function(t4) {
        return t4.field.rt() + t4.dir;
      }(t3);
    }).join(","), lt(e.limit) || (n2 += "|l:", n2 += e.limit), e.startAt && (n2 += "|lb:", n2 += Wt(e.startAt)), e.endAt && (n2 += "|ub:", n2 += Wt(e.endAt)), e.vt = n2;
  }
  return e.vt;
}
function Mt(t2, e) {
  if (t2.limit !== e.limit)
    return false;
  if (t2.orderBy.length !== e.orderBy.length)
    return false;
  for (var n2 = 0; n2 < t2.orderBy.length; n2++)
    if (!Jt(t2.orderBy[n2], e.orderBy[n2]))
      return false;
  if (t2.filters.length !== e.filters.length)
    return false;
  for (var r2 = 0; r2 < t2.filters.length; r2++)
    if (i = t2.filters[r2], o = e.filters[r2], i.op !== o.op || !i.field.isEqual(o.field) || !yt(i.value, o.value))
      return false;
  var i, o;
  return t2.collectionGroup === e.collectionGroup && !!t2.path.isEqual(e.path) && !!te(t2.startAt, e.startAt) && te(t2.endAt, e.endAt);
}
function qt(t2) {
  return tt.wt(t2.path) && t2.collectionGroup === null && t2.filters.length === 0;
}
var Ft = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).field = e2, i.op = n2, i.value = r2, i;
  }
  return __extends(e, t2), e.create = function(t3, n2, r2) {
    return t3.ut() ? n2 === "in" || n2 === "not-in" ? this.St(t3, n2, r2) : new jt(t3, n2, r2) : n2 === "array-contains" ? new Qt(t3, r2) : n2 === "in" ? new Yt(t3, r2) : n2 === "not-in" ? new Ht(t3, r2) : n2 === "array-contains-any" ? new Kt(t3, r2) : new e(t3, n2, r2);
  }, e.St = function(t3, e2, n2) {
    return e2 === "in" ? new zt(t3, n2) : new Gt(t3, n2);
  }, e.prototype.matches = function(t3) {
    var e2 = t3.field(this.field);
    return this.op === "!=" ? e2 !== null && this.Dt(gt(e2, this.value)) : e2 !== null && vt(this.value) === vt(e2) && this.Dt(gt(e2, this.value));
  }, e.prototype.Dt = function(t3) {
    switch (this.op) {
      case "<":
        return t3 < 0;
      case "<=":
        return t3 <= 0;
      case "==":
        return t3 === 0;
      case "!=":
        return t3 !== 0;
      case ">":
        return t3 > 0;
      case ">=":
        return t3 >= 0;
      default:
        return x2();
    }
  }, e.prototype.Ct = function() {
    return ["<", "<=", ">", ">=", "!=", "not-in"].indexOf(this.op) >= 0;
  }, e;
}(function() {
});
var jt = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2, r2) || this).key = tt.ft(r2.referenceValue), i;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = tt.H(t3.key, this.key);
    return this.Dt(e2);
  }, e;
}(Ft);
var zt = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, "in", n2) || this).keys = Bt("in", n2), r2;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    return this.keys.some(function(e2) {
      return e2.isEqual(t3.key);
    });
  }, e;
}(Ft);
var Gt = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, "not-in", n2) || this).keys = Bt("not-in", n2), r2;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    return !this.keys.some(function(e2) {
      return e2.isEqual(t3.key);
    });
  }, e;
}(Ft);
function Bt(t2, e) {
  var n2;
  return (((n2 = e.arrayValue) === null || n2 === void 0 ? void 0 : n2.values) || []).map(function(t3) {
    return tt.ft(t3.referenceValue);
  });
}
var Qt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "array-contains", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = t3.field(this.field);
    return Tt(e2) && mt(e2.arrayValue, this.value);
  }, e;
}(Ft);
var Yt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "in", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = t3.field(this.field);
    return e2 !== null && mt(this.value.arrayValue, e2);
  }, e;
}(Ft);
var Ht = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "not-in", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    if (mt(this.value.arrayValue, {
      nullValue: "NULL_VALUE"
    }))
      return false;
    var e2 = t3.field(this.field);
    return e2 !== null && !mt(this.value.arrayValue, e2);
  }, e;
}(Ft);
var Kt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "array-contains-any", n2) || this;
  }
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = this, n2 = t3.field(this.field);
    return !(!Tt(n2) || !n2.arrayValue.values) && n2.arrayValue.values.some(function(t4) {
      return mt(e2.value.arrayValue, t4);
    });
  }, e;
}(Ft);
var Xt = function(t2, e) {
  this.position = t2, this.before = e;
};
function Wt(t2) {
  return (t2.before ? "b" : "a") + ":" + t2.position.map(function(t3) {
    return bt(t3);
  }).join(",");
}
var Zt = function(t2, e) {
  e === void 0 && (e = "asc"), this.field = t2, this.dir = e;
};
function Jt(t2, e) {
  return t2.dir === e.dir && t2.field.isEqual(e.field);
}
function $t(t2, e, n2) {
  for (var r2 = 0, i = 0; i < t2.position.length; i++) {
    var o = e[i], u = t2.position[i];
    if (r2 = o.field.ut() ? tt.H(tt.ft(u.referenceValue), n2.key) : gt(u, n2.field(o.field)), o.dir === "desc" && (r2 *= -1), r2 !== 0)
      break;
  }
  return t2.before ? r2 <= 0 : r2 < 0;
}
function te(t2, e) {
  if (t2 === null)
    return e === null;
  if (e === null)
    return false;
  if (t2.before !== e.before || t2.position.length !== e.position.length)
    return false;
  for (var n2 = 0; n2 < t2.position.length; n2++)
    if (!yt(t2.position[n2], e.position[n2]))
      return false;
  return true;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ee = function(t2, e, n2, r2, i, o, u, s) {
  e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = "F"), u === void 0 && (u = null), s === void 0 && (s = null), this.path = t2, this.collectionGroup = e, this.xt = n2, this.filters = r2, this.limit = i, this.limitType = o, this.startAt = u, this.endAt = s, this.Nt = null, this.$t = null, this.startAt, this.endAt;
};
function ne(t2, e, n2, r2, i, o, u, s) {
  return new ee(t2, e, n2, r2, i, o, u, s);
}
function re(t2) {
  return new ee(t2);
}
function ie(t2) {
  return !lt(t2.limit) && t2.limitType === "F";
}
function oe(t2) {
  return !lt(t2.limit) && t2.limitType === "L";
}
function ue(t2) {
  return t2.xt.length > 0 ? t2.xt[0].field : null;
}
function se(t2) {
  for (var e = 0, n2 = t2.filters; e < n2.length; e++) {
    var r2 = n2[e];
    if (r2.Ct())
      return r2.field;
  }
  return null;
}
function ae(t2) {
  return t2.collectionGroup !== null;
}
function ce(t2) {
  var e = O2(t2);
  if (e.Nt === null) {
    e.Nt = [];
    var n2 = se(e), r2 = ue(e);
    if (n2 !== null && r2 === null)
      n2.ut() || e.Nt.push(new Zt(n2)), e.Nt.push(new Zt($.ht(), "asc"));
    else {
      for (var i = false, o = 0, u = e.xt; o < u.length; o++) {
        var s = u[o];
        e.Nt.push(s), s.field.ut() && (i = true);
      }
      if (!i) {
        var a = e.xt.length > 0 ? e.xt[e.xt.length - 1].dir : "asc";
        e.Nt.push(new Zt($.ht(), a));
      }
    }
  }
  return e.Nt;
}
function he(t2) {
  var e = O2(t2);
  if (!e.$t)
    if (e.limitType === "F")
      e.$t = Rt(e.path, e.collectionGroup, ce(e), e.filters, e.limit, e.startAt, e.endAt);
    else {
      for (var n2 = [], r2 = 0, i = ce(e); r2 < i.length; r2++) {
        var o = i[r2], u = o.dir === "desc" ? "asc" : "desc";
        n2.push(new Zt(o.field, u));
      }
      var s = e.endAt ? new Xt(e.endAt.position, !e.endAt.before) : null, a = e.startAt ? new Xt(e.startAt.position, !e.startAt.before) : null;
      e.$t = Rt(e.path, e.collectionGroup, n2, e.filters, e.limit, s, a);
    }
  return e.$t;
}
function fe(t2, e, n2) {
  return new ee(t2.path, t2.collectionGroup, t2.xt.slice(), t2.filters.slice(), e, n2, t2.startAt, t2.endAt);
}
function le(t2, e) {
  return Mt(he(t2), he(e)) && t2.limitType === e.limitType;
}
function pe(t2) {
  return Ut(he(t2)) + "|lt:" + t2.limitType;
}
function de(t2) {
  return "Query(target=" + function(t3) {
    var e = t3.path.rt();
    return t3.collectionGroup !== null && (e += " collectionGroup=" + t3.collectionGroup), t3.filters.length > 0 && (e += ", filters: [" + t3.filters.map(function(t4) {
      return (e2 = t4).field.rt() + " " + e2.op + " " + bt(e2.value);
      var e2;
    }).join(", ") + "]"), lt(t3.limit) || (e += ", limit: " + t3.limit), t3.orderBy.length > 0 && (e += ", orderBy: [" + t3.orderBy.map(function(t4) {
      return function(t5) {
        return t5.field.rt() + " (" + t5.dir + ")";
      }(t4);
    }).join(", ") + "]"), t3.startAt && (e += ", startAt: " + Wt(t3.startAt)), t3.endAt && (e += ", endAt: " + Wt(t3.endAt)), "Target(" + e + ")";
  }(he(t2)) + "; limitType=" + t2.limitType + ")";
}
function ve(t2, e) {
  return function(t3, e2) {
    var n2 = e2.key.path;
    return t3.collectionGroup !== null ? e2.key.dt(t3.collectionGroup) && t3.path.nt(n2) : tt.wt(t3.path) ? t3.path.isEqual(n2) : t3.path.st(n2);
  }(t2, e) && function(t3, e2) {
    for (var n2 = 0, r2 = t3.xt; n2 < r2.length; n2++) {
      var i = r2[n2];
      if (!i.field.ut() && e2.field(i.field) === null)
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    for (var n2 = 0, r2 = t3.filters; n2 < r2.length; n2++) {
      if (!r2[n2].matches(e2))
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    return !(t3.startAt && !$t(t3.startAt, ce(t3), e2)) && (!t3.endAt || !$t(t3.endAt, ce(t3), e2));
  }(t2, e);
}
function ye(t2) {
  return function(e, n2) {
    for (var r2 = false, i = 0, o = ce(t2); i < o.length; i++) {
      var u = o[i], s = me(u, e, n2);
      if (s !== 0)
        return s;
      r2 = r2 || u.field.ut();
    }
    return 0;
  };
}
function me(t2, e, n2) {
  var r2 = t2.field.ut() ? tt.H(e.key, n2.key) : function(t3, e2, n3) {
    var r3 = e2.field(t3), i = n3.field(t3);
    return r3 !== null && i !== null ? gt(r3, i) : x2();
  }(t2.field, e, n2);
  switch (t2.dir) {
    case "asc":
      return r2;
    case "desc":
      return -1 * r2;
    default:
      return x2();
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ge = function() {
  function t2(t3, e, n2, r2, i, o, u) {
    i === void 0 && (i = X2.min()), o === void 0 && (o = X2.min()), u === void 0 && (u = U2.T), this.target = t3, this.targetId = e, this.Ft = n2, this.sequenceNumber = r2, this.Ot = i, this.lastLimboFreeSnapshotVersion = o, this.resumeToken = u;
  }
  return t2.prototype.kt = function(e) {
    return new t2(this.target, this.targetId, this.Ft, e, this.Ot, this.lastLimboFreeSnapshotVersion, this.resumeToken);
  }, t2.prototype.Mt = function(e, n2) {
    return new t2(this.target, this.targetId, this.Ft, this.sequenceNumber, n2, this.lastLimboFreeSnapshotVersion, e);
  }, t2.prototype.Lt = function(e) {
    return new t2(this.target, this.targetId, this.Ft, this.sequenceNumber, this.Ot, e, this.resumeToken);
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function we(t2, e) {
  if (t2.Bt) {
    if (isNaN(e))
      return {
        doubleValue: "NaN"
      };
    if (e === 1 / 0)
      return {
        doubleValue: "Infinity"
      };
    if (e === -1 / 0)
      return {
        doubleValue: "-Infinity"
      };
  }
  return {
    doubleValue: pt(e) ? "-0" : e
  };
}
function be(t2) {
  return {
    integerValue: "" + t2
  };
}
function _e(t2, e) {
  return dt(e) ? be(e) : we(t2, e);
}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ie = function() {
  this.qt = void 0;
};
function Ee(t2, e, n2) {
  return t2 instanceof Ae ? function(t3, e2) {
    var n3 = {
      fields: {
        __type__: {
          stringValue: "server_timestamp"
        },
        __local_write_time__: {
          timestampValue: {
            seconds: t3.seconds,
            nanos: t3.nanoseconds
          }
        }
      }
    };
    return e2 && (n3.fields.__previous_value__ = e2), {
      mapValue: n3
    };
  }(n2, e) : t2 instanceof De ? Se(t2, e) : t2 instanceof xe ? ke(t2, e) : function(t3, e2) {
    var n3 = Ne(t3, e2), r2 = Pe(n3) + Pe(t3.Ut);
    return Et(n3) && Et(t3.Ut) ? be(r2) : we(t3.Qt, r2);
  }(t2, e);
}
function Te(t2, e, n2) {
  return t2 instanceof De ? Se(t2, e) : t2 instanceof xe ? ke(t2, e) : n2;
}
function Ne(t2, e) {
  return t2 instanceof Oe ? Et(n2 = e) || function(t3) {
    return !!t3 && "doubleValue" in t3;
  }(n2) ? e : {
    integerValue: 0
  } : null;
  var n2;
}
var Ae = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e;
}(Ie);
var De = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).elements = e2, n2;
  }
  return __extends(e, t2), e;
}(Ie);
function Se(t2, e) {
  for (var n2 = Ve(e), r2 = function(t3) {
    n2.some(function(e2) {
      return yt(e2, t3);
    }) || n2.push(t3);
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r2(o[i]);
  }
  return {
    arrayValue: {
      values: n2
    }
  };
}
var xe = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).elements = e2, n2;
  }
  return __extends(e, t2), e;
}(Ie);
function ke(t2, e) {
  for (var n2 = Ve(e), r2 = function(t3) {
    n2 = n2.filter(function(e2) {
      return !yt(e2, t3);
    });
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r2(o[i]);
  }
  return {
    arrayValue: {
      values: n2
    }
  };
}
var Oe = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).Qt = e2, r2.Ut = n2, r2;
  }
  return __extends(e, t2), e;
}(Ie);
function Pe(t2) {
  return st(t2.integerValue || t2.doubleValue);
}
function Ve(t2) {
  return Tt(t2) && t2.arrayValue.values ? t2.arrayValue.values.slice() : [];
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ce = function(t2, e) {
  this.field = t2, this.transform = e;
};
var Le = function(t2, e) {
  this.version = t2, this.transformResults = e;
};
var Re = function() {
  function t2(t3, e) {
    this.updateTime = t3, this.exists = e;
  }
  return t2.Kt = function() {
    return new t2();
  }, t2.exists = function(e) {
    return new t2(void 0, e);
  }, t2.updateTime = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "Wt", {
    get: function() {
      return this.updateTime === void 0 && this.exists === void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this.exists === t3.exists && (this.updateTime ? !!t3.updateTime && this.updateTime.isEqual(t3.updateTime) : !t3.updateTime);
  }, t2;
}();
function Ue(t2, e) {
  return t2.updateTime !== void 0 ? e instanceof Pt && e.version.isEqual(t2.updateTime) : t2.exists === void 0 || t2.exists === e instanceof Pt;
}
var Me = function() {
};
function qe(t2, e, n2) {
  return t2 instanceof Be ? function(t3, e2, n3) {
    var r2 = t3.value;
    if (n3.transformResults) {
      var i = He(t3.fieldTransforms, e2, n3.transformResults);
      r2 = Xe(t3.fieldTransforms, r2, i);
    }
    return new Pt(t3.key, n3.version, r2, {
      hasCommittedMutations: true
    });
  }(t2, e, n2) : t2 instanceof Qe ? function(t3, e2, n3) {
    if (!Ue(t3.jt, e2))
      return new Ct(t3.key, n3.version);
    var r2 = Ye(t3, e2, n3.transformResults ? He(t3.fieldTransforms, e2, n3.transformResults) : []);
    return new Pt(t3.key, n3.version, r2, {
      hasCommittedMutations: true
    });
  }(t2, e, n2) : function(t3, e2, n3) {
    return new Vt(t3.key, n3.version, {
      hasCommittedMutations: true
    });
  }(t2, 0, n2);
}
function Fe(t2, e, n2) {
  return t2 instanceof Be ? function(t3, e2, n3) {
    if (!Ue(t3.jt, e2))
      return e2;
    var r2 = t3.value, i = Ke(t3.fieldTransforms, n3, e2);
    r2 = Xe(t3.fieldTransforms, r2, i);
    var o = Ge(e2);
    return new Pt(t3.key, o, r2, {
      Vt: true
    });
  }(t2, e, n2) : t2 instanceof Qe ? function(t3, e2, n3) {
    if (!Ue(t3.jt, e2))
      return e2;
    var r2 = Ge(e2), i = Ye(t3, e2, Ke(t3.fieldTransforms, n3, e2));
    return new Pt(t3.key, r2, i, {
      Vt: true
    });
  }(t2, e, n2) : function(t3, e2) {
    return Ue(t3.jt, e2) ? new Vt(t3.key, X2.min()) : e2;
  }(t2, e);
}
function je(t2, e) {
  return function(t3, e2) {
    for (var n2 = null, r2 = 0, i = t3; r2 < i.length; r2++) {
      var o = i[r2], u = e2 instanceof Pt ? e2.field(o.field) : void 0, s = Ne(o.transform, u || null);
      s != null && (n2 = n2 == null ? new xt().set(o.field, s) : n2.set(o.field, s));
    }
    return n2 ? n2.Pt() : null;
  }(t2.fieldTransforms, e);
}
function ze(t2, e) {
  return t2.type === e.type && !!t2.key.isEqual(e.key) && !!t2.jt.isEqual(e.jt) && !!function(t3, e2) {
    return t3 === void 0 && e2 === void 0 || !(!t3 || !e2) && L2(t3, e2, function(t4, e3) {
      return function(t5, e4) {
        return t5.field.isEqual(e4.field) && function(t6, e5) {
          return t6 instanceof De && e5 instanceof De || t6 instanceof xe && e5 instanceof xe ? L2(t6.elements, e5.elements, yt) : t6 instanceof Oe && e5 instanceof Oe ? yt(t6.Ut, e5.Ut) : t6 instanceof Ae && e5 instanceof Ae;
        }(t5.transform, e4.transform);
      }(t4, e3);
    });
  }(t2.fieldTransforms, e.fieldTransforms) && (t2.type === 0 ? t2.value.isEqual(e.value) : t2.type !== 1 || t2.data.isEqual(e.data) && t2.Gt.isEqual(e.Gt));
}
function Ge(t2) {
  return t2 instanceof Pt ? t2.version : X2.min();
}
var Be = function(t2) {
  function e(e2, n2, r2, i) {
    i === void 0 && (i = []);
    var o = this;
    return (o = t2.call(this) || this).key = e2, o.value = n2, o.jt = r2, o.fieldTransforms = i, o.type = 0, o;
  }
  return __extends(e, t2), e;
}(Me);
var Qe = function(t2) {
  function e(e2, n2, r2, i, o) {
    o === void 0 && (o = []);
    var u = this;
    return (u = t2.call(this) || this).key = e2, u.data = n2, u.Gt = r2, u.jt = i, u.fieldTransforms = o, u.type = 1, u;
  }
  return __extends(e, t2), e;
}(Me);
function Ye(t2, e, n2) {
  var r2;
  return r2 = function(t3, e2) {
    var n3 = new xt(e2);
    return t3.Gt.fields.forEach(function(e3) {
      if (!e3.et()) {
        var r3 = t3.data.field(e3);
        r3 !== null ? n3.set(e3, r3) : n3.delete(e3);
      }
    }), n3.Pt();
  }(t2, r2 = e instanceof Pt ? e.data() : St.empty()), r2 = Xe(t2.fieldTransforms, r2, n2);
}
function He(t2, e, n2) {
  var r2 = [];
  k2(t2.length === n2.length);
  for (var i = 0; i < n2.length; i++) {
    var o = t2[i], u = o.transform, s = null;
    e instanceof Pt && (s = e.field(o.field)), r2.push(Te(u, s, n2[i]));
  }
  return r2;
}
function Ke(t2, e, n2) {
  for (var r2 = [], i = 0, o = t2; i < o.length; i++) {
    var u = o[i], s = u.transform, a = null;
    n2 instanceof Pt && (a = n2.field(u.field)), r2.push(Ee(s, a, e));
  }
  return r2;
}
function Xe(t2, e, n2) {
  for (var r2 = new xt(e), i = 0; i < t2.length; i++) {
    var o = t2[i];
    r2.set(o.field, n2[i]);
  }
  return r2.Pt();
}
var We;
var Ze;
var Je = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).key = e2, r2.jt = n2, r2.type = 2, r2.fieldTransforms = [], r2;
  }
  return __extends(e, t2), e;
}(Me);
var $e = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).key = e2, r2.jt = n2, r2.type = 3, r2.fieldTransforms = [], r2;
  }
  return __extends(e, t2), e;
}(Me);
var tn = function(t2) {
  this.count = t2;
};
function en(t2) {
  switch (t2) {
    case M2.OK:
      return x2();
    case M2.CANCELLED:
    case M2.UNKNOWN:
    case M2.DEADLINE_EXCEEDED:
    case M2.RESOURCE_EXHAUSTED:
    case M2.INTERNAL:
    case M2.UNAVAILABLE:
    case M2.UNAUTHENTICATED:
      return false;
    case M2.INVALID_ARGUMENT:
    case M2.NOT_FOUND:
    case M2.ALREADY_EXISTS:
    case M2.PERMISSION_DENIED:
    case M2.FAILED_PRECONDITION:
    case M2.ABORTED:
    case M2.OUT_OF_RANGE:
    case M2.UNIMPLEMENTED:
    case M2.DATA_LOSS:
      return true;
    default:
      return x2();
  }
}
function nn(t2) {
  if (t2 === void 0)
    return A2("GRPC error has no .code"), M2.UNKNOWN;
  switch (t2) {
    case We.OK:
      return M2.OK;
    case We.CANCELLED:
      return M2.CANCELLED;
    case We.UNKNOWN:
      return M2.UNKNOWN;
    case We.DEADLINE_EXCEEDED:
      return M2.DEADLINE_EXCEEDED;
    case We.RESOURCE_EXHAUSTED:
      return M2.RESOURCE_EXHAUSTED;
    case We.INTERNAL:
      return M2.INTERNAL;
    case We.UNAVAILABLE:
      return M2.UNAVAILABLE;
    case We.UNAUTHENTICATED:
      return M2.UNAUTHENTICATED;
    case We.INVALID_ARGUMENT:
      return M2.INVALID_ARGUMENT;
    case We.NOT_FOUND:
      return M2.NOT_FOUND;
    case We.ALREADY_EXISTS:
      return M2.ALREADY_EXISTS;
    case We.PERMISSION_DENIED:
      return M2.PERMISSION_DENIED;
    case We.FAILED_PRECONDITION:
      return M2.FAILED_PRECONDITION;
    case We.ABORTED:
      return M2.ABORTED;
    case We.OUT_OF_RANGE:
      return M2.OUT_OF_RANGE;
    case We.UNIMPLEMENTED:
      return M2.UNIMPLEMENTED;
    case We.DATA_LOSS:
      return M2.DATA_LOSS;
    default:
      return x2();
  }
}
(Ze = We || (We = {}))[Ze.OK = 0] = "OK", Ze[Ze.CANCELLED = 1] = "CANCELLED", Ze[Ze.UNKNOWN = 2] = "UNKNOWN", Ze[Ze.INVALID_ARGUMENT = 3] = "INVALID_ARGUMENT", Ze[Ze.DEADLINE_EXCEEDED = 4] = "DEADLINE_EXCEEDED", Ze[Ze.NOT_FOUND = 5] = "NOT_FOUND", Ze[Ze.ALREADY_EXISTS = 6] = "ALREADY_EXISTS", Ze[Ze.PERMISSION_DENIED = 7] = "PERMISSION_DENIED", Ze[Ze.UNAUTHENTICATED = 16] = "UNAUTHENTICATED", Ze[Ze.RESOURCE_EXHAUSTED = 8] = "RESOURCE_EXHAUSTED", Ze[Ze.FAILED_PRECONDITION = 9] = "FAILED_PRECONDITION", Ze[Ze.ABORTED = 10] = "ABORTED", Ze[Ze.OUT_OF_RANGE = 11] = "OUT_OF_RANGE", Ze[Ze.UNIMPLEMENTED = 12] = "UNIMPLEMENTED", Ze[Ze.INTERNAL = 13] = "INTERNAL", Ze[Ze.UNAVAILABLE = 14] = "UNAVAILABLE", Ze[Ze.DATA_LOSS = 15] = "DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var rn = function() {
  function t2(t3, e) {
    this.H = t3, this.root = e || un.EMPTY;
  }
  return t2.prototype.zt = function(e, n2) {
    return new t2(this.H, this.root.zt(e, n2, this.H).copy(null, null, un.Ht, null, null));
  }, t2.prototype.remove = function(e) {
    return new t2(this.H, this.root.remove(e, this.H).copy(null, null, un.Ht, null, null));
  }, t2.prototype.get = function(t3) {
    for (var e = this.root; !e.et(); ) {
      var n2 = this.H(t3, e.key);
      if (n2 === 0)
        return e.value;
      n2 < 0 ? e = e.left : n2 > 0 && (e = e.right);
    }
    return null;
  }, t2.prototype.indexOf = function(t3) {
    for (var e = 0, n2 = this.root; !n2.et(); ) {
      var r2 = this.H(t3, n2.key);
      if (r2 === 0)
        return e + n2.left.size;
      r2 < 0 ? n2 = n2.left : (e += n2.left.size + 1, n2 = n2.right);
    }
    return -1;
  }, t2.prototype.et = function() {
    return this.root.et();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.root.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Jt = function() {
    return this.root.Jt();
  }, t2.prototype.Yt = function() {
    return this.root.Yt();
  }, t2.prototype.Xt = function(t3) {
    return this.root.Xt(t3);
  }, t2.prototype.forEach = function(t3) {
    this.Xt(function(e, n2) {
      return t3(e, n2), false;
    });
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.Xt(function(e, n2) {
      return t3.push(e + ":" + n2), false;
    }), "{" + t3.join(", ") + "}";
  }, t2.prototype.Zt = function(t3) {
    return this.root.Zt(t3);
  }, t2.prototype.te = function() {
    return new on(this.root, null, this.H, false);
  }, t2.prototype.ee = function(t3) {
    return new on(this.root, t3, this.H, false);
  }, t2.prototype.ne = function() {
    return new on(this.root, null, this.H, true);
  }, t2.prototype.se = function(t3) {
    return new on(this.root, t3, this.H, true);
  }, t2;
}();
var on = function() {
  function t2(t3, e, n2, r2) {
    this.ie = r2, this.re = [];
    for (var i = 1; !t3.et(); )
      if (i = e ? n2(t3.key, e) : 1, r2 && (i *= -1), i < 0)
        t3 = this.ie ? t3.left : t3.right;
      else {
        if (i === 0) {
          this.re.push(t3);
          break;
        }
        this.re.push(t3), t3 = this.ie ? t3.right : t3.left;
      }
  }
  return t2.prototype.oe = function() {
    var t3 = this.re.pop(), e = {
      key: t3.key,
      value: t3.value
    };
    if (this.ie)
      for (t3 = t3.left; !t3.et(); )
        this.re.push(t3), t3 = t3.right;
    else
      for (t3 = t3.right; !t3.et(); )
        this.re.push(t3), t3 = t3.left;
    return e;
  }, t2.prototype.ce = function() {
    return this.re.length > 0;
  }, t2.prototype.ae = function() {
    if (this.re.length === 0)
      return null;
    var t3 = this.re[this.re.length - 1];
    return {
      key: t3.key,
      value: t3.value
    };
  }, t2;
}();
var un = function() {
  function t2(e, n2, r2, i, o) {
    this.key = e, this.value = n2, this.color = r2 != null ? r2 : t2.RED, this.left = i != null ? i : t2.EMPTY, this.right = o != null ? o : t2.EMPTY, this.size = this.left.size + 1 + this.right.size;
  }
  return t2.prototype.copy = function(e, n2, r2, i, o) {
    return new t2(e != null ? e : this.key, n2 != null ? n2 : this.value, r2 != null ? r2 : this.color, i != null ? i : this.left, o != null ? o : this.right);
  }, t2.prototype.et = function() {
    return false;
  }, t2.prototype.Xt = function(t3) {
    return this.left.Xt(t3) || t3(this.key, this.value) || this.right.Xt(t3);
  }, t2.prototype.Zt = function(t3) {
    return this.right.Zt(t3) || t3(this.key, this.value) || this.left.Zt(t3);
  }, t2.prototype.min = function() {
    return this.left.et() ? this : this.left.min();
  }, t2.prototype.Jt = function() {
    return this.min().key;
  }, t2.prototype.Yt = function() {
    return this.right.et() ? this.key : this.right.Yt();
  }, t2.prototype.zt = function(t3, e, n2) {
    var r2 = this, i = n2(t3, r2.key);
    return (r2 = i < 0 ? r2.copy(null, null, null, r2.left.zt(t3, e, n2), null) : i === 0 ? r2.copy(null, e, null, null, null) : r2.copy(null, null, null, null, r2.right.zt(t3, e, n2))).ue();
  }, t2.prototype.he = function() {
    if (this.left.et())
      return t2.EMPTY;
    var e = this;
    return e.left.le() || e.left.left.le() || (e = e._e()), (e = e.copy(null, null, null, e.left.he(), null)).ue();
  }, t2.prototype.remove = function(e, n2) {
    var r2, i = this;
    if (n2(e, i.key) < 0)
      i.left.et() || i.left.le() || i.left.left.le() || (i = i._e()), i = i.copy(null, null, null, i.left.remove(e, n2), null);
    else {
      if (i.left.le() && (i = i.fe()), i.right.et() || i.right.le() || i.right.left.le() || (i = i.de()), n2(e, i.key) === 0) {
        if (i.right.et())
          return t2.EMPTY;
        r2 = i.right.min(), i = i.copy(r2.key, r2.value, null, null, i.right.he());
      }
      i = i.copy(null, null, null, null, i.right.remove(e, n2));
    }
    return i.ue();
  }, t2.prototype.le = function() {
    return this.color;
  }, t2.prototype.ue = function() {
    var t3 = this;
    return t3.right.le() && !t3.left.le() && (t3 = t3.we()), t3.left.le() && t3.left.left.le() && (t3 = t3.fe()), t3.left.le() && t3.right.le() && (t3 = t3.Ee()), t3;
  }, t2.prototype._e = function() {
    var t3 = this.Ee();
    return t3.right.left.le() && (t3 = (t3 = (t3 = t3.copy(null, null, null, null, t3.right.fe())).we()).Ee()), t3;
  }, t2.prototype.de = function() {
    var t3 = this.Ee();
    return t3.left.left.le() && (t3 = (t3 = t3.fe()).Ee()), t3;
  }, t2.prototype.we = function() {
    var e = this.copy(null, null, t2.RED, null, this.right.left);
    return this.right.copy(null, null, this.color, e, null);
  }, t2.prototype.fe = function() {
    var e = this.copy(null, null, t2.RED, this.left.right, null);
    return this.left.copy(null, null, this.color, null, e);
  }, t2.prototype.Ee = function() {
    var t3 = this.left.copy(null, null, !this.left.color, null, null), e = this.right.copy(null, null, !this.right.color, null, null);
    return this.copy(null, null, !this.color, t3, e);
  }, t2.prototype.Te = function() {
    var t3 = this.Ie();
    return Math.pow(2, t3) <= this.size + 1;
  }, t2.prototype.Ie = function() {
    if (this.le() && this.left.le())
      throw x2();
    if (this.right.le())
      throw x2();
    var t3 = this.left.Ie();
    if (t3 !== this.right.Ie())
      throw x2();
    return t3 + (this.le() ? 0 : 1);
  }, t2;
}();
un.EMPTY = null, un.RED = true, un.Ht = false, un.EMPTY = new (function() {
  function t2() {
    this.size = 0;
  }
  return Object.defineProperty(t2.prototype, "key", {
    get: function() {
      throw x2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "value", {
    get: function() {
      throw x2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "color", {
    get: function() {
      throw x2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "left", {
    get: function() {
      throw x2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "right", {
    get: function() {
      throw x2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.copy = function(t3, e, n2, r2, i) {
    return this;
  }, t2.prototype.zt = function(t3, e, n2) {
    return new un(t3, e);
  }, t2.prototype.remove = function(t3, e) {
    return this;
  }, t2.prototype.et = function() {
    return true;
  }, t2.prototype.Xt = function(t3) {
    return false;
  }, t2.prototype.Zt = function(t3) {
    return false;
  }, t2.prototype.Jt = function() {
    return null;
  }, t2.prototype.Yt = function() {
    return null;
  }, t2.prototype.le = function() {
    return false;
  }, t2.prototype.Te = function() {
    return true;
  }, t2.prototype.Ie = function() {
    return 0;
  }, t2;
}())();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var sn = function() {
  function t2(t3) {
    this.H = t3, this.data = new rn(this.H);
  }
  return t2.prototype.has = function(t3) {
    return this.data.get(t3) !== null;
  }, t2.prototype.first = function() {
    return this.data.Jt();
  }, t2.prototype.last = function() {
    return this.data.Yt();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.data.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.indexOf = function(t3) {
    return this.data.indexOf(t3);
  }, t2.prototype.forEach = function(t3) {
    this.data.Xt(function(e, n2) {
      return t3(e), false;
    });
  }, t2.prototype.me = function(t3, e) {
    for (var n2 = this.data.ee(t3[0]); n2.ce(); ) {
      var r2 = n2.oe();
      if (this.H(r2.key, t3[1]) >= 0)
        return;
      e(r2.key);
    }
  }, t2.prototype.Ae = function(t3, e) {
    var n2;
    for (n2 = e !== void 0 ? this.data.ee(e) : this.data.te(); n2.ce(); )
      if (!t3(n2.oe().key))
        return;
  }, t2.prototype.Re = function(t3) {
    var e = this.data.ee(t3);
    return e.ce() ? e.oe().key : null;
  }, t2.prototype.te = function() {
    return new an(this.data.te());
  }, t2.prototype.ee = function(t3) {
    return new an(this.data.ee(t3));
  }, t2.prototype.add = function(t3) {
    return this.copy(this.data.remove(t3).zt(t3, true));
  }, t2.prototype.delete = function(t3) {
    return this.has(t3) ? this.copy(this.data.remove(t3)) : this;
  }, t2.prototype.et = function() {
    return this.data.et();
  }, t2.prototype.Pe = function(t3) {
    var e = this;
    return e.size < t3.size && (e = t3, t3 = this), t3.forEach(function(t4) {
      e = e.add(t4);
    }), e;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n2 = this.data.te(), r2 = e.data.te(); n2.ce(); ) {
      var i = n2.oe().key, o = r2.oe().key;
      if (this.H(i, o) !== 0)
        return false;
    }
    return true;
  }, t2.prototype.it = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e);
    }), t3;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      return t3.push(e);
    }), "SortedSet(" + t3.toString() + ")";
  }, t2.prototype.copy = function(e) {
    var n2 = new t2(this.H);
    return n2.data = e, n2;
  }, t2;
}();
var an = function() {
  function t2(t3) {
    this.ye = t3;
  }
  return t2.prototype.oe = function() {
    return this.ye.oe().key;
  }, t2.prototype.ce = function() {
    return this.ye.ce();
  }, t2;
}();
var cn = new rn(tt.H);
function hn() {
  return cn;
}
function fn() {
  return hn();
}
var ln = new rn(tt.H);
function pn() {
  return ln;
}
var dn = new rn(tt.H);
function vn() {
  return dn;
}
var yn = new sn(tt.H);
function mn() {
  for (var t2 = [], e = 0; e < arguments.length; e++)
    t2[e] = arguments[e];
  for (var n2 = yn, r2 = 0, i = t2; r2 < i.length; r2++) {
    var o = i[r2];
    n2 = n2.add(o);
  }
  return n2;
}
var gn = new sn(C);
function wn() {
  return gn;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var bn = function() {
  function t2(t3) {
    this.H = t3 ? function(e, n2) {
      return t3(e, n2) || tt.H(e.key, n2.key);
    } : function(t4, e) {
      return tt.H(t4.key, e.key);
    }, this.ge = pn(), this.Ve = new rn(this.H);
  }
  return t2.pe = function(e) {
    return new t2(e.H);
  }, t2.prototype.has = function(t3) {
    return this.ge.get(t3) != null;
  }, t2.prototype.get = function(t3) {
    return this.ge.get(t3);
  }, t2.prototype.first = function() {
    return this.Ve.Jt();
  }, t2.prototype.last = function() {
    return this.Ve.Yt();
  }, t2.prototype.et = function() {
    return this.Ve.et();
  }, t2.prototype.indexOf = function(t3) {
    var e = this.ge.get(t3);
    return e ? this.Ve.indexOf(e) : -1;
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.Ve.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3) {
    this.Ve.Xt(function(e, n2) {
      return t3(e), false;
    });
  }, t2.prototype.add = function(t3) {
    var e = this.delete(t3.key);
    return e.copy(e.ge.zt(t3.key, t3), e.Ve.zt(t3, null));
  }, t2.prototype.delete = function(t3) {
    var e = this.get(t3);
    return e ? this.copy(this.ge.remove(t3), this.Ve.remove(e)) : this;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n2 = this.Ve.te(), r2 = e.Ve.te(); n2.ce(); ) {
      var i = n2.oe().key, o = r2.oe().key;
      if (!i.isEqual(o))
        return false;
    }
    return true;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e.toString());
    }), t3.length === 0 ? "DocumentSet ()" : "DocumentSet (\n  " + t3.join("  \n") + "\n)";
  }, t2.prototype.copy = function(e, n2) {
    var r2 = new t2();
    return r2.H = this.H, r2.ge = e, r2.Ve = n2, r2;
  }, t2;
}();
var _n = function() {
  function t2() {
    this.be = new rn(tt.H);
  }
  return t2.prototype.track = function(t3) {
    var e = t3.doc.key, n2 = this.be.get(e);
    n2 ? t3.type !== 0 && n2.type === 3 ? this.be = this.be.zt(e, t3) : t3.type === 3 && n2.type !== 1 ? this.be = this.be.zt(e, {
      type: n2.type,
      doc: t3.doc
    }) : t3.type === 2 && n2.type === 2 ? this.be = this.be.zt(e, {
      type: 2,
      doc: t3.doc
    }) : t3.type === 2 && n2.type === 0 ? this.be = this.be.zt(e, {
      type: 0,
      doc: t3.doc
    }) : t3.type === 1 && n2.type === 0 ? this.be = this.be.remove(e) : t3.type === 1 && n2.type === 2 ? this.be = this.be.zt(e, {
      type: 1,
      doc: n2.doc
    }) : t3.type === 0 && n2.type === 1 ? this.be = this.be.zt(e, {
      type: 2,
      doc: t3.doc
    }) : x2() : this.be = this.be.zt(e, t3);
  }, t2.prototype.ve = function() {
    var t3 = [];
    return this.be.Xt(function(e, n2) {
      t3.push(n2);
    }), t3;
  }, t2;
}();
var In = function() {
  function t2(t3, e, n2, r2, i, o, u, s) {
    this.query = t3, this.docs = e, this.Se = n2, this.docChanges = r2, this.De = i, this.fromCache = o, this.Ce = u, this.xe = s;
  }
  return t2.Ne = function(e, n2, r2, i) {
    var o = [];
    return n2.forEach(function(t3) {
      o.push({
        type: 0,
        doc: t3
      });
    }), new t2(e, n2, bn.pe(n2), o, r2, i, true, false);
  }, Object.defineProperty(t2.prototype, "hasPendingWrites", {
    get: function() {
      return !this.De.et();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    if (!(this.fromCache === t3.fromCache && this.Ce === t3.Ce && this.De.isEqual(t3.De) && le(this.query, t3.query) && this.docs.isEqual(t3.docs) && this.Se.isEqual(t3.Se)))
      return false;
    var e = this.docChanges, n2 = t3.docChanges;
    if (e.length !== n2.length)
      return false;
    for (var r2 = 0; r2 < e.length; r2++)
      if (e[r2].type !== n2[r2].type || !e[r2].doc.isEqual(n2[r2].doc))
        return false;
    return true;
  }, t2;
}();
var En = function() {
  function t2(t3, e, n2, r2, i) {
    this.Ot = t3, this.$e = e, this.Fe = n2, this.Oe = r2, this.ke = i;
  }
  return t2.Me = function(e, n2) {
    var r2 = new Map();
    return r2.set(e, Tn.Le(e, n2)), new t2(X2.min(), r2, wn(), hn(), mn());
  }, t2;
}();
var Tn = function() {
  function t2(t3, e, n2, r2, i) {
    this.resumeToken = t3, this.Be = e, this.qe = n2, this.Ue = r2, this.Qe = i;
  }
  return t2.Le = function(e, n2) {
    return new t2(U2.T, n2, mn(), mn(), mn());
  }, t2;
}();
var Nn = function(t2, e, n2, r2) {
  this.Ke = t2, this.removedTargetIds = e, this.key = n2, this.We = r2;
};
var An = function(t2, e) {
  this.targetId = t2, this.je = e;
};
var Dn = function(t2, e, n2, r2) {
  n2 === void 0 && (n2 = U2.T), r2 === void 0 && (r2 = null), this.state = t2, this.targetIds = e, this.resumeToken = n2, this.cause = r2;
};
var Sn = function() {
  function t2() {
    this.Ge = 0, this.ze = On(), this.He = U2.T, this.Je = false, this.Ye = true;
  }
  return Object.defineProperty(t2.prototype, "Be", {
    get: function() {
      return this.Je;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "resumeToken", {
    get: function() {
      return this.He;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Xe", {
    get: function() {
      return this.Ge !== 0;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Ze", {
    get: function() {
      return this.Ye;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.tn = function(t3) {
    t3.l() > 0 && (this.Ye = true, this.He = t3);
  }, t2.prototype.en = function() {
    var t3 = mn(), e = mn(), n2 = mn();
    return this.ze.forEach(function(r2, i) {
      switch (i) {
        case 0:
          t3 = t3.add(r2);
          break;
        case 2:
          e = e.add(r2);
          break;
        case 1:
          n2 = n2.add(r2);
          break;
        default:
          x2();
      }
    }), new Tn(this.He, this.Je, t3, e, n2);
  }, t2.prototype.nn = function() {
    this.Ye = false, this.ze = On();
  }, t2.prototype.sn = function(t3, e) {
    this.Ye = true, this.ze = this.ze.zt(t3, e);
  }, t2.prototype.rn = function(t3) {
    this.Ye = true, this.ze = this.ze.remove(t3);
  }, t2.prototype.on = function() {
    this.Ge += 1;
  }, t2.prototype.cn = function() {
    this.Ge -= 1;
  }, t2.prototype.an = function() {
    this.Ye = true, this.Je = true;
  }, t2;
}();
var xn = function() {
  function t2(t3) {
    this.un = t3, this.hn = new Map(), this.ln = hn(), this._n = kn(), this.fn = new sn(C);
  }
  return t2.prototype.dn = function(t3) {
    for (var e = 0, n2 = t3.Ke; e < n2.length; e++) {
      var r2 = n2[e];
      t3.We instanceof Pt ? this.wn(r2, t3.We) : t3.We instanceof Vt && this.En(r2, t3.key, t3.We);
    }
    for (var i = 0, o = t3.removedTargetIds; i < o.length; i++) {
      r2 = o[i];
      this.En(r2, t3.key, t3.We);
    }
  }, t2.prototype.Tn = function(t3) {
    var e = this;
    this.In(t3, function(n2) {
      var r2 = e.mn(n2);
      switch (t3.state) {
        case 0:
          e.An(n2) && r2.tn(t3.resumeToken);
          break;
        case 1:
          r2.cn(), r2.Xe || r2.nn(), r2.tn(t3.resumeToken);
          break;
        case 2:
          r2.cn(), r2.Xe || e.removeTarget(n2);
          break;
        case 3:
          e.An(n2) && (r2.an(), r2.tn(t3.resumeToken));
          break;
        case 4:
          e.An(n2) && (e.Rn(n2), r2.tn(t3.resumeToken));
          break;
        default:
          x2();
      }
    });
  }, t2.prototype.In = function(t3, e) {
    var n2 = this;
    t3.targetIds.length > 0 ? t3.targetIds.forEach(e) : this.hn.forEach(function(t4, r2) {
      n2.An(r2) && e(r2);
    });
  }, t2.prototype.Pn = function(t3) {
    var e = t3.targetId, n2 = t3.je.count, r2 = this.yn(e);
    if (r2) {
      var i = r2.target;
      if (qt(i))
        if (n2 === 0) {
          var o = new tt(i.path);
          this.En(e, o, new Vt(o, X2.min()));
        } else
          k2(n2 === 1);
      else
        this.gn(e) !== n2 && (this.Rn(e), this.fn = this.fn.add(e));
    }
  }, t2.prototype.Vn = function(t3) {
    var e = this, n2 = new Map();
    this.hn.forEach(function(r3, i2) {
      var o = e.yn(i2);
      if (o) {
        if (r3.Be && qt(o.target)) {
          var u = new tt(o.target.path);
          e.ln.get(u) !== null || e.pn(i2, u) || e.En(i2, u, new Vt(u, t3));
        }
        r3.Ze && (n2.set(i2, r3.en()), r3.nn());
      }
    });
    var r2 = mn();
    this._n.forEach(function(t4, n3) {
      var i2 = true;
      n3.Ae(function(t5) {
        var n4 = e.yn(t5);
        return !n4 || n4.Ft === 2 || (i2 = false, false);
      }), i2 && (r2 = r2.add(t4));
    });
    var i = new En(t3, n2, this.fn, this.ln, r2);
    return this.ln = hn(), this._n = kn(), this.fn = new sn(C), i;
  }, t2.prototype.wn = function(t3, e) {
    if (this.An(t3)) {
      var n2 = this.pn(t3, e.key) ? 2 : 0;
      this.mn(t3).sn(e.key, n2), this.ln = this.ln.zt(e.key, e), this._n = this._n.zt(e.key, this.bn(e.key).add(t3));
    }
  }, t2.prototype.En = function(t3, e, n2) {
    if (this.An(t3)) {
      var r2 = this.mn(t3);
      this.pn(t3, e) ? r2.sn(e, 1) : r2.rn(e), this._n = this._n.zt(e, this.bn(e).delete(t3)), n2 && (this.ln = this.ln.zt(e, n2));
    }
  }, t2.prototype.removeTarget = function(t3) {
    this.hn.delete(t3);
  }, t2.prototype.gn = function(t3) {
    var e = this.mn(t3).en();
    return this.un.vn(t3).size + e.qe.size - e.Qe.size;
  }, t2.prototype.on = function(t3) {
    this.mn(t3).on();
  }, t2.prototype.mn = function(t3) {
    var e = this.hn.get(t3);
    return e || (e = new Sn(), this.hn.set(t3, e)), e;
  }, t2.prototype.bn = function(t3) {
    var e = this._n.get(t3);
    return e || (e = new sn(C), this._n = this._n.zt(t3, e)), e;
  }, t2.prototype.An = function(t3) {
    var e = this.yn(t3) !== null;
    return e || N2("WatchChangeAggregator", "Detected inactive target", t3), e;
  }, t2.prototype.yn = function(t3) {
    var e = this.hn.get(t3);
    return e && e.Xe ? null : this.un.Sn(t3);
  }, t2.prototype.Rn = function(t3) {
    var e = this;
    this.hn.set(t3, new Sn()), this.un.vn(t3).forEach(function(n2) {
      e.En(t3, n2, null);
    });
  }, t2.prototype.pn = function(t3, e) {
    return this.un.vn(t3).has(e);
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function kn() {
  return new rn(tt.H);
}
function On() {
  return new rn(tt.H);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Pn = {
  asc: "ASCENDING",
  desc: "DESCENDING"
};
var Vn = {
  "<": "LESS_THAN",
  "<=": "LESS_THAN_OR_EQUAL",
  ">": "GREATER_THAN",
  ">=": "GREATER_THAN_OR_EQUAL",
  "==": "EQUAL",
  "!=": "NOT_EQUAL",
  "array-contains": "ARRAY_CONTAINS",
  in: "IN",
  "not-in": "NOT_IN",
  "array-contains-any": "ARRAY_CONTAINS_ANY"
};
var Cn = function(t2, e) {
  this.t = t2, this.Bt = e;
};
function Ln(t2, e) {
  return t2.Bt ? new Date(1e3 * e.seconds).toISOString().replace(/\.\d*/, "").replace("Z", "") + "." + ("000000000" + e.nanoseconds).slice(-9) + "Z" : {
    seconds: "" + e.seconds,
    nanos: e.nanoseconds
  };
}
function Rn(t2, e) {
  return t2.Bt ? e.toBase64() : e.toUint8Array();
}
function Un(t2, e) {
  return Ln(t2, e.j());
}
function Mn(t2) {
  return k2(!!t2), X2.K(function(t3) {
    var e = ut(t3);
    return new K2(e.seconds, e.nanos);
  }(t2));
}
function qn(t2, e) {
  return function(t3) {
    return new Z2(["projects", t3.projectId, "databases", t3.database]);
  }(t2).child("documents").child(e).rt();
}
function Fn(t2) {
  var e = Z2.ot(t2);
  return k2(hr(e)), e;
}
function jn(t2, e) {
  return qn(t2.t, e.path);
}
function zn(t2, e) {
  var n2 = Fn(e);
  if (n2.get(1) !== t2.t.projectId)
    throw new q2(M2.INVALID_ARGUMENT, "Tried to deserialize key from different project: " + n2.get(1) + " vs " + t2.t.projectId);
  if (n2.get(3) !== t2.t.database)
    throw new q2(M2.INVALID_ARGUMENT, "Tried to deserialize key from different database: " + n2.get(3) + " vs " + t2.t.database);
  return new tt(Yn(n2));
}
function Gn(t2, e) {
  return qn(t2.t, e);
}
function Bn(t2) {
  var e = Fn(t2);
  return e.length === 4 ? Z2.ct() : Yn(e);
}
function Qn(t2) {
  return new Z2(["projects", t2.t.projectId, "databases", t2.t.database]).rt();
}
function Yn(t2) {
  return k2(t2.length > 4 && t2.get(4) === "documents"), t2.Y(5);
}
function Hn(t2, e, n2) {
  return {
    name: jn(t2, e),
    fields: n2.proto.mapValue.fields
  };
}
function Kn(t2, e, n2) {
  var r2 = zn(t2, e.name), i = Mn(e.updateTime), o = new St({
    mapValue: {
      fields: e.fields
    }
  });
  return new Pt(r2, i, o, {
    hasCommittedMutations: !!n2
  });
}
function Xn(t2, e) {
  var n2;
  if (e instanceof Be)
    n2 = {
      update: Hn(t2, e.key, e.value)
    };
  else if (e instanceof Je)
    n2 = {
      delete: jn(t2, e.key)
    };
  else if (e instanceof Qe)
    n2 = {
      update: Hn(t2, e.key, e.data),
      updateMask: cr(e.Gt)
    };
  else {
    if (!(e instanceof $e))
      return x2();
    n2 = {
      verify: jn(t2, e.key)
    };
  }
  return e.fieldTransforms.length > 0 && (n2.updateTransforms = e.fieldTransforms.map(function(t3) {
    return function(t4, e2) {
      var n3 = e2.transform;
      if (n3 instanceof Ae)
        return {
          fieldPath: e2.field.rt(),
          setToServerValue: "REQUEST_TIME"
        };
      if (n3 instanceof De)
        return {
          fieldPath: e2.field.rt(),
          appendMissingElements: {
            values: n3.elements
          }
        };
      if (n3 instanceof xe)
        return {
          fieldPath: e2.field.rt(),
          removeAllFromArray: {
            values: n3.elements
          }
        };
      if (n3 instanceof Oe)
        return {
          fieldPath: e2.field.rt(),
          increment: n3.Ut
        };
      throw x2();
    }(0, t3);
  })), e.jt.Wt || (n2.currentDocument = function(t3, e2) {
    return e2.updateTime !== void 0 ? {
      updateTime: Un(t3, e2.updateTime)
    } : e2.exists !== void 0 ? {
      exists: e2.exists
    } : x2();
  }(t2, e.jt)), n2;
}
function Wn(t2, e) {
  var n2 = e.currentDocument ? function(t3) {
    return t3.updateTime !== void 0 ? Re.updateTime(Mn(t3.updateTime)) : t3.exists !== void 0 ? Re.exists(t3.exists) : Re.Kt();
  }(e.currentDocument) : Re.Kt(), r2 = e.updateTransforms ? e.updateTransforms.map(function(e2) {
    return function(t3, e3) {
      var n3 = null;
      if ("setToServerValue" in e3)
        k2(e3.setToServerValue === "REQUEST_TIME"), n3 = new Ae();
      else if ("appendMissingElements" in e3) {
        var r3 = e3.appendMissingElements.values || [];
        n3 = new De(r3);
      } else if ("removeAllFromArray" in e3) {
        var i2 = e3.removeAllFromArray.values || [];
        n3 = new xe(i2);
      } else
        "increment" in e3 ? n3 = new Oe(t3, e3.increment) : x2();
      var o2 = $.lt(e3.fieldPath);
      return new Ce(o2, n3);
    }(t2, e2);
  }) : [];
  if (e.update) {
    e.update.name;
    var i = zn(t2, e.update.name), o = new St({
      mapValue: {
        fields: e.update.fields
      }
    });
    if (e.updateMask) {
      var u = function(t3) {
        var e2 = t3.fieldPaths || [];
        return new it(e2.map(function(t4) {
          return $.lt(t4);
        }));
      }(e.updateMask);
      return new Qe(i, o, u, n2, r2);
    }
    return new Be(i, o, n2, r2);
  }
  if (e.delete) {
    var s = zn(t2, e.delete);
    return new Je(s, n2);
  }
  if (e.verify) {
    var a = zn(t2, e.verify);
    return new $e(a, n2);
  }
  return x2();
}
function Zn(t2, e) {
  return {
    documents: [Gn(t2, e.path)]
  };
}
function Jn(t2, e) {
  var n2 = {
    structuredQuery: {}
  }, r2 = e.path;
  e.collectionGroup !== null ? (n2.parent = Gn(t2, r2), n2.structuredQuery.from = [{
    collectionId: e.collectionGroup,
    allDescendants: true
  }]) : (n2.parent = Gn(t2, r2.X()), n2.structuredQuery.from = [{
    collectionId: r2.tt()
  }]);
  var i = function(t3) {
    if (t3.length !== 0) {
      var e2 = t3.map(function(t4) {
        return function(t5) {
          if (t5.op === "==") {
            if (At(t5.value))
              return {
                unaryFilter: {
                  field: or(t5.field),
                  op: "IS_NAN"
                }
              };
            if (Nt(t5.value))
              return {
                unaryFilter: {
                  field: or(t5.field),
                  op: "IS_NULL"
                }
              };
          } else if (t5.op === "!=") {
            if (At(t5.value))
              return {
                unaryFilter: {
                  field: or(t5.field),
                  op: "IS_NOT_NAN"
                }
              };
            if (Nt(t5.value))
              return {
                unaryFilter: {
                  field: or(t5.field),
                  op: "IS_NOT_NULL"
                }
              };
          }
          return {
            fieldFilter: {
              field: or(t5.field),
              op: ir(t5.op),
              value: t5.value
            }
          };
        }(t4);
      });
      return e2.length === 1 ? e2[0] : {
        compositeFilter: {
          op: "AND",
          filters: e2
        }
      };
    }
  }(e.filters);
  i && (n2.structuredQuery.where = i);
  var o = function(t3) {
    if (t3.length !== 0)
      return t3.map(function(t4) {
        return function(t5) {
          return {
            field: or(t5.field),
            direction: rr(t5.dir)
          };
        }(t4);
      });
  }(e.orderBy);
  o && (n2.structuredQuery.orderBy = o);
  var u = function(t3, e2) {
    return t3.Bt || lt(e2) ? e2 : {
      value: e2
    };
  }(t2, e.limit);
  return u !== null && (n2.structuredQuery.limit = u), e.startAt && (n2.structuredQuery.startAt = er(e.startAt)), e.endAt && (n2.structuredQuery.endAt = er(e.endAt)), n2;
}
function $n(t2) {
  var e = Bn(t2.parent), n2 = t2.structuredQuery, r2 = n2.from ? n2.from.length : 0, i = null;
  if (r2 > 0) {
    k2(r2 === 1);
    var o = n2.from[0];
    o.allDescendants ? i = o.collectionId : e = e.child(o.collectionId);
  }
  var u = [];
  n2.where && (u = tr(n2.where));
  var s = [];
  n2.orderBy && (s = n2.orderBy.map(function(t3) {
    return function(t4) {
      return new Zt(ur(t4.field), function(t5) {
        switch (t5) {
          case "ASCENDING":
            return "asc";
          case "DESCENDING":
            return "desc";
          default:
            return;
        }
      }(t4.direction));
    }(t3);
  }));
  var a = null;
  n2.limit && (a = function(t3) {
    var e2;
    return lt(e2 = typeof t3 == "object" ? t3.value : t3) ? null : e2;
  }(n2.limit));
  var c = null;
  n2.startAt && (c = nr(n2.startAt));
  var h2 = null;
  return n2.endAt && (h2 = nr(n2.endAt)), ne(e, i, s, u, a, "F", c, h2);
}
function tr(t2) {
  return t2 ? t2.unaryFilter !== void 0 ? [ar(t2)] : t2.fieldFilter !== void 0 ? [sr(t2)] : t2.compositeFilter !== void 0 ? t2.compositeFilter.filters.map(function(t3) {
    return tr(t3);
  }).reduce(function(t3, e) {
    return t3.concat(e);
  }) : x2() : [];
}
function er(t2) {
  return {
    before: t2.before,
    values: t2.position
  };
}
function nr(t2) {
  var e = !!t2.before, n2 = t2.values || [];
  return new Xt(n2, e);
}
function rr(t2) {
  return Pn[t2];
}
function ir(t2) {
  return Vn[t2];
}
function or(t2) {
  return {
    fieldPath: t2.rt()
  };
}
function ur(t2) {
  return $.lt(t2.fieldPath);
}
function sr(t2) {
  return Ft.create(ur(t2.fieldFilter.field), function(t3) {
    switch (t3) {
      case "EQUAL":
        return "==";
      case "NOT_EQUAL":
        return "!=";
      case "GREATER_THAN":
        return ">";
      case "GREATER_THAN_OR_EQUAL":
        return ">=";
      case "LESS_THAN":
        return "<";
      case "LESS_THAN_OR_EQUAL":
        return "<=";
      case "ARRAY_CONTAINS":
        return "array-contains";
      case "IN":
        return "in";
      case "NOT_IN":
        return "not-in";
      case "ARRAY_CONTAINS_ANY":
        return "array-contains-any";
      case "OPERATOR_UNSPECIFIED":
      default:
        return x2();
    }
  }(t2.fieldFilter.op), t2.fieldFilter.value);
}
function ar(t2) {
  switch (t2.unaryFilter.op) {
    case "IS_NAN":
      var e = ur(t2.unaryFilter.field);
      return Ft.create(e, "==", {
        doubleValue: NaN
      });
    case "IS_NULL":
      var n2 = ur(t2.unaryFilter.field);
      return Ft.create(n2, "==", {
        nullValue: "NULL_VALUE"
      });
    case "IS_NOT_NAN":
      var r2 = ur(t2.unaryFilter.field);
      return Ft.create(r2, "!=", {
        doubleValue: NaN
      });
    case "IS_NOT_NULL":
      var i = ur(t2.unaryFilter.field);
      return Ft.create(i, "!=", {
        nullValue: "NULL_VALUE"
      });
    case "OPERATOR_UNSPECIFIED":
    default:
      return x2();
  }
}
function cr(t2) {
  var e = [];
  return t2.fields.forEach(function(t3) {
    return e.push(t3.rt());
  }), {
    fieldPaths: e
  };
}
function hr(t2) {
  return t2.length >= 4 && t2.get(0) === "projects" && t2.get(2) === "databases";
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var fr = function() {
  var t2 = this;
  this.promise = new Promise(function(e, n2) {
    t2.resolve = e, t2.reject = n2;
  });
};
var lr = function() {
  function t2(t3) {
    var e = this;
    this.Dn = null, this.Cn = null, this.result = void 0, this.error = void 0, this.xn = false, this.Nn = false, t3(function(t4) {
      e.xn = true, e.result = t4, e.Dn && e.Dn(t4);
    }, function(t4) {
      e.xn = true, e.error = t4, e.Cn && e.Cn(t4);
    });
  }
  return t2.prototype.catch = function(t3) {
    return this.next(void 0, t3);
  }, t2.prototype.next = function(e, n2) {
    var r2 = this;
    return this.Nn && x2(), this.Nn = true, this.xn ? this.error ? this.$n(n2, this.error) : this.Fn(e, this.result) : new t2(function(t3, i) {
      r2.Dn = function(n3) {
        r2.Fn(e, n3).next(t3, i);
      }, r2.Cn = function(e2) {
        r2.$n(n2, e2).next(t3, i);
      };
    });
  }, t2.prototype.On = function() {
    var t3 = this;
    return new Promise(function(e, n2) {
      t3.next(e, n2);
    });
  }, t2.prototype.kn = function(e) {
    try {
      var n2 = e();
      return n2 instanceof t2 ? n2 : t2.resolve(n2);
    } catch (e2) {
      return t2.reject(e2);
    }
  }, t2.prototype.Fn = function(e, n2) {
    return e ? this.kn(function() {
      return e(n2);
    }) : t2.resolve(n2);
  }, t2.prototype.$n = function(e, n2) {
    return e ? this.kn(function() {
      return e(n2);
    }) : t2.reject(n2);
  }, t2.resolve = function(e) {
    return new t2(function(t3, n2) {
      t3(e);
    });
  }, t2.reject = function(e) {
    return new t2(function(t3, n2) {
      n2(e);
    });
  }, t2.Mn = function(e) {
    return new t2(function(t3, n2) {
      var r2 = 0, i = 0, o = false;
      e.forEach(function(e2) {
        ++r2, e2.next(function() {
          ++i, o && i === r2 && t3();
        }, function(t4) {
          return n2(t4);
        });
      }), o = true, i === r2 && t3();
    });
  }, t2.Ln = function(e) {
    for (var n2 = t2.resolve(false), r2 = function(e2) {
      n2 = n2.next(function(n3) {
        return n3 ? t2.resolve(n3) : e2();
      });
    }, i = 0, o = e; i < o.length; i++) {
      r2(o[i]);
    }
    return n2;
  }, t2.forEach = function(t3, e) {
    var n2 = this, r2 = [];
    return t3.forEach(function(t4, i) {
      r2.push(e.call(n2, t4, i));
    }), this.Mn(r2);
  }, t2;
}();
var pr = function() {
  function t2(t3, e) {
    var n2 = this;
    this.action = t3, this.transaction = e, this.aborted = false, this.Bn = new fr(), this.transaction.oncomplete = function() {
      n2.Bn.resolve();
    }, this.transaction.onabort = function() {
      e.error ? n2.Bn.reject(new yr(t3, e.error)) : n2.Bn.resolve();
    }, this.transaction.onerror = function(e2) {
      var r2 = _r(e2.target.error);
      n2.Bn.reject(new yr(t3, r2));
    };
  }
  return t2.open = function(e, n2, r2, i) {
    try {
      return new t2(n2, e.transaction(i, r2));
    } catch (e2) {
      throw new yr(n2, e2);
    }
  }, Object.defineProperty(t2.prototype, "qn", {
    get: function() {
      return this.Bn.promise;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.abort = function(t3) {
    t3 && this.Bn.reject(t3), this.aborted || (N2("SimpleDb", "Aborting transaction:", t3 ? t3.message : "Client-initiated abort"), this.aborted = true, this.transaction.abort());
  }, t2.prototype.store = function(t3) {
    var e = this.transaction.objectStore(t3);
    return new gr(e);
  }, t2;
}();
var dr = function() {
  function t2(e, r2, i) {
    this.name = e, this.version = r2, this.Un = i, t2.Qn(getUA()) === 12.2 && A2("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
  }
  return t2.delete = function(t3) {
    return N2("SimpleDb", "Removing database:", t3), wr(window.indexedDB.deleteDatabase(t3)).On();
  }, t2.Kn = function() {
    if (typeof indexedDB == "undefined")
      return false;
    if (t2.Wn())
      return true;
    var e = getUA(), r2 = t2.Qn(e), i = 0 < r2 && r2 < 10, o = t2.jn(e), u = 0 < o && o < 4.5;
    return !(e.indexOf("MSIE ") > 0 || e.indexOf("Trident/") > 0 || e.indexOf("Edge/") > 0 || i || u);
  }, t2.Wn = function() {
    var t3;
    return typeof process != "undefined" && ((t3 = process.env) === null || t3 === void 0 ? void 0 : t3.Gn) === "YES";
  }, t2.zn = function(t3, e) {
    return t3.store(e);
  }, t2.Qn = function(t3) {
    var e = t3.match(/i(?:phone|pad|pod) os ([\d_]+)/i), n2 = e ? e[1].split("_").slice(0, 2).join(".") : "-1";
    return Number(n2);
  }, t2.jn = function(t3) {
    var e = t3.match(/Android ([\d.]+)/i), n2 = e ? e[1].split(".").slice(0, 2).join(".") : "-1";
    return Number(n2);
  }, t2.prototype.Hn = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e, n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.db ? [3, 2] : (N2("SimpleDb", "Opening database:", this.name), e = this, [4, new Promise(function(e2, r3) {
              var i = indexedDB.open(n2.name, n2.version);
              i.onsuccess = function(t4) {
                var n3 = t4.target.result;
                e2(n3);
              }, i.onblocked = function() {
                r3(new yr(t3, "Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."));
              }, i.onerror = function(e3) {
                var n3 = e3.target.error;
                n3.name === "VersionError" ? r3(new q2(M2.FAILED_PRECONDITION, "A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")) : r3(new yr(t3, n3));
              }, i.onupgradeneeded = function(t4) {
                N2("SimpleDb", 'Database "' + n2.name + '" requires upgrade from version:', t4.oldVersion);
                var e3 = t4.target.result;
                n2.Un.Jn(e3, i.transaction, t4.oldVersion, n2.version).next(function() {
                  N2("SimpleDb", "Database upgrade to version " + n2.version + " complete");
                });
              };
            })]);
          case 1:
            e.db = r2.sent(), r2.label = 2;
          case 2:
            return [2, (this.Yn && (this.db.onversionchange = function(t4) {
              return n2.Yn(t4);
            }), this.db)];
        }
      });
    });
  }, t2.prototype.Xn = function(t3) {
    this.Yn = t3, this.db && (this.db.onversionchange = function(e) {
      return t3(e);
    });
  }, t2.prototype.runTransaction = function(t3, e, n2, r2) {
    return __awaiter(this, void 0, void 0, function() {
      var i, o, u, s, a;
      return __generator(this, function(c) {
        switch (c.label) {
          case 0:
            i = e === "readonly", o = 0, u = function() {
              var e2, u2, a2, c2, h2;
              return __generator(this, function(f) {
                switch (f.label) {
                  case 0:
                    ++o, f.label = 1;
                  case 1:
                    return f.trys.push([1, 4, , 5]), [4, s.Hn(t3)];
                  case 2:
                    return s.db = f.sent(), e2 = pr.open(s.db, t3, i ? "readonly" : "readwrite", n2), u2 = r2(e2).catch(function(t4) {
                      return e2.abort(t4), lr.reject(t4);
                    }).On(), a2 = {}, u2.catch(function() {
                    }), [4, e2.qn];
                  case 3:
                    return [2, (a2.value = (f.sent(), u2), a2)];
                  case 4:
                    return c2 = f.sent(), h2 = c2.name !== "FirebaseError" && o < 3, N2("SimpleDb", "Transaction failed with error:", c2.message, "Retrying:", h2), s.close(), h2 ? [3, 5] : [2, {
                      value: Promise.reject(c2)
                    }];
                  case 5:
                    return [2];
                }
              });
            }, s = this, c.label = 1;
          case 1:
            return [5, u()];
          case 2:
            if (typeof (a = c.sent()) == "object")
              return [2, a.value];
            c.label = 3;
          case 3:
            return [3, 1];
          case 4:
            return [2];
        }
      });
    });
  }, t2.prototype.close = function() {
    this.db && this.db.close(), this.db = void 0;
  }, t2;
}();
var vr = function() {
  function t2(t3) {
    this.Zn = t3, this.ts = false, this.es = null;
  }
  return Object.defineProperty(t2.prototype, "xn", {
    get: function() {
      return this.ts;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "ns", {
    get: function() {
      return this.es;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "cursor", {
    set: function(t3) {
      this.Zn = t3;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.done = function() {
    this.ts = true;
  }, t2.prototype.ss = function(t3) {
    this.es = t3;
  }, t2.prototype.delete = function() {
    return wr(this.Zn.delete());
  }, t2;
}();
var yr = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, M2.UNAVAILABLE, "IndexedDB transaction '" + e2 + "' failed: " + n2) || this).name = "IndexedDbTransactionError", r2;
  }
  return __extends(e, t2), e;
}(q2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function mr(t2) {
  return t2.name === "IndexedDbTransactionError";
}
var gr = function() {
  function t2(t3) {
    this.store = t3;
  }
  return t2.prototype.put = function(t3, e) {
    var n2;
    return e !== void 0 ? (N2("SimpleDb", "PUT", this.store.name, t3, e), n2 = this.store.put(e, t3)) : (N2("SimpleDb", "PUT", this.store.name, "<auto-key>", t3), n2 = this.store.put(t3)), wr(n2);
  }, t2.prototype.add = function(t3) {
    return N2("SimpleDb", "ADD", this.store.name, t3, t3), wr(this.store.add(t3));
  }, t2.prototype.get = function(t3) {
    var e = this;
    return wr(this.store.get(t3)).next(function(n2) {
      return n2 === void 0 && (n2 = null), N2("SimpleDb", "GET", e.store.name, t3, n2), n2;
    });
  }, t2.prototype.delete = function(t3) {
    return N2("SimpleDb", "DELETE", this.store.name, t3), wr(this.store.delete(t3));
  }, t2.prototype.count = function() {
    return N2("SimpleDb", "COUNT", this.store.name), wr(this.store.count());
  }, t2.prototype.rs = function(t3, e) {
    var n2 = this.cursor(this.options(t3, e)), r2 = [];
    return this.os(n2, function(t4, e2) {
      r2.push(e2);
    }).next(function() {
      return r2;
    });
  }, t2.prototype.cs = function(t3, e) {
    N2("SimpleDb", "DELETE ALL", this.store.name);
    var n2 = this.options(t3, e);
    n2.us = false;
    var r2 = this.cursor(n2);
    return this.os(r2, function(t4, e2, n3) {
      return n3.delete();
    });
  }, t2.prototype.hs = function(t3, e) {
    var n2;
    e ? n2 = t3 : (n2 = {}, e = t3);
    var r2 = this.cursor(n2);
    return this.os(r2, e);
  }, t2.prototype.ls = function(t3) {
    var e = this.cursor({});
    return new lr(function(n2, r2) {
      e.onerror = function(t4) {
        var e2 = _r(t4.target.error);
        r2(e2);
      }, e.onsuccess = function(e2) {
        var r3 = e2.target.result;
        r3 ? t3(r3.primaryKey, r3.value).next(function(t4) {
          t4 ? r3.continue() : n2();
        }) : n2();
      };
    });
  }, t2.prototype.os = function(t3, e) {
    var n2 = [];
    return new lr(function(r2, i) {
      t3.onerror = function(t4) {
        i(t4.target.error);
      }, t3.onsuccess = function(t4) {
        var i2 = t4.target.result;
        if (i2) {
          var o = new vr(i2), u = e(i2.primaryKey, i2.value, o);
          if (u instanceof lr) {
            var s = u.catch(function(t5) {
              return o.done(), lr.reject(t5);
            });
            n2.push(s);
          }
          o.xn ? r2() : o.ns === null ? i2.continue() : i2.continue(o.ns);
        } else
          r2();
      };
    }).next(function() {
      return lr.Mn(n2);
    });
  }, t2.prototype.options = function(t3, e) {
    var n2;
    return t3 !== void 0 && (typeof t3 == "string" ? n2 = t3 : e = t3), {
      index: n2,
      range: e
    };
  }, t2.prototype.cursor = function(t3) {
    var e = "next";
    if (t3.reverse && (e = "prev"), t3.index) {
      var n2 = this.store.index(t3.index);
      return t3.us ? n2.openKeyCursor(t3.range, e) : n2.openCursor(t3.range, e);
    }
    return this.store.openCursor(t3.range, e);
  }, t2;
}();
function wr(t2) {
  return new lr(function(e, n2) {
    t2.onsuccess = function(t3) {
      var n3 = t3.target.result;
      e(n3);
    }, t2.onerror = function(t3) {
      var e2 = _r(t3.target.error);
      n2(e2);
    };
  });
}
var br = false;
function _r(t2) {
  var e = dr.Qn(getUA());
  if (e >= 12.2 && e < 13) {
    var r2 = "An internal error was encountered in the Indexed Database server";
    if (t2.message.indexOf(r2) >= 0) {
      var i = new q2("internal", "IOS_INDEXEDDB_BUG1: IndexedDb has thrown '" + r2 + "'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
      return br || (br = true, setTimeout(function() {
        throw i;
      }, 0)), i;
    }
  }
  return t2;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ir = function() {
  function t2(t3, e, n2, r2, i) {
    this._s = t3, this.fs = e, this.ds = n2, this.op = r2, this.ws = i, this.Es = new fr(), this.then = this.Es.promise.then.bind(this.Es.promise), this.Es.promise.catch(function(t4) {
    });
  }
  return t2.Ts = function(e, n2, r2, i, o) {
    var u = new t2(e, n2, Date.now() + r2, i, o);
    return u.start(r2), u;
  }, t2.prototype.start = function(t3) {
    var e = this;
    this.Is = setTimeout(function() {
      return e.As();
    }, t3);
  }, t2.prototype.Rs = function() {
    return this.As();
  }, t2.prototype.cancel = function(t3) {
    this.Is !== null && (this.clearTimeout(), this.Es.reject(new q2(M2.CANCELLED, "Operation cancelled" + (t3 ? ": " + t3 : ""))));
  }, t2.prototype.As = function() {
    var t3 = this;
    this._s.Ps(function() {
      return t3.Is !== null ? (t3.clearTimeout(), t3.op().then(function(e) {
        return t3.Es.resolve(e);
      })) : Promise.resolve();
    });
  }, t2.prototype.clearTimeout = function() {
    this.Is !== null && (this.ws(this), clearTimeout(this.Is), this.Is = null);
  }, t2;
}();
function Er(t2, e) {
  if (A2("AsyncQueue", e + ": " + t2), mr(t2))
    return new q2(M2.UNAVAILABLE, e + ": " + t2);
  throw t2;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Tr = "The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";
var Nr = function() {
  function t2() {
    this.ys = [];
  }
  return t2.prototype.gs = function(t3) {
    this.ys.push(t3);
  }, t2.prototype.Vs = function() {
    this.ys.forEach(function(t3) {
      return t3();
    });
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ar(t2) {
  for (var e = "", n2 = 0; n2 < t2.length; n2++)
    e.length > 0 && (e = Sr(e)), e = Dr(t2.get(n2), e);
  return Sr(e);
}
function Dr(t2, e) {
  for (var n2 = e, r2 = t2.length, i = 0; i < r2; i++) {
    var o = t2.charAt(i);
    switch (o) {
      case "\0":
        n2 += "";
        break;
      case "":
        n2 += "";
        break;
      default:
        n2 += o;
    }
  }
  return n2;
}
function Sr(t2) {
  return t2 + "";
}
function xr(t2) {
  var e = t2.length;
  if (k2(e >= 2), e === 2)
    return k2(t2.charAt(0) === "" && t2.charAt(1) === ""), Z2.ct();
  for (var n2 = e - 2, r2 = [], i = "", o = 0; o < e; ) {
    var u = t2.indexOf("", o);
    switch ((u < 0 || u > n2) && x2(), t2.charAt(u + 1)) {
      case "":
        var s = t2.substring(o, u), a = void 0;
        i.length === 0 ? a = s : (a = i += s, i = ""), r2.push(a);
        break;
      case "":
        i += t2.substring(o, u), i += "\0";
        break;
      case "":
        i += t2.substring(o, u + 1);
        break;
      default:
        x2();
    }
    o = u + 2;
  }
  return new Z2(r2);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var kr = function(t2, e) {
  this.seconds = t2, this.nanoseconds = e;
};
var Or = function(t2, e, n2) {
  this.ownerId = t2, this.allowTabSynchronization = e, this.leaseTimestampMs = n2;
};
Or.store = "owner", Or.key = "owner";
var Pr = function(t2, e, n2) {
  this.userId = t2, this.lastAcknowledgedBatchId = e, this.lastStreamToken = n2;
};
Pr.store = "mutationQueues", Pr.keyPath = "userId";
var Vr = function(t2, e, n2, r2, i) {
  this.userId = t2, this.batchId = e, this.localWriteTimeMs = n2, this.baseMutations = r2, this.mutations = i;
};
Vr.store = "mutations", Vr.keyPath = "batchId", Vr.userMutationsIndex = "userMutationsIndex", Vr.userMutationsKeyPath = ["userId", "batchId"];
var Cr = function() {
  function t2() {
  }
  return t2.prefixForUser = function(t3) {
    return [t3];
  }, t2.prefixForPath = function(t3, e) {
    return [t3, Ar(e)];
  }, t2.key = function(t3, e, n2) {
    return [t3, Ar(e), n2];
  }, t2;
}();
Cr.store = "documentMutations", Cr.PLACEHOLDER = new Cr();
var Lr = function(t2, e) {
  this.path = t2, this.readTime = e;
};
var Rr = function(t2, e) {
  this.path = t2, this.version = e;
};
var Ur = function(t2, e, n2, r2, i, o) {
  this.unknownDocument = t2, this.noDocument = e, this.document = n2, this.hasCommittedMutations = r2, this.readTime = i, this.parentPath = o;
};
Ur.store = "remoteDocuments", Ur.readTimeIndex = "readTimeIndex", Ur.readTimeIndexPath = "readTime", Ur.collectionReadTimeIndex = "collectionReadTimeIndex", Ur.collectionReadTimeIndexPath = ["parentPath", "readTime"];
var Mr = function(t2) {
  this.byteSize = t2;
};
Mr.store = "remoteDocumentGlobal", Mr.key = "remoteDocumentGlobalKey";
var qr = function(t2, e, n2, r2, i, o, u) {
  this.targetId = t2, this.canonicalId = e, this.readTime = n2, this.resumeToken = r2, this.lastListenSequenceNumber = i, this.lastLimboFreeSnapshotVersion = o, this.query = u;
};
qr.store = "targets", qr.keyPath = "targetId", qr.queryTargetsIndexName = "queryTargetsIndex", qr.queryTargetsKeyPath = ["canonicalId", "targetId"];
var Fr = function(t2, e, n2) {
  this.targetId = t2, this.path = e, this.sequenceNumber = n2;
};
Fr.store = "targetDocuments", Fr.keyPath = ["targetId", "path"], Fr.documentTargetsIndex = "documentTargetsIndex", Fr.documentTargetsKeyPath = ["path", "targetId"];
var jr = function(t2, e, n2, r2) {
  this.highestTargetId = t2, this.highestListenSequenceNumber = e, this.lastRemoteSnapshotVersion = n2, this.targetCount = r2;
};
jr.key = "targetGlobalKey", jr.store = "targetGlobal";
var zr = function(t2, e) {
  this.collectionId = t2, this.parent = e;
};
zr.store = "collectionParents", zr.keyPath = ["collectionId", "parent"];
var Gr = function(t2, e, n2, r2) {
  this.clientId = t2, this.updateTimeMs = e, this.networkEnabled = n2, this.inForeground = r2;
};
Gr.store = "clientMetadata", Gr.keyPath = "clientId";
var Br = function(t2, e, n2) {
  this.bundleId = t2, this.createTime = e, this.version = n2;
};
Br.store = "bundles", Br.keyPath = "bundleId";
var Qr = function(t2, e, n2) {
  this.name = t2, this.readTime = e, this.bundledQuery = n2;
};
Qr.store = "namedQueries", Qr.keyPath = "name";
var Yr = __spreadArrays(__spreadArrays(__spreadArrays(__spreadArrays([Pr.store, Vr.store, Cr.store, Ur.store, qr.store, Or.store, jr.store, Fr.store], [Gr.store]), [Mr.store]), [zr.store]), [Br.store, Qr.store]);
var Hr = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).ps = e2, r2.bs = n2, r2;
  }
  return __extends(e, t2), e;
}(Nr);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Kr(t2, e) {
  var n2 = O2(t2);
  return dr.zn(n2.ps, e);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Xr = function() {
  function t2(t3, e, n2, r2) {
    this.batchId = t3, this.vs = e, this.baseMutations = n2, this.mutations = r2;
  }
  return t2.prototype.Ss = function(t3, e, n2) {
    for (var r2 = n2.Ds, i = 0; i < this.mutations.length; i++) {
      var o = this.mutations[i];
      o.key.isEqual(t3) && (e = qe(o, e, r2[i]));
    }
    return e;
  }, t2.prototype.Cs = function(t3, e) {
    for (var n2 = 0, r2 = this.baseMutations; n2 < r2.length; n2++) {
      (u = r2[n2]).key.isEqual(t3) && (e = Fe(u, e, this.vs));
    }
    for (var i = 0, o = this.mutations; i < o.length; i++) {
      var u;
      (u = o[i]).key.isEqual(t3) && (e = Fe(u, e, this.vs));
    }
    return e;
  }, t2.prototype.xs = function(t3) {
    var e = this, n2 = t3;
    return this.mutations.forEach(function(r2) {
      var i = e.Cs(r2.key, t3.get(r2.key));
      i && (n2 = n2.zt(r2.key, i));
    }), n2;
  }, t2.prototype.keys = function() {
    return this.mutations.reduce(function(t3, e) {
      return t3.add(e.key);
    }, mn());
  }, t2.prototype.isEqual = function(t3) {
    return this.batchId === t3.batchId && L2(this.mutations, t3.mutations, function(t4, e) {
      return ze(t4, e);
    }) && L2(this.baseMutations, t3.baseMutations, function(t4, e) {
      return ze(t4, e);
    });
  }, t2;
}();
var Wr = function() {
  function t2(t3, e, n2, r2) {
    this.batch = t3, this.Ns = e, this.Ds = n2, this.$s = r2;
  }
  return t2.from = function(e, n2, r2) {
    k2(e.mutations.length === r2.length);
    for (var i = vn(), o = e.mutations, u = 0; u < o.length; u++)
      i = i.zt(o[u].key, r2[u].version);
    return new t2(e, n2, r2, i);
  }, t2;
}();
var Zr = function(t2) {
  this.Fs = t2;
};
function Jr(t2, e) {
  if (e.document)
    return Kn(t2.Fs, e.document, !!e.hasCommittedMutations);
  if (e.noDocument) {
    var n2 = tt.Et(e.noDocument.path), r2 = ri(e.noDocument.readTime);
    return new Vt(n2, r2, {
      hasCommittedMutations: !!e.hasCommittedMutations
    });
  }
  if (e.unknownDocument) {
    var i = tt.Et(e.unknownDocument.path);
    r2 = ri(e.unknownDocument.version);
    return new Ct(i, r2);
  }
  return x2();
}
function $r(t2, e, n2) {
  var r2 = ti(n2), i = e.key.path.X().it();
  if (e instanceof Pt) {
    var o = function(t3, e2) {
      return {
        name: jn(t3, e2.key),
        fields: e2.bt().mapValue.fields,
        updateTime: Ln(t3, e2.version.j())
      };
    }(t2.Fs, e), u = e.hasCommittedMutations;
    return new Ur(null, null, o, u, r2, i);
  }
  if (e instanceof Vt) {
    var s = e.key.path.it(), a = ni(e.version);
    u = e.hasCommittedMutations;
    return new Ur(null, new Lr(s, a), null, u, r2, i);
  }
  if (e instanceof Ct) {
    var c = e.key.path.it(), h2 = ni(e.version);
    return new Ur(new Rr(c, h2), null, null, true, r2, i);
  }
  return x2();
}
function ti(t2) {
  var e = t2.j();
  return [e.seconds, e.nanoseconds];
}
function ei(t2) {
  var e = new K2(t2[0], t2[1]);
  return X2.K(e);
}
function ni(t2) {
  var e = t2.j();
  return new kr(e.seconds, e.nanoseconds);
}
function ri(t2) {
  var e = new K2(t2.seconds, t2.nanoseconds);
  return X2.K(e);
}
function ii(t2, e) {
  for (var n2 = (e.baseMutations || []).map(function(e2) {
    return Wn(t2.Fs, e2);
  }), r2 = 0; r2 < e.mutations.length - 1; ++r2) {
    var i = e.mutations[r2];
    if (r2 + 1 < e.mutations.length && e.mutations[r2 + 1].transform !== void 0) {
      var o = e.mutations[r2 + 1];
      i.updateTransforms = o.transform.fieldTransforms, e.mutations.splice(r2 + 1, 1), ++r2;
    }
  }
  var u = e.mutations.map(function(e2) {
    return Wn(t2.Fs, e2);
  }), s = K2.fromMillis(e.localWriteTimeMs);
  return new Xr(e.batchId, s, n2, u);
}
function oi(t2) {
  var e, n2, r2 = ri(t2.readTime), i = t2.lastLimboFreeSnapshotVersion !== void 0 ? ri(t2.lastLimboFreeSnapshotVersion) : X2.min();
  return t2.query.documents !== void 0 ? (k2((n2 = t2.query).documents.length === 1), e = he(re(Bn(n2.documents[0])))) : e = function(t3) {
    return he($n(t3));
  }(t2.query), new ge(e, t2.targetId, 0, t2.lastListenSequenceNumber, r2, i, U2.fromBase64String(t2.resumeToken));
}
function ui(t2, e) {
  var n2, r2 = ni(e.Ot), i = ni(e.lastLimboFreeSnapshotVersion);
  n2 = qt(e.target) ? Zn(t2.Fs, e.target) : Jn(t2.Fs, e.target);
  var o = e.resumeToken.toBase64();
  return new qr(e.targetId, Ut(e.target), r2, o, e.sequenceNumber, i, n2);
}
function si(t2) {
  var e = $n({
    parent: t2.parent,
    structuredQuery: t2.structuredQuery
  });
  return t2.limitType === "LAST" ? fe(e, e.limit, "L") : e;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ai = function() {
  function t2() {
  }
  return t2.prototype.Os = function(t3, e) {
    return ci(t3).get(e).next(function(t4) {
      if (t4)
        return {
          id: (e2 = t4).bundleId,
          createTime: ri(e2.createTime),
          version: e2.version
        };
      var e2;
    });
  }, t2.prototype.ks = function(t3, e) {
    return ci(t3).put({
      bundleId: (n2 = e).id,
      createTime: ni(Mn(n2.createTime)),
      version: n2.version
    });
    var n2;
  }, t2.prototype.Ms = function(t3, e) {
    return hi(t3).get(e).next(function(t4) {
      if (t4)
        return {
          name: (e2 = t4).name,
          query: si(e2.bundledQuery),
          readTime: ri(e2.readTime)
        };
      var e2;
    });
  }, t2.prototype.Ls = function(t3, e) {
    return hi(t3).put(function(t4) {
      return {
        name: t4.name,
        readTime: ni(Mn(t4.readTime)),
        bundledQuery: t4.bundledQuery
      };
    }(e));
  }, t2;
}();
function ci(t2) {
  return Kr(t2, Br.store);
}
function hi(t2) {
  return Kr(t2, Qr.store);
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var fi = function() {
  function t2() {
    this.Bs = new li();
  }
  return t2.prototype.qs = function(t3, e) {
    return this.Bs.add(e), lr.resolve();
  }, t2.prototype.Us = function(t3, e) {
    return lr.resolve(this.Bs.getEntries(e));
  }, t2;
}();
var li = function() {
  function t2() {
    this.index = {};
  }
  return t2.prototype.add = function(t3) {
    var e = t3.tt(), n2 = t3.X(), r2 = this.index[e] || new sn(Z2.H), i = !r2.has(n2);
    return this.index[e] = r2.add(n2), i;
  }, t2.prototype.has = function(t3) {
    var e = t3.tt(), n2 = t3.X(), r2 = this.index[e];
    return r2 && r2.has(n2);
  }, t2.prototype.getEntries = function(t3) {
    return (this.index[t3] || new sn(Z2.H)).it();
  }, t2;
}();
var pi = function() {
  function t2() {
    this.Qs = new li();
  }
  return t2.prototype.qs = function(t3, e) {
    var n2 = this;
    if (!this.Qs.has(e)) {
      var r2 = e.tt(), i = e.X();
      t3.gs(function() {
        n2.Qs.add(e);
      });
      var o = {
        collectionId: r2,
        parent: Ar(i)
      };
      return di(t3).put(o);
    }
    return lr.resolve();
  }, t2.prototype.Us = function(t3, e) {
    var n2 = [], r2 = IDBKeyRange.bound([e, ""], [R2(e), ""], false, true);
    return di(t3).rs(r2).next(function(t4) {
      for (var r3 = 0, i = t4; r3 < i.length; r3++) {
        var o = i[r3];
        if (o.collectionId !== e)
          break;
        n2.push(xr(o.parent));
      }
      return n2;
    });
  }, t2;
}();
function di(t2) {
  return Kr(t2, zr.store);
}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var vi = {
  Ks: false,
  Ws: 0,
  js: 0,
  Gs: 0
};
var yi = function() {
  function t2(t3, e, n2) {
    this.zs = t3, this.Hs = e, this.Js = n2;
  }
  return t2.Ys = function(e) {
    return new t2(e, t2.Xs, t2.Zs);
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function mi(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      if (t2.code !== M2.FAILED_PRECONDITION || t2.message !== Tr)
        throw t2;
      return N2("LocalStore", "Unexpectedly lost primary lease"), [2];
    });
  });
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
yi.Xs = 10, yi.Zs = 1e3, yi.ti = new yi(41943040, yi.Xs, yi.Zs), yi.ei = new yi(-1, 0, 0);
var gi = function() {
  function t2(t3, e) {
    this.ni = t3, this.si = e, this.ii = {};
  }
  return t2.prototype.get = function(t3) {
    var e = this.ni(t3), n2 = this.ii[e];
    if (n2 !== void 0)
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        var o = i[r2], u = o[0], s = o[1];
        if (this.si(u, t3))
          return s;
      }
  }, t2.prototype.has = function(t3) {
    return this.get(t3) !== void 0;
  }, t2.prototype.set = function(t3, e) {
    var n2 = this.ni(t3), r2 = this.ii[n2];
    if (r2 !== void 0) {
      for (var i = 0; i < r2.length; i++)
        if (this.si(r2[i][0], t3))
          return void (r2[i] = [t3, e]);
      r2.push([t3, e]);
    } else
      this.ii[n2] = [[t3, e]];
  }, t2.prototype.delete = function(t3) {
    var e = this.ni(t3), n2 = this.ii[e];
    if (n2 === void 0)
      return false;
    for (var r2 = 0; r2 < n2.length; r2++)
      if (this.si(n2[r2][0], t3))
        return n2.length === 1 ? delete this.ii[e] : n2.splice(r2, 1), true;
    return false;
  }, t2.prototype.forEach = function(t3) {
    nt(this.ii, function(e, n2) {
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        var o = i[r2], u = o[0], s = o[1];
        t3(u, s);
      }
    });
  }, t2.prototype.et = function() {
    return rt(this.ii);
  }, t2;
}();
var wi = function() {
  function t2() {
    this.ri = new gi(function(t3) {
      return t3.toString();
    }, function(t3, e) {
      return t3.isEqual(e);
    }), this.oi = false;
  }
  return t2.prototype.ci = function(t3) {
    var e = this.ri.get(t3);
    return e ? e.readTime : X2.min();
  }, t2.prototype.ai = function(t3, e) {
    this.ui(), this.ri.set(t3.key, {
      hi: t3,
      readTime: e
    });
  }, t2.prototype.li = function(t3, e) {
    e === void 0 && (e = null), this.ui(), this.ri.set(t3, {
      hi: null,
      readTime: e
    });
  }, t2.prototype._i = function(t3, e) {
    this.ui();
    var n2 = this.ri.get(e);
    return n2 !== void 0 ? lr.resolve(n2.hi) : this.fi(t3, e);
  }, t2.prototype.getEntries = function(t3, e) {
    return this.di(t3, e);
  }, t2.prototype.apply = function(t3) {
    return this.ui(), this.oi = true, this.wi(t3);
  }, t2.prototype.ui = function() {
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function bi(t2, e, n2) {
  var r2 = t2.store(Vr.store), i = t2.store(Cr.store), o = [], u = IDBKeyRange.only(n2.batchId), s = 0, a = r2.hs({
    range: u
  }, function(t3, e2, n3) {
    return s++, n3.delete();
  });
  o.push(a.next(function() {
    k2(s === 1);
  }));
  for (var c = [], h2 = 0, f = n2.mutations; h2 < f.length; h2++) {
    var l = f[h2], p2 = Cr.key(e, l.key.path, n2.batchId);
    o.push(i.delete(p2)), c.push(l.key);
  }
  return lr.Mn(o).next(function() {
    return c;
  });
}
function _i(t2) {
  var e;
  if (t2.document)
    e = t2.document;
  else if (t2.unknownDocument)
    e = t2.unknownDocument;
  else {
    if (!t2.noDocument)
      throw x2();
    e = t2.noDocument;
  }
  return JSON.stringify(e).length;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ii = function() {
  function t2(t3, e, n2, r2) {
    this.userId = t3, this.Qt = e, this.Ei = n2, this.Ti = r2, this.Ii = {};
  }
  return t2.mi = function(e, n2, r2, i) {
    return k2(e.uid !== ""), new t2(e.m() ? e.uid : "", n2, r2, i);
  }, t2.prototype.Ai = function(t3) {
    var e = true, n2 = IDBKeyRange.bound([this.userId, Number.NEGATIVE_INFINITY], [this.userId, Number.POSITIVE_INFINITY]);
    return Ti(t3).hs({
      index: Vr.userMutationsIndex,
      range: n2
    }, function(t4, n3, r2) {
      e = false, r2.done();
    }).next(function() {
      return e;
    });
  }, t2.prototype.Ri = function(t3, e, n2, r2) {
    var i = this, o = Ni(t3), u = Ti(t3);
    return u.add({}).next(function(s) {
      k2(typeof s == "number");
      for (var a = new Xr(s, e, n2, r2), c = function(t4, e2, n3) {
        var r3 = n3.baseMutations.map(function(e3) {
          return Xn(t4.Fs, e3);
        }), i2 = n3.mutations.map(function(e3) {
          return Xn(t4.Fs, e3);
        });
        return new Vr(e2, n3.batchId, n3.vs.toMillis(), r3, i2);
      }(i.Qt, i.userId, a), h2 = [], f = new sn(function(t4, e2) {
        return C(t4.rt(), e2.rt());
      }), l = 0, p2 = r2; l < p2.length; l++) {
        var d = p2[l], v2 = Cr.key(i.userId, d.key.path, s);
        f = f.add(d.key.path.X()), h2.push(u.put(c)), h2.push(o.put(v2, Cr.PLACEHOLDER));
      }
      return f.forEach(function(e2) {
        h2.push(i.Ei.qs(t3, e2));
      }), t3.gs(function() {
        i.Ii[s] = a.keys();
      }), lr.Mn(h2).next(function() {
        return a;
      });
    });
  }, t2.prototype.Pi = function(t3, e) {
    var n2 = this;
    return Ti(t3).get(e).next(function(t4) {
      return t4 ? (k2(t4.userId === n2.userId), ii(n2.Qt, t4)) : null;
    });
  }, t2.prototype.yi = function(t3, e) {
    var n2 = this;
    return this.Ii[e] ? lr.resolve(this.Ii[e]) : this.Pi(t3, e).next(function(t4) {
      if (t4) {
        var r2 = t4.keys();
        return n2.Ii[e] = r2, r2;
      }
      return null;
    });
  }, t2.prototype.gi = function(t3, e) {
    var n2 = this, r2 = e + 1, i = IDBKeyRange.lowerBound([this.userId, r2]), o = null;
    return Ti(t3).hs({
      index: Vr.userMutationsIndex,
      range: i
    }, function(t4, e2, i2) {
      e2.userId === n2.userId && (k2(e2.batchId >= r2), o = ii(n2.Qt, e2)), i2.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.Vi = function(t3) {
    var e = IDBKeyRange.upperBound([this.userId, Number.POSITIVE_INFINITY]), n2 = -1;
    return Ti(t3).hs({
      index: Vr.userMutationsIndex,
      range: e,
      reverse: true
    }, function(t4, e2, r2) {
      n2 = e2.batchId, r2.done();
    }).next(function() {
      return n2;
    });
  }, t2.prototype.pi = function(t3) {
    var e = this, n2 = IDBKeyRange.bound([this.userId, -1], [this.userId, Number.POSITIVE_INFINITY]);
    return Ti(t3).rs(Vr.userMutationsIndex, n2).next(function(t4) {
      return t4.map(function(t5) {
        return ii(e.Qt, t5);
      });
    });
  }, t2.prototype.bi = function(t3, e) {
    var n2 = this, r2 = Cr.prefixForPath(this.userId, e.path), i = IDBKeyRange.lowerBound(r2), o = [];
    return Ni(t3).hs({
      range: i
    }, function(r3, i2, u) {
      var s = r3[0], a = r3[1], c = r3[2], h2 = xr(a);
      if (s === n2.userId && e.path.isEqual(h2))
        return Ti(t3).get(c).next(function(t4) {
          if (!t4)
            throw x2();
          k2(t4.userId === n2.userId), o.push(ii(n2.Qt, t4));
        });
      u.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.vi = function(t3, e) {
    var n2 = this, r2 = new sn(C), i = [];
    return e.forEach(function(e2) {
      var o = Cr.prefixForPath(n2.userId, e2.path), u = IDBKeyRange.lowerBound(o), s = Ni(t3).hs({
        range: u
      }, function(t4, i2, o2) {
        var u2 = t4[0], s2 = t4[1], a = t4[2], c = xr(s2);
        u2 === n2.userId && e2.path.isEqual(c) ? r2 = r2.add(a) : o2.done();
      });
      i.push(s);
    }), lr.Mn(i).next(function() {
      return n2.Si(t3, r2);
    });
  }, t2.prototype.Di = function(t3, e) {
    var n2 = this, r2 = e.path, i = r2.length + 1, o = Cr.prefixForPath(this.userId, r2), u = IDBKeyRange.lowerBound(o), s = new sn(C);
    return Ni(t3).hs({
      range: u
    }, function(t4, e2, o2) {
      var u2 = t4[0], a = t4[1], c = t4[2], h2 = xr(a);
      u2 === n2.userId && r2.nt(h2) ? h2.length === i && (s = s.add(c)) : o2.done();
    }).next(function() {
      return n2.Si(t3, s);
    });
  }, t2.prototype.Si = function(t3, e) {
    var n2 = this, r2 = [], i = [];
    return e.forEach(function(e2) {
      i.push(Ti(t3).get(e2).next(function(t4) {
        if (t4 === null)
          throw x2();
        k2(t4.userId === n2.userId), r2.push(ii(n2.Qt, t4));
      }));
    }), lr.Mn(i).next(function() {
      return r2;
    });
  }, t2.prototype.Ci = function(t3, e) {
    var n2 = this;
    return bi(t3.ps, this.userId, e).next(function(r2) {
      return t3.gs(function() {
        n2.xi(e.batchId);
      }), lr.forEach(r2, function(e2) {
        return n2.Ti.Ni(t3, e2);
      });
    });
  }, t2.prototype.xi = function(t3) {
    delete this.Ii[t3];
  }, t2.prototype.$i = function(t3) {
    var e = this;
    return this.Ai(t3).next(function(n2) {
      if (!n2)
        return lr.resolve();
      var r2 = IDBKeyRange.lowerBound(Cr.prefixForUser(e.userId)), i = [];
      return Ni(t3).hs({
        range: r2
      }, function(t4, n3, r3) {
        if (t4[0] === e.userId) {
          var o = xr(t4[1]);
          i.push(o);
        } else
          r3.done();
      }).next(function() {
        k2(i.length === 0);
      });
    });
  }, t2.prototype.Fi = function(t3, e) {
    return Ei(t3, this.userId, e);
  }, t2.prototype.Oi = function(t3) {
    var e = this;
    return Ai(t3).get(this.userId).next(function(t4) {
      return t4 || new Pr(e.userId, -1, "");
    });
  }, t2;
}();
function Ei(t2, e, n2) {
  var r2 = Cr.prefixForPath(e, n2.path), i = r2[1], o = IDBKeyRange.lowerBound(r2), u = false;
  return Ni(t2).hs({
    range: o,
    us: true
  }, function(t3, n3, r3) {
    var o2 = t3[0], s = t3[1];
    t3[2];
    o2 === e && s === i && (u = true), r3.done();
  }).next(function() {
    return u;
  });
}
function Ti(t2) {
  return Kr(t2, Vr.store);
}
function Ni(t2) {
  return Kr(t2, Cr.store);
}
function Ai(t2) {
  return Kr(t2, Pr.store);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Di = function() {
  function t2(t3) {
    this.ki = t3;
  }
  return t2.prototype.next = function() {
    return this.ki += 2, this.ki;
  }, t2.Mi = function() {
    return new t2(0);
  }, t2.Li = function() {
    return new t2(-1);
  }, t2;
}();
var Si = function() {
  function t2(t3, e) {
    this.Ti = t3, this.Qt = e;
  }
  return t2.prototype.Bi = function(t3) {
    var e = this;
    return this.qi(t3).next(function(n2) {
      var r2 = new Di(n2.highestTargetId);
      return n2.highestTargetId = r2.next(), e.Ui(t3, n2).next(function() {
        return n2.highestTargetId;
      });
    });
  }, t2.prototype.Qi = function(t3) {
    return this.qi(t3).next(function(t4) {
      return X2.K(new K2(t4.lastRemoteSnapshotVersion.seconds, t4.lastRemoteSnapshotVersion.nanoseconds));
    });
  }, t2.prototype.Ki = function(t3) {
    return this.qi(t3).next(function(t4) {
      return t4.highestListenSequenceNumber;
    });
  }, t2.prototype.Wi = function(t3, e, n2) {
    var r2 = this;
    return this.qi(t3).next(function(i) {
      return i.highestListenSequenceNumber = e, n2 && (i.lastRemoteSnapshotVersion = n2.j()), e > i.highestListenSequenceNumber && (i.highestListenSequenceNumber = e), r2.Ui(t3, i);
    });
  }, t2.prototype.ji = function(t3, e) {
    var n2 = this;
    return this.Gi(t3, e).next(function() {
      return n2.qi(t3).next(function(r2) {
        return r2.targetCount += 1, n2.zi(e, r2), n2.Ui(t3, r2);
      });
    });
  }, t2.prototype.Hi = function(t3, e) {
    return this.Gi(t3, e);
  }, t2.prototype.Ji = function(t3, e) {
    var n2 = this;
    return this.Yi(t3, e.targetId).next(function() {
      return xi(t3).delete(e.targetId);
    }).next(function() {
      return n2.qi(t3);
    }).next(function(e2) {
      return k2(e2.targetCount > 0), e2.targetCount -= 1, n2.Ui(t3, e2);
    });
  }, t2.prototype.Xi = function(t3, e, n2) {
    var r2 = this, i = 0, o = [];
    return xi(t3).hs(function(u, s) {
      var a = oi(s);
      a.sequenceNumber <= e && n2.get(a.targetId) === null && (i++, o.push(r2.Ji(t3, a)));
    }).next(function() {
      return lr.Mn(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.In = function(t3, e) {
    return xi(t3).hs(function(t4, n2) {
      var r2 = oi(n2);
      e(r2);
    });
  }, t2.prototype.qi = function(t3) {
    return ki(t3).get(jr.key).next(function(t4) {
      return k2(t4 !== null), t4;
    });
  }, t2.prototype.Ui = function(t3, e) {
    return ki(t3).put(jr.key, e);
  }, t2.prototype.Gi = function(t3, e) {
    return xi(t3).put(ui(this.Qt, e));
  }, t2.prototype.zi = function(t3, e) {
    var n2 = false;
    return t3.targetId > e.highestTargetId && (e.highestTargetId = t3.targetId, n2 = true), t3.sequenceNumber > e.highestListenSequenceNumber && (e.highestListenSequenceNumber = t3.sequenceNumber, n2 = true), n2;
  }, t2.prototype.Zi = function(t3) {
    return this.qi(t3).next(function(t4) {
      return t4.targetCount;
    });
  }, t2.prototype.tr = function(t3, e) {
    var n2 = Ut(e), r2 = IDBKeyRange.bound([n2, Number.NEGATIVE_INFINITY], [n2, Number.POSITIVE_INFINITY]), i = null;
    return xi(t3).hs({
      range: r2,
      index: qr.queryTargetsIndexName
    }, function(t4, n3, r3) {
      var o = oi(n3);
      Mt(e, o.target) && (i = o, r3.done());
    }).next(function() {
      return i;
    });
  }, t2.prototype.er = function(t3, e, n2) {
    var r2 = this, i = [], o = Oi(t3);
    return e.forEach(function(e2) {
      var u = Ar(e2.path);
      i.push(o.put(new Fr(n2, u))), i.push(r2.Ti.nr(t3, n2, e2));
    }), lr.Mn(i);
  }, t2.prototype.sr = function(t3, e, n2) {
    var r2 = this, i = Oi(t3);
    return lr.forEach(e, function(e2) {
      var o = Ar(e2.path);
      return lr.Mn([i.delete([n2, o]), r2.Ti.ir(t3, n2, e2)]);
    });
  }, t2.prototype.Yi = function(t3, e) {
    var n2 = Oi(t3), r2 = IDBKeyRange.bound([e], [e + 1], false, true);
    return n2.delete(r2);
  }, t2.prototype.rr = function(t3, e) {
    var n2 = IDBKeyRange.bound([e], [e + 1], false, true), r2 = Oi(t3), i = mn();
    return r2.hs({
      range: n2,
      us: true
    }, function(t4, e2, n3) {
      var r3 = xr(t4[1]), o = new tt(r3);
      i = i.add(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.Fi = function(t3, e) {
    var n2 = Ar(e.path), r2 = IDBKeyRange.bound([n2], [R2(n2)], false, true), i = 0;
    return Oi(t3).hs({
      index: Fr.documentTargetsIndex,
      us: true,
      range: r2
    }, function(t4, e2, n3) {
      var r3 = t4[0];
      t4[1];
      r3 !== 0 && (i++, n3.done());
    }).next(function() {
      return i > 0;
    });
  }, t2.prototype.Sn = function(t3, e) {
    return xi(t3).get(e).next(function(t4) {
      return t4 ? oi(t4) : null;
    });
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function xi(t2) {
  return Kr(t2, qr.store);
}
function ki(t2) {
  return Kr(t2, jr.store);
}
function Oi(t2) {
  return Kr(t2, Fr.store);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Pi(t2, e) {
  var n2 = t2[0], r2 = t2[1], i = e[0], o = e[1], u = C(n2, i);
  return u === 0 ? C(r2, o) : u;
}
var Vi = function() {
  function t2(t3) {
    this.cr = t3, this.buffer = new sn(Pi), this.ar = 0;
  }
  return t2.prototype.ur = function() {
    return ++this.ar;
  }, t2.prototype.hr = function(t3) {
    var e = [t3, this.ur()];
    if (this.buffer.size < this.cr)
      this.buffer = this.buffer.add(e);
    else {
      var n2 = this.buffer.last();
      Pi(e, n2) < 0 && (this.buffer = this.buffer.delete(n2).add(e));
    }
  }, Object.defineProperty(t2.prototype, "maxValue", {
    get: function() {
      return this.buffer.last()[0];
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var Ci = function() {
  function t2(t3, e) {
    this.lr = t3, this._s = e, this._r = false, this.dr = null;
  }
  return t2.prototype.start = function(t3) {
    this.lr.params.zs !== -1 && this.wr(t3);
  }, t2.prototype.stop = function() {
    this.dr && (this.dr.cancel(), this.dr = null);
  }, Object.defineProperty(t2.prototype, "Er", {
    get: function() {
      return this.dr !== null;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.wr = function(t3) {
    var e = this, n2 = this._r ? 3e5 : 6e4;
    N2("LruGarbageCollector", "Garbage collection scheduled in " + n2 + "ms"), this.dr = this._s.Tr("lru_garbage_collection", n2, function() {
      return __awaiter(e, void 0, void 0, function() {
        var e2;
        return __generator(this, function(n3) {
          switch (n3.label) {
            case 0:
              this.dr = null, this._r = true, n3.label = 1;
            case 1:
              return n3.trys.push([1, 3, , 7]), [4, t3.Ir(this.lr)];
            case 2:
              return n3.sent(), [3, 7];
            case 3:
              return mr(e2 = n3.sent()) ? (N2("LruGarbageCollector", "Ignoring IndexedDB error during garbage collection: ", e2), [3, 6]) : [3, 4];
            case 4:
              return [4, mi(e2)];
            case 5:
              n3.sent(), n3.label = 6;
            case 6:
              return [3, 7];
            case 7:
              return [4, this.wr(t3)];
            case 8:
              return n3.sent(), [2];
          }
        });
      });
    });
  }, t2;
}();
var Li = function() {
  function t2(t3, e) {
    this.mr = t3, this.params = e;
  }
  return t2.prototype.Ar = function(t3, e) {
    return this.mr.Rr(t3).next(function(t4) {
      return Math.floor(e / 100 * t4);
    });
  }, t2.prototype.Pr = function(t3, e) {
    var n2 = this;
    if (e === 0)
      return lr.resolve(H2.q);
    var r2 = new Vi(e);
    return this.mr.In(t3, function(t4) {
      return r2.hr(t4.sequenceNumber);
    }).next(function() {
      return n2.mr.yr(t3, function(t4) {
        return r2.hr(t4);
      });
    }).next(function() {
      return r2.maxValue;
    });
  }, t2.prototype.Xi = function(t3, e, n2) {
    return this.mr.Xi(t3, e, n2);
  }, t2.prototype.gr = function(t3, e) {
    return this.mr.gr(t3, e);
  }, t2.prototype.Vr = function(t3, e) {
    var n2 = this;
    return this.params.zs === -1 ? (N2("LruGarbageCollector", "Garbage collection skipped; disabled"), lr.resolve(vi)) : this.pr(t3).next(function(r2) {
      return r2 < n2.params.zs ? (N2("LruGarbageCollector", "Garbage collection skipped; Cache size " + r2 + " is lower than threshold " + n2.params.zs), vi) : n2.br(t3, e);
    });
  }, t2.prototype.pr = function(t3) {
    return this.mr.pr(t3);
  }, t2.prototype.br = function(t3, n2) {
    var r2, i, o, u, s, a, c, h2 = this, f = Date.now();
    return this.Ar(t3, this.params.Hs).next(function(e) {
      return e > h2.params.Js ? (N2("LruGarbageCollector", "Capping sequence numbers to collect down to the maximum of " + h2.params.Js + " from " + e), i = h2.params.Js) : i = e, u = Date.now(), h2.Pr(t3, i);
    }).next(function(e) {
      return r2 = e, s = Date.now(), h2.Xi(t3, r2, n2);
    }).next(function(e) {
      return o = e, a = Date.now(), h2.gr(t3, r2);
    }).next(function(t4) {
      return c = Date.now(), T2() <= LogLevel.DEBUG && N2("LruGarbageCollector", "LRU Garbage Collection\n	Counted targets in " + (u - f) + "ms\n	Determined least recently used " + i + " in " + (s - u) + "ms\n	Removed " + o + " targets in " + (a - s) + "ms\n	Removed " + t4 + " documents in " + (c - a) + "ms\nTotal Duration: " + (c - f) + "ms"), lr.resolve({
        Ks: true,
        Ws: i,
        js: o,
        Gs: t4
      });
    });
  }, t2;
}();
var Ri = function() {
  function t2(t3, e) {
    this.db = t3, this.lr = function(t4, e2) {
      return new Li(t4, e2);
    }(this, e);
  }
  return t2.prototype.Rr = function(t3) {
    var e = this.vr(t3);
    return this.db.Sr().Zi(t3).next(function(t4) {
      return e.next(function(e2) {
        return t4 + e2;
      });
    });
  }, t2.prototype.vr = function(t3) {
    var e = 0;
    return this.yr(t3, function(t4) {
      e++;
    }).next(function() {
      return e;
    });
  }, t2.prototype.In = function(t3, e) {
    return this.db.Sr().In(t3, e);
  }, t2.prototype.yr = function(t3, e) {
    return this.Dr(t3, function(t4, n2) {
      return e(n2);
    });
  }, t2.prototype.nr = function(t3, e, n2) {
    return Ui(t3, n2);
  }, t2.prototype.ir = function(t3, e, n2) {
    return Ui(t3, n2);
  }, t2.prototype.Xi = function(t3, e, n2) {
    return this.db.Sr().Xi(t3, e, n2);
  }, t2.prototype.Ni = function(t3, e) {
    return Ui(t3, e);
  }, t2.prototype.Cr = function(t3, e) {
    return function(t4, e2) {
      var n2 = false;
      return Ai(t4).ls(function(r2) {
        return Ei(t4, r2, e2).next(function(t5) {
          return t5 && (n2 = true), lr.resolve(!t5);
        });
      }).next(function() {
        return n2;
      });
    }(t3, e);
  }, t2.prototype.gr = function(t3, e) {
    var n2 = this, r2 = this.db.$r().Nr(), i = [], o = 0;
    return this.Dr(t3, function(u, s) {
      if (s <= e) {
        var a = n2.Cr(t3, u).next(function(e2) {
          if (!e2)
            return o++, r2._i(t3, u).next(function() {
              return r2.li(u), Oi(t3).delete([0, Ar(u.path)]);
            });
        });
        i.push(a);
      }
    }).next(function() {
      return lr.Mn(i);
    }).next(function() {
      return r2.apply(t3);
    }).next(function() {
      return o;
    });
  }, t2.prototype.removeTarget = function(t3, e) {
    var n2 = e.kt(t3.bs);
    return this.db.Sr().Hi(t3, n2);
  }, t2.prototype.Fr = function(t3, e) {
    return Ui(t3, e);
  }, t2.prototype.Dr = function(t3, e) {
    var n2, r2 = Oi(t3), i = H2.q;
    return r2.hs({
      index: Fr.documentTargetsIndex
    }, function(t4, r3) {
      var o = t4[0], u = (t4[1], r3.path), s = r3.sequenceNumber;
      o === 0 ? (i !== H2.q && e(new tt(xr(n2)), i), i = s, n2 = u) : i = H2.q;
    }).next(function() {
      i !== H2.q && e(new tt(xr(n2)), i);
    });
  }, t2.prototype.pr = function(t3) {
    return this.db.$r().Or(t3);
  }, t2;
}();
function Ui(t2, e) {
  return Oi(t2).put(function(t3, e2) {
    return new Fr(0, Ar(t3.path), e2);
  }(e, t2.bs));
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Mi = function() {
  function t2(t3, e) {
    this.Qt = t3, this.Ei = e;
  }
  return t2.prototype.ai = function(t3, e, n2) {
    return ji(t3).put(zi(e), n2);
  }, t2.prototype.li = function(t3, e) {
    var n2 = ji(t3), r2 = zi(e);
    return n2.delete(r2);
  }, t2.prototype.updateMetadata = function(t3, e) {
    var n2 = this;
    return this.getMetadata(t3).next(function(r2) {
      return r2.byteSize += e, n2.kr(t3, r2);
    });
  }, t2.prototype._i = function(t3, e) {
    var n2 = this;
    return ji(t3).get(zi(e)).next(function(t4) {
      return n2.Mr(t4);
    });
  }, t2.prototype.Lr = function(t3, e) {
    var n2 = this;
    return ji(t3).get(zi(e)).next(function(t4) {
      var e2 = n2.Mr(t4);
      return e2 ? {
        hi: e2,
        size: _i(t4)
      } : null;
    });
  }, t2.prototype.getEntries = function(t3, e) {
    var n2 = this, r2 = fn();
    return this.Br(t3, e, function(t4, e2) {
      var i = n2.Mr(e2);
      r2 = r2.zt(t4, i);
    }).next(function() {
      return r2;
    });
  }, t2.prototype.qr = function(t3, e) {
    var n2 = this, r2 = fn(), i = new rn(tt.H);
    return this.Br(t3, e, function(t4, e2) {
      var o = n2.Mr(e2);
      o ? (r2 = r2.zt(t4, o), i = i.zt(t4, _i(e2))) : (r2 = r2.zt(t4, null), i = i.zt(t4, 0));
    }).next(function() {
      return {
        Ur: r2,
        Qr: i
      };
    });
  }, t2.prototype.Br = function(t3, e, n2) {
    if (e.et())
      return lr.resolve();
    var r2 = IDBKeyRange.bound(e.first().path.it(), e.last().path.it()), i = e.te(), o = i.oe();
    return ji(t3).hs({
      range: r2
    }, function(t4, e2, r3) {
      for (var u = tt.Et(t4); o && tt.H(o, u) < 0; )
        n2(o, null), o = i.oe();
      o && o.isEqual(u) && (n2(o, e2), o = i.ce() ? i.oe() : null), o ? r3.ss(o.path.it()) : r3.done();
    }).next(function() {
      for (; o; )
        n2(o, null), o = i.ce() ? i.oe() : null;
    });
  }, t2.prototype.Kr = function(t3, e, n2) {
    var r2 = this, i = pn(), o = e.path.length + 1, u = {};
    if (n2.isEqual(X2.min())) {
      var s = e.path.it();
      u.range = IDBKeyRange.lowerBound(s);
    } else {
      var a = e.path.it(), c = ti(n2);
      u.range = IDBKeyRange.lowerBound([a, c], true), u.index = Ur.collectionReadTimeIndex;
    }
    return ji(t3).hs(u, function(t4, n3, u2) {
      if (t4.length === o) {
        var s2 = Jr(r2.Qt, n3);
        e.path.nt(s2.key.path) ? s2 instanceof Pt && ve(e, s2) && (i = i.zt(s2.key, s2)) : u2.done();
      }
    }).next(function() {
      return i;
    });
  }, t2.prototype.Nr = function(t3) {
    return new qi(this, !!t3 && t3.Wr);
  }, t2.prototype.Or = function(t3) {
    return this.getMetadata(t3).next(function(t4) {
      return t4.byteSize;
    });
  }, t2.prototype.getMetadata = function(t3) {
    return Fi(t3).get(Mr.key).next(function(t4) {
      return k2(!!t4), t4;
    });
  }, t2.prototype.kr = function(t3, e) {
    return Fi(t3).put(Mr.key, e);
  }, t2.prototype.Mr = function(t3) {
    if (t3) {
      var e = Jr(this.Qt, t3);
      return e instanceof Vt && e.version.isEqual(X2.min()) ? null : e;
    }
    return null;
  }, t2;
}();
var qi = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).jr = e2, r2.Wr = n2, r2.Gr = new gi(function(t3) {
      return t3.toString();
    }, function(t3, e3) {
      return t3.isEqual(e3);
    }), r2;
  }
  return __extends(e, t2), e.prototype.wi = function(t3) {
    var e2 = this, n2 = [], r2 = 0, i = new sn(function(t4, e3) {
      return C(t4.rt(), e3.rt());
    });
    return this.ri.forEach(function(o, u) {
      var s = e2.Gr.get(o);
      if (u.hi) {
        var a = $r(e2.jr.Qt, u.hi, e2.ci(o));
        i = i.add(o.path.X());
        var c = _i(a);
        r2 += c - s, n2.push(e2.jr.ai(t3, o, a));
      } else if (r2 -= s, e2.Wr) {
        var h2 = $r(e2.jr.Qt, new Vt(o, X2.min()), e2.ci(o));
        n2.push(e2.jr.ai(t3, o, h2));
      } else
        n2.push(e2.jr.li(t3, o));
    }), i.forEach(function(r3) {
      n2.push(e2.jr.Ei.qs(t3, r3));
    }), n2.push(this.jr.updateMetadata(t3, r2)), lr.Mn(n2);
  }, e.prototype.fi = function(t3, e2) {
    var n2 = this;
    return this.jr.Lr(t3, e2).next(function(t4) {
      return t4 === null ? (n2.Gr.set(e2, 0), null) : (n2.Gr.set(e2, t4.size), t4.hi);
    });
  }, e.prototype.di = function(t3, e2) {
    var n2 = this;
    return this.jr.qr(t3, e2).next(function(t4) {
      var e3 = t4.Ur;
      return t4.Qr.forEach(function(t5, e4) {
        n2.Gr.set(t5, e4);
      }), e3;
    });
  }, e;
}(wi);
function Fi(t2) {
  return Kr(t2, Mr.store);
}
function ji(t2) {
  return Kr(t2, Ur.store);
}
function zi(t2) {
  return t2.path.it();
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Gi = function() {
  function t2(t3) {
    this.Qt = t3;
  }
  return t2.prototype.Jn = function(t3, e, n2, r2) {
    var i = this;
    k2(n2 < r2 && n2 >= 0 && r2 <= 11);
    var o = new pr("createOrUpgrade", e);
    n2 < 1 && r2 >= 1 && (function(t4) {
      t4.createObjectStore(Or.store);
    }(t3), function(t4) {
      t4.createObjectStore(Pr.store, {
        keyPath: Pr.keyPath
      }), t4.createObjectStore(Vr.store, {
        keyPath: Vr.keyPath,
        autoIncrement: true
      }).createIndex(Vr.userMutationsIndex, Vr.userMutationsKeyPath, {
        unique: true
      }), t4.createObjectStore(Cr.store);
    }(t3), Bi(t3), function(t4) {
      t4.createObjectStore(Ur.store);
    }(t3));
    var u = lr.resolve();
    return n2 < 3 && r2 >= 3 && (n2 !== 0 && (function(t4) {
      t4.deleteObjectStore(Fr.store), t4.deleteObjectStore(qr.store), t4.deleteObjectStore(jr.store);
    }(t3), Bi(t3)), u = u.next(function() {
      return function(t4) {
        var e2 = t4.store(jr.store), n3 = new jr(0, 0, X2.min().j(), 0);
        return e2.put(jr.key, n3);
      }(o);
    })), n2 < 4 && r2 >= 4 && (n2 !== 0 && (u = u.next(function() {
      return function(t4, e2) {
        return e2.store(Vr.store).rs().next(function(n3) {
          t4.deleteObjectStore(Vr.store), t4.createObjectStore(Vr.store, {
            keyPath: Vr.keyPath,
            autoIncrement: true
          }).createIndex(Vr.userMutationsIndex, Vr.userMutationsKeyPath, {
            unique: true
          });
          var r3 = e2.store(Vr.store), i2 = n3.map(function(t5) {
            return r3.put(t5);
          });
          return lr.Mn(i2);
        });
      }(t3, o);
    })), u = u.next(function() {
      !function(t4) {
        t4.createObjectStore(Gr.store, {
          keyPath: Gr.keyPath
        });
      }(t3);
    })), n2 < 5 && r2 >= 5 && (u = u.next(function() {
      return i.zr(o);
    })), n2 < 6 && r2 >= 6 && (u = u.next(function() {
      return function(t4) {
        t4.createObjectStore(Mr.store);
      }(t3), i.Hr(o);
    })), n2 < 7 && r2 >= 7 && (u = u.next(function() {
      return i.Jr(o);
    })), n2 < 8 && r2 >= 8 && (u = u.next(function() {
      return i.Yr(t3, o);
    })), n2 < 9 && r2 >= 9 && (u = u.next(function() {
      !function(t4) {
        t4.objectStoreNames.contains("remoteDocumentChanges") && t4.deleteObjectStore("remoteDocumentChanges");
      }(t3), function(t4) {
        var e2 = t4.objectStore(Ur.store);
        e2.createIndex(Ur.readTimeIndex, Ur.readTimeIndexPath, {
          unique: false
        }), e2.createIndex(Ur.collectionReadTimeIndex, Ur.collectionReadTimeIndexPath, {
          unique: false
        });
      }(e);
    })), n2 < 10 && r2 >= 10 && (u = u.next(function() {
      return i.Xr(o);
    })), n2 < 11 && r2 >= 11 && (u = u.next(function() {
      !function(t4) {
        t4.createObjectStore(Br.store, {
          keyPath: Br.keyPath
        });
      }(t3), function(t4) {
        t4.createObjectStore(Qr.store, {
          keyPath: Qr.keyPath
        });
      }(t3);
    })), u;
  }, t2.prototype.Hr = function(t3) {
    var e = 0;
    return t3.store(Ur.store).hs(function(t4, n2) {
      e += _i(n2);
    }).next(function() {
      var n2 = new Mr(e);
      return t3.store(Mr.store).put(Mr.key, n2);
    });
  }, t2.prototype.zr = function(t3) {
    var e = this, n2 = t3.store(Pr.store), r2 = t3.store(Vr.store);
    return n2.rs().next(function(n3) {
      return lr.forEach(n3, function(n4) {
        var i = IDBKeyRange.bound([n4.userId, -1], [n4.userId, n4.lastAcknowledgedBatchId]);
        return r2.rs(Vr.userMutationsIndex, i).next(function(r3) {
          return lr.forEach(r3, function(r4) {
            k2(r4.userId === n4.userId);
            var i2 = ii(e.Qt, r4);
            return bi(t3, n4.userId, i2).next(function() {
            });
          });
        });
      });
    });
  }, t2.prototype.Jr = function(t3) {
    var e = t3.store(Fr.store), n2 = t3.store(Ur.store);
    return t3.store(jr.store).get(jr.key).next(function(t4) {
      var r2 = [];
      return n2.hs(function(n3, i) {
        var o = new Z2(n3), u = function(t5) {
          return [0, Ar(t5)];
        }(o);
        r2.push(e.get(u).next(function(n4) {
          return n4 ? lr.resolve() : function(n5) {
            return e.put(new Fr(0, Ar(n5), t4.highestListenSequenceNumber));
          }(o);
        }));
      }).next(function() {
        return lr.Mn(r2);
      });
    });
  }, t2.prototype.Yr = function(t3, e) {
    t3.createObjectStore(zr.store, {
      keyPath: zr.keyPath
    });
    var n2 = e.store(zr.store), r2 = new li(), i = function(t4) {
      if (r2.add(t4)) {
        var e2 = t4.tt(), i2 = t4.X();
        return n2.put({
          collectionId: e2,
          parent: Ar(i2)
        });
      }
    };
    return e.store(Ur.store).hs({
      us: true
    }, function(t4, e2) {
      var n3 = new Z2(t4);
      return i(n3.X());
    }).next(function() {
      return e.store(Cr.store).hs({
        us: true
      }, function(t4, e2) {
        t4[0];
        var n3 = t4[1], r3 = (t4[2], xr(n3));
        return i(r3.X());
      });
    });
  }, t2.prototype.Xr = function(t3) {
    var e = this, n2 = t3.store(qr.store);
    return n2.hs(function(t4, r2) {
      var i = oi(r2), o = ui(e.Qt, i);
      return n2.put(o);
    });
  }, t2;
}();
function Bi(t2) {
  t2.createObjectStore(Fr.store, {
    keyPath: Fr.keyPath
  }).createIndex(Fr.documentTargetsIndex, Fr.documentTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(qr.store, {
    keyPath: qr.keyPath
  }).createIndex(qr.queryTargetsIndexName, qr.queryTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(jr.store);
}
var Qi = "Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";
var Yi = function() {
  function t2(e, n2, r2, i, o, u, s, a, c, h2) {
    if (this.allowTabSynchronization = e, this.persistenceKey = n2, this.clientId = r2, this.Zr = o, this.window = u, this.document = s, this.eo = c, this.no = h2, this.so = null, this.io = false, this.isPrimary = false, this.networkEnabled = true, this.ro = null, this.inForeground = false, this.oo = null, this.co = null, this.ao = Number.NEGATIVE_INFINITY, this.uo = function(t3) {
      return Promise.resolve();
    }, !t2.Kn())
      throw new q2(M2.UNIMPLEMENTED, "This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");
    this.Ti = new Ri(this, i), this.ho = n2 + "main", this.Qt = new Zr(a), this.lo = new dr(this.ho, 11, new Gi(this.Qt)), this._o = new Si(this.Ti, this.Qt), this.Ei = new pi(), this.fo = function(t3, e2) {
      return new Mi(t3, e2);
    }(this.Qt, this.Ei), this.wo = new ai(), this.window && this.window.localStorage ? this.Eo = this.window.localStorage : (this.Eo = null, h2 === false && A2("IndexedDbPersistence", "LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."));
  }
  return t2.prototype.start = function() {
    var t3 = this;
    return this.To().then(function() {
      if (!t3.isPrimary && !t3.allowTabSynchronization)
        throw new q2(M2.FAILED_PRECONDITION, Qi);
      return t3.Io(), t3.mo(), t3.Ao(), t3.runTransaction("getHighestListenSequenceNumber", "readonly", function(e) {
        return t3._o.Ki(e);
      });
    }).then(function(e) {
      t3.so = new H2(e, t3.eo);
    }).then(function() {
      t3.io = true;
    }).catch(function(e) {
      return t3.lo && t3.lo.close(), Promise.reject(e);
    });
  }, t2.prototype.Ro = function(t3) {
    var e = this;
    return this.uo = function(n2) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          return this.Er ? [2, t3(n2)] : [2];
        });
      });
    }, t3(this.isPrimary);
  }, t2.prototype.Po = function(t3) {
    var e = this;
    this.lo.Xn(function(n2) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          switch (e2.label) {
            case 0:
              return n2.newVersion === null ? [4, t3()] : [3, 2];
            case 1:
              e2.sent(), e2.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }, t2.prototype.yo = function(t3) {
    var e = this;
    this.networkEnabled !== t3 && (this.networkEnabled = t3, this.Zr.Ps(function() {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return this.Er ? [4, this.To()] : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    }));
  }, t2.prototype.To = function() {
    var t3 = this;
    return this.runTransaction("updateClientMetadataAndTryBecomePrimary", "readwrite", function(e) {
      return Ki(e).put(new Gr(t3.clientId, Date.now(), t3.networkEnabled, t3.inForeground)).next(function() {
        if (t3.isPrimary)
          return t3.Vo(e).next(function(e2) {
            e2 || (t3.isPrimary = false, t3.Zr.po(function() {
              return t3.uo(false);
            }));
          });
      }).next(function() {
        return t3.bo(e);
      }).next(function(n2) {
        return t3.isPrimary && !n2 ? t3.vo(e).next(function() {
          return false;
        }) : !!n2 && t3.So(e).next(function() {
          return true;
        });
      });
    }).catch(function(e) {
      if (mr(e))
        return N2("IndexedDbPersistence", "Failed to extend owner lease: ", e), t3.isPrimary;
      if (!t3.allowTabSynchronization)
        throw e;
      return N2("IndexedDbPersistence", "Releasing owner lease after error during lease refresh", e), false;
    }).then(function(e) {
      t3.isPrimary !== e && t3.Zr.po(function() {
        return t3.uo(e);
      }), t3.isPrimary = e;
    });
  }, t2.prototype.Vo = function(t3) {
    var e = this;
    return Hi(t3).get(Or.key).next(function(t4) {
      return lr.resolve(e.Do(t4));
    });
  }, t2.prototype.Co = function(t3) {
    return Ki(t3).delete(this.clientId);
  }, t2.prototype.xo = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i = this;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return !this.isPrimary || this.No(this.ao, 18e5) ? [3, 2] : (this.ao = Date.now(), [4, this.runTransaction("maybeGarbageCollectMultiClientState", "readwrite-primary", function(t4) {
              var e2 = Kr(t4, Gr.store);
              return e2.rs().next(function(t5) {
                var n3 = i.$o(t5, 18e5), r3 = t5.filter(function(t6) {
                  return n3.indexOf(t6) === -1;
                });
                return lr.forEach(r3, function(t6) {
                  return e2.delete(t6.clientId);
                }).next(function() {
                  return r3;
                });
              });
            }).catch(function() {
              return [];
            })]);
          case 1:
            if (t3 = o.sent(), this.Eo)
              for (e = 0, n2 = t3; e < n2.length; e++)
                r2 = n2[e], this.Eo.removeItem(this.Fo(r2.clientId));
            o.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.Ao = function() {
    var t3 = this;
    this.co = this.Zr.Tr("client_metadata_refresh", 4e3, function() {
      return t3.To().then(function() {
        return t3.xo();
      }).then(function() {
        return t3.Ao();
      });
    });
  }, t2.prototype.Do = function(t3) {
    return !!t3 && t3.ownerId === this.clientId;
  }, t2.prototype.bo = function(t3) {
    var e = this;
    return this.no ? lr.resolve(true) : Hi(t3).get(Or.key).next(function(n2) {
      if (n2 !== null && e.No(n2.leaseTimestampMs, 5e3) && !e.Oo(n2.ownerId)) {
        if (e.Do(n2) && e.networkEnabled)
          return true;
        if (!e.Do(n2)) {
          if (!n2.allowTabSynchronization)
            throw new q2(M2.FAILED_PRECONDITION, Qi);
          return false;
        }
      }
      return !(!e.networkEnabled || !e.inForeground) || Ki(t3).rs().next(function(t4) {
        return e.$o(t4, 5e3).find(function(t5) {
          if (e.clientId !== t5.clientId) {
            var n3 = !e.networkEnabled && t5.networkEnabled, r2 = !e.inForeground && t5.inForeground, i = e.networkEnabled === t5.networkEnabled;
            if (n3 || r2 && i)
              return true;
          }
          return false;
        }) === void 0;
      });
    }).next(function(t4) {
      return e.isPrimary !== t4 && N2("IndexedDbPersistence", "Client " + (t4 ? "is" : "is not") + " eligible for a primary lease."), t4;
    });
  }, t2.prototype.ko = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3 = this;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.io = false, this.Mo(), this.co && (this.co.cancel(), this.co = null), this.Lo(), this.Bo(), [4, this.lo.runTransaction("shutdown", "readwrite", [Or.store, Gr.store], function(e2) {
              var n2 = new Hr(e2, H2.q);
              return t3.vo(n2).next(function() {
                return t3.Co(n2);
              });
            })];
          case 1:
            return e.sent(), this.lo.close(), this.qo(), [2];
        }
      });
    });
  }, t2.prototype.$o = function(t3, e) {
    var n2 = this;
    return t3.filter(function(t4) {
      return n2.No(t4.updateTimeMs, e) && !n2.Oo(t4.clientId);
    });
  }, t2.prototype.Uo = function() {
    var t3 = this;
    return this.runTransaction("getActiveClients", "readonly", function(e) {
      return Ki(e).rs().next(function(e2) {
        return t3.$o(e2, 18e5).map(function(t4) {
          return t4.clientId;
        });
      });
    });
  }, Object.defineProperty(t2.prototype, "Er", {
    get: function() {
      return this.io;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Qo = function(t3) {
    return Ii.mi(t3, this.Qt, this.Ei, this.Ti);
  }, t2.prototype.Sr = function() {
    return this._o;
  }, t2.prototype.$r = function() {
    return this.fo;
  }, t2.prototype.Ko = function() {
    return this.Ei;
  }, t2.prototype.Wo = function() {
    return this.wo;
  }, t2.prototype.runTransaction = function(t3, e, n2) {
    var r2 = this;
    N2("IndexedDbPersistence", "Starting transaction:", t3);
    var i, o = e === "readonly" ? "readonly" : "readwrite";
    return this.lo.runTransaction(t3, o, Yr, function(o2) {
      return i = new Hr(o2, r2.so ? r2.so.next() : H2.q), e === "readwrite-primary" ? r2.Vo(i).next(function(t4) {
        return !!t4 || r2.bo(i);
      }).next(function(e2) {
        if (!e2)
          throw A2("Failed to obtain primary lease for action '" + t3 + "'."), r2.isPrimary = false, r2.Zr.po(function() {
            return r2.uo(false);
          }), new q2(M2.FAILED_PRECONDITION, Tr);
        return n2(i);
      }).next(function(t4) {
        return r2.So(i).next(function() {
          return t4;
        });
      }) : r2.jo(i).next(function() {
        return n2(i);
      });
    }).then(function(t4) {
      return i.Vs(), t4;
    });
  }, t2.prototype.jo = function(t3) {
    var e = this;
    return Hi(t3).get(Or.key).next(function(t4) {
      if (t4 !== null && e.No(t4.leaseTimestampMs, 5e3) && !e.Oo(t4.ownerId) && !e.Do(t4) && !(e.no || e.allowTabSynchronization && t4.allowTabSynchronization))
        throw new q2(M2.FAILED_PRECONDITION, Qi);
    });
  }, t2.prototype.So = function(t3) {
    var e = new Or(this.clientId, this.allowTabSynchronization, Date.now());
    return Hi(t3).put(Or.key, e);
  }, t2.Kn = function() {
    return dr.Kn();
  }, t2.prototype.vo = function(t3) {
    var e = this, n2 = Hi(t3);
    return n2.get(Or.key).next(function(t4) {
      return e.Do(t4) ? (N2("IndexedDbPersistence", "Releasing primary lease."), n2.delete(Or.key)) : lr.resolve();
    });
  }, t2.prototype.No = function(t3, e) {
    var n2 = Date.now();
    return !(t3 < n2 - e || t3 > n2 && (A2("Detected an update time that is in the future: " + t3 + " > " + n2), 1));
  }, t2.prototype.Io = function() {
    var t3 = this;
    this.document !== null && typeof this.document.addEventListener == "function" && (this.oo = function() {
      t3.Zr.Ps(function() {
        return t3.inForeground = t3.document.visibilityState === "visible", t3.To();
      });
    }, this.document.addEventListener("visibilitychange", this.oo), this.inForeground = this.document.visibilityState === "visible");
  }, t2.prototype.Lo = function() {
    this.oo && (this.document.removeEventListener("visibilitychange", this.oo), this.oo = null);
  }, t2.prototype.mo = function() {
    var t3, e = this;
    typeof ((t3 = this.window) === null || t3 === void 0 ? void 0 : t3.addEventListener) == "function" && (this.ro = function() {
      e.Mo(), e.Zr.Ps(function() {
        return e.ko();
      });
    }, this.window.addEventListener("unload", this.ro));
  }, t2.prototype.Bo = function() {
    this.ro && (this.window.removeEventListener("unload", this.ro), this.ro = null);
  }, t2.prototype.Oo = function(t3) {
    var e;
    try {
      var n2 = ((e = this.Eo) === null || e === void 0 ? void 0 : e.getItem(this.Fo(t3))) !== null;
      return N2("IndexedDbPersistence", "Client '" + t3 + "' " + (n2 ? "is" : "is not") + " zombied in LocalStorage"), n2;
    } catch (t4) {
      return A2("IndexedDbPersistence", "Failed to get zombied client id.", t4), false;
    }
  }, t2.prototype.Mo = function() {
    if (this.Eo)
      try {
        this.Eo.setItem(this.Fo(this.clientId), String(Date.now()));
      } catch (t3) {
        A2("Failed to set zombie client id.", t3);
      }
  }, t2.prototype.qo = function() {
    if (this.Eo)
      try {
        this.Eo.removeItem(this.Fo(this.clientId));
      } catch (t3) {
      }
  }, t2.prototype.Fo = function(t3) {
    return "firestore_zombie_" + this.persistenceKey + "_" + t3;
  }, t2;
}();
function Hi(t2) {
  return Kr(t2, Or.store);
}
function Ki(t2) {
  return Kr(t2, Gr.store);
}
function Xi(t2, e) {
  var n2 = t2.projectId;
  return t2.o || (n2 += "." + t2.database), "firestore/" + e + "/" + n2 + "/";
}
var Wi = function(t2, e) {
  this.progress = t2, this.Go = e;
};
var Zi = function() {
  function t2(t3, e, n2) {
    this.fo = t3, this.zo = e, this.Ei = n2;
  }
  return t2.prototype.Ho = function(t3, e) {
    var n2 = this;
    return this.zo.bi(t3, e).next(function(r2) {
      return n2.Jo(t3, e, r2);
    });
  }, t2.prototype.Jo = function(t3, e, n2) {
    return this.fo._i(t3, e).next(function(t4) {
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        t4 = i[r2].Cs(e, t4);
      }
      return t4;
    });
  }, t2.prototype.Yo = function(t3, e, n2) {
    var r2 = fn();
    return e.forEach(function(t4, e2) {
      for (var i = 0, o = n2; i < o.length; i++) {
        e2 = o[i].Cs(t4, e2);
      }
      r2 = r2.zt(t4, e2);
    }), r2;
  }, t2.prototype.Xo = function(t3, e) {
    var n2 = this;
    return this.fo.getEntries(t3, e).next(function(e2) {
      return n2.Zo(t3, e2);
    });
  }, t2.prototype.Zo = function(t3, e) {
    var n2 = this;
    return this.zo.vi(t3, e).next(function(r2) {
      var i = n2.Yo(t3, e, r2), o = hn();
      return i.forEach(function(t4, e2) {
        e2 || (e2 = new Vt(t4, X2.min())), o = o.zt(t4, e2);
      }), o;
    });
  }, t2.prototype.Kr = function(t3, e, n2) {
    return function(t4) {
      return tt.wt(t4.path) && t4.collectionGroup === null && t4.filters.length === 0;
    }(e) ? this.tc(t3, e.path) : ae(e) ? this.ec(t3, e, n2) : this.nc(t3, e, n2);
  }, t2.prototype.tc = function(t3, e) {
    return this.Ho(t3, new tt(e)).next(function(t4) {
      var e2 = pn();
      return t4 instanceof Pt && (e2 = e2.zt(t4.key, t4)), e2;
    });
  }, t2.prototype.ec = function(t3, e, n2) {
    var r2 = this, i = e.collectionGroup, o = pn();
    return this.Ei.Us(t3, i).next(function(u) {
      return lr.forEach(u, function(u2) {
        var s = function(t4, e2) {
          return new ee(e2, null, t4.xt.slice(), t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, t4.endAt);
        }(e, u2.child(i));
        return r2.nc(t3, s, n2).next(function(t4) {
          t4.forEach(function(t5, e2) {
            o = o.zt(t5, e2);
          });
        });
      }).next(function() {
        return o;
      });
    });
  }, t2.prototype.nc = function(t3, e, n2) {
    var r2, i, o = this;
    return this.fo.Kr(t3, e, n2).next(function(n3) {
      return r2 = n3, o.zo.Di(t3, e);
    }).next(function(e2) {
      return i = e2, o.sc(t3, i, r2).next(function(t4) {
        r2 = t4;
        for (var e3 = 0, n3 = i; e3 < n3.length; e3++)
          for (var o2 = n3[e3], u = 0, s = o2.mutations; u < s.length; u++) {
            var a = s[u], c = a.key, h2 = Fe(a, r2.get(c), o2.vs);
            r2 = h2 instanceof Pt ? r2.zt(c, h2) : r2.remove(c);
          }
      });
    }).next(function() {
      return r2.forEach(function(t4, n3) {
        ve(e, n3) || (r2 = r2.remove(t4));
      }), r2;
    });
  }, t2.prototype.sc = function(t3, e, n2) {
    for (var r2 = mn(), i = 0, o = e; i < o.length; i++)
      for (var u = 0, s = o[i].mutations; u < s.length; u++) {
        var a = s[u];
        a instanceof Qe && n2.get(a.key) === null && (r2 = r2.add(a.key));
      }
    var c = n2;
    return this.fo.getEntries(t3, r2).next(function(t4) {
      return t4.forEach(function(t5, e2) {
        e2 !== null && e2 instanceof Pt && (c = c.zt(t5, e2));
      }), c;
    });
  }, t2;
}();
var Ji = function() {
  function t2(t3, e, n2, r2) {
    this.targetId = t3, this.fromCache = e, this.ic = n2, this.rc = r2;
  }
  return t2.oc = function(e, n2) {
    for (var r2 = mn(), i = mn(), o = 0, u = n2.docChanges; o < u.length; o++) {
      var s = u[o];
      switch (s.type) {
        case 0:
          r2 = r2.add(s.doc.key);
          break;
        case 1:
          i = i.add(s.doc.key);
      }
    }
    return new t2(e, n2.fromCache, r2, i);
  }, t2;
}();
var $i = function() {
  function t2() {
  }
  return t2.prototype.cc = function(t3) {
    this.ac = t3;
  }, t2.prototype.Kr = function(t3, n2, r2, i) {
    var o = this;
    return function(t4) {
      return t4.filters.length === 0 && t4.limit === null && t4.startAt == null && t4.endAt == null && (t4.xt.length === 0 || t4.xt.length === 1 && t4.xt[0].field.ut());
    }(n2) || r2.isEqual(X2.min()) ? this.uc(t3, n2) : this.ac.Xo(t3, i).next(function(u) {
      var s = o.hc(n2, u);
      return (ie(n2) || oe(n2)) && o.lc(n2.limitType, s, i, r2) ? o.uc(t3, n2) : (T2() <= LogLevel.DEBUG && N2("QueryEngine", "Re-using previous result from %s to execute query: %s", r2.toString(), de(n2)), o.ac.Kr(t3, n2, r2).next(function(t4) {
        return s.forEach(function(e) {
          t4 = t4.zt(e.key, e);
        }), t4;
      }));
    });
  }, t2.prototype.hc = function(t3, e) {
    var n2 = new sn(ye(t3));
    return e.forEach(function(e2, r2) {
      r2 instanceof Pt && ve(t3, r2) && (n2 = n2.add(r2));
    }), n2;
  }, t2.prototype.lc = function(t3, e, n2, r2) {
    if (n2.size !== e.size)
      return true;
    var i = t3 === "F" ? e.last() : e.first();
    return !!i && (i.hasPendingWrites || i.version._(r2) > 0);
  }, t2.prototype.uc = function(t3, n2) {
    return T2() <= LogLevel.DEBUG && N2("QueryEngine", "Using full collection scan to execute query:", de(n2)), this.ac.Kr(t3, n2, X2.min());
  }, t2;
}();
var to = function() {
  function t2(t3, e, n2, r2) {
    this.persistence = t3, this._c = e, this.Qt = r2, this.fc = new rn(C), this.dc = new gi(function(t4) {
      return Ut(t4);
    }, Mt), this.wc = X2.min(), this.zo = t3.Qo(n2), this.Ec = t3.$r(), this._o = t3.Sr(), this.Tc = new Zi(this.Ec, this.zo, this.persistence.Ko()), this.wo = t3.Wo(), this._c.cc(this.Tc);
  }
  return t2.prototype.Ir = function(t3) {
    var e = this;
    return this.persistence.runTransaction("Collect garbage", "readwrite-primary", function(n2) {
      return t3.Vr(n2, e.fc);
    });
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function eo(t2, e, n2, r2) {
  return new to(t2, e, n2, r2);
}
function no(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          return n2 = O2(t2), r2 = n2.zo, i = n2.Tc, [4, n2.persistence.runTransaction("Handle user change", "readonly", function(t3) {
            var o2;
            return n2.zo.pi(t3).next(function(u2) {
              return o2 = u2, r2 = n2.persistence.Qo(e), i = new Zi(n2.Ec, r2, n2.persistence.Ko()), r2.pi(t3);
            }).next(function(e2) {
              for (var n3 = [], r3 = [], u2 = mn(), s = 0, a = o2; s < a.length; s++) {
                var c = a[s];
                n3.push(c.batchId);
                for (var h2 = 0, f = c.mutations; h2 < f.length; h2++) {
                  var l = f[h2];
                  u2 = u2.add(l.key);
                }
              }
              for (var p2 = 0, d = e2; p2 < d.length; p2++) {
                var v2 = d[p2];
                r3.push(v2.batchId);
                for (var y2 = 0, m = v2.mutations; y2 < m.length; y2++) {
                  var g = m[y2];
                  u2 = u2.add(g.key);
                }
              }
              return i.Xo(t3, u2).next(function(t4) {
                return {
                  Ic: t4,
                  mc: n3,
                  Ac: r3
                };
              });
            });
          })];
        case 1:
          return o = u.sent(), [2, (n2.zo = r2, n2.Tc = i, n2._c.cc(n2.Tc), o)];
      }
    });
  });
}
function ro(t2, e) {
  var n2 = O2(t2);
  return n2.persistence.runTransaction("Acknowledge batch", "readwrite-primary", function(t3) {
    var r2 = e.batch.keys(), i = n2.Ec.Nr({
      Wr: true
    });
    return function(t4, e2, n3, r3) {
      var i2 = n3.batch, o = i2.keys(), u = lr.resolve();
      return o.forEach(function(t5) {
        u = u.next(function() {
          return r3._i(e2, t5);
        }).next(function(e3) {
          var o2 = e3, u2 = n3.$s.get(t5);
          k2(u2 !== null), (!o2 || o2.version._(u2) < 0) && ((o2 = i2.Ss(t5, o2, n3)) && r3.ai(o2, n3.Ns));
        });
      }), u.next(function() {
        return t4.zo.Ci(e2, i2);
      });
    }(n2, t3, e, i).next(function() {
      return i.apply(t3);
    }).next(function() {
      return n2.zo.$i(t3);
    }).next(function() {
      return n2.Tc.Xo(t3, r2);
    });
  });
}
function io(t2) {
  var e = O2(t2);
  return e.persistence.runTransaction("Get last remote snapshot version", "readonly", function(t3) {
    return e._o.Qi(t3);
  });
}
function oo(t2, e) {
  var n2 = O2(t2), r2 = e.Ot, i = n2.fc;
  return n2.persistence.runTransaction("Apply remote event", "readwrite-primary", function(t3) {
    var o = n2.Ec.Nr({
      Wr: true
    });
    i = n2.fc;
    var u = [];
    e.$e.forEach(function(e2, o2) {
      var s2 = i.get(o2);
      if (s2) {
        u.push(n2._o.sr(t3, e2.Qe, o2).next(function() {
          return n2._o.er(t3, e2.qe, o2);
        }));
        var a2 = e2.resumeToken;
        if (a2.l() > 0) {
          var c = s2.Mt(a2, r2).kt(t3.bs);
          i = i.zt(o2, c), function(t4, e3, n3) {
            return k2(e3.resumeToken.l() > 0), t4.resumeToken.l() === 0 || (e3.Ot.W() - t4.Ot.W() >= 3e8 || n3.qe.size + n3.Ue.size + n3.Qe.size > 0);
          }(s2, c, e2) && u.push(n2._o.Hi(t3, c));
        }
      }
    });
    var s = hn();
    if (e.Oe.forEach(function(r3, i2) {
      e.ke.has(r3) && u.push(n2.persistence.Ti.Fr(t3, r3));
    }), u.push(uo(t3, o, e.Oe, r2, void 0).next(function(t4) {
      s = t4;
    })), !r2.isEqual(X2.min())) {
      var a = n2._o.Qi(t3).next(function(e2) {
        return n2._o.Wi(t3, t3.bs, r2);
      });
      u.push(a);
    }
    return lr.Mn(u).next(function() {
      return o.apply(t3);
    }).next(function() {
      return n2.Tc.Zo(t3, s);
    });
  }).then(function(t3) {
    return n2.fc = i, t3;
  });
}
function uo(t2, e, n2, r2, i) {
  var o = mn();
  return n2.forEach(function(t3) {
    return o = o.add(t3);
  }), e.getEntries(t2, o).next(function(t3) {
    var o2 = hn();
    return n2.forEach(function(n3, u) {
      var s = t3.get(n3), a = (i == null ? void 0 : i.get(n3)) || r2;
      u instanceof Vt && u.version.isEqual(X2.min()) ? (e.li(n3, a), o2 = o2.zt(n3, u)) : s == null || u.version._(s.version) > 0 || u.version._(s.version) === 0 && s.hasPendingWrites ? (e.ai(u, a), o2 = o2.zt(n3, u)) : N2("LocalStore", "Ignoring outdated watch update for ", n3, ". Current version:", s.version, " Watch version:", u.version);
    }), o2;
  });
}
function so(t2, e) {
  var n2 = O2(t2);
  return n2.persistence.runTransaction("Get next mutation batch", "readonly", function(t3) {
    return e === void 0 && (e = -1), n2.zo.gi(t3, e);
  });
}
function ao(t2, e) {
  var n2 = O2(t2);
  return n2.persistence.runTransaction("Allocate target", "readwrite", function(t3) {
    var r2;
    return n2._o.tr(t3, e).next(function(i) {
      return i ? (r2 = i, lr.resolve(r2)) : n2._o.Bi(t3).next(function(i2) {
        return r2 = new ge(e, i2, 0, t3.bs), n2._o.ji(t3, r2).next(function() {
          return r2;
        });
      });
    });
  }).then(function(t3) {
    var r2 = n2.fc.get(t3.targetId);
    return (r2 === null || t3.Ot._(r2.Ot) > 0) && (n2.fc = n2.fc.zt(t3.targetId, t3), n2.dc.set(e, t3.targetId)), t3;
  });
}
function co(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, u;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          r2 = O2(t2), i = r2.fc.get(e), o = n2 ? "readwrite" : "readwrite-primary", s.label = 1;
        case 1:
          return s.trys.push([1, 4, , 5]), n2 ? [3, 3] : [4, r2.persistence.runTransaction("Release target", o, function(t3) {
            return r2.persistence.Ti.removeTarget(t3, i);
          })];
        case 2:
          s.sent(), s.label = 3;
        case 3:
          return [3, 5];
        case 4:
          if (!mr(u = s.sent()))
            throw u;
          return N2("LocalStore", "Failed to update sequence numbers for target " + e + ": " + u), [3, 5];
        case 5:
          return r2.fc = r2.fc.remove(e), r2.dc.delete(i.target), [2];
      }
    });
  });
}
function ho(t2, e, n2) {
  var r2 = O2(t2), i = X2.min(), o = mn();
  return r2.persistence.runTransaction("Execute query", "readonly", function(t3) {
    return function(t4, e2, n3) {
      var r3 = O2(t4), i2 = r3.dc.get(n3);
      return i2 !== void 0 ? lr.resolve(r3.fc.get(i2)) : r3._o.tr(e2, n3);
    }(r2, t3, he(e)).next(function(e2) {
      if (e2)
        return i = e2.lastLimboFreeSnapshotVersion, r2._o.rr(t3, e2.targetId).next(function(t4) {
          o = t4;
        });
    }).next(function() {
      return r2._c.Kr(t3, e, n2 ? i : X2.min(), n2 ? o : mn());
    }).next(function(t4) {
      return {
        documents: t4,
        Rc: o
      };
    });
  });
}
function fo(t2, e) {
  var n2 = O2(t2), r2 = O2(n2._o), i = n2.fc.get(e);
  return i ? Promise.resolve(i.target) : n2.persistence.runTransaction("Get target data", "readonly", function(t3) {
    return r2.Sn(t3, e).next(function(t4) {
      return t4 ? t4.target : null;
    });
  });
}
function lo(t2) {
  var e = O2(t2);
  return e.persistence.runTransaction("Get new document changes", "readonly", function(t3) {
    return function(t4, e2, n2) {
      var r2 = O2(t4), i = hn(), o = ti(n2), u = ji(e2), s = IDBKeyRange.lowerBound(o, true);
      return u.hs({
        index: Ur.readTimeIndex,
        range: s
      }, function(t5, e3) {
        var n3 = Jr(r2.Qt, e3);
        i = i.zt(n3.key, n3), o = e3.readTime;
      }).next(function() {
        return {
          Go: i,
          readTime: ei(o)
        };
      });
    }(e.Ec, t3, e.wc);
  }).then(function(t3) {
    var n2 = t3.Go, r2 = t3.readTime;
    return e.wc = r2, n2;
  });
}
function po(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n2) {
      return [2, (e = O2(t2)).persistence.runTransaction("Synchronize last document change read time", "readonly", function(t3) {
        return function(t4) {
          var e2 = ji(t4), n3 = X2.min();
          return e2.hs({
            index: Ur.readTimeIndex,
            reverse: true
          }, function(t5, e3, r2) {
            e3.readTime && (n3 = ei(e3.readTime)), r2.done();
          }).next(function() {
            return n3;
          });
        }(t3);
      }).then(function(t3) {
        e.wc = t3;
      })];
    });
  });
}
function vo(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, u, s, a, c, h2, f, l, p2;
    return __generator(this, function(d) {
      switch (d.label) {
        case 0:
          for (i = O2(t2), o = mn(), u = hn(), s = vn(), a = 0, c = n2; a < c.length; a++)
            h2 = c[a], f = e.Pc(h2.metadata.name), h2.document && (o = o.add(f)), u = u.zt(f, e.yc(h2)), s = s.zt(f, e.gc(h2.metadata.readTime));
          return l = i.Ec.Nr({
            Wr: true
          }), [4, ao(i, function(t3) {
            return he(re(Z2.ot("__bundle__/docs/" + t3)));
          }(r2))];
        case 1:
          return p2 = d.sent(), [2, i.persistence.runTransaction("Apply bundle documents", "readwrite", function(t3) {
            return uo(t3, l, u, X2.min(), s).next(function(e2) {
              return l.apply(t3), e2;
            }).next(function(e2) {
              return i._o.Yi(t3, p2.targetId).next(function() {
                return i._o.er(t3, o, p2.targetId);
              }).next(function() {
                return i.Tc.Zo(t3, e2);
              });
            });
          })];
      }
    });
  });
}
function yo(t2, e, n2) {
  return n2 === void 0 && (n2 = mn()), __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return [4, ao(t2, he(si(e.bundledQuery)))];
        case 1:
          return r2 = o.sent(), [2, (i = O2(t2)).persistence.runTransaction("Save named query", "readwrite", function(t3) {
            var o2 = Mn(e.readTime);
            if (r2.Ot._(o2) >= 0)
              return i.wo.Ls(t3, e);
            var u = r2.Mt(U2.T, o2);
            return i.fc = i.fc.zt(u.targetId, u), i._o.Hi(t3, u).next(function() {
              return i._o.Yi(t3, r2.targetId);
            }).next(function() {
              return i._o.er(t3, n2, r2.targetId);
            }).next(function() {
              return i.wo.Ls(t3, e);
            });
          })];
      }
    });
  });
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var mo = function() {
  function t2(t3) {
    this.Qt = t3, this.Vc = new Map(), this.bc = new Map();
  }
  return t2.prototype.Os = function(t3, e) {
    return lr.resolve(this.Vc.get(e));
  }, t2.prototype.ks = function(t3, e) {
    var n2;
    return this.Vc.set(e.id, {
      id: (n2 = e).id,
      version: n2.version,
      createTime: Mn(n2.createTime)
    }), lr.resolve();
  }, t2.prototype.Ms = function(t3, e) {
    return lr.resolve(this.bc.get(e));
  }, t2.prototype.Ls = function(t3, e) {
    return this.bc.set(e.name, function(t4) {
      return {
        name: t4.name,
        query: si(t4.bundledQuery),
        readTime: Mn(t4.readTime)
      };
    }(e)), lr.resolve();
  }, t2;
}();
var go = function() {
  function t2() {
    this.vc = new sn(wo.Sc), this.Dc = new sn(wo.Cc);
  }
  return t2.prototype.et = function() {
    return this.vc.et();
  }, t2.prototype.nr = function(t3, e) {
    var n2 = new wo(t3, e);
    this.vc = this.vc.add(n2), this.Dc = this.Dc.add(n2);
  }, t2.prototype.xc = function(t3, e) {
    var n2 = this;
    t3.forEach(function(t4) {
      return n2.nr(t4, e);
    });
  }, t2.prototype.ir = function(t3, e) {
    this.Nc(new wo(t3, e));
  }, t2.prototype.$c = function(t3, e) {
    var n2 = this;
    t3.forEach(function(t4) {
      return n2.ir(t4, e);
    });
  }, t2.prototype.Fc = function(t3) {
    var e = this, n2 = new tt(new Z2([])), r2 = new wo(n2, t3), i = new wo(n2, t3 + 1), o = [];
    return this.Dc.me([r2, i], function(t4) {
      e.Nc(t4), o.push(t4.key);
    }), o;
  }, t2.prototype.Oc = function() {
    var t3 = this;
    this.vc.forEach(function(e) {
      return t3.Nc(e);
    });
  }, t2.prototype.Nc = function(t3) {
    this.vc = this.vc.delete(t3), this.Dc = this.Dc.delete(t3);
  }, t2.prototype.kc = function(t3) {
    var e = new tt(new Z2([])), n2 = new wo(e, t3), r2 = new wo(e, t3 + 1), i = mn();
    return this.Dc.me([n2, r2], function(t4) {
      i = i.add(t4.key);
    }), i;
  }, t2.prototype.Fi = function(t3) {
    var e = new wo(t3, 0), n2 = this.vc.Re(e);
    return n2 !== null && t3.isEqual(n2.key);
  }, t2;
}();
var wo = function() {
  function t2(t3, e) {
    this.key = t3, this.Mc = e;
  }
  return t2.Sc = function(t3, e) {
    return tt.H(t3.key, e.key) || C(t3.Mc, e.Mc);
  }, t2.Cc = function(t3, e) {
    return C(t3.Mc, e.Mc) || tt.H(t3.key, e.key);
  }, t2;
}();
var bo = function() {
  function t2(t3, e) {
    this.Ei = t3, this.Ti = e, this.zo = [], this.Lc = 1, this.Bc = new sn(wo.Sc);
  }
  return t2.prototype.Ai = function(t3) {
    return lr.resolve(this.zo.length === 0);
  }, t2.prototype.Ri = function(t3, e, n2, r2) {
    var i = this.Lc;
    this.Lc++, this.zo.length > 0 && this.zo[this.zo.length - 1];
    var o = new Xr(i, e, n2, r2);
    this.zo.push(o);
    for (var u = 0, s = r2; u < s.length; u++) {
      var a = s[u];
      this.Bc = this.Bc.add(new wo(a.key, i)), this.Ei.qs(t3, a.key.path.X());
    }
    return lr.resolve(o);
  }, t2.prototype.Pi = function(t3, e) {
    return lr.resolve(this.qc(e));
  }, t2.prototype.gi = function(t3, e) {
    var n2 = e + 1, r2 = this.Uc(n2), i = r2 < 0 ? 0 : r2;
    return lr.resolve(this.zo.length > i ? this.zo[i] : null);
  }, t2.prototype.Vi = function() {
    return lr.resolve(this.zo.length === 0 ? -1 : this.Lc - 1);
  }, t2.prototype.pi = function(t3) {
    return lr.resolve(this.zo.slice());
  }, t2.prototype.bi = function(t3, e) {
    var n2 = this, r2 = new wo(e, 0), i = new wo(e, Number.POSITIVE_INFINITY), o = [];
    return this.Bc.me([r2, i], function(t4) {
      var e2 = n2.qc(t4.Mc);
      o.push(e2);
    }), lr.resolve(o);
  }, t2.prototype.vi = function(t3, e) {
    var n2 = this, r2 = new sn(C);
    return e.forEach(function(t4) {
      var e2 = new wo(t4, 0), i = new wo(t4, Number.POSITIVE_INFINITY);
      n2.Bc.me([e2, i], function(t5) {
        r2 = r2.add(t5.Mc);
      });
    }), lr.resolve(this.Qc(r2));
  }, t2.prototype.Di = function(t3, e) {
    var n2 = e.path, r2 = n2.length + 1, i = n2;
    tt.wt(i) || (i = i.child(""));
    var o = new wo(new tt(i), 0), u = new sn(C);
    return this.Bc.Ae(function(t4) {
      var e2 = t4.key.path;
      return !!n2.nt(e2) && (e2.length === r2 && (u = u.add(t4.Mc)), true);
    }, o), lr.resolve(this.Qc(u));
  }, t2.prototype.Qc = function(t3) {
    var e = this, n2 = [];
    return t3.forEach(function(t4) {
      var r2 = e.qc(t4);
      r2 !== null && n2.push(r2);
    }), n2;
  }, t2.prototype.Ci = function(t3, e) {
    var n2 = this;
    k2(this.Kc(e.batchId, "removed") === 0), this.zo.shift();
    var r2 = this.Bc;
    return lr.forEach(e.mutations, function(i) {
      var o = new wo(i.key, e.batchId);
      return r2 = r2.delete(o), n2.Ti.Ni(t3, i.key);
    }).next(function() {
      n2.Bc = r2;
    });
  }, t2.prototype.xi = function(t3) {
  }, t2.prototype.Fi = function(t3, e) {
    var n2 = new wo(e, 0), r2 = this.Bc.Re(n2);
    return lr.resolve(e.isEqual(r2 && r2.key));
  }, t2.prototype.$i = function(t3) {
    return this.zo.length, lr.resolve();
  }, t2.prototype.Kc = function(t3, e) {
    return this.Uc(t3);
  }, t2.prototype.Uc = function(t3) {
    return this.zo.length === 0 ? 0 : t3 - this.zo[0].batchId;
  }, t2.prototype.qc = function(t3) {
    var e = this.Uc(t3);
    return e < 0 || e >= this.zo.length ? null : this.zo[e];
  }, t2;
}();
var _o = function() {
  function t2(t3, e) {
    this.Ei = t3, this.Wc = e, this.docs = new rn(tt.H), this.size = 0;
  }
  return t2.prototype.ai = function(t3, e, n2) {
    var r2 = e.key, i = this.docs.get(r2), o = i ? i.size : 0, u = this.Wc(e);
    return this.docs = this.docs.zt(r2, {
      hi: e,
      size: u,
      readTime: n2
    }), this.size += u - o, this.Ei.qs(t3, r2.path.X());
  }, t2.prototype.li = function(t3) {
    var e = this.docs.get(t3);
    e && (this.docs = this.docs.remove(t3), this.size -= e.size);
  }, t2.prototype._i = function(t3, e) {
    var n2 = this.docs.get(e);
    return lr.resolve(n2 ? n2.hi : null);
  }, t2.prototype.getEntries = function(t3, e) {
    var n2 = this, r2 = fn();
    return e.forEach(function(t4) {
      var e2 = n2.docs.get(t4);
      r2 = r2.zt(t4, e2 ? e2.hi : null);
    }), lr.resolve(r2);
  }, t2.prototype.Kr = function(t3, e, n2) {
    for (var r2 = pn(), i = new tt(e.path.child("")), o = this.docs.ee(i); o.ce(); ) {
      var u = o.oe(), s = u.key, a = u.value, c = a.hi, h2 = a.readTime;
      if (!e.path.nt(s.path))
        break;
      h2._(n2) <= 0 || c instanceof Pt && ve(e, c) && (r2 = r2.zt(c.key, c));
    }
    return lr.resolve(r2);
  }, t2.prototype.jc = function(t3, e) {
    return lr.forEach(this.docs, function(t4) {
      return e(t4);
    });
  }, t2.prototype.Nr = function(t3) {
    return new Io(this);
  }, t2.prototype.Or = function(t3) {
    return lr.resolve(this.size);
  }, t2;
}();
var Io = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).jr = e2, n2;
  }
  return __extends(e, t2), e.prototype.wi = function(t3) {
    var e2 = this, n2 = [];
    return this.ri.forEach(function(r2, i) {
      i && i.hi ? n2.push(e2.jr.ai(t3, i.hi, e2.ci(r2))) : e2.jr.li(r2);
    }), lr.Mn(n2);
  }, e.prototype.fi = function(t3, e2) {
    return this.jr._i(t3, e2);
  }, e.prototype.di = function(t3, e2) {
    return this.jr.getEntries(t3, e2);
  }, e;
}(wi);
var Eo = function() {
  function t2(t3) {
    this.persistence = t3, this.Gc = new gi(function(t4) {
      return Ut(t4);
    }, Mt), this.lastRemoteSnapshotVersion = X2.min(), this.highestTargetId = 0, this.zc = 0, this.Hc = new go(), this.targetCount = 0, this.Jc = Di.Mi();
  }
  return t2.prototype.In = function(t3, e) {
    return this.Gc.forEach(function(t4, n2) {
      return e(n2);
    }), lr.resolve();
  }, t2.prototype.Qi = function(t3) {
    return lr.resolve(this.lastRemoteSnapshotVersion);
  }, t2.prototype.Ki = function(t3) {
    return lr.resolve(this.zc);
  }, t2.prototype.Bi = function(t3) {
    return this.highestTargetId = this.Jc.next(), lr.resolve(this.highestTargetId);
  }, t2.prototype.Wi = function(t3, e, n2) {
    return n2 && (this.lastRemoteSnapshotVersion = n2), e > this.zc && (this.zc = e), lr.resolve();
  }, t2.prototype.Gi = function(t3) {
    this.Gc.set(t3.target, t3);
    var e = t3.targetId;
    e > this.highestTargetId && (this.Jc = new Di(e), this.highestTargetId = e), t3.sequenceNumber > this.zc && (this.zc = t3.sequenceNumber);
  }, t2.prototype.ji = function(t3, e) {
    return this.Gi(e), this.targetCount += 1, lr.resolve();
  }, t2.prototype.Hi = function(t3, e) {
    return this.Gi(e), lr.resolve();
  }, t2.prototype.Ji = function(t3, e) {
    return this.Gc.delete(e.target), this.Hc.Fc(e.targetId), this.targetCount -= 1, lr.resolve();
  }, t2.prototype.Xi = function(t3, e, n2) {
    var r2 = this, i = 0, o = [];
    return this.Gc.forEach(function(u, s) {
      s.sequenceNumber <= e && n2.get(s.targetId) === null && (r2.Gc.delete(u), o.push(r2.Yi(t3, s.targetId)), i++);
    }), lr.Mn(o).next(function() {
      return i;
    });
  }, t2.prototype.Zi = function(t3) {
    return lr.resolve(this.targetCount);
  }, t2.prototype.tr = function(t3, e) {
    var n2 = this.Gc.get(e) || null;
    return lr.resolve(n2);
  }, t2.prototype.er = function(t3, e, n2) {
    return this.Hc.xc(e, n2), lr.resolve();
  }, t2.prototype.sr = function(t3, e, n2) {
    this.Hc.$c(e, n2);
    var r2 = this.persistence.Ti, i = [];
    return r2 && e.forEach(function(e2) {
      i.push(r2.Ni(t3, e2));
    }), lr.Mn(i);
  }, t2.prototype.Yi = function(t3, e) {
    return this.Hc.Fc(e), lr.resolve();
  }, t2.prototype.rr = function(t3, e) {
    var n2 = this.Hc.kc(e);
    return lr.resolve(n2);
  }, t2.prototype.Fi = function(t3, e) {
    return lr.resolve(this.Hc.Fi(e));
  }, t2;
}();
var To = function() {
  function t2(t3, e) {
    var n2 = this;
    this.Yc = {}, this.so = new H2(0), this.io = false, this.io = true, this.Ti = t3(this), this._o = new Eo(this), this.Ei = new fi(), this.fo = function(t4, e2) {
      return new _o(t4, function(t5) {
        return n2.Ti.Xc(t5);
      });
    }(this.Ei), this.Qt = new Zr(e), this.wo = new mo(this.Qt);
  }
  return t2.prototype.start = function() {
    return Promise.resolve();
  }, t2.prototype.ko = function() {
    return this.io = false, Promise.resolve();
  }, Object.defineProperty(t2.prototype, "Er", {
    get: function() {
      return this.io;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Po = function() {
  }, t2.prototype.yo = function() {
  }, t2.prototype.Ko = function() {
    return this.Ei;
  }, t2.prototype.Qo = function(t3) {
    var e = this.Yc[t3.A()];
    return e || (e = new bo(this.Ei, this.Ti), this.Yc[t3.A()] = e), e;
  }, t2.prototype.Sr = function() {
    return this._o;
  }, t2.prototype.$r = function() {
    return this.fo;
  }, t2.prototype.Wo = function() {
    return this.wo;
  }, t2.prototype.runTransaction = function(t3, e, n2) {
    var r2 = this;
    N2("MemoryPersistence", "Starting transaction:", t3);
    var i = new No(this.so.next());
    return this.Ti.Zc(), n2(i).next(function(t4) {
      return r2.Ti.ta(i).next(function() {
        return t4;
      });
    }).On().then(function(t4) {
      return i.Vs(), t4;
    });
  }, t2.prototype.ea = function(t3, e) {
    return lr.Ln(Object.values(this.Yc).map(function(n2) {
      return function() {
        return n2.Fi(t3, e);
      };
    }));
  }, t2;
}();
var No = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).bs = e2, n2;
  }
  return __extends(e, t2), e;
}(Nr);
var Ao = function() {
  function t2(t3) {
    this.persistence = t3, this.na = new go(), this.sa = null;
  }
  return t2.ia = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "ra", {
    get: function() {
      if (this.sa)
        return this.sa;
      throw x2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.nr = function(t3, e, n2) {
    return this.na.nr(n2, e), this.ra.delete(n2.toString()), lr.resolve();
  }, t2.prototype.ir = function(t3, e, n2) {
    return this.na.ir(n2, e), this.ra.add(n2.toString()), lr.resolve();
  }, t2.prototype.Ni = function(t3, e) {
    return this.ra.add(e.toString()), lr.resolve();
  }, t2.prototype.removeTarget = function(t3, e) {
    var n2 = this;
    this.na.Fc(e.targetId).forEach(function(t4) {
      return n2.ra.add(t4.toString());
    });
    var r2 = this.persistence.Sr();
    return r2.rr(t3, e.targetId).next(function(t4) {
      t4.forEach(function(t5) {
        return n2.ra.add(t5.toString());
      });
    }).next(function() {
      return r2.Ji(t3, e);
    });
  }, t2.prototype.Zc = function() {
    this.sa = new Set();
  }, t2.prototype.ta = function(t3) {
    var e = this, n2 = this.persistence.$r().Nr();
    return lr.forEach(this.ra, function(r2) {
      var i = tt._t(r2);
      return e.oa(t3, i).next(function(t4) {
        t4 || n2.li(i);
      });
    }).next(function() {
      return e.sa = null, n2.apply(t3);
    });
  }, t2.prototype.Fr = function(t3, e) {
    var n2 = this;
    return this.oa(t3, e).next(function(t4) {
      t4 ? n2.ra.delete(e.toString()) : n2.ra.add(e.toString());
    });
  }, t2.prototype.Xc = function(t3) {
    return 0;
  }, t2.prototype.oa = function(t3, e) {
    var n2 = this;
    return lr.Ln([function() {
      return lr.resolve(n2.na.Fi(e));
    }, function() {
      return n2.persistence.Sr().Fi(t3, e);
    }, function() {
      return n2.persistence.ea(t3, e);
    }]);
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Do(t2, e) {
  return "firestore_clients_" + t2 + "_" + e;
}
function So(t2, e, n2) {
  var r2 = "firestore_mutations_" + t2 + "_" + n2;
  return e.m() && (r2 += "_" + e.uid), r2;
}
function xo(t2, e) {
  return "firestore_targets_" + t2 + "_" + e;
}
var ko = function() {
  function t2(t3, e, n2, r2) {
    this.user = t3, this.batchId = e, this.state = n2, this.error = r2;
  }
  return t2.ca = function(e, n2, r2) {
    var i, o = JSON.parse(r2), u = typeof o == "object" && ["pending", "acknowledged", "rejected"].indexOf(o.state) !== -1 && (o.error === void 0 || typeof o.error == "object");
    return u && o.error && ((u = typeof o.error.message == "string" && typeof o.error.code == "string") && (i = new q2(o.error.code, o.error.message))), u ? new t2(e, n2, o.state, i) : (A2("SharedClientState", "Failed to parse mutation state for ID '" + n2 + "': " + r2), null);
  }, t2.prototype.aa = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var Oo = function() {
  function t2(t3, e, n2) {
    this.targetId = t3, this.state = e, this.error = n2;
  }
  return t2.ca = function(e, n2) {
    var r2, i = JSON.parse(n2), o = typeof i == "object" && ["not-current", "current", "rejected"].indexOf(i.state) !== -1 && (i.error === void 0 || typeof i.error == "object");
    return o && i.error && ((o = typeof i.error.message == "string" && typeof i.error.code == "string") && (r2 = new q2(i.error.code, i.error.message))), o ? new t2(e, i.state, r2) : (A2("SharedClientState", "Failed to parse target state for ID '" + e + "': " + n2), null);
  }, t2.prototype.aa = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var Po = function() {
  function t2(t3, e) {
    this.clientId = t3, this.activeTargetIds = e;
  }
  return t2.ca = function(e, n2) {
    for (var r2 = JSON.parse(n2), i = typeof r2 == "object" && r2.activeTargetIds instanceof Array, o = wn(), u = 0; i && u < r2.activeTargetIds.length; ++u)
      i = dt(r2.activeTargetIds[u]), o = o.add(r2.activeTargetIds[u]);
    return i ? new t2(e, o) : (A2("SharedClientState", "Failed to parse client data for instance '" + e + "': " + n2), null);
  }, t2;
}();
var Vo = function() {
  function t2(t3, e) {
    this.clientId = t3, this.onlineState = e;
  }
  return t2.ca = function(e) {
    var n2 = JSON.parse(e);
    return typeof n2 == "object" && ["Unknown", "Online", "Offline"].indexOf(n2.onlineState) !== -1 && typeof n2.clientId == "string" ? new t2(n2.clientId, n2.onlineState) : (A2("SharedClientState", "Failed to parse online state: " + e), null);
  }, t2;
}();
var Co = function() {
  function t2() {
    this.activeTargetIds = wn();
  }
  return t2.prototype.ua = function(t3) {
    this.activeTargetIds = this.activeTargetIds.add(t3);
  }, t2.prototype.ha = function(t3) {
    this.activeTargetIds = this.activeTargetIds.delete(t3);
  }, t2.prototype.aa = function() {
    var t3 = {
      activeTargetIds: this.activeTargetIds.it(),
      updateTimeMs: Date.now()
    };
    return JSON.stringify(t3);
  }, t2;
}();
var Lo = function() {
  function t2(t3, e, n2, r2, i) {
    this.window = t3, this.Zr = e, this.persistenceKey = n2, this.la = r2, this._a = null, this.fa = null, this.k = null, this.da = this.wa.bind(this), this.Ea = new rn(C), this.Er = false, this.Ta = [];
    var o = n2.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    this.storage = this.window.localStorage, this.currentUser = i, this.Ia = Do(this.persistenceKey, this.la), this.ma = function(t4) {
      return "firestore_sequence_number_" + t4;
    }(this.persistenceKey), this.Ea = this.Ea.zt(this.la, new Co()), this.Aa = new RegExp("^firestore_clients_" + o + "_([^_]*)$"), this.Ra = new RegExp("^firestore_mutations_" + o + "_(\\d+)(?:_(.*))?$"), this.Pa = new RegExp("^firestore_targets_" + o + "_(\\d+)$"), this.ya = function(t4) {
      return "firestore_online_state_" + t4;
    }(this.persistenceKey), this.ga = function(t4) {
      return "firestore_bundle_loaded_" + t4;
    }(this.persistenceKey), this.window.addEventListener("storage", this.da);
  }
  return t2.Kn = function(t3) {
    return !(!t3 || !t3.localStorage);
  }, t2.prototype.start = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i, o, u, s, a, c, h2, f = this;
      return __generator(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this._a.Uo()];
          case 1:
            for (t3 = l.sent(), e = 0, n2 = t3; e < n2.length; e++)
              (r2 = n2[e]) !== this.la && (i = this.getItem(Do(this.persistenceKey, r2))) && (o = Po.ca(r2, i)) && (this.Ea = this.Ea.zt(o.clientId, o));
            for (this.Va(), (u = this.storage.getItem(this.ya)) && (s = this.pa(u)) && this.ba(s), a = 0, c = this.Ta; a < c.length; a++)
              h2 = c[a], this.wa(h2);
            return this.Ta = [], this.window.addEventListener("unload", function() {
              return f.ko();
            }), this.Er = true, [2];
        }
      });
    });
  }, t2.prototype.B = function(t3) {
    this.setItem(this.ma, JSON.stringify(t3));
  }, t2.prototype.va = function() {
    return this.Sa(this.Ea);
  }, t2.prototype.Da = function(t3) {
    var e = false;
    return this.Ea.forEach(function(n2, r2) {
      r2.activeTargetIds.has(t3) && (e = true);
    }), e;
  }, t2.prototype.Ca = function(t3) {
    this.xa(t3, "pending");
  }, t2.prototype.Na = function(t3, e, n2) {
    this.xa(t3, e, n2), this.$a(t3);
  }, t2.prototype.Fa = function(t3) {
    var e = "not-current";
    if (this.Da(t3)) {
      var n2 = this.storage.getItem(xo(this.persistenceKey, t3));
      if (n2) {
        var r2 = Oo.ca(t3, n2);
        r2 && (e = r2.state);
      }
    }
    return this.Oa.ua(t3), this.Va(), e;
  }, t2.prototype.ka = function(t3) {
    this.Oa.ha(t3), this.Va();
  }, t2.prototype.Ma = function(t3) {
    return this.Oa.activeTargetIds.has(t3);
  }, t2.prototype.La = function(t3) {
    this.removeItem(xo(this.persistenceKey, t3));
  }, t2.prototype.Ba = function(t3, e, n2) {
    this.qa(t3, e, n2);
  }, t2.prototype.Ua = function(t3, e, n2) {
    var r2 = this;
    e.forEach(function(t4) {
      r2.$a(t4);
    }), this.currentUser = t3, n2.forEach(function(t4) {
      r2.Ca(t4);
    });
  }, t2.prototype.Qa = function(t3) {
    this.Ka(t3);
  }, t2.prototype.Wa = function() {
    this.ja();
  }, t2.prototype.ko = function() {
    this.Er && (this.window.removeEventListener("storage", this.da), this.removeItem(this.Ia), this.Er = false);
  }, t2.prototype.getItem = function(t3) {
    var e = this.storage.getItem(t3);
    return N2("SharedClientState", "READ", t3, e), e;
  }, t2.prototype.setItem = function(t3, e) {
    N2("SharedClientState", "SET", t3, e), this.storage.setItem(t3, e);
  }, t2.prototype.removeItem = function(t3) {
    N2("SharedClientState", "REMOVE", t3), this.storage.removeItem(t3);
  }, t2.prototype.wa = function(t3) {
    var e = this, n2 = t3;
    if (n2.storageArea === this.storage) {
      if (N2("SharedClientState", "EVENT", n2.key, n2.newValue), n2.key === this.Ia)
        return void A2("Received WebStorage notification for local change. Another client might have garbage-collected our state");
      this.Zr.po(function() {
        return __awaiter(e, void 0, void 0, function() {
          var t4, e2, r2, i, o, u;
          return __generator(this, function(s) {
            if (this.Er) {
              if (n2.key !== null) {
                if (this.Aa.test(n2.key)) {
                  if (n2.newValue == null)
                    return t4 = this.Ga(n2.key), [2, this.za(t4, null)];
                  if (e2 = this.Ha(n2.key, n2.newValue))
                    return [2, this.za(e2.clientId, e2)];
                } else if (this.Ra.test(n2.key)) {
                  if (n2.newValue !== null && (r2 = this.Ja(n2.key, n2.newValue)))
                    return [2, this.Ya(r2)];
                } else if (this.Pa.test(n2.key)) {
                  if (n2.newValue !== null && (i = this.Xa(n2.key, n2.newValue)))
                    return [2, this.Za(i)];
                } else if (n2.key === this.ya) {
                  if (n2.newValue !== null && (o = this.pa(n2.newValue)))
                    return [2, this.ba(o)];
                } else if (n2.key === this.ma)
                  (u = function(t5) {
                    var e3 = H2.q;
                    if (t5 != null)
                      try {
                        var n3 = JSON.parse(t5);
                        k2(typeof n3 == "number"), e3 = n3;
                      } catch (t6) {
                        A2("SharedClientState", "Failed to read sequence number from WebStorage", t6);
                      }
                    return e3;
                  }(n2.newValue)) !== H2.q && this.k(u);
                else if (n2.key === this.ga)
                  return [2, this._a.tu()];
              }
            } else
              this.Ta.push(n2);
            return [2];
          });
        });
      });
    }
  }, Object.defineProperty(t2.prototype, "Oa", {
    get: function() {
      return this.Ea.get(this.la);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Va = function() {
    this.setItem(this.Ia, this.Oa.aa());
  }, t2.prototype.xa = function(t3, e, n2) {
    var r2 = new ko(this.currentUser, t3, e, n2), i = So(this.persistenceKey, this.currentUser, t3);
    this.setItem(i, r2.aa());
  }, t2.prototype.$a = function(t3) {
    var e = So(this.persistenceKey, this.currentUser, t3);
    this.removeItem(e);
  }, t2.prototype.Ka = function(t3) {
    var e = {
      clientId: this.la,
      onlineState: t3
    };
    this.storage.setItem(this.ya, JSON.stringify(e));
  }, t2.prototype.qa = function(t3, e, n2) {
    var r2 = xo(this.persistenceKey, t3), i = new Oo(t3, e, n2);
    this.setItem(r2, i.aa());
  }, t2.prototype.ja = function() {
    this.setItem(this.ga, "value-not-used");
  }, t2.prototype.Ga = function(t3) {
    var e = this.Aa.exec(t3);
    return e ? e[1] : null;
  }, t2.prototype.Ha = function(t3, e) {
    var n2 = this.Ga(t3);
    return Po.ca(n2, e);
  }, t2.prototype.Ja = function(t3, e) {
    var n2 = this.Ra.exec(t3), r2 = Number(n2[1]), i = n2[2] !== void 0 ? n2[2] : null;
    return ko.ca(new j(i), r2, e);
  }, t2.prototype.Xa = function(t3, e) {
    var n2 = this.Pa.exec(t3), r2 = Number(n2[1]);
    return Oo.ca(r2, e);
  }, t2.prototype.pa = function(t3) {
    return Vo.ca(t3);
  }, t2.prototype.Ya = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        return t3.user.uid === this.currentUser.uid ? [2, this._a.eu(t3.batchId, t3.state, t3.error)] : (N2("SharedClientState", "Ignoring mutation for non-active user " + t3.user.uid), [2]);
      });
    });
  }, t2.prototype.Za = function(t3) {
    return this._a.nu(t3.targetId, t3.state, t3.error);
  }, t2.prototype.za = function(t3, e) {
    var n2 = this, r2 = e ? this.Ea.zt(t3, e) : this.Ea.remove(t3), i = this.Sa(this.Ea), o = this.Sa(r2), u = [], s = [];
    return o.forEach(function(t4) {
      i.has(t4) || u.push(t4);
    }), i.forEach(function(t4) {
      o.has(t4) || s.push(t4);
    }), this._a.su(u, s).then(function() {
      n2.Ea = r2;
    });
  }, t2.prototype.ba = function(t3) {
    this.Ea.get(t3.clientId) && this.fa(t3.onlineState);
  }, t2.prototype.Sa = function(t3) {
    var e = wn();
    return t3.forEach(function(t4, n2) {
      e = e.Pe(n2.activeTargetIds);
    }), e;
  }, t2;
}();
var Ro = function() {
  function t2() {
    this.iu = new Co(), this.ru = {}, this.fa = null, this.k = null;
  }
  return t2.prototype.Ca = function(t3) {
  }, t2.prototype.Na = function(t3, e, n2) {
  }, t2.prototype.Fa = function(t3) {
    return this.iu.ua(t3), this.ru[t3] || "not-current";
  }, t2.prototype.Ba = function(t3, e, n2) {
    this.ru[t3] = e;
  }, t2.prototype.ka = function(t3) {
    this.iu.ha(t3);
  }, t2.prototype.Ma = function(t3) {
    return this.iu.activeTargetIds.has(t3);
  }, t2.prototype.La = function(t3) {
    delete this.ru[t3];
  }, t2.prototype.va = function() {
    return this.iu.activeTargetIds;
  }, t2.prototype.Da = function(t3) {
    return this.iu.activeTargetIds.has(t3);
  }, t2.prototype.start = function() {
    return this.iu = new Co(), Promise.resolve();
  }, t2.prototype.Ua = function(t3, e, n2) {
  }, t2.prototype.Qa = function(t3) {
  }, t2.prototype.ko = function() {
  }, t2.prototype.B = function(t3) {
  }, t2.prototype.Wa = function() {
  }, t2;
}();
var Uo = function() {
  function t2() {
  }
  return t2.prototype.ou = function(t3) {
  }, t2.prototype.ko = function() {
  }, t2;
}();
var Mo = function() {
  function t2() {
    var t3 = this;
    this.cu = function() {
      return t3.au();
    }, this.uu = function() {
      return t3.hu();
    }, this.lu = [], this._u();
  }
  return t2.prototype.ou = function(t3) {
    this.lu.push(t3);
  }, t2.prototype.ko = function() {
    window.removeEventListener("online", this.cu), window.removeEventListener("offline", this.uu);
  }, t2.prototype._u = function() {
    window.addEventListener("online", this.cu), window.addEventListener("offline", this.uu);
  }, t2.prototype.au = function() {
    N2("ConnectivityMonitor", "Network connectivity changed: AVAILABLE");
    for (var t3 = 0, e = this.lu; t3 < e.length; t3++) {
      (0, e[t3])(0);
    }
  }, t2.prototype.hu = function() {
    N2("ConnectivityMonitor", "Network connectivity changed: UNAVAILABLE");
    for (var t3 = 0, e = this.lu; t3 < e.length; t3++) {
      (0, e[t3])(1);
    }
  }, t2.Kn = function() {
    return typeof window != "undefined" && window.addEventListener !== void 0 && window.removeEventListener !== void 0;
  }, t2;
}();
var qo = {
  BatchGetDocuments: "batchGet",
  Commit: "commit",
  RunQuery: "runQuery"
};
var Fo = function() {
  function t2(t3) {
    this.fu = t3.fu, this.du = t3.du;
  }
  return t2.prototype.wu = function(t3) {
    this.Eu = t3;
  }, t2.prototype.Tu = function(t3) {
    this.Iu = t3;
  }, t2.prototype.onMessage = function(t3) {
    this.mu = t3;
  }, t2.prototype.close = function() {
    this.du();
  }, t2.prototype.send = function(t3) {
    this.fu(t3);
  }, t2.prototype.Au = function() {
    this.Eu();
  }, t2.prototype.Ru = function(t3) {
    this.Iu(t3);
  }, t2.prototype.Pu = function(t3) {
    this.mu(t3);
  }, t2;
}();
var jo = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this, e2) || this).forceLongPolling = e2.forceLongPolling, n2.i = e2.i, n2;
  }
  return __extends(e, t2), e.prototype.Su = function(t3, e2, n2, r2) {
    return new Promise(function(i, o) {
      var u = new XhrIo();
      u.listenOnce(EventType.COMPLETE, function() {
        try {
          switch (u.getLastErrorCode()) {
            case ErrorCode.NO_ERROR:
              var e3 = u.getResponseJson();
              N2("Connection", "XHR received:", JSON.stringify(e3)), i(e3);
              break;
            case ErrorCode.TIMEOUT:
              N2("Connection", 'RPC "' + t3 + '" timed out'), o(new q2(M2.DEADLINE_EXCEEDED, "Request time out"));
              break;
            case ErrorCode.HTTP_ERROR:
              var n3 = u.getStatus();
              if (N2("Connection", 'RPC "' + t3 + '" failed with status:', n3, "response text:", u.getResponseText()), n3 > 0) {
                var r3 = u.getResponseJson().error;
                if (r3 && r3.status && r3.message) {
                  var s2 = function(t4) {
                    var e4 = t4.toLowerCase().replace(/_/g, "-");
                    return Object.values(M2).indexOf(e4) >= 0 ? e4 : M2.UNKNOWN;
                  }(r3.status);
                  o(new q2(s2, r3.message));
                } else
                  o(new q2(M2.UNKNOWN, "Server responded with status " + u.getStatus()));
              } else
                o(new q2(M2.UNAVAILABLE, "Connection failed."));
              break;
            default:
              x2();
          }
        } finally {
          N2("Connection", 'RPC "' + t3 + '" completed.');
        }
      });
      var s = JSON.stringify(r2);
      u.send(e2, "POST", s, n2, 15);
    });
  }, e.prototype.Cu = function(t3, e2) {
    var n2 = [this.gu, "/", "google.firestore.v1.Firestore", "/", t3, "/channel"], c = createWebChannelTransport(), h2 = getStatEventTarget(), f = {
      httpSessionIdParam: "gsessionid",
      initMessageHeaders: {},
      messageUrlParams: {
        database: "projects/" + this.t.projectId + "/databases/" + this.t.database
      },
      sendRawJson: true,
      supportsCrossDomainXhr: true,
      internalChannelParams: {
        forwardChannelRequestTimeoutMs: 6e5
      },
      forceLongPolling: this.forceLongPolling,
      detectBufferingProxy: this.i
    };
    this.vu(f.initMessageHeaders, e2), isMobileCordova() || isReactNative() || isElectron() || isIE() || isUWP() || isBrowserExtension() || (f.httpHeadersOverwriteParam = "$httpHeaders");
    var m = n2.join("");
    N2("Connection", "Creating WebChannel: " + m, f);
    var g = c.createWebChannel(m, f), w2 = false, b = false, _2 = new Fo({
      fu: function(t4) {
        b ? N2("Connection", "Not sending because WebChannel is closed:", t4) : (w2 || (N2("Connection", "Opening WebChannel transport."), g.open(), w2 = true), N2("Connection", "WebChannel sending:", t4), g.send(t4));
      },
      du: function() {
        return g.close();
      }
    }), I4 = function(t4, e3, n3) {
      t4.listen(e3, function(t5) {
        try {
          n3(t5);
        } catch (t6) {
          setTimeout(function() {
            throw t6;
          }, 0);
        }
      });
    };
    return I4(g, WebChannel.EventType.OPEN, function() {
      b || N2("Connection", "WebChannel transport opened.");
    }), I4(g, WebChannel.EventType.CLOSE, function() {
      b || (b = true, N2("Connection", "WebChannel transport closed"), _2.Ru());
    }), I4(g, WebChannel.EventType.ERROR, function(t4) {
      b || (b = true, D2("Connection", "WebChannel transport errored:", t4), _2.Ru(new q2(M2.UNAVAILABLE, "The operation could not be completed")));
    }), I4(g, WebChannel.EventType.MESSAGE, function(t4) {
      var e3;
      if (!b) {
        var n3 = t4.data[0];
        k2(!!n3);
        var r2 = n3, i = r2.error || ((e3 = r2[0]) === null || e3 === void 0 ? void 0 : e3.error);
        if (i) {
          N2("Connection", "WebChannel received error:", i);
          var o = i.status, u = function(t5) {
            var e4 = We[t5];
            if (e4 !== void 0)
              return nn(e4);
          }(o), s = i.message;
          u === void 0 && (u = M2.INTERNAL, s = "Unknown error status: " + o + " with message " + i.message), b = true, _2.Ru(new q2(u, s)), g.close();
        } else
          N2("Connection", "WebChannel received:", n3), _2.Pu(n3);
      }
    }), I4(h2, Event.STAT_EVENT, function(t4) {
      t4.stat === Stat.PROXY ? N2("Connection", "Detected buffering proxy") : t4.stat === Stat.NOPROXY && N2("Connection", "Detected no buffering proxy");
    }), setTimeout(function() {
      _2.Au();
    }, 0), _2;
  }, e;
}(function() {
  function t2(t3) {
    this.yu = t3, this.t = t3.t;
    var e = t3.ssl ? "https" : "http";
    this.gu = e + "://" + t3.host, this.Vu = "projects/" + this.t.projectId + "/databases/" + this.t.database + "/documents";
  }
  return t2.prototype.pu = function(t3, e, n2, r2) {
    var i = this.bu(t3, e);
    N2("RestConnection", "Sending: ", i, n2);
    var o = {};
    return this.vu(o, r2), this.Su(t3, i, o, n2).then(function(t4) {
      return N2("RestConnection", "Received: ", t4), t4;
    }, function(e2) {
      throw D2("RestConnection", t3 + " failed with error: ", e2, "url: ", i, "request:", n2), e2;
    });
  }, t2.prototype.Du = function(t3, e, n2, r2) {
    return this.pu(t3, e, n2, r2);
  }, t2.prototype.vu = function(t3, e) {
    if (t3["X-Goog-Api-Client"] = "gl-js/ fire/8.2.9", t3["Content-Type"] = "text/plain", e)
      for (var n2 in e.g)
        e.g.hasOwnProperty(n2) && (t3[n2] = e.g[n2]);
  }, t2.prototype.bu = function(t3, e) {
    var n2 = qo[t3];
    return this.gu + "/v1/" + e + ":" + n2;
  }, t2;
}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function zo() {
  return typeof window != "undefined" ? window : null;
}
function Go() {
  return typeof document != "undefined" ? document : null;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Bo(t2) {
  return new Cn(t2, true);
}
var Qo = function() {
  function t2(t3, e, n2, r2, i) {
    n2 === void 0 && (n2 = 1e3), r2 === void 0 && (r2 = 1.5), i === void 0 && (i = 6e4), this.Zr = t3, this.fs = e, this.xu = n2, this.Nu = r2, this.$u = i, this.Fu = 0, this.Ou = null, this.ku = Date.now(), this.reset();
  }
  return t2.prototype.reset = function() {
    this.Fu = 0;
  }, t2.prototype.Mu = function() {
    this.Fu = this.$u;
  }, t2.prototype.Lu = function(t3) {
    var e = this;
    this.cancel();
    var n2 = Math.floor(this.Fu + this.Bu()), r2 = Math.max(0, Date.now() - this.ku), i = Math.max(0, n2 - r2);
    i > 0 && N2("ExponentialBackoff", "Backing off for " + i + " ms (base delay: " + this.Fu + " ms, delay with jitter: " + n2 + " ms, last attempt: " + r2 + " ms ago)"), this.Ou = this.Zr.Tr(this.fs, i, function() {
      return e.ku = Date.now(), t3();
    }), this.Fu *= this.Nu, this.Fu < this.xu && (this.Fu = this.xu), this.Fu > this.$u && (this.Fu = this.$u);
  }, t2.prototype.qu = function() {
    this.Ou !== null && (this.Ou.Rs(), this.Ou = null);
  }, t2.prototype.cancel = function() {
    this.Ou !== null && (this.Ou.cancel(), this.Ou = null);
  }, t2.prototype.Bu = function() {
    return (Math.random() - 0.5) * this.Fu;
  }, t2;
}();
var Yo = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.Zr = t3, this.Uu = n2, this.Qu = r2, this.Ku = i, this.listener = o, this.state = 0, this.Wu = 0, this.ju = null, this.stream = null, this.Gu = new Qo(t3, e);
  }
  return t2.prototype.zu = function() {
    return this.state === 1 || this.state === 2 || this.state === 4;
  }, t2.prototype.Hu = function() {
    return this.state === 2;
  }, t2.prototype.start = function() {
    this.state !== 3 ? this.auth() : this.Ju();
  }, t2.prototype.stop = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.zu() ? [4, this.close(0)] : [3, 2];
          case 1:
            t3.sent(), t3.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.Yu = function() {
    this.state = 0, this.Gu.reset();
  }, t2.prototype.Xu = function() {
    var t3 = this;
    this.Hu() && this.ju === null && (this.ju = this.Zr.Tr(this.Uu, 6e4, function() {
      return t3.Zu();
    }));
  }, t2.prototype.th = function(t3) {
    this.eh(), this.stream.send(t3);
  }, t2.prototype.Zu = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return this.Hu() ? [2, this.close(0)] : [2];
      });
    });
  }, t2.prototype.eh = function() {
    this.ju && (this.ju.cancel(), this.ju = null);
  }, t2.prototype.close = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.eh(), this.Gu.cancel(), this.Wu++, t3 !== 3 ? this.Gu.reset() : e && e.code === M2.RESOURCE_EXHAUSTED ? (A2(e.toString()), A2("Using maximum backoff delay to prevent overloading the backend."), this.Gu.Mu()) : e && e.code === M2.UNAUTHENTICATED && this.Ku.p(), this.stream !== null && (this.nh(), this.stream.close(), this.stream = null), this.state = t3, [4, this.listener.Tu(e)];
          case 1:
            return n2.sent(), [2];
        }
      });
    });
  }, t2.prototype.nh = function() {
  }, t2.prototype.auth = function() {
    var t3 = this;
    this.state = 1;
    var e = this.sh(this.Wu), n2 = this.Wu;
    this.Ku.getToken().then(function(e2) {
      t3.Wu === n2 && t3.ih(e2);
    }, function(n3) {
      e(function() {
        var e2 = new q2(M2.UNKNOWN, "Fetching auth token failed: " + n3.message);
        return t3.rh(e2);
      });
    });
  }, t2.prototype.ih = function(t3) {
    var e = this, n2 = this.sh(this.Wu);
    this.stream = this.oh(t3), this.stream.wu(function() {
      n2(function() {
        return e.state = 2, e.listener.wu();
      });
    }), this.stream.Tu(function(t4) {
      n2(function() {
        return e.rh(t4);
      });
    }), this.stream.onMessage(function(t4) {
      n2(function() {
        return e.onMessage(t4);
      });
    });
  }, t2.prototype.Ju = function() {
    var t3 = this;
    this.state = 4, this.Gu.Lu(function() {
      return __awaiter(t3, void 0, void 0, function() {
        return __generator(this, function(t4) {
          return this.state = 0, this.start(), [2];
        });
      });
    });
  }, t2.prototype.rh = function(t3) {
    return N2("PersistentStream", "close with error: " + t3), this.stream = null, this.close(3, t3);
  }, t2.prototype.sh = function(t3) {
    var e = this;
    return function(n2) {
      e.Zr.Ps(function() {
        return e.Wu === t3 ? n2() : (N2("PersistentStream", "stream callback skipped by getCloseGuardedDispatcher."), Promise.resolve());
      });
    };
  }, t2;
}();
var Ho = function(t2) {
  function e(e2, n2, r2, i, o) {
    var u = this;
    return (u = t2.call(this, e2, "listen_stream_connection_backoff", "listen_stream_idle", n2, r2, o) || this).Qt = i, u;
  }
  return __extends(e, t2), e.prototype.oh = function(t3) {
    return this.Qu.Cu("Listen", t3);
  }, e.prototype.onMessage = function(t3) {
    this.Gu.reset();
    var e2 = function(t4, e3) {
      var n3;
      if ("targetChange" in e3) {
        e3.targetChange;
        var r2 = function(t5) {
          return t5 === "NO_CHANGE" ? 0 : t5 === "ADD" ? 1 : t5 === "REMOVE" ? 2 : t5 === "CURRENT" ? 3 : t5 === "RESET" ? 4 : x2();
        }(e3.targetChange.targetChangeType || "NO_CHANGE"), i = e3.targetChange.targetIds || [], o = function(t5, e4) {
          return t5.Bt ? (k2(e4 === void 0 || typeof e4 == "string"), U2.fromBase64String(e4 || "")) : (k2(e4 === void 0 || e4 instanceof Uint8Array), U2.fromUint8Array(e4 || new Uint8Array()));
        }(t4, e3.targetChange.resumeToken), u = (s = e3.targetChange.cause) && function(t5) {
          var e4 = t5.code === void 0 ? M2.UNKNOWN : nn(t5.code);
          return new q2(e4, t5.message || "");
        }(s);
        n3 = new Dn(r2, i, o, u || null);
      } else if ("documentChange" in e3) {
        e3.documentChange, (r2 = e3.documentChange).document, r2.document.name, r2.document.updateTime, i = zn(t4, r2.document.name), o = Mn(r2.document.updateTime);
        var s = new St({
          mapValue: {
            fields: r2.document.fields
          }
        }), a = (u = new Pt(i, o, s, {}), r2.targetIds || []), c = r2.removedTargetIds || [];
        n3 = new Nn(a, c, u.key, u);
      } else if ("documentDelete" in e3)
        e3.documentDelete, (r2 = e3.documentDelete).document, i = zn(t4, r2.document), o = r2.readTime ? Mn(r2.readTime) : X2.min(), s = new Vt(i, o), u = r2.removedTargetIds || [], n3 = new Nn([], u, s.key, s);
      else if ("documentRemove" in e3)
        e3.documentRemove, (r2 = e3.documentRemove).document, i = zn(t4, r2.document), o = r2.removedTargetIds || [], n3 = new Nn([], o, i, null);
      else {
        if (!("filter" in e3))
          return x2();
        e3.filter;
        var h2 = e3.filter;
        h2.targetId, r2 = h2.count || 0, i = new tn(r2), o = h2.targetId, n3 = new An(o, i);
      }
      return n3;
    }(this.Qt, t3), n2 = function(t4) {
      if (!("targetChange" in t4))
        return X2.min();
      var e3 = t4.targetChange;
      return e3.targetIds && e3.targetIds.length ? X2.min() : e3.readTime ? Mn(e3.readTime) : X2.min();
    }(t3);
    return this.listener.ah(e2, n2);
  }, e.prototype.uh = function(t3) {
    var e2 = {};
    e2.database = Qn(this.Qt), e2.addTarget = function(t4, e3) {
      var n3, r2 = e3.target;
      return (n3 = qt(r2) ? {
        documents: Zn(t4, r2)
      } : {
        query: Jn(t4, r2)
      }).targetId = e3.targetId, e3.resumeToken.l() > 0 ? n3.resumeToken = Rn(t4, e3.resumeToken) : e3.Ot._(X2.min()) > 0 && (n3.readTime = Ln(t4, e3.Ot.j())), n3;
    }(this.Qt, t3);
    var n2 = function(t4, e3) {
      var n3 = function(t5, e4) {
        switch (e4) {
          case 0:
            return null;
          case 1:
            return "existence-filter-mismatch";
          case 2:
            return "limbo-document";
          default:
            return x2();
        }
      }(0, e3.Ft);
      return n3 == null ? null : {
        "goog-listen-tags": n3
      };
    }(this.Qt, t3);
    n2 && (e2.labels = n2), this.th(e2);
  }, e.prototype.hh = function(t3) {
    var e2 = {};
    e2.database = Qn(this.Qt), e2.removeTarget = t3, this.th(e2);
  }, e;
}(Yo);
var Ko = function(t2) {
  function e(e2, n2, r2, i, o) {
    var u = this;
    return (u = t2.call(this, e2, "write_stream_connection_backoff", "write_stream_idle", n2, r2, o) || this).Qt = i, u.lh = false, u;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "_h", {
    get: function() {
      return this.lh;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.start = function() {
    this.lh = false, this.lastStreamToken = void 0, t2.prototype.start.call(this);
  }, e.prototype.nh = function() {
    this.lh && this.fh([]);
  }, e.prototype.oh = function(t3) {
    return this.Qu.Cu("Write", t3);
  }, e.prototype.onMessage = function(t3) {
    if (k2(!!t3.streamToken), this.lastStreamToken = t3.streamToken, this.lh) {
      this.Gu.reset();
      var e2 = function(t4, e3) {
        return t4 && t4.length > 0 ? (k2(e3 !== void 0), t4.map(function(t5) {
          return function(t6, e4) {
            var n3 = t6.updateTime ? Mn(t6.updateTime) : Mn(e4);
            n3.isEqual(X2.min()) && (n3 = Mn(e4));
            var r2 = null;
            return t6.transformResults && t6.transformResults.length > 0 && (r2 = t6.transformResults), new Le(n3, r2);
          }(t5, e3);
        })) : [];
      }(t3.writeResults, t3.commitTime), n2 = Mn(t3.commitTime);
      return this.listener.dh(n2, e2);
    }
    return k2(!t3.writeResults || t3.writeResults.length === 0), this.lh = true, this.listener.wh();
  }, e.prototype.Eh = function() {
    var t3 = {};
    t3.database = Qn(this.Qt), this.th(t3);
  }, e.prototype.fh = function(t3) {
    var e2 = this, n2 = {
      streamToken: this.lastStreamToken,
      writes: t3.map(function(t4) {
        return Xn(e2.Qt, t4);
      })
    };
    this.th(n2);
  }, e;
}(Yo);
var Xo = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).credentials = e2, i.Qu = n2, i.Qt = r2, i.Th = false, i;
  }
  return __extends(e, t2), e.prototype.Ih = function() {
    if (this.Th)
      throw new q2(M2.FAILED_PRECONDITION, "The client has already been terminated.");
  }, e.prototype.pu = function(t3, e2, n2) {
    var r2 = this;
    return this.Ih(), this.credentials.getToken().then(function(i) {
      return r2.Qu.pu(t3, e2, n2, i);
    }).catch(function(t4) {
      throw t4.code === M2.UNAUTHENTICATED && r2.credentials.p(), t4;
    });
  }, e.prototype.Du = function(t3, e2, n2) {
    var r2 = this;
    return this.Ih(), this.credentials.getToken().then(function(i) {
      return r2.Qu.Du(t3, e2, n2, i);
    }).catch(function(t4) {
      throw t4.code === M2.UNAUTHENTICATED && r2.credentials.p(), t4;
    });
  }, e.prototype.terminate = function() {
    this.Th = false;
  }, e;
}(function() {
});
var Wo = function() {
  function t2(t3, e) {
    this._s = t3, this.fa = e, this.state = "Unknown", this.mh = 0, this.Ah = null, this.Rh = true;
  }
  return t2.prototype.Ph = function() {
    var t3 = this;
    this.mh === 0 && (this.yh("Unknown"), this.Ah = this._s.Tr("online_state_timeout", 1e4, function() {
      return t3.Ah = null, t3.gh("Backend didn't respond within 10 seconds."), t3.yh("Offline"), Promise.resolve();
    }));
  }, t2.prototype.Vh = function(t3) {
    this.state === "Online" ? this.yh("Unknown") : (this.mh++, this.mh >= 1 && (this.ph(), this.gh("Connection failed 1 times. Most recent error: " + t3.toString()), this.yh("Offline")));
  }, t2.prototype.set = function(t3) {
    this.ph(), this.mh = 0, t3 === "Online" && (this.Rh = false), this.yh(t3);
  }, t2.prototype.yh = function(t3) {
    t3 !== this.state && (this.state = t3, this.fa(t3));
  }, t2.prototype.gh = function(t3) {
    var e = "Could not reach Cloud Firestore backend. " + t3 + "\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";
    this.Rh ? (A2(e), this.Rh = false) : N2("OnlineStateTracker", e);
  }, t2.prototype.ph = function() {
    this.Ah !== null && (this.Ah.cancel(), this.Ah = null);
  }, t2;
}();
var Zo = function(t2, e, n2, r2, i) {
  var o = this;
  this.bh = t2, this.Sh = e, this._s = n2, this.Dh = {}, this.Ch = [], this.xh = new Map(), this.Nh = new Set(), this.$h = [], this.Fh = i, this.Fh.ou(function(t3) {
    n2.Ps(function() {
      return __awaiter(o, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return uu(this) ? (N2("RemoteStore", "Restarting streams for network reachability change."), [4, function(t5) {
                return __awaiter(this, void 0, void 0, function() {
                  var e2;
                  return __generator(this, function(n3) {
                    switch (n3.label) {
                      case 0:
                        return (e2 = O2(t5)).Nh.add(4), [4, $o(e2)];
                      case 1:
                        return n3.sent(), e2.Oh.set("Unknown"), e2.Nh.delete(4), [4, Jo(e2)];
                      case 2:
                        return n3.sent(), [2];
                    }
                  });
                });
              }(this)]) : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }), this.Oh = new Wo(n2, r2);
};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Jo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          if (!uu(t2))
            return [3, 4];
          e = 0, n2 = t2.$h, r2.label = 1;
        case 1:
          return e < n2.length ? [4, (0, n2[e])(true)] : [3, 4];
        case 2:
          r2.sent(), r2.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
function $o(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          e = 0, n2 = t2.$h, r2.label = 1;
        case 1:
          return e < n2.length ? [4, (0, n2[e])(false)] : [3, 4];
        case 2:
          r2.sent(), r2.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
function tu(t2, e) {
  var n2 = O2(t2);
  n2.xh.has(e.targetId) || (n2.xh.set(e.targetId, e), ou(n2) ? iu(n2) : _u(n2).Hu() && nu(n2, e));
}
function eu(t2, e) {
  var n2 = O2(t2), r2 = _u(n2);
  n2.xh.delete(e), r2.Hu() && ru(n2, e), n2.xh.size === 0 && (r2.Hu() ? r2.Xu() : uu(n2) && n2.Oh.set("Unknown"));
}
function nu(t2, e) {
  t2.kh.on(e.targetId), _u(t2).uh(e);
}
function ru(t2, e) {
  t2.kh.on(e), _u(t2).hh(e);
}
function iu(t2) {
  t2.kh = new xn({
    vn: function(e) {
      return t2.Dh.vn(e);
    },
    Sn: function(e) {
      return t2.xh.get(e) || null;
    }
  }), _u(t2).start(), t2.Oh.Ph();
}
function ou(t2) {
  return uu(t2) && !_u(t2).zu() && t2.xh.size > 0;
}
function uu(t2) {
  return O2(t2).Nh.size === 0;
}
function su(t2) {
  t2.kh = void 0;
}
function au(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return t2.xh.forEach(function(e2, n2) {
        nu(t2, e2);
      }), [2];
    });
  });
}
function cu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(n2) {
      return su(t2), ou(t2) ? (t2.Oh.Vh(e), iu(t2)) : t2.Oh.set("Unknown"), [2];
    });
  });
}
function hu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          if (t2.Oh.set("Online"), !(e instanceof Dn && e.state === 2 && e.cause))
            return [3, 6];
          u.label = 1;
        case 1:
          return u.trys.push([1, 3, , 5]), [
            4,
            function(t3, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r3, i2, o2;
                return __generator(this, function(u2) {
                  switch (u2.label) {
                    case 0:
                      n3 = e2.cause, r3 = 0, i2 = e2.targetIds, u2.label = 1;
                    case 1:
                      return r3 < i2.length ? (o2 = i2[r3], t3.xh.has(o2) ? [4, t3.Dh.Mh(o2, n3)] : [3, 3]) : [3, 5];
                    case 2:
                      u2.sent(), t3.xh.delete(o2), t3.kh.removeTarget(o2), u2.label = 3;
                    case 3:
                      u2.label = 4;
                    case 4:
                      return r3++, [3, 1];
                    case 5:
                      return [2];
                  }
                });
              });
            }(t2, e)
          ];
        case 2:
          return u.sent(), [3, 5];
        case 3:
          return r2 = u.sent(), N2("RemoteStore", "Failed to remove targets %s: %s ", e.targetIds.join(","), r2), [4, fu(t2, r2)];
        case 4:
          return u.sent(), [3, 5];
        case 5:
          return [3, 13];
        case 6:
          if (e instanceof Nn ? t2.kh.dn(e) : e instanceof An ? t2.kh.Pn(e) : t2.kh.Tn(e), n2.isEqual(X2.min()))
            return [3, 13];
          u.label = 7;
        case 7:
          return u.trys.push([7, 11, , 13]), [4, io(t2.bh)];
        case 8:
          return i = u.sent(), n2._(i) >= 0 ? [
            4,
            function(t3, e2) {
              var n3 = t3.kh.Vn(e2);
              return n3.$e.forEach(function(n4, r3) {
                if (n4.resumeToken.l() > 0) {
                  var i2 = t3.xh.get(r3);
                  i2 && t3.xh.set(r3, i2.Mt(n4.resumeToken, e2));
                }
              }), n3.Fe.forEach(function(e3) {
                var n4 = t3.xh.get(e3);
                if (n4) {
                  t3.xh.set(e3, n4.Mt(U2.T, n4.Ot)), ru(t3, e3);
                  var r3 = new ge(n4.target, e3, 1, n4.sequenceNumber);
                  nu(t3, r3);
                }
              }), t3.Dh.Lh(n3);
            }(t2, n2)
          ] : [3, 10];
        case 9:
          u.sent(), u.label = 10;
        case 10:
          return [3, 13];
        case 11:
          return N2("RemoteStore", "Failed to raise snapshot:", o = u.sent()), [4, fu(t2, o)];
        case 12:
          return u.sent(), [3, 13];
        case 13:
          return [2];
      }
    });
  });
}
function fu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2 = this;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          if (!mr(e))
            throw e;
          return t2.Nh.add(1), [4, $o(t2)];
        case 1:
          return i.sent(), t2.Oh.set("Offline"), n2 || (n2 = function() {
            return io(t2.bh);
          }), t2._s.po(function() {
            return __awaiter(r2, void 0, void 0, function() {
              return __generator(this, function(e2) {
                switch (e2.label) {
                  case 0:
                    return N2("RemoteStore", "Retrying IndexedDB access"), [4, n2()];
                  case 1:
                    return e2.sent(), t2.Nh.delete(1), [4, Jo(t2)];
                  case 2:
                    return e2.sent(), [2];
                }
              });
            });
          }), [2];
      }
    });
  });
}
function lu(t2, e) {
  return e().catch(function(n2) {
    return fu(t2, n2, e);
  });
}
function pu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2, r2, i, o;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          e = O2(t2), n2 = Iu(e), r2 = e.Ch.length > 0 ? e.Ch[e.Ch.length - 1].batchId : -1, u.label = 1;
        case 1:
          if (!function(t3) {
            return uu(t3) && t3.Ch.length < 10;
          }(e))
            return [3, 7];
          u.label = 2;
        case 2:
          return u.trys.push([2, 4, , 6]), [4, so(e.bh, r2)];
        case 3:
          return (i = u.sent()) === null ? (e.Ch.length === 0 && n2.Xu(), [3, 7]) : (r2 = i.batchId, function(t3, e2) {
            t3.Ch.push(e2);
            var n3 = Iu(t3);
            n3.Hu() && n3._h && n3.fh(e2.mutations);
          }(e, i), [3, 6]);
        case 4:
          return o = u.sent(), [4, fu(e, o)];
        case 5:
          return u.sent(), [3, 6];
        case 6:
          return [3, 1];
        case 7:
          return du(e) && vu(e), [2];
      }
    });
  });
}
function du(t2) {
  return uu(t2) && !Iu(t2).zu() && t2.Ch.length > 0;
}
function vu(t2) {
  Iu(t2).start();
}
function yu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return Iu(t2).Eh(), [2];
    });
  });
}
function mu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2, r2, i;
    return __generator(this, function(o) {
      for (e = Iu(t2), n2 = 0, r2 = t2.Ch; n2 < r2.length; n2++)
        i = r2[n2], e.fh(i.mutations);
      return [2];
    });
  });
}
function gu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return r2 = t2.Ch.shift(), i = Wr.from(r2, e, n2), [4, lu(t2, function() {
            return t2.Dh.Bh(i);
          })];
        case 1:
          return o.sent(), [4, pu(t2)];
        case 2:
          return o.sent(), [2];
      }
    });
  });
}
function wu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(n2) {
      switch (n2.label) {
        case 0:
          return e && Iu(t2)._h ? [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n3, r2;
              return __generator(this, function(i) {
                switch (i.label) {
                  case 0:
                    return en(r2 = e2.code) && r2 !== M2.ABORTED ? (n3 = t3.Ch.shift(), Iu(t3).Yu(), [4, lu(t3, function() {
                      return t3.Dh.qh(n3.batchId, e2);
                    })]) : [3, 3];
                  case 1:
                    return i.sent(), [4, pu(t3)];
                  case 2:
                    i.sent(), i.label = 3;
                  case 3:
                    return [2];
                }
              });
            });
          }(t2, e)] : [3, 2];
        case 1:
          n2.sent(), n2.label = 2;
        case 2:
          return du(t2) && vu(t2), [2];
      }
    });
  });
}
function bu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return n2 = O2(t2), e ? (n2.Nh.delete(2), [4, Jo(n2)]) : [3, 2];
        case 1:
          return i.sent(), [3, 5];
        case 2:
          return (r2 = e) ? [3, 4] : (n2.Nh.add(2), [4, $o(n2)]);
        case 3:
          i.sent(), r2 = n2.Oh.set("Unknown"), i.label = 4;
        case 4:
          r2, i.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
function _u(t2) {
  var e = this;
  return t2.Uh || (t2.Uh = function(t3, e2, n2) {
    var r2 = O2(t3);
    return r2.Ih(), new Ho(e2, r2.Qu, r2.credentials, r2.Qt, n2);
  }(t2.Sh, t2._s, {
    wu: au.bind(null, t2),
    Tu: cu.bind(null, t2),
    ah: hu.bind(null, t2)
  }), t2.$h.push(function(n2) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return n2 ? (t2.Uh.Yu(), ou(t2) ? iu(t2) : t2.Oh.set("Unknown"), [3, 3]) : [3, 1];
          case 1:
            return [4, t2.Uh.stop()];
          case 2:
            e2.sent(), su(t2), e2.label = 3;
          case 3:
            return [2];
        }
      });
    });
  })), t2.Uh;
}
function Iu(t2) {
  var e = this;
  return t2.Qh || (t2.Qh = function(t3, e2, n2) {
    var r2 = O2(t3);
    return r2.Ih(), new Ko(e2, r2.Qu, r2.credentials, r2.Qt, n2);
  }(t2.Sh, t2._s, {
    wu: yu.bind(null, t2),
    Tu: wu.bind(null, t2),
    wh: mu.bind(null, t2),
    dh: gu.bind(null, t2)
  }), t2.$h.push(function(n2) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return n2 ? (t2.Qh.Yu(), [4, pu(t2)]) : [3, 2];
          case 1:
            return e2.sent(), [3, 4];
          case 2:
            return [4, t2.Qh.stop()];
          case 3:
            e2.sent(), t2.Ch.length > 0 && (N2("RemoteStore", "Stopping write stream with " + t2.Ch.length + " pending writes"), t2.Ch = []), e2.label = 4;
          case 4:
            return [2];
        }
      });
    });
  })), t2.Qh;
}
var Eu = function() {
  this.Kh = void 0, this.listeners = [];
};
var Tu = function() {
  this.queries = new gi(function(t2) {
    return pe(t2);
  }, le), this.onlineState = "Unknown", this.Wh = new Set();
};
function Nu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, u, s, a;
    return __generator(this, function(c) {
      switch (c.label) {
        case 0:
          if (n2 = O2(t2), r2 = e.query, i = false, (o = n2.queries.get(r2)) || (i = true, o = new Eu()), !i)
            return [3, 4];
          c.label = 1;
        case 1:
          return c.trys.push([1, 3, , 4]), u = o, [4, n2.jh(r2)];
        case 2:
          return u.Kh = c.sent(), [3, 4];
        case 3:
          return s = c.sent(), a = Er(s, "Initialization of query '" + de(e.query) + "' failed"), [2, void e.onError(a)];
        case 4:
          return n2.queries.set(r2, o), o.listeners.push(e), e.Gh(n2.onlineState), o.Kh && e.zh(o.Kh) && xu(n2), [2];
      }
    });
  });
}
function Au(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, u;
    return __generator(this, function(s) {
      return n2 = O2(t2), r2 = e.query, i = false, (o = n2.queries.get(r2)) && (u = o.listeners.indexOf(e)) >= 0 && (o.listeners.splice(u, 1), i = o.listeners.length === 0), i ? [2, (n2.queries.delete(r2), n2.Hh(r2))] : [2];
    });
  });
}
function Du(t2, e) {
  for (var n2 = O2(t2), r2 = false, i = 0, o = e; i < o.length; i++) {
    var u = o[i], s = u.query, a = n2.queries.get(s);
    if (a) {
      for (var c = 0, h2 = a.listeners; c < h2.length; c++) {
        h2[c].zh(u) && (r2 = true);
      }
      a.Kh = u;
    }
  }
  r2 && xu(n2);
}
function Su(t2, e, n2) {
  var r2 = O2(t2), i = r2.queries.get(e);
  if (i)
    for (var o = 0, u = i.listeners; o < u.length; o++) {
      u[o].onError(n2);
    }
  r2.queries.delete(e);
}
function xu(t2) {
  t2.Wh.forEach(function(t3) {
    t3.next();
  });
}
var ku = function() {
  function t2(t3, e, n2) {
    this.query = t3, this.Jh = e, this.Yh = false, this.Xh = null, this.onlineState = "Unknown", this.options = n2 || {};
  }
  return t2.prototype.zh = function(t3) {
    if (!this.options.includeMetadataChanges) {
      for (var e = [], n2 = 0, r2 = t3.docChanges; n2 < r2.length; n2++) {
        var i = r2[n2];
        i.type !== 3 && e.push(i);
      }
      t3 = new In(t3.query, t3.docs, t3.Se, e, t3.De, t3.fromCache, t3.Ce, true);
    }
    var o = false;
    return this.Yh ? this.Zh(t3) && (this.Jh.next(t3), o = true) : this.tl(t3, this.onlineState) && (this.el(t3), o = true), this.Xh = t3, o;
  }, t2.prototype.onError = function(t3) {
    this.Jh.error(t3);
  }, t2.prototype.Gh = function(t3) {
    this.onlineState = t3;
    var e = false;
    return this.Xh && !this.Yh && this.tl(this.Xh, t3) && (this.el(this.Xh), e = true), e;
  }, t2.prototype.tl = function(t3, e) {
    if (!t3.fromCache)
      return true;
    var n2 = e !== "Offline";
    return !(this.options.nl && n2 || t3.docs.et() && e !== "Offline");
  }, t2.prototype.Zh = function(t3) {
    if (t3.docChanges.length > 0)
      return true;
    var e = this.Xh && this.Xh.hasPendingWrites !== t3.hasPendingWrites;
    return !(!t3.Ce && !e) && this.options.includeMetadataChanges === true;
  }, t2.prototype.el = function(t3) {
    t3 = In.Ne(t3.query, t3.docs, t3.De, t3.fromCache), this.Yh = true, this.Jh.next(t3);
  }, t2;
}();
var Ou = function() {
  function t2(t3, e) {
    this.payload = t3, this.byteLength = e;
  }
  return t2.prototype.sl = function() {
    return "metadata" in this.payload;
  }, t2;
}();
var Pu = function() {
  function t2(t3) {
    this.Qt = t3;
  }
  return t2.prototype.Pc = function(t3) {
    return zn(this.Qt, t3);
  }, t2.prototype.yc = function(t3) {
    return t3.metadata.exists ? Kn(this.Qt, t3.document, false) : new Vt(this.Pc(t3.metadata.name), this.gc(t3.metadata.readTime));
  }, t2.prototype.gc = function(t3) {
    return Mn(t3);
  }, t2;
}();
var Vu = function() {
  function t2(t3, e, n2) {
    this.il = t3, this.bh = e, this.Qt = n2, this.queries = [], this.documents = [], this.progress = Cu(t3);
  }
  return t2.prototype.rl = function(t3) {
    this.progress.bytesLoaded += t3.byteLength;
    var e = this.progress.documentsLoaded;
    return t3.payload.namedQuery ? this.queries.push(t3.payload.namedQuery) : t3.payload.documentMetadata ? (this.documents.push({
      metadata: t3.payload.documentMetadata
    }), t3.payload.documentMetadata.exists || ++e) : t3.payload.document && (this.documents[this.documents.length - 1].document = t3.payload.document, ++e), e !== this.progress.documentsLoaded ? (this.progress.documentsLoaded = e, Object.assign({}, this.progress)) : null;
  }, t2.prototype.ol = function(t3) {
    for (var e = new Map(), n2 = new Pu(this.Qt), r2 = 0, i = t3; r2 < i.length; r2++) {
      var o = i[r2];
      if (o.metadata.queries)
        for (var u = n2.Pc(o.metadata.name), s = 0, a = o.metadata.queries; s < a.length; s++) {
          var c = a[s], h2 = (e.get(c) || mn()).add(u);
          e.set(c, h2);
        }
    }
    return e;
  }, t2.prototype.complete = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return [4, vo(this.bh, new Pu(this.Qt), this.documents, this.il.id)];
          case 1:
            t3 = o.sent(), e = this.ol(this.documents), n2 = 0, r2 = this.queries, o.label = 2;
          case 2:
            return n2 < r2.length ? (i = r2[n2], [4, yo(this.bh, i, e.get(i.name))]) : [3, 5];
          case 3:
            o.sent(), o.label = 4;
          case 4:
            return n2++, [3, 2];
          case 5:
            return [2, (this.progress.taskState = "Success", new Wi(Object.assign({}, this.progress), t3))];
        }
      });
    });
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Cu(t2) {
  return {
    taskState: "Running",
    documentsLoaded: 0,
    bytesLoaded: 0,
    totalDocuments: t2.totalDocuments,
    totalBytes: t2.totalBytes
  };
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Lu = function(t2) {
  this.key = t2;
};
var Ru = function(t2) {
  this.key = t2;
};
var Uu = function() {
  function t2(t3, e) {
    this.query = t3, this.cl = e, this.al = null, this.Be = false, this.ul = mn(), this.De = mn(), this.hl = ye(t3), this.ll = new bn(this.hl);
  }
  return Object.defineProperty(t2.prototype, "_l", {
    get: function() {
      return this.cl;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.fl = function(t3, e) {
    var n2 = this, r2 = e ? e.dl : new _n(), i = e ? e.ll : this.ll, o = e ? e.De : this.De, u = i, s = false, a = ie(this.query) && i.size === this.query.limit ? i.last() : null, c = oe(this.query) && i.size === this.query.limit ? i.first() : null;
    if (t3.Xt(function(t4, e2) {
      var h3 = i.get(t4), f = e2 instanceof Pt ? e2 : null;
      f && (f = ve(n2.query, f) ? f : null);
      var l = !!h3 && n2.De.has(h3.key), p2 = !!f && (f.Vt || n2.De.has(f.key) && f.hasCommittedMutations), d = false;
      h3 && f ? h3.data().isEqual(f.data()) ? l !== p2 && (r2.track({
        type: 3,
        doc: f
      }), d = true) : n2.wl(h3, f) || (r2.track({
        type: 2,
        doc: f
      }), d = true, (a && n2.hl(f, a) > 0 || c && n2.hl(f, c) < 0) && (s = true)) : !h3 && f ? (r2.track({
        type: 0,
        doc: f
      }), d = true) : h3 && !f && (r2.track({
        type: 1,
        doc: h3
      }), d = true, (a || c) && (s = true)), d && (f ? (u = u.add(f), o = p2 ? o.add(t4) : o.delete(t4)) : (u = u.delete(t4), o = o.delete(t4)));
    }), ie(this.query) || oe(this.query))
      for (; u.size > this.query.limit; ) {
        var h2 = ie(this.query) ? u.last() : u.first();
        u = u.delete(h2.key), o = o.delete(h2.key), r2.track({
          type: 1,
          doc: h2
        });
      }
    return {
      ll: u,
      dl: r2,
      lc: s,
      De: o
    };
  }, t2.prototype.wl = function(t3, e) {
    return t3.Vt && e.hasCommittedMutations && !e.Vt;
  }, t2.prototype.wi = function(t3, e, n2) {
    var r2 = this, i = this.ll;
    this.ll = t3.ll, this.De = t3.De;
    var o = t3.dl.ve();
    o.sort(function(t4, e2) {
      return function(t5, e3) {
        var n3 = function(t6) {
          switch (t6) {
            case 0:
              return 1;
            case 2:
            case 3:
              return 2;
            case 1:
              return 0;
            default:
              return x2();
          }
        };
        return n3(t5) - n3(e3);
      }(t4.type, e2.type) || r2.hl(t4.doc, e2.doc);
    }), this.El(n2);
    var u = e ? this.Tl() : [], s = this.ul.size === 0 && this.Be ? 1 : 0, a = s !== this.al;
    return this.al = s, o.length !== 0 || a ? {
      snapshot: new In(this.query, t3.ll, i, o, t3.De, s === 0, a, false),
      Il: u
    } : {
      Il: u
    };
  }, t2.prototype.Gh = function(t3) {
    return this.Be && t3 === "Offline" ? (this.Be = false, this.wi({
      ll: this.ll,
      dl: new _n(),
      De: this.De,
      lc: false
    }, false)) : {
      Il: []
    };
  }, t2.prototype.ml = function(t3) {
    return !this.cl.has(t3) && !!this.ll.has(t3) && !this.ll.get(t3).Vt;
  }, t2.prototype.El = function(t3) {
    var e = this;
    t3 && (t3.qe.forEach(function(t4) {
      return e.cl = e.cl.add(t4);
    }), t3.Ue.forEach(function(t4) {
    }), t3.Qe.forEach(function(t4) {
      return e.cl = e.cl.delete(t4);
    }), this.Be = t3.Be);
  }, t2.prototype.Tl = function() {
    var t3 = this;
    if (!this.Be)
      return [];
    var e = this.ul;
    this.ul = mn(), this.ll.forEach(function(e2) {
      t3.ml(e2.key) && (t3.ul = t3.ul.add(e2.key));
    });
    var n2 = [];
    return e.forEach(function(e2) {
      t3.ul.has(e2) || n2.push(new Ru(e2));
    }), this.ul.forEach(function(t4) {
      e.has(t4) || n2.push(new Lu(t4));
    }), n2;
  }, t2.prototype.Al = function(t3) {
    this.cl = t3.Rc, this.ul = mn();
    var e = this.fl(t3.documents);
    return this.wi(e, true);
  }, t2.prototype.Rl = function() {
    return In.Ne(this.query, this.ll, this.De, this.al === 0);
  }, t2;
}();
var Mu = function(t2, e, n2) {
  this.query = t2, this.targetId = e, this.view = n2;
};
var qu = function(t2) {
  this.key = t2, this.Pl = false;
};
var Fu = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.bh = t3, this.yl = e, this.gl = n2, this.Vl = r2, this.currentUser = i, this.pl = o, this.bl = {}, this.vl = new gi(function(t4) {
      return pe(t4);
    }, le), this.Sl = new Map(), this.Dl = new Set(), this.Cl = new rn(tt.H), this.xl = new Map(), this.Nl = new go(), this.$l = {}, this.Fl = new Map(), this.Ol = Di.Li(), this.onlineState = "Unknown", this.kl = void 0;
  }
  return Object.defineProperty(t2.prototype, "Ml", {
    get: function() {
      return this.kl === true;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
function ju(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, u, s;
    return __generator(this, function(a) {
      switch (a.label) {
        case 0:
          return n2 = ys(t2), (o = n2.vl.get(e)) ? (r2 = o.targetId, n2.Vl.Fa(r2), i = o.view.Rl(), [3, 4]) : [3, 1];
        case 1:
          return [4, ao(n2.bh, he(e))];
        case 2:
          return u = a.sent(), s = n2.Vl.Fa(u.targetId), r2 = u.targetId, [4, zu(n2, e, r2, s === "current")];
        case 3:
          i = a.sent(), n2.Ml && tu(n2.yl, u), a.label = 4;
        case 4:
          return [2, i];
      }
    });
  });
}
function zu(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, u, s, a, c;
    return __generator(this, function(h2) {
      switch (h2.label) {
        case 0:
          return t2.Ll = function(e2, n3, r3) {
            return function(t3, e3, n4, r4) {
              return __awaiter(this, void 0, void 0, function() {
                var i2, o2, u2;
                return __generator(this, function(s2) {
                  switch (s2.label) {
                    case 0:
                      return i2 = e3.view.fl(n4), i2.lc ? [4, ho(t3.bh, e3.query, false).then(function(t4) {
                        var n5 = t4.documents;
                        return e3.view.fl(n5, i2);
                      })] : [3, 2];
                    case 1:
                      i2 = s2.sent(), s2.label = 2;
                    case 2:
                      return o2 = r4 && r4.$e.get(e3.targetId), u2 = e3.view.wi(i2, t3.Ml, o2), [2, (es(t3, e3.targetId, u2.Il), u2.snapshot)];
                  }
                });
              });
            }(t2, e2, n3, r3);
          }, [4, ho(t2.bh, e, true)];
        case 1:
          return i = h2.sent(), o = new Uu(e, i.Rc), u = o.fl(i.documents), s = Tn.Le(n2, r2 && t2.onlineState !== "Offline"), a = o.wi(u, t2.Ml, s), es(t2, n2, a.Il), c = new Mu(e, n2, o), [2, (t2.vl.set(e, c), t2.Sl.has(n2) ? t2.Sl.get(n2).push(e) : t2.Sl.set(n2, [e]), a.snapshot)];
      }
    });
  });
}
function Gu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return n2 = O2(t2), r2 = n2.vl.get(e), (i = n2.Sl.get(r2.targetId)).length > 1 ? [2, (n2.Sl.set(r2.targetId, i.filter(function(t3) {
            return !le(t3, e);
          })), void n2.vl.delete(e))] : n2.Ml ? (n2.Vl.ka(r2.targetId), n2.Vl.Da(r2.targetId) ? [3, 2] : [4, co(n2.bh, r2.targetId, false).then(function() {
            n2.Vl.La(r2.targetId), eu(n2.yl, r2.targetId), $u(n2, r2.targetId);
          }).catch(mi)]) : [3, 3];
        case 1:
          o.sent(), o.label = 2;
        case 2:
          return [3, 5];
        case 3:
          return $u(n2, r2.targetId), [4, co(n2.bh, r2.targetId, true)];
        case 4:
          o.sent(), o.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
function Bu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, u;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          r2 = ms(t2), s.label = 1;
        case 1:
          return s.trys.push([1, 5, , 6]), [4, function(t3, e2) {
            var n3, r3 = O2(t3), i2 = K2.now(), o2 = e2.reduce(function(t4, e3) {
              return t4.add(e3.key);
            }, mn());
            return r3.persistence.runTransaction("Locally write mutations", "readwrite", function(t4) {
              return r3.Tc.Xo(t4, o2).next(function(o3) {
                n3 = o3;
                for (var u2 = [], s2 = 0, a = e2; s2 < a.length; s2++) {
                  var c = a[s2], h2 = je(c, n3.get(c.key));
                  h2 != null && u2.push(new Qe(c.key, h2, kt(h2.proto.mapValue), Re.exists(true)));
                }
                return r3.zo.Ri(t4, i2, u2, e2);
              });
            }).then(function(t4) {
              var e3 = t4.xs(n3);
              return {
                batchId: t4.batchId,
                ri: e3
              };
            });
          }(r2.bh, e)];
        case 2:
          return i = s.sent(), r2.Vl.Ca(i.batchId), function(t3, e2, n3) {
            var r3 = t3.$l[t3.currentUser.A()];
            r3 || (r3 = new rn(C)), r3 = r3.zt(e2, n3), t3.$l[t3.currentUser.A()] = r3;
          }(r2, i.batchId, n2), [4, is(r2, i.ri)];
        case 3:
          return s.sent(), [4, pu(r2.yl)];
        case 4:
          return s.sent(), [3, 6];
        case 5:
          return o = s.sent(), u = Er(o, "Failed to persist write"), n2.reject(u), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Qu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          n2 = O2(t2), i.label = 1;
        case 1:
          return i.trys.push([1, 4, , 6]), [4, oo(n2.bh, e)];
        case 2:
          return r2 = i.sent(), e.$e.forEach(function(t3, e2) {
            var r3 = n2.xl.get(e2);
            r3 && (k2(t3.qe.size + t3.Ue.size + t3.Qe.size <= 1), t3.qe.size > 0 ? r3.Pl = true : t3.Ue.size > 0 ? k2(r3.Pl) : t3.Qe.size > 0 && (k2(r3.Pl), r3.Pl = false));
          }), [4, is(n2, r2, e)];
        case 3:
          return i.sent(), [3, 6];
        case 4:
          return [4, mi(i.sent())];
        case 5:
          return i.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Yu(t2, e, n2) {
  var r2 = O2(t2);
  if (r2.Ml && n2 === 0 || !r2.Ml && n2 === 1) {
    var i = [];
    r2.vl.forEach(function(t3, n3) {
      var r3 = n3.view.Gh(e);
      r3.snapshot && i.push(r3.snapshot);
    }), function(t3, e2) {
      var n3 = O2(t3);
      n3.onlineState = e2;
      var r3 = false;
      n3.queries.forEach(function(t4, n4) {
        for (var i2 = 0, o = n4.listeners; i2 < o.length; i2++) {
          o[i2].Gh(e2) && (r3 = true);
        }
      }), r3 && xu(n3);
    }(r2.gl, e), i.length && r2.bl.ah(i), r2.onlineState = e, r2.Ml && r2.Vl.Qa(e);
  }
}
function Hu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, u, s, a;
    return __generator(this, function(c) {
      switch (c.label) {
        case 0:
          return (r2 = O2(t2)).Vl.Ba(e, "rejected", n2), i = r2.xl.get(e), (o = i && i.key) ? (u = (u = new rn(tt.H)).zt(o, new Vt(o, X2.min())), s = mn().add(o), a = new En(X2.min(), new Map(), new sn(C), u, s), [4, Qu(r2, a)]) : [3, 2];
        case 1:
          return c.sent(), r2.Cl = r2.Cl.remove(o), r2.xl.delete(e), rs(r2), [3, 4];
        case 2:
          return [4, co(r2.bh, e, false).then(function() {
            return $u(r2, e, n2);
          }).catch(mi)];
        case 3:
          c.sent(), c.label = 4;
        case 4:
          return [2];
      }
    });
  });
}
function Ku(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          n2 = O2(t2), r2 = e.batch.batchId, o.label = 1;
        case 1:
          return o.trys.push([1, 4, , 6]), [4, ro(n2.bh, e)];
        case 2:
          return i = o.sent(), Ju(n2, r2, null), Zu(n2, r2), n2.Vl.Na(r2, "acknowledged"), [4, is(n2, i)];
        case 3:
          return o.sent(), [3, 6];
        case 4:
          return [4, mi(o.sent())];
        case 5:
          return o.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Xu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          r2 = O2(t2), o.label = 1;
        case 1:
          return o.trys.push([1, 4, , 6]), [4, function(t3, e2) {
            var n3 = O2(t3);
            return n3.persistence.runTransaction("Reject batch", "readwrite-primary", function(t4) {
              var r3;
              return n3.zo.Pi(t4, e2).next(function(e3) {
                return k2(e3 !== null), r3 = e3.keys(), n3.zo.Ci(t4, e3);
              }).next(function() {
                return n3.zo.$i(t4);
              }).next(function() {
                return n3.Tc.Xo(t4, r3);
              });
            });
          }(r2.bh, e)];
        case 2:
          return i = o.sent(), Ju(r2, e, n2), Zu(r2, e), r2.Vl.Na(e, "rejected", n2), [4, is(r2, i)];
        case 3:
          return o.sent(), [3, 6];
        case 4:
          return [4, mi(o.sent())];
        case 5:
          return o.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Wu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, u;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          uu((n2 = O2(t2)).yl) || N2("SyncEngine", "The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."), s.label = 1;
        case 1:
          return s.trys.push([1, 3, , 4]), [4, function(t3) {
            var e2 = O2(t3);
            return e2.persistence.runTransaction("Get highest unacknowledged batch id", "readonly", function(t4) {
              return e2.zo.Vi(t4);
            });
          }(n2.bh)];
        case 2:
          return (r2 = s.sent()) === -1 ? [2, void e.resolve()] : ((i = n2.Fl.get(r2) || []).push(e), n2.Fl.set(r2, i), [3, 4]);
        case 3:
          return o = s.sent(), u = Er(o, "Initialization of waitForPendingWrites() operation failed"), e.reject(u), [3, 4];
        case 4:
          return [2];
      }
    });
  });
}
function Zu(t2, e) {
  (t2.Fl.get(e) || []).forEach(function(t3) {
    t3.resolve();
  }), t2.Fl.delete(e);
}
function Ju(t2, e, n2) {
  var r2 = O2(t2), i = r2.$l[r2.currentUser.A()];
  if (i) {
    var o = i.get(e);
    o && (n2 ? o.reject(n2) : o.resolve(), i = i.remove(e)), r2.$l[r2.currentUser.A()] = i;
  }
}
function $u(t2, e, n2) {
  n2 === void 0 && (n2 = null), t2.Vl.ka(e);
  for (var r2 = 0, i = t2.Sl.get(e); r2 < i.length; r2++) {
    var o = i[r2];
    t2.vl.delete(o), n2 && t2.bl.Bl(o, n2);
  }
  t2.Sl.delete(e), t2.Ml && t2.Nl.Fc(e).forEach(function(e2) {
    t2.Nl.Fi(e2) || ts(t2, e2);
  });
}
function ts(t2, e) {
  t2.Dl.delete(e.path.rt());
  var n2 = t2.Cl.get(e);
  n2 !== null && (eu(t2.yl, n2), t2.Cl = t2.Cl.remove(e), t2.xl.delete(n2), rs(t2));
}
function es(t2, e, n2) {
  for (var r2 = 0, i = n2; r2 < i.length; r2++) {
    var o = i[r2];
    o instanceof Lu ? (t2.Nl.nr(o.key, e), ns(t2, o)) : o instanceof Ru ? (N2("SyncEngine", "Document no longer in limbo: " + o.key), t2.Nl.ir(o.key, e), t2.Nl.Fi(o.key) || ts(t2, o.key)) : x2();
  }
}
function ns(t2, e) {
  var n2 = e.key, r2 = n2.path.rt();
  t2.Cl.get(n2) || t2.Dl.has(r2) || (N2("SyncEngine", "New document in limbo: " + n2), t2.Dl.add(r2), rs(t2));
}
function rs(t2) {
  for (; t2.Dl.size > 0 && t2.Cl.size < t2.pl; ) {
    var e = t2.Dl.values().next().value;
    t2.Dl.delete(e);
    var n2 = new tt(Z2.ot(e)), r2 = t2.Ol.next();
    t2.xl.set(r2, new qu(n2)), t2.Cl = t2.Cl.zt(n2, r2), tu(t2.yl, new ge(he(re(n2.path)), r2, 2, H2.q));
  }
}
function is(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, u;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          return r2 = O2(t2), i = [], o = [], u = [], r2.vl.et() ? [3, 3] : (r2.vl.forEach(function(t3, s2) {
            u.push(r2.Ll(s2, e, n2).then(function(t4) {
              if (t4) {
                r2.Ml && r2.Vl.Ba(s2.targetId, t4.fromCache ? "not-current" : "current"), i.push(t4);
                var e2 = Ji.oc(s2.targetId, t4);
                o.push(e2);
              }
            }));
          }), [4, Promise.all(u)]);
        case 1:
          return s.sent(), r2.bl.ah(i), [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n3, r3, i2, o2, u2, s2, a, c, h2;
              return __generator(this, function(f) {
                switch (f.label) {
                  case 0:
                    n3 = O2(t3), f.label = 1;
                  case 1:
                    return f.trys.push([1, 3, , 4]), [4, n3.persistence.runTransaction("notifyLocalViewChanges", "readwrite", function(t4) {
                      return lr.forEach(e2, function(e3) {
                        return lr.forEach(e3.ic, function(r4) {
                          return n3.persistence.Ti.nr(t4, e3.targetId, r4);
                        }).next(function() {
                          return lr.forEach(e3.rc, function(r4) {
                            return n3.persistence.Ti.ir(t4, e3.targetId, r4);
                          });
                        });
                      });
                    })];
                  case 2:
                    return f.sent(), [3, 4];
                  case 3:
                    if (!mr(r3 = f.sent()))
                      throw r3;
                    return N2("LocalStore", "Failed to update sequence numbers: " + r3), [3, 4];
                  case 4:
                    for (i2 = 0, o2 = e2; i2 < o2.length; i2++)
                      u2 = o2[i2], s2 = u2.targetId, u2.fromCache || (a = n3.fc.get(s2), c = a.Ot, h2 = a.Lt(c), n3.fc = n3.fc.zt(s2, h2));
                    return [2];
                }
              });
            });
          }(r2.bh, o)];
        case 2:
          s.sent(), s.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
function os(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return (n2 = O2(t2)).currentUser.isEqual(e) ? [3, 3] : (N2("SyncEngine", "User change. New user:", e.A()), [4, no(n2.bh, e)]);
        case 1:
          return r2 = i.sent(), n2.currentUser = e, function(t3, e2) {
            t3.Fl.forEach(function(t4) {
              t4.forEach(function(t5) {
                t5.reject(new q2(M2.CANCELLED, "'waitForPendingWrites' promise is rejected due to a user change."));
              });
            }), t3.Fl.clear();
          }(n2), n2.Vl.Ua(e, r2.mc, r2.Ac), [4, is(n2, r2.Ic)];
        case 2:
          i.sent(), i.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
function us(t2, e) {
  var n2 = O2(t2), r2 = n2.xl.get(e);
  if (r2 && r2.Pl)
    return mn().add(r2.key);
  var i = mn(), o = n2.Sl.get(e);
  if (!o)
    return i;
  for (var u = 0, s = o; u < s.length; u++) {
    var a = s[u], c = n2.vl.get(a);
    i = i.Pe(c.view._l);
  }
  return i;
}
function ss(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return [4, ho((n2 = O2(t2)).bh, e.query, true)];
        case 1:
          return r2 = o.sent(), i = e.view.Al(r2), [2, (n2.Ml && es(n2, e.targetId, i.Il), i)];
      }
    });
  });
}
function as(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n2) {
      return [2, lo((e = O2(t2)).bh).then(function(t3) {
        return is(e, t3);
      })];
    });
  });
}
function cs(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          return [4, function(t3, e2) {
            var n3 = O2(t3), r3 = O2(n3.zo);
            return n3.persistence.runTransaction("Lookup mutation documents", "readonly", function(t4) {
              return r3.yi(t4, e2).next(function(e3) {
                return e3 ? n3.Tc.Xo(t4, e3) : lr.resolve(null);
              });
            });
          }((i = O2(t2)).bh, e)];
        case 1:
          return (o = u.sent()) === null ? [3, 6] : n2 !== "pending" ? [3, 3] : [4, pu(i.yl)];
        case 2:
          return u.sent(), [3, 4];
        case 3:
          n2 === "acknowledged" || n2 === "rejected" ? (Ju(i, e, r2 || null), Zu(i, e), function(t3, e2) {
            O2(O2(t3).zo).xi(e2);
          }(i.bh, e)) : x2(), u.label = 4;
        case 4:
          return [4, is(i, o)];
        case 5:
          return u.sent(), [3, 7];
        case 6:
          N2("SyncEngine", "Cannot apply mutation batch with id: " + e), u.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
function hs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, u, s, a, c;
    return __generator(this, function(h2) {
      switch (h2.label) {
        case 0:
          return ys(n2 = O2(t2)), ms(n2), e !== true || n2.kl === true ? [3, 3] : (r2 = n2.Vl.va(), [4, fs(n2, r2.it())]);
        case 1:
          return i = h2.sent(), n2.kl = true, [4, bu(n2.yl, true)];
        case 2:
          for (h2.sent(), o = 0, u = i; o < u.length; o++)
            s = u[o], tu(n2.yl, s);
          return [3, 7];
        case 3:
          return e !== false || n2.kl === false ? [3, 7] : (a = [], c = Promise.resolve(), n2.Sl.forEach(function(t3, e2) {
            n2.Vl.Ma(e2) ? a.push(e2) : c = c.then(function() {
              return $u(n2, e2), co(n2.bh, e2, true);
            }), eu(n2.yl, e2);
          }), [4, c]);
        case 4:
          return h2.sent(), [4, fs(n2, a)];
        case 5:
          return h2.sent(), function(t3) {
            var e2 = O2(t3);
            e2.xl.forEach(function(t4, n3) {
              eu(e2.yl, n3);
            }), e2.Nl.Oc(), e2.xl = new Map(), e2.Cl = new rn(tt.H);
          }(n2), n2.kl = false, [4, bu(n2.yl, false)];
        case 6:
          h2.sent(), h2.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
function fs(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var n3, r2, i, o, u, s, a, c, h2, f, l, p2, d, v2;
    return __generator(this, function(y2) {
      switch (y2.label) {
        case 0:
          n3 = O2(t2), r2 = [], i = [], o = 0, u = e, y2.label = 1;
        case 1:
          return o < u.length ? (s = u[o], a = void 0, (c = n3.Sl.get(s)) && c.length !== 0 ? [4, ao(n3.bh, he(c[0]))] : [3, 7]) : [3, 13];
        case 2:
          a = y2.sent(), h2 = 0, f = c, y2.label = 3;
        case 3:
          return h2 < f.length ? (l = f[h2], p2 = n3.vl.get(l), [4, ss(n3, p2)]) : [3, 6];
        case 4:
          (d = y2.sent()).snapshot && i.push(d.snapshot), y2.label = 5;
        case 5:
          return h2++, [3, 3];
        case 6:
          return [3, 11];
        case 7:
          return [4, fo(n3.bh, s)];
        case 8:
          return v2 = y2.sent(), [4, ao(n3.bh, v2)];
        case 9:
          return a = y2.sent(), [4, zu(n3, ls(v2), s, false)];
        case 10:
          y2.sent(), y2.label = 11;
        case 11:
          r2.push(a), y2.label = 12;
        case 12:
          return o++, [3, 1];
        case 13:
          return [2, (n3.bl.ah(i), r2)];
      }
    });
  });
}
function ls(t2) {
  return ne(t2.path, t2.collectionGroup, t2.orderBy, t2.filters, t2.limit, "F", t2.startAt, t2.endAt);
}
function ps(t2) {
  var e = O2(t2);
  return O2(O2(e.bh).persistence).Uo();
}
function ds(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, u;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          return (i = O2(t2)).kl ? (N2("SyncEngine", "Ignoring unexpected query state notification."), [3, 8]) : [3, 1];
        case 1:
          if (!i.Sl.has(e))
            return [3, 8];
          switch (n2) {
            case "current":
            case "not-current":
              return [3, 2];
            case "rejected":
              return [3, 5];
          }
          return [3, 7];
        case 2:
          return [4, lo(i.bh)];
        case 3:
          return o = s.sent(), u = En.Me(e, n2 === "current"), [4, is(i, o, u)];
        case 4:
          return s.sent(), [3, 8];
        case 5:
          return [4, co(i.bh, e, true)];
        case 6:
          return s.sent(), $u(i, e, r2), [3, 8];
        case 7:
          x2(), s.label = 8;
        case 8:
          return [2];
      }
    });
  });
}
function vs(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, u, s, a, c, h2, f, l;
    return __generator(this, function(p2) {
      switch (p2.label) {
        case 0:
          if (!(r2 = ys(t2)).kl)
            return [3, 10];
          i = 0, o = e, p2.label = 1;
        case 1:
          return i < o.length ? (u = o[i], r2.Sl.has(u) ? (N2("SyncEngine", "Adding an already active target " + u), [3, 5]) : [4, fo(r2.bh, u)]) : [3, 6];
        case 2:
          return s = p2.sent(), [4, ao(r2.bh, s)];
        case 3:
          return a = p2.sent(), [4, zu(r2, ls(s), a.targetId, false)];
        case 4:
          p2.sent(), tu(r2.yl, a), p2.label = 5;
        case 5:
          return i++, [3, 1];
        case 6:
          c = function(t3) {
            return __generator(this, function(e2) {
              switch (e2.label) {
                case 0:
                  return r2.Sl.has(t3) ? [4, co(r2.bh, t3, false).then(function() {
                    eu(r2.yl, t3), $u(r2, t3);
                  }).catch(mi)] : [3, 2];
                case 1:
                  e2.sent(), e2.label = 2;
                case 2:
                  return [2];
              }
            });
          }, h2 = 0, f = n2, p2.label = 7;
        case 7:
          return h2 < f.length ? (l = f[h2], [5, c(l)]) : [3, 10];
        case 8:
          p2.sent(), p2.label = 9;
        case 9:
          return h2++, [3, 7];
        case 10:
          return [2];
      }
    });
  });
}
function ys(t2) {
  var e = O2(t2);
  return e.yl.Dh.Lh = Qu.bind(null, e), e.yl.Dh.vn = us.bind(null, e), e.yl.Dh.Mh = Hu.bind(null, e), e.bl.ah = Du.bind(null, e.gl), e.bl.Bl = Su.bind(null, e.gl), e;
}
function ms(t2) {
  var e = O2(t2);
  return e.yl.Dh.Bh = Ku.bind(null, e), e.yl.Dh.qh = Xu.bind(null, e), e;
}
var ws = function() {
  function t2() {
    this.synchronizeTabs = false;
  }
  return t2.prototype.initialize = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.Qt = Bo(t3.yu.t), this.Vl = this.Wl(t3), this.persistence = this.jl(t3), [4, this.persistence.start()];
          case 1:
            return e.sent(), this.Gl = this.zl(t3), this.bh = this.Hl(t3), [2];
        }
      });
    });
  }, t2.prototype.zl = function(t3) {
    return null;
  }, t2.prototype.Hl = function(t3) {
    return eo(this.persistence, new $i(), t3.Jl, this.Qt);
  }, t2.prototype.jl = function(t3) {
    return new To(Ao.ia, this.Qt);
  }, t2.prototype.Wl = function(t3) {
    return new Ro();
  }, t2.prototype.terminate = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.Gl && this.Gl.stop(), [4, this.Vl.ko()];
          case 1:
            return t3.sent(), [4, this.persistence.ko()];
          case 2:
            return t3.sent(), [2];
        }
      });
    });
  }, t2;
}();
var bs = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).Yl = e2, i.cacheSizeBytes = n2, i.forceOwnership = r2, i.synchronizeTabs = false, i;
  }
  return __extends(e, t2), e.prototype.initialize = function(e2) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, t2.prototype.initialize.call(this, e2)];
          case 1:
            return n2.sent(), [4, po(this.bh)];
          case 2:
            return n2.sent(), [4, this.Yl.initialize(this, e2)];
          case 3:
            return n2.sent(), [4, ms(this.Yl._a)];
          case 4:
            return n2.sent(), [4, pu(this.Yl.yl)];
          case 5:
            return n2.sent(), [2];
        }
      });
    });
  }, e.prototype.Hl = function(t3) {
    return eo(this.persistence, new $i(), t3.Jl, this.Qt);
  }, e.prototype.zl = function(t3) {
    var e2 = this.persistence.Ti.lr;
    return new Ci(e2, t3._s);
  }, e.prototype.jl = function(t3) {
    var e2 = Xi(t3.yu.t, t3.yu.persistenceKey), n2 = this.cacheSizeBytes !== void 0 ? yi.Ys(this.cacheSizeBytes) : yi.ti;
    return new Yi(this.synchronizeTabs, e2, t3.clientId, n2, t3._s, zo(), Go(), this.Qt, this.Vl, !!this.forceOwnership);
  }, e.prototype.Wl = function(t3) {
    return new Ro();
  }, e;
}(ws);
var _s = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2, false) || this).Yl = e2, r2.cacheSizeBytes = n2, r2.synchronizeTabs = true, r2;
  }
  return __extends(e, t2), e.prototype.initialize = function(e2) {
    return __awaiter(this, void 0, void 0, function() {
      var n2, r2 = this;
      return __generator(this, function(i) {
        switch (i.label) {
          case 0:
            return [4, t2.prototype.initialize.call(this, e2)];
          case 1:
            return i.sent(), n2 = this.Yl._a, this.Vl instanceof Lo ? (this.Vl._a = {
              eu: cs.bind(null, n2),
              nu: ds.bind(null, n2),
              su: vs.bind(null, n2),
              Uo: ps.bind(null, n2),
              tu: as.bind(null, n2)
            }, [4, this.Vl.start()]) : [3, 3];
          case 2:
            i.sent(), i.label = 3;
          case 3:
            return [4, this.persistence.Ro(function(t3) {
              return __awaiter(r2, void 0, void 0, function() {
                return __generator(this, function(e3) {
                  switch (e3.label) {
                    case 0:
                      return [4, hs(this.Yl._a, t3)];
                    case 1:
                      return e3.sent(), this.Gl && (t3 && !this.Gl.Er ? this.Gl.start(this.bh) : t3 || this.Gl.stop()), [2];
                  }
                });
              });
            })];
          case 4:
            return i.sent(), [2];
        }
      });
    });
  }, e.prototype.Wl = function(t3) {
    var e2 = zo();
    if (!Lo.Kn(e2))
      throw new q2(M2.UNIMPLEMENTED, "IndexedDB persistence is only available on platforms that support LocalStorage.");
    var n2 = Xi(t3.yu.t, t3.yu.persistenceKey);
    return new Lo(e2, t3._s, n2, t3.clientId, t3.Jl);
  }, e;
}(bs);
var Is = function() {
  function t2() {
  }
  return t2.prototype.initialize = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      var n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.bh ? [3, 2] : (this.bh = t3.bh, this.Vl = t3.Vl, this.Sh = this.Xl(e), this.yl = this.Zl(e), this.gl = this.t_(e), this._a = this.e_(e, !t3.synchronizeTabs), this.Vl.fa = function(t4) {
              return Yu(n2._a, t4, 1);
            }, this.yl.Dh.n_ = os.bind(null, this._a), [4, bu(this.yl, this._a.Ml)]);
          case 1:
            r2.sent(), r2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.t_ = function(t3) {
    return new Tu();
  }, t2.prototype.Xl = function(t3) {
    var e, n2 = Bo(t3.yu.t), r2 = (e = t3.yu, new jo(e));
    return function(t4, e2, n3) {
      return new Xo(t4, e2, n3);
    }(t3.credentials, r2, n2);
  }, t2.prototype.Zl = function(t3) {
    var e, n2, r2, i, o, u = this;
    return e = this.bh, n2 = this.Sh, r2 = t3._s, i = function(t4) {
      return Yu(u._a, t4, 0);
    }, o = Mo.Kn() ? new Mo() : new Uo(), new Zo(e, n2, r2, i, o);
  }, t2.prototype.e_ = function(t3, e) {
    return function(t4, e2, n2, r2, i, o, u) {
      var s = new Fu(t4, e2, n2, r2, i, o);
      return u && (s.kl = true), s;
    }(this.bh, this.yl, this.gl, this.Vl, t3.Jl, t3.pl, e);
  }, t2.prototype.terminate = function() {
    return function(t3) {
      return __awaiter(this, void 0, void 0, function() {
        var e;
        return __generator(this, function(n2) {
          switch (n2.label) {
            case 0:
              return e = O2(t3), N2("RemoteStore", "RemoteStore shutting down."), e.Nh.add(5), [4, $o(e)];
            case 1:
              return n2.sent(), e.Fh.ko(), e.Oh.set("Unknown"), [2];
          }
        });
      });
    }(this.yl);
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ts = function() {
  function t2(t3) {
    this.observer = t3, this.muted = false;
  }
  return t2.prototype.next = function(t3) {
    this.observer.next && this.s_(this.observer.next, t3);
  }, t2.prototype.error = function(t3) {
    this.observer.error ? this.s_(this.observer.error, t3) : console.error("Uncaught Error in snapshot listener:", t3);
  }, t2.prototype.i_ = function() {
    this.muted = true;
  }, t2.prototype.s_ = function(t3, e) {
    var n2 = this;
    this.muted || setTimeout(function() {
      n2.muted || t3(e);
    }, 0);
  }, t2;
}();
var Ns = function() {
  function t2(t3, e) {
    var n2 = this;
    this.r_ = t3, this.Qt = e, this.metadata = new fr(), this.buffer = new Uint8Array(), this.o_ = new TextDecoder("utf-8"), this.c_().then(function(t4) {
      t4 && t4.sl() ? n2.metadata.resolve(t4.payload.metadata) : n2.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             " + JSON.stringify(t4 == null ? void 0 : t4.payload)));
    }, function(t4) {
      return n2.metadata.reject(t4);
    });
  }
  return t2.prototype.close = function() {
    return this.r_.cancel();
  }, t2.prototype.getMetadata = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return [2, this.metadata.promise];
      });
    });
  }, t2.prototype.Ql = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, this.getMetadata()];
          case 1:
            return [2, (t3.sent(), this.c_())];
        }
      });
    });
  }, t2.prototype.c_ = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2;
      return __generator(this, function(i) {
        switch (i.label) {
          case 0:
            return [4, this.a_()];
          case 1:
            return (t3 = i.sent()) === null ? [2, null] : (e = this.o_.decode(t3), n2 = Number(e), isNaN(n2) && this.u_("length string (" + e + ") is not valid number"), [4, this.h_(n2)]);
          case 2:
            return r2 = i.sent(), [2, new Ou(JSON.parse(r2), t3.length + n2)];
        }
      });
    });
  }, t2.prototype.l_ = function() {
    return this.buffer.findIndex(function(t3) {
      return t3 === "{".charCodeAt(0);
    });
  }, t2.prototype.a_ = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.l_() < 0 ? [4, this.__()] : [3, 3];
          case 1:
            if (n2.sent())
              return [3, 3];
            n2.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return this.buffer.length === 0 ? [2, null] : ((t3 = this.l_()) < 0 && this.u_("Reached the end of bundle when a length string is expected."), e = this.buffer.slice(0, t3), [2, (this.buffer = this.buffer.slice(t3), e)]);
        }
      });
    });
  }, t2.prototype.h_ = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.buffer.length < t3 ? [4, this.__()] : [3, 3];
          case 1:
            n2.sent() && this.u_("Reached the end of bundle when more is expected."), n2.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return e = this.o_.decode(this.buffer.slice(0, t3)), [2, (this.buffer = this.buffer.slice(t3), e)];
        }
      });
    });
  }, t2.prototype.u_ = function(t3) {
    throw this.r_.cancel(), new Error("Invalid bundle format: " + t3);
  }, t2.prototype.__ = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.r_.read()];
          case 1:
            return (t3 = n2.sent()).done || ((e = new Uint8Array(this.buffer.length + t3.value.length)).set(this.buffer), e.set(t3.value, this.buffer.length), this.buffer = e), [2, t3.done];
        }
      });
    });
  }, t2;
}();
var As = function() {
  function t2() {
    for (var t3 = [], e = 0; e < arguments.length; e++)
      t3[e] = arguments[e];
    for (var n2 = 0; n2 < t3.length; ++n2)
      if (t3[n2].length === 0)
        throw new q2(M2.INVALID_ARGUMENT, "Invalid field name at argument $(i + 1). Field names must not be empty.");
    this.f_ = new $(t3);
  }
  return t2.prototype.isEqual = function(t3) {
    return this.f_.isEqual(t3.f_);
  }, t2;
}();
var Ds = function(t2) {
  this._methodName = t2;
};
var Ss = function(t2) {
  this.d_ = t2;
};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function xs(t2, e, n2) {
  if (!n2)
    throw new q2(M2.INVALID_ARGUMENT, "Function " + t2 + "() cannot be called with an empty " + e + ".");
}
function ks(t2, e) {
  if (e === void 0)
    return {
      merge: false
    };
  if (e.mergeFields !== void 0 && e.merge !== void 0)
    throw new q2(M2.INVALID_ARGUMENT, "Invalid options passed to function " + t2 + '(): You cannot specify both "merge" and "mergeFields".');
  return e;
}
function Os(t2, e, n2, r2) {
  if (e === true && r2 === true)
    throw new q2(M2.INVALID_ARGUMENT, t2 + " and " + n2 + " cannot be used together.");
}
function Ps(t2) {
  if (!tt.wt(t2))
    throw new q2(M2.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + t2 + " has " + t2.length + ".");
}
function Vs(t2) {
  if (tt.wt(t2))
    throw new q2(M2.INVALID_ARGUMENT, "Invalid collection reference. Collection references must have an odd number of segments, but " + t2 + " has " + t2.length + ".");
}
function Cs(t2) {
  if (t2 === void 0)
    return "undefined";
  if (t2 === null)
    return "null";
  if (typeof t2 == "string")
    return t2.length > 20 && (t2 = t2.substring(0, 20) + "..."), JSON.stringify(t2);
  if (typeof t2 == "number" || typeof t2 == "boolean")
    return "" + t2;
  if (typeof t2 == "object") {
    if (t2 instanceof Array)
      return "an array";
    var e = function(t3) {
      if (t3.constructor) {
        var e2 = /function\s+([^\s(]+)\s*\(/.exec(t3.constructor.toString());
        if (e2 && e2.length > 1)
          return e2[1];
      }
      return null;
    }(t2);
    return e ? "a custom " + e + " object" : "an object";
  }
  return typeof t2 == "function" ? "a function" : x2();
}
function Ls(t2, e) {
  if ("_delegate" in t2 && (t2 = t2.d_), !(t2 instanceof e)) {
    if (e.name === t2.constructor.name)
      throw new q2(M2.INVALID_ARGUMENT, "Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");
    var n2 = Cs(t2);
    throw new q2(M2.INVALID_ARGUMENT, "Expected type '" + e.name + "', but it was: " + n2);
  }
  return t2;
}
function Rs(t2, e) {
  if (e <= 0)
    throw new q2(M2.INVALID_ARGUMENT, "Function " + t2 + "() requires a positive number, but it was: " + e + ".");
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Us = function() {
  function t2(t3) {
    var e;
    if (t3.host === void 0) {
      if (t3.ssl !== void 0)
        throw new q2(M2.INVALID_ARGUMENT, "Can't provide ssl option if host option is not set");
      this.host = "firestore.googleapis.com", this.ssl = true;
    } else
      this.host = t3.host, this.ssl = (e = t3.ssl) === null || e === void 0 || e;
    if (this.credentials = t3.credentials, this.ignoreUndefinedProperties = !!t3.ignoreUndefinedProperties, t3.cacheSizeBytes === void 0)
      this.cacheSizeBytes = 41943040;
    else {
      if (t3.cacheSizeBytes !== -1 && t3.cacheSizeBytes < 1048576)
        throw new q2(M2.INVALID_ARGUMENT, "cacheSizeBytes must be at least 1048576");
      this.cacheSizeBytes = t3.cacheSizeBytes;
    }
    this.experimentalForceLongPolling = !!t3.experimentalForceLongPolling, this.experimentalAutoDetectLongPolling = !!t3.experimentalAutoDetectLongPolling, Os("experimentalForceLongPolling", t3.experimentalForceLongPolling, "experimentalAutoDetectLongPolling", t3.experimentalAutoDetectLongPolling);
  }
  return t2.prototype.isEqual = function(t3) {
    return this.host === t3.host && this.ssl === t3.ssl && this.credentials === t3.credentials && this.cacheSizeBytes === t3.cacheSizeBytes && this.experimentalForceLongPolling === t3.experimentalForceLongPolling && this.experimentalAutoDetectLongPolling === t3.experimentalAutoDetectLongPolling && this.ignoreUndefinedProperties === t3.ignoreUndefinedProperties;
  }, t2;
}();
var Ms = new Map();
var qs = function() {
  function t2(t3, e) {
    this.w_ = "(lite)", this.E_ = new Us({}), this.T_ = false, t3 instanceof I2 ? (this.I_ = t3, this.m_ = new G2()) : (this.A_ = t3, this.I_ = function(t4) {
      if (!Object.prototype.hasOwnProperty.apply(t4.options, ["projectId"]))
        throw new q2(M2.INVALID_ARGUMENT, '"projectId" not provided in firebase.initializeApp.');
      return new I2(t4.options.projectId);
    }(t3), this.m_ = new B(e));
  }
  return Object.defineProperty(t2.prototype, "app", {
    get: function() {
      if (!this.A_)
        throw new q2(M2.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this.A_;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "R_", {
    get: function() {
      return this.T_;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "P_", {
    get: function() {
      return this.y_ !== void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.g_ = function(t3) {
    if (this.T_)
      throw new q2(M2.FAILED_PRECONDITION, "Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");
    this.E_ = new Us(t3), t3.credentials !== void 0 && (this.m_ = function(t4) {
      if (!t4)
        return new G2();
      switch (t4.type) {
        case "gapi":
          var e = t4.client;
          return k2(!(typeof e != "object" || e === null || !e.auth || !e.auth.getAuthHeaderValueForFirstParty)), new Y2(e, t4.sessionIndex || "0");
        case "provider":
          return t4.client;
        default:
          throw new q2(M2.INVALID_ARGUMENT, "makeCredentialsProvider failed due to invalid credential type");
      }
    }(t3.credentials));
  }, t2.prototype.V_ = function() {
    return this.E_;
  }, t2.prototype.p_ = function() {
    return this.T_ = true, this.E_;
  }, t2.prototype._delete = function() {
    return this.y_ || (this.y_ = this.b_()), this.y_;
  }, t2.prototype.toJSON = function() {
    return {
      app: this.A_,
      t: this.I_,
      settings: this.E_
    };
  }, t2.prototype.b_ = function() {
    return t3 = this, (e = Ms.get(t3)) && (N2("ComponentProvider", "Removing Datastore"), Ms.delete(t3), e.terminate()), Promise.resolve();
    var t3, e;
  }, t2;
}();
var Fs = function() {
  function t2(t3, e, n2) {
    this.v_ = e, this.S_ = n2, this.type = "document", this.firestore = t3;
  }
  return Object.defineProperty(t2.prototype, "D_", {
    get: function() {
      return this.S_.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this.S_.path.tt();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this.S_.path.rt();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "parent", {
    get: function() {
      return new zs(this.firestore, this.v_, this.S_.path.X());
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this.S_);
  }, t2;
}();
var js = function() {
  function t2(t3, e, n2) {
    this.v_ = e, this.C_ = n2, this.type = "query", this.firestore = t3;
  }
  return t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this.C_);
  }, t2;
}();
var zs = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2, re(r2)) || this).firestore = e2, i.D_ = r2, i.type = "collection", i;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this.C_.path.tt();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this.C_.path.rt();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      var t3 = this.D_.X();
      return t3.et() ? null : new Fs(this.firestore, null, new tt(t3));
    },
    enumerable: false,
    configurable: true
  }), e.prototype.withConverter = function(t3) {
    return new e(this.firestore, t3, this.D_);
  }, e;
}(js);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Gs(t2, e) {
  for (var n2, r2 = [], i = 2; i < arguments.length; i++)
    r2[i - 2] = arguments[i];
  if (t2 instanceof Ss && (t2 = t2.d_), xs("collection", "path", e), t2 instanceof qs)
    return Vs(n2 = Z2.ot.apply(Z2, __spreadArrays([e], r2))), new zs(t2, null, n2);
  if (!(t2 instanceof Fs || t2 instanceof zs))
    throw new q2(M2.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return Vs(n2 = Z2.ot.apply(Z2, __spreadArrays([t2.path], r2)).child(Z2.ot(e))), new zs(t2.firestore, null, n2);
}
function Bs(t2, e) {
  for (var n2, r2 = [], i = 2; i < arguments.length; i++)
    r2[i - 2] = arguments[i];
  if (t2 instanceof Ss && (t2 = t2.d_), arguments.length === 1 && (e = V2.u()), xs("doc", "path", e), t2 instanceof qs)
    return Ps(n2 = Z2.ot.apply(Z2, __spreadArrays([e], r2))), new Fs(t2, null, new tt(n2));
  if (!(t2 instanceof Fs || t2 instanceof zs))
    throw new q2(M2.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return Ps(n2 = t2.D_.child(Z2.ot.apply(Z2, __spreadArrays([e], r2)))), new Fs(t2.firestore, t2 instanceof zs ? t2.v_ : null, new tt(n2));
}
function Qs(t2, e) {
  return t2 instanceof Ss && (t2 = t2.d_), e instanceof Ss && (e = e.d_), (t2 instanceof Fs || t2 instanceof zs) && (e instanceof Fs || e instanceof zs) && t2.firestore === e.firestore && t2.path === e.path && t2.v_ === e.v_;
}
function Ys(t2, e) {
  return t2 instanceof Ss && (t2 = t2.d_), e instanceof Ss && (e = e.d_), t2 instanceof js && e instanceof js && t2.firestore === e.firestore && le(t2.C_, e.C_) && t2.v_ === e.v_;
}
var Hs = function() {
  function t2(t3, e) {
    if (!isFinite(t3) || t3 < -90 || t3 > 90)
      throw new q2(M2.INVALID_ARGUMENT, "Latitude must be a number between -90 and 90, but was: " + t3);
    if (!isFinite(e) || e < -180 || e > 180)
      throw new q2(M2.INVALID_ARGUMENT, "Longitude must be a number between -180 and 180, but was: " + e);
    this.x_ = t3, this.N_ = e;
  }
  return Object.defineProperty(t2.prototype, "latitude", {
    get: function() {
      return this.x_;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "longitude", {
    get: function() {
      return this.N_;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this.x_ === t3.x_ && this.N_ === t3.N_;
  }, t2.prototype.toJSON = function() {
    return {
      latitude: this.x_,
      longitude: this.N_
    };
  }, t2.prototype.U = function(t3) {
    return C(this.x_, t3.x_) || C(this.N_, t3.N_);
  }, t2;
}();
var Ks = /^__.*__$/;
var Xs = function() {
  function t2(t3, e, n2) {
    this.data = t3, this.Gt = e, this.fieldTransforms = n2;
  }
  return t2.prototype.F_ = function(t3, e) {
    return this.Gt !== null ? new Qe(t3, this.data, this.Gt, e, this.fieldTransforms) : new Be(t3, this.data, e, this.fieldTransforms);
  }, t2;
}();
var Ws = function() {
  function t2(t3, e, n2) {
    this.data = t3, this.Gt = e, this.fieldTransforms = n2;
  }
  return t2.prototype.F_ = function(t3, e) {
    return new Qe(t3, this.data, this.Gt, e, this.fieldTransforms);
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Zs(t2) {
  switch (t2) {
    case 0:
    case 2:
    case 1:
      return true;
    case 3:
    case 4:
      return false;
    default:
      throw x2();
  }
}
var Js = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.settings = t3, this.t = e, this.Qt = n2, this.ignoreUndefinedProperties = r2, i === void 0 && this.O_(), this.fieldTransforms = i || [], this.Gt = o || [];
  }
  return Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this.settings.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "k_", {
    get: function() {
      return this.settings.k_;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.M_ = function(e) {
    return new t2(Object.assign(Object.assign({}, this.settings), e), this.t, this.Qt, this.ignoreUndefinedProperties, this.fieldTransforms, this.Gt);
  }, t2.prototype.L_ = function(t3) {
    var e, n2 = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r2 = this.M_({
      path: n2,
      B_: false
    });
    return r2.q_(t3), r2;
  }, t2.prototype.U_ = function(t3) {
    var e, n2 = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r2 = this.M_({
      path: n2,
      B_: false
    });
    return r2.O_(), r2;
  }, t2.prototype.Q_ = function(t3) {
    return this.M_({
      path: void 0,
      B_: true
    });
  }, t2.prototype.K_ = function(t3) {
    return ga(t3, this.settings.methodName, this.settings.W_ || false, this.path, this.settings.j_);
  }, t2.prototype.contains = function(t3) {
    return this.Gt.find(function(e) {
      return t3.nt(e);
    }) !== void 0 || this.fieldTransforms.find(function(e) {
      return t3.nt(e.field);
    }) !== void 0;
  }, t2.prototype.O_ = function() {
    if (this.path)
      for (var t3 = 0; t3 < this.path.length; t3++)
        this.q_(this.path.get(t3));
  }, t2.prototype.q_ = function(t3) {
    if (t3.length === 0)
      throw this.K_("Document fields must not be empty");
    if (Zs(this.k_) && Ks.test(t3))
      throw this.K_('Document fields cannot begin and end with "__"');
  }, t2;
}();
var $s = function() {
  function t2(t3, e, n2) {
    this.t = t3, this.ignoreUndefinedProperties = e, this.Qt = n2 || Bo(t3);
  }
  return t2.prototype.G_ = function(t3, e, n2, r2) {
    return r2 === void 0 && (r2 = false), new Js({
      k_: t3,
      methodName: e,
      j_: n2,
      path: $.ct(),
      B_: false,
      W_: r2
    }, this.t, this.Qt, this.ignoreUndefinedProperties);
  }, t2;
}();
function ta2(t2) {
  var e = t2.p_(), n2 = Bo(t2.I_);
  return new $s(t2.I_, !!e.ignoreUndefinedProperties, n2);
}
function ea2(t2, e, n2, r2, i, o) {
  o === void 0 && (o = {});
  var u = t2.G_(o.merge || o.mergeFields ? 2 : 0, e, n2, i);
  da2("Data must be an object, but it was:", u, r2);
  var s, a, c = la(r2, u);
  if (o.merge)
    s = new it(u.Gt), a = u.fieldTransforms;
  else if (o.mergeFields) {
    for (var h2 = [], f = 0, l = o.mergeFields; f < l.length; f++) {
      var p2 = va(e, l[f], n2);
      if (!u.contains(p2))
        throw new q2(M2.INVALID_ARGUMENT, "Field '" + p2 + "' is specified in your field mask but missing from your input data.");
      wa(h2, p2) || h2.push(p2);
    }
    s = new it(h2), a = u.fieldTransforms.filter(function(t3) {
      return s.Tt(t3.field);
    });
  } else
    s = null, a = u.fieldTransforms;
  return new Xs(new St(c), s, a);
}
var na2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.z_ = function(t3) {
    if (t3.k_ !== 2)
      throw t3.k_ === 1 ? t3.K_(this._methodName + "() can only appear at the top level of your update data") : t3.K_(this._methodName + "() cannot be used with set() unless you pass {merge:true}");
    return t3.Gt.push(t3.path), null;
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e;
  }, e;
}(Ds);
function ra2(t2, e, n2) {
  return new Js({
    k_: 3,
    j_: e.settings.j_,
    methodName: t2._methodName,
    B_: n2
  }, e.t, e.Qt, e.ignoreUndefinedProperties);
}
var ia = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.z_ = function(t3) {
    return new Ce(t3.path, new Ae());
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e;
  }, e;
}(Ds);
var oa2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).H_ = n2, r2;
  }
  return __extends(e, t2), e.prototype.z_ = function(t3) {
    var e2 = ra2(this, t3, true), n2 = this.H_.map(function(t4) {
      return fa2(t4, e2);
    }), r2 = new De(n2);
    return new Ce(t3.path, r2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(Ds);
var ua2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).H_ = n2, r2;
  }
  return __extends(e, t2), e.prototype.z_ = function(t3) {
    var e2 = ra2(this, t3, true), n2 = this.H_.map(function(t4) {
      return fa2(t4, e2);
    }), r2 = new xe(n2);
    return new Ce(t3.path, r2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(Ds);
var sa2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).J_ = n2, r2;
  }
  return __extends(e, t2), e.prototype.z_ = function(t3) {
    var e2 = new Oe(t3.Qt, _e(t3.Qt, this.J_));
    return new Ce(t3.path, e2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(Ds);
function aa2(t2, e, n2, r2) {
  var i = t2.G_(1, e, n2);
  da2("Data must be an object, but it was:", i, r2);
  var o = [], u = new xt();
  nt(r2, function(t3, r3) {
    var s2 = ma2(e, t3, n2);
    r3 instanceof Ss && (r3 = r3.d_);
    var a = i.U_(s2);
    if (r3 instanceof na2)
      o.push(s2);
    else {
      var c = fa2(r3, a);
      c != null && (o.push(s2), u.set(s2, c));
    }
  });
  var s = new it(o);
  return new Ws(u.Pt(), s, i.fieldTransforms);
}
function ca2(t2, e, n2, r2, i, o) {
  var u = t2.G_(1, e, n2), s = [va(e, r2, n2)], a = [i];
  if (o.length % 2 != 0)
    throw new q2(M2.INVALID_ARGUMENT, "Function " + e + "() needs to be called with an even number of arguments that alternate between field names and values.");
  for (var c = 0; c < o.length; c += 2)
    s.push(va(e, o[c])), a.push(o[c + 1]);
  for (var h2 = [], f = new xt(), l = s.length - 1; l >= 0; --l)
    if (!wa(h2, s[l])) {
      var p2 = s[l], d = a[l];
      d instanceof Ss && (d = d.d_);
      var v2 = u.U_(p2);
      if (d instanceof na2)
        h2.push(p2);
      else {
        var y2 = fa2(d, v2);
        y2 != null && (h2.push(p2), f.set(p2, y2));
      }
    }
  var m = new it(h2);
  return new Ws(f.Pt(), m, u.fieldTransforms);
}
function ha2(t2, e, n2, r2) {
  return r2 === void 0 && (r2 = false), fa2(n2, t2.G_(r2 ? 4 : 3, e));
}
function fa2(t2, e) {
  if (t2 instanceof Ss && (t2 = t2.d_), pa2(t2))
    return da2("Unsupported field value:", e, t2), la(t2, e);
  if (t2 instanceof Ds)
    return function(t3, e2) {
      if (!Zs(e2.k_))
        throw e2.K_(t3._methodName + "() can only be used with update() and set()");
      if (!e2.path)
        throw e2.K_(t3._methodName + "() is not currently supported inside arrays");
      var n2 = t3.z_(e2);
      n2 && e2.fieldTransforms.push(n2);
    }(t2, e), null;
  if (t2 === void 0 && e.ignoreUndefinedProperties)
    return null;
  if (e.path && e.Gt.push(e.path), t2 instanceof Array) {
    if (e.settings.B_ && e.k_ !== 4)
      throw e.K_("Nested arrays are not supported");
    return function(t3, e2) {
      for (var n2 = [], r2 = 0, i = 0, o = t3; i < o.length; i++) {
        var u = fa2(o[i], e2.Q_(r2));
        u == null && (u = {
          nullValue: "NULL_VALUE"
        }), n2.push(u), r2++;
      }
      return {
        arrayValue: {
          values: n2
        }
      };
    }(t2, e);
  }
  return function(t3, e2) {
    if (t3 instanceof Ss && (t3 = t3.d_), t3 === null)
      return {
        nullValue: "NULL_VALUE"
      };
    if (typeof t3 == "number")
      return _e(e2.Qt, t3);
    if (typeof t3 == "boolean")
      return {
        booleanValue: t3
      };
    if (typeof t3 == "string")
      return {
        stringValue: t3
      };
    if (t3 instanceof Date) {
      var n2 = K2.fromDate(t3);
      return {
        timestampValue: Ln(e2.Qt, n2)
      };
    }
    if (t3 instanceof K2) {
      n2 = new K2(t3.seconds, 1e3 * Math.floor(t3.nanoseconds / 1e3));
      return {
        timestampValue: Ln(e2.Qt, n2)
      };
    }
    if (t3 instanceof Hs)
      return {
        geoPointValue: {
          latitude: t3.latitude,
          longitude: t3.longitude
        }
      };
    if (t3 instanceof F2)
      return {
        bytesValue: Rn(e2.Qt, t3.I)
      };
    if (t3 instanceof Fs) {
      n2 = e2.t;
      var r2 = t3.firestore.I_;
      if (!r2.isEqual(n2))
        throw e2.K_("Document reference is for database " + r2.projectId + "/" + r2.database + " but should be for database " + n2.projectId + "/" + n2.database);
      return {
        referenceValue: qn(t3.firestore.I_ || e2.t, t3.S_.path)
      };
    }
    throw e2.K_("Unsupported field value: " + Cs(t3));
  }(t2, e);
}
function la(t2, e) {
  var n2 = {};
  return rt(t2) ? e.path && e.path.length > 0 && e.Gt.push(e.path) : nt(t2, function(t3, r2) {
    var i = fa2(r2, e.L_(t3));
    i != null && (n2[t3] = i);
  }), {
    mapValue: {
      fields: n2
    }
  };
}
function pa2(t2) {
  return !(typeof t2 != "object" || t2 === null || t2 instanceof Array || t2 instanceof Date || t2 instanceof K2 || t2 instanceof Hs || t2 instanceof F2 || t2 instanceof Fs || t2 instanceof Ds);
}
function da2(t2, e, n2) {
  if (!pa2(n2) || !function(t3) {
    return typeof t3 == "object" && t3 !== null && (Object.getPrototypeOf(t3) === Object.prototype || Object.getPrototypeOf(t3) === null);
  }(n2)) {
    var r2 = Cs(n2);
    throw r2 === "an object" ? e.K_(t2 + " a custom object") : e.K_(t2 + " " + r2);
  }
}
function va(t2, e, n2) {
  if (e instanceof Ss && (e = e.d_), e instanceof As)
    return e.f_;
  if (typeof e == "string")
    return ma2(t2, e);
  throw ga("Field path arguments must be of type string or FieldPath.", t2, false, void 0, n2);
}
var ya = new RegExp("[~\\*/\\[\\]]");
function ma2(t2, e, n2) {
  if (e.search(ya) >= 0)
    throw ga("Invalid field path (" + e + "). Paths must not contain '~', '*', '/', '[', or ']'", t2, false, void 0, n2);
  try {
    return new (As.bind.apply(As, __spreadArrays([void 0], e.split("."))))().f_;
  } catch (r2) {
    throw ga("Invalid field path (" + e + "). Paths must not be empty, begin with '.', end with '.', or contain '..'", t2, false, void 0, n2);
  }
}
function ga(t2, e, n2, r2, i) {
  var o = r2 && !r2.et(), u = i !== void 0, s = "Function " + e + "() called with invalid data";
  n2 && (s += " (via `toFirestore()`)");
  var a = "";
  return (o || u) && (a += " (found", o && (a += " in field " + r2), u && (a += " in document " + i), a += ")"), new q2(M2.INVALID_ARGUMENT, (s += ". ") + t2 + a);
}
function wa(t2, e) {
  return t2.some(function(t3) {
    return t3.isEqual(e);
  });
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ba2 = function() {
  function t2(t3) {
    this.Sh = t3, this.Y_ = new Map(), this.mutations = [], this.X_ = false, this.Z_ = null, this.tf = new Set();
  }
  return t2.prototype.ef = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e, n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            if (this.nf(), this.mutations.length > 0)
              throw new q2(M2.INVALID_ARGUMENT, "Firestore transactions require all reads to be executed before all writes.");
            return [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r3, i, o, u, s;
                return __generator(this, function(a) {
                  switch (a.label) {
                    case 0:
                      return n3 = O2(t4), r3 = Qn(n3.Qt) + "/documents", i = {
                        documents: e2.map(function(t5) {
                          return jn(n3.Qt, t5);
                        })
                      }, [4, n3.Du("BatchGetDocuments", r3, i)];
                    case 1:
                      return o = a.sent(), u = new Map(), o.forEach(function(t5) {
                        var e3 = function(t6, e4) {
                          return "found" in e4 ? function(t7, e5) {
                            k2(!!e5.found), e5.found.name, e5.found.updateTime;
                            var n4 = zn(t7, e5.found.name), r4 = Mn(e5.found.updateTime), i2 = new St({
                              mapValue: {
                                fields: e5.found.fields
                              }
                            });
                            return new Pt(n4, r4, i2, {});
                          }(t6, e4) : "missing" in e4 ? function(t7, e5) {
                            k2(!!e5.missing), k2(!!e5.readTime);
                            var n4 = zn(t7, e5.missing), r4 = Mn(e5.readTime);
                            return new Vt(n4, r4);
                          }(t6, e4) : x2();
                        }(n3.Qt, t5);
                        u.set(e3.key.toString(), e3);
                      }), s = [], [2, (e2.forEach(function(t5) {
                        var e3 = u.get(t5.toString());
                        k2(!!e3), s.push(e3);
                      }), s)];
                  }
                });
              });
            }(this.Sh, t3)];
          case 1:
            return [2, ((e = r2.sent()).forEach(function(t4) {
              t4 instanceof Vt || t4 instanceof Pt ? n2.sf(t4) : x2();
            }), e)];
        }
      });
    });
  }, t2.prototype.set = function(t3, e) {
    this.write(e.F_(t3, this.jt(t3))), this.tf.add(t3.toString());
  }, t2.prototype.update = function(t3, e) {
    try {
      this.write(e.F_(t3, this.rf(t3)));
    } catch (t4) {
      this.Z_ = t4;
    }
    this.tf.add(t3.toString());
  }, t2.prototype.delete = function(t3) {
    this.write(new Je(t3, this.jt(t3))), this.tf.add(t3.toString());
  }, t2.prototype.commit = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            if (this.nf(), this.Z_)
              throw this.Z_;
            return t3 = this.Y_, this.mutations.forEach(function(e2) {
              t3.delete(e2.key.toString());
            }), t3.forEach(function(t4, n3) {
              var r2 = tt._t(n3);
              e.mutations.push(new $e(r2, e.jt(r2)));
            }), [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r2, i;
                return __generator(this, function(o) {
                  switch (o.label) {
                    case 0:
                      return n3 = O2(t4), r2 = Qn(n3.Qt) + "/documents", i = {
                        writes: e2.map(function(t5) {
                          return Xn(n3.Qt, t5);
                        })
                      }, [4, n3.pu("Commit", r2, i)];
                    case 1:
                      return o.sent(), [2];
                  }
                });
              });
            }(this.Sh, this.mutations)];
          case 1:
            return n2.sent(), this.X_ = true, [2];
        }
      });
    });
  }, t2.prototype.sf = function(t3) {
    var e;
    if (t3 instanceof Pt)
      e = t3.version;
    else {
      if (!(t3 instanceof Vt))
        throw x2();
      e = X2.min();
    }
    var n2 = this.Y_.get(t3.key.toString());
    if (n2) {
      if (!e.isEqual(n2))
        throw new q2(M2.ABORTED, "Document version changed between two reads.");
    } else
      this.Y_.set(t3.key.toString(), e);
  }, t2.prototype.jt = function(t3) {
    var e = this.Y_.get(t3.toString());
    return !this.tf.has(t3.toString()) && e ? Re.updateTime(e) : Re.Kt();
  }, t2.prototype.rf = function(t3) {
    var e = this.Y_.get(t3.toString());
    if (!this.tf.has(t3.toString()) && e) {
      if (e.isEqual(X2.min()))
        throw new q2(M2.INVALID_ARGUMENT, "Can't update a document that doesn't exist.");
      return Re.updateTime(e);
    }
    return Re.exists(true);
  }, t2.prototype.write = function(t3) {
    this.nf(), this.mutations.push(t3);
  }, t2.prototype.nf = function() {
  }, t2;
}();
var _a = function() {
  function t2(t3, e, n2, r2) {
    this._s = t3, this.Sh = e, this.updateFunction = n2, this.Es = r2, this.cf = 5, this.Gu = new Qo(this._s, "transaction_retry");
  }
  return t2.prototype.run = function() {
    this.af();
  }, t2.prototype.af = function() {
    var t3 = this;
    this.Gu.Lu(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, e, n2 = this;
        return __generator(this, function(r2) {
          return t4 = new ba2(this.Sh), (e = this.uf(t4)) && e.then(function(e2) {
            n2._s.Ps(function() {
              return t4.commit().then(function() {
                n2.Es.resolve(e2);
              }).catch(function(t5) {
                n2.hf(t5);
              });
            });
          }).catch(function(t5) {
            n2.hf(t5);
          }), [2];
        });
      });
    });
  }, t2.prototype.uf = function(t3) {
    try {
      var e = this.updateFunction(t3);
      return !lt(e) && e.catch && e.then ? e : (this.Es.reject(Error("Transaction callback must return a Promise")), null);
    } catch (t4) {
      return this.Es.reject(t4), null;
    }
  }, t2.prototype.hf = function(t3) {
    var e = this;
    this.cf > 0 && this.lf(t3) ? (this.cf -= 1, this._s.Ps(function() {
      return e.af(), Promise.resolve();
    })) : this.Es.reject(t3);
  }, t2.prototype.lf = function(t3) {
    if (t3.name === "FirebaseError") {
      var e = t3.code;
      return e === "aborted" || e === "failed-precondition" || !en(e);
    }
    return false;
  }, t2;
}();
var Ia2 = function() {
  function t2(t3, e, n2) {
    var r2 = this;
    this.credentials = t3, this._s = e, this.yu = n2, this.user = j.UNAUTHENTICATED, this.clientId = V2.u(), this._f = function() {
    }, this.C = new fr(), this.credentials.v(function(t4) {
      N2("FirestoreClient", "Received user=", t4.uid), r2.user = t4, r2._f(t4), r2.C.resolve();
    });
  }
  return t2.prototype.getConfiguration = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, this.C.promise];
          case 1:
            return [2, (t3.sent(), {
              _s: this._s,
              yu: this.yu,
              clientId: this.clientId,
              credentials: this.credentials,
              Jl: this.user,
              pl: 100
            })];
        }
      });
    });
  }, t2.prototype.ff = function(t3) {
    var e = this;
    this._f = t3, this.C.promise.then(function() {
      return e._f(e.user);
    });
  }, t2.prototype.df = function() {
    if (this._s.wf)
      throw new q2(M2.FAILED_PRECONDITION, "The client has already been terminated.");
  }, t2.prototype.terminate = function() {
    var t3 = this;
    this._s.Ef();
    var e = new fr();
    return this._s.Tf(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, n2;
        return __generator(this, function(r2) {
          switch (r2.label) {
            case 0:
              return r2.trys.push([0, 5, , 6]), this.If ? [4, this.If.terminate()] : [3, 2];
            case 1:
              r2.sent(), r2.label = 2;
            case 2:
              return this.mf ? [4, this.mf.terminate()] : [3, 4];
            case 3:
              r2.sent(), r2.label = 4;
            case 4:
              return this.credentials.S(), e.resolve(), [3, 6];
            case 5:
              return t4 = r2.sent(), n2 = Er(t4, "Failed to shutdown persistence"), e.reject(n2), [3, 6];
            case 6:
              return [2];
          }
        });
      });
    }), e.promise;
  }, t2;
}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ea2(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i = this;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return t2._s.Af(), N2("FirestoreClient", "Initializing OfflineComponentProvider"), [4, t2.getConfiguration()];
        case 1:
          return n2 = o.sent(), [4, e.initialize(n2)];
        case 2:
          return o.sent(), r2 = n2.Jl, t2.ff(function(n3) {
            r2.isEqual(n3) || (r2 = n3, t2._s.po(function() {
              return __awaiter(i, void 0, void 0, function() {
                return __generator(this, function(t3) {
                  switch (t3.label) {
                    case 0:
                      return [4, no(e.bh, n3)];
                    case 1:
                      return t3.sent(), [2];
                  }
                });
              });
            }));
          }), e.persistence.Po(function() {
            return t2.terminate();
          }), t2.mf = e, [2];
      }
    });
  });
}
function Ta2(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return t2._s.Af(), [4, Na(t2)];
        case 1:
          return n2 = i.sent(), N2("FirestoreClient", "Initializing OnlineComponentProvider"), [4, t2.getConfiguration()];
        case 2:
          return r2 = i.sent(), [4, e.initialize(n2, r2)];
        case 3:
          return i.sent(), t2.ff(function(n3) {
            return t2._s.po(function() {
              return function(t3, e2) {
                return __awaiter(this, void 0, void 0, function() {
                  var n4, r3;
                  return __generator(this, function(i2) {
                    switch (i2.label) {
                      case 0:
                        return (n4 = O2(t3))._s.Af(), N2("RemoteStore", "RemoteStore received new credentials"), r3 = uu(n4), n4.Nh.add(3), [4, $o(n4)];
                      case 1:
                        return i2.sent(), r3 && n4.Oh.set("Unknown"), [4, n4.Dh.n_(e2)];
                      case 2:
                        return i2.sent(), n4.Nh.delete(3), [4, Jo(n4)];
                      case 3:
                        return i2.sent(), [2];
                    }
                  });
                });
              }(e.yl, n3);
            });
          }), t2.If = e, [2];
      }
    });
  });
}
function Na(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.mf ? [3, 2] : (N2("FirestoreClient", "Using default OfflineComponentProvider"), [4, Ea2(t2, new ws())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.mf];
      }
    });
  });
}
function Aa2(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.If ? [3, 2] : (N2("FirestoreClient", "Using default OnlineComponentProvider"), [4, Ta2(t2, new Is())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.If];
      }
    });
  });
}
function Da2(t2) {
  return Na(t2).then(function(t3) {
    return t3.persistence;
  });
}
function Sa(t2) {
  return Na(t2).then(function(t3) {
    return t3.bh;
  });
}
function xa(t2) {
  return Aa2(t2).then(function(t3) {
    return t3.yl;
  });
}
function ka2(t2) {
  return Aa2(t2).then(function(t3) {
    return t3._a;
  });
}
function Oa(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          return [4, Aa2(t2)];
        case 1:
          return e = r2.sent(), [2, ((n2 = e.gl).jh = ju.bind(null, e._a), n2.Hh = Gu.bind(null, e._a), n2)];
      }
    });
  });
}
function Pa(t2, e, n2) {
  var r2 = this;
  n2 === void 0 && (n2 = {});
  var i = new fr();
  return t2._s.Ps(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return r3 = function(t3, e2, n3, r4, i2) {
              var o2 = new Ts({
                next: function(o3) {
                  e2.Ps(function() {
                    return Au(t3, u);
                  });
                  var s = o3.docs.has(n3);
                  !s && o3.fromCache ? i2.reject(new q2(M2.UNAVAILABLE, "Failed to get document because the client is offline.")) : s && o3.fromCache && r4 && r4.source === "server" ? i2.reject(new q2(M2.UNAVAILABLE, 'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')) : i2.resolve(o3);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), u = new ku(re(n3.path), o2, {
                includeMetadataChanges: true,
                nl: true
              });
              return Nu(t3, u);
            }, [4, Oa(t2)];
          case 1:
            return [2, r3.apply(void 0, [o.sent(), t2._s, e, n2, i])];
        }
      });
    });
  }), i.promise;
}
function Va2(t2, e, n2) {
  var r2 = this;
  n2 === void 0 && (n2 = {});
  var i = new fr();
  return t2._s.Ps(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return r3 = function(t3, e2, n3, r4, i2) {
              var o2 = new Ts({
                next: function(n4) {
                  e2.Ps(function() {
                    return Au(t3, u);
                  }), n4.fromCache && r4.source === "server" ? i2.reject(new q2(M2.UNAVAILABLE, 'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')) : i2.resolve(n4);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), u = new ku(n3, o2, {
                includeMetadataChanges: true,
                nl: true
              });
              return Nu(t3, u);
            }, [4, Oa(t2)];
          case 1:
            return [2, r3.apply(void 0, [o.sent(), t2._s, e, n2, i])];
        }
      });
    });
  }), i.promise;
}
var Ca2 = function() {
  function t2() {
    var t3 = this;
    this.Rf = Promise.resolve(), this.Pf = [], this.yf = false, this.gf = [], this.Vf = null, this.pf = false, this.bf = [], this.Gu = new Qo(this, "async_queue_retry"), this.vf = function() {
      var e2 = Go();
      e2 && N2("AsyncQueue", "Visibility state changed to " + e2.visibilityState), t3.Gu.qu();
    };
    var e = Go();
    e && typeof e.addEventListener == "function" && e.addEventListener("visibilitychange", this.vf);
  }
  return Object.defineProperty(t2.prototype, "wf", {
    get: function() {
      return this.yf;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Ps = function(t3) {
    this.enqueue(t3);
  }, t2.prototype.Tf = function(t3) {
    this.Sf(), this.Df(t3);
  }, t2.prototype.Ef = function() {
    if (!this.yf) {
      this.yf = true;
      var t3 = Go();
      t3 && typeof t3.removeEventListener == "function" && t3.removeEventListener("visibilitychange", this.vf);
    }
  }, t2.prototype.enqueue = function(t3) {
    return this.Sf(), this.yf ? new Promise(function(t4) {
    }) : this.Df(t3);
  }, t2.prototype.po = function(t3) {
    var e = this;
    this.Ps(function() {
      return e.Pf.push(t3), e.Cf();
    });
  }, t2.prototype.Cf = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            if (this.Pf.length === 0)
              return [3, 5];
            n2.label = 1;
          case 1:
            return n2.trys.push([1, 3, , 4]), [4, this.Pf[0]()];
          case 2:
            return n2.sent(), this.Pf.shift(), this.Gu.reset(), [3, 4];
          case 3:
            if (!mr(t3 = n2.sent()))
              throw t3;
            return N2("AsyncQueue", "Operation failed with retryable error: " + t3), [3, 4];
          case 4:
            this.Pf.length > 0 && this.Gu.Lu(function() {
              return e.Cf();
            }), n2.label = 5;
          case 5:
            return [2];
        }
      });
    });
  }, t2.prototype.Df = function(t3) {
    var e = this, n2 = this.Rf.then(function() {
      return e.pf = true, t3().catch(function(t4) {
        throw e.Vf = t4, e.pf = false, A2("INTERNAL UNHANDLED ERROR: ", function(t5) {
          var e2 = t5.message || "";
          return t5.stack && (e2 = t5.stack.includes(t5.message) ? t5.stack : t5.message + "\n" + t5.stack), e2;
        }(t4)), t4;
      }).then(function(t4) {
        return e.pf = false, t4;
      });
    });
    return this.Rf = n2, n2;
  }, t2.prototype.Tr = function(t3, e, n2) {
    var r2 = this;
    this.Sf(), this.bf.indexOf(t3) > -1 && (e = 0);
    var i = Ir.Ts(this, t3, e, n2, function(t4) {
      return r2.xf(t4);
    });
    return this.gf.push(i), i;
  }, t2.prototype.Sf = function() {
    this.Vf && x2();
  }, t2.prototype.Af = function() {
  }, t2.prototype.Nf = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return [4, t3 = this.Rf];
          case 1:
            e.sent(), e.label = 2;
          case 2:
            if (t3 !== this.Rf)
              return [3, 0];
            e.label = 3;
          case 3:
            return [2];
        }
      });
    });
  }, t2.prototype.$f = function(t3) {
    for (var e = 0, n2 = this.gf; e < n2.length; e++) {
      if (n2[e].fs === t3)
        return true;
    }
    return false;
  }, t2.prototype.Ff = function(t3) {
    var e = this;
    return this.Nf().then(function() {
      e.gf.sort(function(t4, e2) {
        return t4.ds - e2.ds;
      });
      for (var n2 = 0, r2 = e.gf; n2 < r2.length; n2++) {
        var i = r2[n2];
        if (i.Rs(), t3 !== "all" && i.fs === t3)
          break;
      }
      return e.Nf();
    });
  }, t2.prototype.Of = function(t3) {
    this.bf.push(t3);
  }, t2.prototype.xf = function(t3) {
    var e = this.gf.indexOf(t3);
    this.gf.splice(e, 1);
  }, t2;
}();
function La2(t2) {
  return function(t3, e) {
    if (typeof t3 != "object" || t3 === null)
      return false;
    for (var n2 = t3, r2 = 0, i = ["next", "error", "complete"]; r2 < i.length; r2++) {
      var o = i[r2];
      if (o in n2 && typeof n2[o] == "function")
        return true;
    }
    return false;
  }(t2);
}
var Ra2 = function() {
  function t2() {
    this.kf = {}, this.Mf = new fr(), this.Lf = {
      taskState: "Running",
      totalBytes: 0,
      totalDocuments: 0,
      bytesLoaded: 0,
      documentsLoaded: 0
    };
  }
  return t2.prototype.onProgress = function(t3, e, n2) {
    this.kf = {
      next: t3,
      error: e,
      complete: n2
    };
  }, t2.prototype.catch = function(t3) {
    return this.Mf.promise.catch(t3);
  }, t2.prototype.then = function(t3, e) {
    return this.Mf.promise.then(t3, e);
  }, t2.prototype.ql = function(t3) {
    this.Ul(t3), this.kf.complete && this.kf.complete(), this.Mf.resolve(t3);
  }, t2.prototype.Kl = function(t3) {
    this.Lf.taskState = "Error", this.kf.next && this.kf.next(this.Lf), this.kf.error && this.kf.error(t3), this.Mf.reject(t3);
  }, t2.prototype.Ul = function(t3) {
    this.Lf = t3, this.kf.next && this.kf.next(t3);
  }, t2;
}();
var Ua2 = -1;
var Ma2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this).Bf = new Ca2(), r2.w_ = "name" in e2 ? e2.name : "[DEFAULT]", r2;
  }
  return __extends(e, t2), e.prototype.b_ = function() {
    return this.qf || Fa2(this), this.qf.terminate();
  }, e;
}(qs);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function qa2(t2) {
  return t2.qf || Fa2(t2), t2.qf.df(), t2.qf;
}
function Fa2(t2) {
  var e = t2.p_(), n2 = function(t3, e2, n3) {
    return new _(t3, e2, n3.host, n3.ssl, n3.experimentalForceLongPolling, n3.experimentalAutoDetectLongPolling);
  }(t2.I_, t2.w_, e);
  t2.qf = new Ia2(t2.m_, t2.Bf, n2);
}
function ja2(t2, e, n2) {
  var r2 = this, i = new fr();
  return t2._s.enqueue(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return o.trys.push([0, 3, , 4]), [4, Ea2(t2, n2)];
          case 1:
            return o.sent(), [4, Ta2(t2, e)];
          case 2:
            return o.sent(), i.resolve(), [3, 4];
          case 3:
            if (!function(t3) {
              return t3.name === "FirebaseError" ? t3.code === M2.FAILED_PRECONDITION || t3.code === M2.UNIMPLEMENTED : !(typeof DOMException != "undefined" && t3 instanceof DOMException) || (t3.code === 22 || t3.code === 20 || t3.code === 11);
            }(r3 = o.sent()))
              throw r3;
            return console.warn("Error enabling offline persistence. Falling back to persistence disabled: " + r3), i.reject(r3), [3, 4];
          case 4:
            return [2];
        }
      });
    });
  }).then(function() {
    return i.promise;
  });
}
function za2(t2) {
  if (t2.R_ || t2.P_)
    throw new q2(M2.FAILED_PRECONDITION, "Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ga2 = function() {
  function t2() {
  }
  return t2.prototype.Uf = function(t3, e) {
    switch (e === void 0 && (e = "none"), vt(t3)) {
      case 0:
        return null;
      case 1:
        return t3.booleanValue;
      case 2:
        return st(t3.integerValue || t3.doubleValue);
      case 3:
        return this.Qf(t3.timestampValue);
      case 4:
        return this.Kf(t3, e);
      case 5:
        return t3.stringValue;
      case 6:
        return this.Wf(at(t3.bytesValue));
      case 7:
        return this.jf(t3.referenceValue);
      case 8:
        return this.Gf(t3.geoPointValue);
      case 9:
        return this.zf(t3.arrayValue, e);
      case 10:
        return this.Hf(t3.mapValue, e);
      default:
        throw x2();
    }
  }, t2.prototype.Hf = function(t3, e) {
    var n2 = this, r2 = {};
    return nt(t3.fields || {}, function(t4, i) {
      r2[t4] = n2.Uf(i, e);
    }), r2;
  }, t2.prototype.Gf = function(t3) {
    return new Hs(st(t3.latitude), st(t3.longitude));
  }, t2.prototype.zf = function(t3, e) {
    var n2 = this;
    return (t3.values || []).map(function(t4) {
      return n2.Uf(t4, e);
    });
  }, t2.prototype.Kf = function(t3, e) {
    switch (e) {
      case "previous":
        var n2 = ht(t3);
        return n2 == null ? null : this.Uf(n2, e);
      case "estimate":
        return this.Qf(ft(t3));
      default:
        return null;
    }
  }, t2.prototype.Qf = function(t3) {
    var e = ut(t3);
    return new K2(e.seconds, e.nanos);
  }, t2.prototype.Jf = function(t3, e) {
    var n2 = Z2.ot(t3);
    k2(hr(n2));
    var r2 = new I2(n2.get(1), n2.get(3)), i = new tt(n2.Y(5));
    return r2.isEqual(e) || A2("Document " + i + " contains a document reference within a different database (" + r2.projectId + "/" + r2.database + ") which is not supported. It will be treated as a reference in the current database (" + e.projectId + "/" + e.database + ") instead."), i;
  }, t2;
}();
var Ba2 = function() {
  function t2(t3, e, n2, r2, i) {
    this.Yf = t3, this.Xf = e, this.S_ = n2, this.Zf = r2, this.v_ = i;
  }
  return Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this.S_.path.tt();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "ref", {
    get: function() {
      return new Fs(this.Yf, this.v_, this.S_);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.exists = function() {
    return this.Zf !== null;
  }, t2.prototype.data = function() {
    if (this.Zf) {
      if (this.v_) {
        var t3 = new Qa2(this.Yf, this.Xf, this.S_, this.Zf, null);
        return this.v_.fromFirestore(t3);
      }
      return this.Xf.Uf(this.Zf.bt());
    }
  }, t2.prototype.get = function(t3) {
    if (this.Zf) {
      var e = this.Zf.data().field(Ya2("DocumentSnapshot.get", t3));
      if (e !== null)
        return this.Xf.Uf(e);
    }
  }, t2;
}();
var Qa2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.data = function() {
    return t2.prototype.data.call(this);
  }, e;
}(Ba2);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ya2(t2, e) {
  return typeof e == "string" ? ma2(t2, e) : e instanceof Ss ? e.d_.f_ : e.f_;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ha2(t2) {
  if (oe(t2) && t2.xt.length === 0)
    throw new q2(M2.UNIMPLEMENTED, "limitToLast() queries require specifying at least one orderBy() clause");
}
var Ka2 = function() {
};
function Xa2(t2) {
  for (var e = [], n2 = 1; n2 < arguments.length; n2++)
    e[n2 - 1] = arguments[n2];
  for (var r2 = 0, i = e; r2 < i.length; r2++) {
    var o = i[r2];
    t2 = o.td(t2);
  }
  return t2;
}
var Wa2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).ed = e2, i.nd = n2, i.sd = r2, i.type = "where", i;
  }
  return __extends(e, t2), e.prototype.td = function(t3) {
    var e2 = ta2(t3.firestore), n2 = function(t4, e3, n3, r2, i, o, u) {
      var s;
      if (i.ut()) {
        if (o === "array-contains" || o === "array-contains-any")
          throw new q2(M2.INVALID_ARGUMENT, "Invalid Query. You can't perform '" + o + "' queries on FieldPath.documentId().");
        if (o === "in" || o === "not-in") {
          rc2(u, o);
          for (var a = [], c = 0, h2 = u; c < h2.length; c++) {
            var f = h2[c];
            a.push(nc2(r2, t4, f));
          }
          s = {
            arrayValue: {
              values: a
            }
          };
        } else
          s = nc2(r2, t4, u);
      } else
        o !== "in" && o !== "not-in" && o !== "array-contains-any" || rc2(u, o), s = ha2(n3, "where", u, o === "in" || o === "not-in");
      var l = Ft.create(i, o, s);
      return function(t5, e4) {
        if (e4.Ct()) {
          var n4 = se(t5);
          if (n4 !== null && !n4.isEqual(e4.field))
            throw new q2(M2.INVALID_ARGUMENT, "Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '" + n4.toString() + "' and '" + e4.field.toString() + "'");
          var r3 = ue(t5);
          r3 !== null && ic2(t5, e4.field, r3);
        }
        var i2 = function(t6, e5) {
          for (var n5 = 0, r4 = t6.filters; n5 < r4.length; n5++) {
            var i3 = r4[n5];
            if (e5.indexOf(i3.op) >= 0)
              return i3.op;
          }
          return null;
        }(t5, function(t6) {
          switch (t6) {
            case "!=":
              return ["!=", "not-in"];
            case "array-contains":
              return ["array-contains", "array-contains-any", "not-in"];
            case "in":
              return ["array-contains-any", "in", "not-in"];
            case "array-contains-any":
              return ["array-contains", "array-contains-any", "in", "not-in"];
            case "not-in":
              return ["array-contains", "array-contains-any", "in", "not-in", "!="];
            default:
              return [];
          }
        }(e4.op));
        if (i2 !== null)
          throw i2 === e4.op ? new q2(M2.INVALID_ARGUMENT, "Invalid query. You cannot use more than one '" + e4.op.toString() + "' filter.") : new q2(M2.INVALID_ARGUMENT, "Invalid query. You cannot use '" + e4.op.toString() + "' filters with '" + i2.toString() + "' filters.");
      }(t4, l), l;
    }(t3.C_, 0, e2, t3.firestore.I_, this.ed, this.nd, this.sd);
    return new js(t3.firestore, t3.v_, function(t4, e3) {
      var n3 = t4.filters.concat([e3]);
      return new ee(t4.path, t4.collectionGroup, t4.xt.slice(), n3, t4.limit, t4.limitType, t4.startAt, t4.endAt);
    }(t3.C_, n2));
  }, e;
}(Ka2);
var Za2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).ed = e2, r2.rd = n2, r2.type = "orderBy", r2;
  }
  return __extends(e, t2), e.prototype.td = function(t3) {
    var e2 = function(t4, e3, n2) {
      if (t4.startAt !== null)
        throw new q2(M2.INVALID_ARGUMENT, "Invalid query. You must not call startAt() or startAfter() before calling orderBy().");
      if (t4.endAt !== null)
        throw new q2(M2.INVALID_ARGUMENT, "Invalid query. You must not call endAt() or endBefore() before calling orderBy().");
      var r2 = new Zt(e3, n2);
      return function(t5, e4) {
        if (ue(t5) === null) {
          var n3 = se(t5);
          n3 !== null && ic2(t5, n3, e4.field);
        }
      }(t4, r2), r2;
    }(t3.C_, this.ed, this.rd);
    return new js(t3.firestore, t3.v_, function(t4, e3) {
      var n2 = t4.xt.concat([e3]);
      return new ee(t4.path, t4.collectionGroup, n2, t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, t4.endAt);
    }(t3.C_, e2));
  }, e;
}(Ka2);
var Ja2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.od = n2, i.ad = r2, i;
  }
  return __extends(e, t2), e.prototype.td = function(t3) {
    return new js(t3.firestore, t3.v_, fe(t3.C_, this.od, this.ad));
  }, e;
}(Ka2);
var $a2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.ud = n2, i.hd = r2, i;
  }
  return __extends(e, t2), e.prototype.td = function(t3) {
    var e2 = ec2(t3, this.type, this.ud, this.hd);
    return new js(t3.firestore, t3.v_, function(t4, e3) {
      return new ee(t4.path, t4.collectionGroup, t4.xt.slice(), t4.filters.slice(), t4.limit, t4.limitType, e3, t4.endAt);
    }(t3.C_, e2));
  }, e;
}(Ka2);
var tc = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.ud = n2, i.hd = r2, i;
  }
  return __extends(e, t2), e.prototype.td = function(t3) {
    var e2 = ec2(t3, this.type, this.ud, this.hd);
    return new js(t3.firestore, t3.v_, function(t4, e3) {
      return new ee(t4.path, t4.collectionGroup, t4.xt.slice(), t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, e3);
    }(t3.C_, e2));
  }, e;
}(Ka2);
function ec2(t2, e, n2, r2) {
  if (n2[0] instanceof Ss && (n2[0] = n2[0].d_), n2[0] instanceof Ba2)
    return function(t3, e2, n3, r3, i2) {
      if (!r3)
        throw new q2(M2.NOT_FOUND, "Can't use a DocumentSnapshot that doesn't exist for " + n3 + "().");
      for (var o = [], u = 0, s = ce(t3); u < s.length; u++) {
        var a = s[u];
        if (a.field.ut())
          o.push(It(e2, r3.key));
        else {
          var c = r3.field(a.field);
          if (ct(c))
            throw new q2(M2.INVALID_ARGUMENT, 'Invalid query. You are trying to start or end a query using a document for which the field "' + a.field + '" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');
          if (c === null) {
            var h2 = a.field.rt();
            throw new q2(M2.INVALID_ARGUMENT, "Invalid query. You are trying to start or end a query using a document for which the field '" + h2 + "' (used as the orderBy) does not exist.");
          }
          o.push(c);
        }
      }
      return new Xt(o, i2);
    }(t2.C_, t2.firestore.I_, e, n2[0].Zf, r2);
  var i = ta2(t2.firestore);
  return function(t3, e2, n3, r3, i2, o) {
    var u = t3.xt;
    if (i2.length > u.length)
      throw new q2(M2.INVALID_ARGUMENT, "Too many arguments provided to " + r3 + "(). The number of arguments must be less than or equal to the number of orderBy() clauses");
    for (var s = [], a = 0; a < i2.length; a++) {
      var c = i2[a];
      if (u[a].field.ut()) {
        if (typeof c != "string")
          throw new q2(M2.INVALID_ARGUMENT, "Invalid query. Expected a string for document ID in " + r3 + "(), but got a " + typeof c);
        if (!ae(t3) && c.indexOf("/") !== -1)
          throw new q2(M2.INVALID_ARGUMENT, "Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to " + r3 + "() must be a plain document ID, but '" + c + "' contains a slash.");
        var h2 = t3.path.child(Z2.ot(c));
        if (!tt.wt(h2))
          throw new q2(M2.INVALID_ARGUMENT, "Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to " + r3 + "() must result in a valid document path, but '" + h2 + "' is not because it contains an odd number of segments.");
        var f = new tt(h2);
        s.push(It(e2, f));
      } else {
        var l = ha2(n3, r3, c);
        s.push(l);
      }
    }
    return new Xt(s, o);
  }(t2.C_, t2.firestore.I_, i, e, n2, r2);
}
function nc2(t2, e, n2) {
  if (n2 instanceof Ss && (n2 = n2.d_), typeof n2 == "string") {
    if (n2 === "")
      throw new q2(M2.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");
    if (!ae(e) && n2.indexOf("/") !== -1)
      throw new q2(M2.INVALID_ARGUMENT, "Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '" + n2 + "' contains a '/' character.");
    var r2 = e.path.child(Z2.ot(n2));
    if (!tt.wt(r2))
      throw new q2(M2.INVALID_ARGUMENT, "Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '" + r2 + "' is not because it has an odd number of segments (" + r2.length + ").");
    return It(t2, new tt(r2));
  }
  if (n2 instanceof Fs)
    return It(t2, n2.S_);
  throw new q2(M2.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: " + Cs(n2) + ".");
}
function rc2(t2, e) {
  if (!Array.isArray(t2) || t2.length === 0)
    throw new q2(M2.INVALID_ARGUMENT, "Invalid Query. A non-empty array is required for '" + e.toString() + "' filters.");
  if (t2.length > 10)
    throw new q2(M2.INVALID_ARGUMENT, "Invalid Query. '" + e.toString() + "' filters support a maximum of 10 elements in the value array.");
}
function ic2(t2, e, n2) {
  if (!n2.isEqual(e))
    throw new q2(M2.INVALID_ARGUMENT, "Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '" + e.toString() + "' and so you must also use '" + e.toString() + "' as your first argument to orderBy(), but your first orderBy() is on field '" + n2.toString() + "' instead.");
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function oc2(t2, e, n2) {
  return t2 ? n2 && (n2.merge || n2.mergeFields) ? t2.toFirestore(e, n2) : t2.toFirestore(e) : e;
}
var uc2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  return __extends(e, t2), e.prototype.Wf = function(t3) {
    return new F2(t3);
  }, e.prototype.jf = function(t3) {
    var e2 = this.Jf(t3, this.firestore.I_);
    return new Fs(this.firestore, null, e2);
  }, e;
}(Ga2);
var sc2 = function() {
  function t2(t3, e) {
    this.hasPendingWrites = t3, this.fromCache = e;
  }
  return t2.prototype.isEqual = function(t3) {
    return this.hasPendingWrites === t3.hasPendingWrites && this.fromCache === t3.fromCache;
  }, t2;
}();
var ac2 = function(t2) {
  function e(e2, n2, r2, i, o, u) {
    var s = this;
    return (s = t2.call(this, e2, n2, r2, i, u) || this).Yf = e2, s.ld = e2, s.metadata = o, s;
  }
  return __extends(e, t2), e.prototype.exists = function() {
    return t2.prototype.exists.call(this);
  }, e.prototype.data = function(t3) {
    if (t3 === void 0 && (t3 = {}), this.Zf) {
      if (this.v_) {
        var e2 = new cc2(this.Yf, this.Xf, this.S_, this.Zf, this.metadata, null);
        return this.v_.fromFirestore(e2, t3);
      }
      return this.Xf.Uf(this.Zf.bt(), t3.serverTimestamps);
    }
  }, e.prototype.get = function(t3, e2) {
    if (e2 === void 0 && (e2 = {}), this.Zf) {
      var n2 = this.Zf.data().field(Ya2("DocumentSnapshot.get", t3));
      if (n2 !== null)
        return this.Xf.Uf(n2, e2.serverTimestamps);
    }
  }, e;
}(Ba2);
var cc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.data = function(e2) {
    return e2 === void 0 && (e2 = {}), t2.prototype.data.call(this, e2);
  }, e;
}(ac2);
var hc2 = function() {
  function t2(t3, e, n2, r2) {
    this.Yf = t3, this.Xf = e, this._d = r2, this.metadata = new sc2(r2.hasPendingWrites, r2.fromCache), this.query = n2;
  }
  return Object.defineProperty(t2.prototype, "docs", {
    get: function() {
      var t3 = [];
      return this.forEach(function(e) {
        return t3.push(e);
      }), t3;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this._d.docs.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "empty", {
    get: function() {
      return this.size === 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3, e) {
    var n2 = this;
    this._d.docs.forEach(function(r2) {
      t3.call(e, new cc2(n2.Yf, n2.Xf, r2.key, r2, new sc2(n2._d.De.has(r2.key), n2._d.fromCache), n2.query.v_));
    });
  }, t2.prototype.docChanges = function(t3) {
    t3 === void 0 && (t3 = {});
    var e = !!t3.includeMetadataChanges;
    if (e && this._d.xe)
      throw new q2(M2.INVALID_ARGUMENT, "To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");
    return this.fd && this.dd === e || (this.fd = function(t4, e2) {
      if (t4._d.Se.et()) {
        var n2 = 0;
        return t4._d.docChanges.map(function(e3) {
          var r3 = new cc2(t4.Yf, t4.Xf, e3.doc.key, e3.doc, new sc2(t4._d.De.has(e3.doc.key), t4._d.fromCache), t4.query.v_);
          return e3.doc, {
            type: "added",
            doc: r3,
            oldIndex: -1,
            newIndex: n2++
          };
        });
      }
      var r2 = t4._d.Se;
      return t4._d.docChanges.filter(function(t5) {
        return e2 || t5.type !== 3;
      }).map(function(e3) {
        var n3 = new cc2(t4.Yf, t4.Xf, e3.doc.key, e3.doc, new sc2(t4._d.De.has(e3.doc.key), t4._d.fromCache), t4.query.v_), i = -1, o = -1;
        return e3.type !== 0 && (i = r2.indexOf(e3.doc.key), r2 = r2.delete(e3.doc.key)), e3.type !== 1 && (o = (r2 = r2.add(e3.doc)).indexOf(e3.doc.key)), {
          type: fc2(e3.type),
          doc: n3,
          oldIndex: i,
          newIndex: o
        };
      });
    }(this, e), this.dd = e), this.fd;
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function fc2(t2) {
  switch (t2) {
    case 0:
      return "added";
    case 2:
    case 3:
      return "modified";
    case 1:
      return "removed";
    default:
      return x2();
  }
}
function lc2(t2, e) {
  return t2 instanceof ac2 && e instanceof ac2 ? t2.Yf === e.Yf && t2.S_.isEqual(e.S_) && (t2.Zf === null ? e.Zf === null : t2.Zf.isEqual(e.Zf)) && t2.v_ === e.v_ : t2 instanceof hc2 && e instanceof hc2 && t2.Yf === e.Yf && Ys(t2.query, e.query) && t2.metadata.isEqual(e.metadata) && t2._d.isEqual(e._d);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var pc2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  return __extends(e, t2), e.prototype.Wf = function(t3) {
    return new F2(t3);
  }, e.prototype.jf = function(t3) {
    var e2 = this.Jf(t3, this.firestore.I_);
    return new Fs(this.firestore, null, e2);
  }, e;
}(Ga2);
function dc2(t2, e, n2) {
  for (var r2 = [], i = 3; i < arguments.length; i++)
    r2[i - 3] = arguments[i];
  t2 = Ls(t2, Fs);
  var o = Ls(t2.firestore, Ma2), u = ta2(o);
  return e instanceof Ss && (e = e.d_), yc2(o, [(typeof e == "string" || e instanceof As ? ca2(u, "updateDoc", t2.S_, e, n2, r2) : aa2(u, "updateDoc", t2.S_, e)).F_(t2.S_, Re.exists(true))]);
}
function vc2(t2) {
  for (var e, n2, r2, i = [], o = 1; o < arguments.length; o++)
    i[o - 1] = arguments[o];
  t2 instanceof Ss && (t2 = t2.d_);
  var u = {
    includeMetadataChanges: false
  }, s = 0;
  typeof i[s] != "object" || La2(i[s]) || (u = i[s], s++);
  var a, c, h2, f = {
    includeMetadataChanges: u.includeMetadataChanges
  };
  if (La2(i[s])) {
    var l = i[s];
    i[s] = (e = l.next) === null || e === void 0 ? void 0 : e.bind(l), i[s + 1] = (n2 = l.error) === null || n2 === void 0 ? void 0 : n2.bind(l), i[s + 2] = (r2 = l.complete) === null || r2 === void 0 ? void 0 : r2.bind(l);
  }
  if (t2 instanceof Fs)
    c = Ls(t2.firestore, Ma2), h2 = re(t2.S_.path), a = {
      next: function(e2) {
        i[s] && i[s](mc2(c, t2, e2));
      },
      error: i[s + 1],
      complete: i[s + 2]
    };
  else {
    var p2 = Ls(t2, js);
    c = Ls(p2.firestore, Ma2), h2 = p2.C_;
    var d = new pc2(c);
    a = {
      next: function(t3) {
        i[s] && i[s](new hc2(c, d, p2, t3));
      },
      error: i[s + 1],
      complete: i[s + 2]
    }, Ha2(t2.C_);
  }
  return function(t3, e2, n3, r3) {
    var i2 = this, o2 = new Ts(r3), u2 = new ku(e2, o2, n3);
    return t3._s.Ps(function() {
      return __awaiter(i2, void 0, void 0, function() {
        var e3;
        return __generator(this, function(n4) {
          switch (n4.label) {
            case 0:
              return e3 = Nu, [4, Oa(t3)];
            case 1:
              return [2, e3.apply(void 0, [n4.sent(), u2])];
          }
        });
      });
    }), function() {
      o2.i_(), t3._s.Ps(function() {
        return __awaiter(i2, void 0, void 0, function() {
          var e3;
          return __generator(this, function(n4) {
            switch (n4.label) {
              case 0:
                return e3 = Au, [4, Oa(t3)];
              case 1:
                return [2, e3.apply(void 0, [n4.sent(), u2])];
            }
          });
        });
      });
    };
  }(qa2(c), h2, f, a);
}
function yc2(t2, e) {
  return function(t3, e2) {
    var n2 = this, r2 = new fr();
    return t3._s.Ps(function() {
      return __awaiter(n2, void 0, void 0, function() {
        var n3;
        return __generator(this, function(i) {
          switch (i.label) {
            case 0:
              return n3 = Bu, [4, ka2(t3)];
            case 1:
              return [2, n3.apply(void 0, [i.sent(), e2, r2])];
          }
        });
      });
    }), r2.promise;
  }(qa2(t2), e);
}
function mc2(t2, e, n2) {
  var r2 = n2.docs.get(e.S_), i = new pc2(t2);
  return new ac2(t2, i, e.S_, r2, new sc2(n2.hasPendingWrites, n2.fromCache), e.v_);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var gc2 = function() {
  function t2(t3, e) {
    this.Yf = t3, this.wd = e, this.Ed = [], this.Td = false, this.Id = ta2(t3);
  }
  return t2.prototype.set = function(t3, e, n2) {
    this.md();
    var r2 = wc2(t3, this.Yf), i = oc2(r2.v_, e, n2), o = ea2(this.Id, "WriteBatch.set", r2.S_, i, r2.v_ !== null, n2);
    return this.Ed.push(o.F_(r2.S_, Re.Kt())), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2 = [], i = 3; i < arguments.length; i++)
      r2[i - 3] = arguments[i];
    this.md();
    var o, u = wc2(t3, this.Yf);
    return e instanceof Ss && (e = e.d_), o = typeof e == "string" || e instanceof As ? ca2(this.Id, "WriteBatch.update", u.S_, e, n2, r2) : aa2(this.Id, "WriteBatch.update", u.S_, e), this.Ed.push(o.F_(u.S_, Re.exists(true))), this;
  }, t2.prototype.delete = function(t3) {
    this.md();
    var e = wc2(t3, this.Yf);
    return this.Ed = this.Ed.concat(new Je(e.S_, Re.Kt())), this;
  }, t2.prototype.commit = function() {
    return this.md(), this.Td = true, this.Ed.length > 0 ? this.wd(this.Ed) : Promise.resolve();
  }, t2.prototype.md = function() {
    if (this.Td)
      throw new q2(M2.FAILED_PRECONDITION, "A write batch can no longer be used after commit() has been called.");
  }, t2;
}();
function wc2(t2, e) {
  if (t2 instanceof Ss && (t2 = t2.d_), t2.firestore !== e)
    throw new q2(M2.INVALID_ARGUMENT, "Provided document reference is from a different Firestore instance.");
  return t2;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var bc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this).Yf = e2, r2;
  }
  return __extends(e, t2), e.prototype.get = function(e2) {
    var n2 = this, r2 = wc2(e2, this.Yf), i = new pc2(this.Yf);
    return t2.prototype.get.call(this, e2).then(function(t3) {
      return new ac2(n2.Yf, i, r2.S_, t3.Zf, new sc2(false, false), r2.v_);
    });
  }, e;
}(function() {
  function t2(t3, e) {
    this.Yf = t3, this.Ad = e, this.Id = ta2(t3);
  }
  return t2.prototype.get = function(t3) {
    var e = this, n2 = wc2(t3, this.Yf), r2 = new uc2(this.Yf);
    return this.Ad.ef([n2.S_]).then(function(t4) {
      if (!t4 || t4.length !== 1)
        return x2();
      var i = t4[0];
      if (i instanceof Vt)
        return new Ba2(e.Yf, r2, n2.S_, null, n2.v_);
      if (i instanceof Pt)
        return new Ba2(e.Yf, r2, i.key, i, n2.v_);
      throw x2();
    });
  }, t2.prototype.set = function(t3, e, n2) {
    var r2 = wc2(t3, this.Yf), i = oc2(r2.v_, e, n2), o = ea2(this.Id, "Transaction.set", r2.S_, i, r2.v_ !== null, n2);
    return this.Ad.set(r2.S_, o), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2 = [], i = 3; i < arguments.length; i++)
      r2[i - 3] = arguments[i];
    var o, u = wc2(t3, this.Yf);
    return e instanceof Ss && (e = e.d_), o = typeof e == "string" || e instanceof As ? ca2(this.Id, "Transaction.update", u.S_, e, n2, r2) : aa2(this.Id, "Transaction.update", u.S_, e), this.Ad.update(u.S_, o), this;
  }, t2.prototype.delete = function(t3) {
    var e = wc2(t3, this.Yf);
    return this.Ad.delete(e.S_), this;
  }, t2;
}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _c() {
  if (typeof Uint8Array == "undefined")
    throw new q2(M2.UNIMPLEMENTED, "Uint8Arrays are not available in this environment.");
}
function Ic2() {
  if (typeof atob == "undefined")
    throw new q2(M2.UNIMPLEMENTED, "Blobs are unavailable in Firestore in this environment.");
}
var Ec2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.fromBase64String = function(t3) {
    return Ic2(), new e(F2.fromBase64String(t3));
  }, e.fromUint8Array = function(t3) {
    return _c(), new e(F2.fromUint8Array(t3));
  }, e.prototype.toBase64 = function() {
    return Ic2(), this.d_.toBase64();
  }, e.prototype.toUint8Array = function() {
    return _c(), this.d_.toUint8Array();
  }, e.prototype.isEqual = function(t3) {
    return this.d_.isEqual(t3.d_);
  }, e.prototype.toString = function() {
    return "Blob(base64: " + this.toBase64() + ")";
  }, e;
}(Ss);
var Tc2 = function() {
  function t2() {
  }
  return t2.prototype.enableIndexedDbPersistence = function(t3, e) {
    return function(t4, e2) {
      za2(t4 = Ls(t4, Ma2));
      var n2 = qa2(t4), r2 = t4.p_(), i = new Is();
      return ja2(n2, i, new bs(i, r2.cacheSizeBytes, e2 == null ? void 0 : e2.forceOwnership));
    }(t3.d_, {
      forceOwnership: e
    });
  }, t2.prototype.enableMultiTabIndexedDbPersistence = function(t3) {
    return function(t4) {
      za2(t4 = Ls(t4, Ma2));
      var e = qa2(t4), n2 = t4.p_(), r2 = new Is();
      return ja2(e, r2, new _s(r2, n2.cacheSizeBytes));
    }(t3.d_);
  }, t2.prototype.clearIndexedDbPersistence = function(t3) {
    return function(t4) {
      var e = this;
      if (t4.R_ && !t4.P_)
        throw new q2(M2.FAILED_PRECONDITION, "Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");
      var n2 = new fr();
      return t4.Bf.Tf(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return r2.trys.push([0, 2, , 3]), [4, function(t5) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e3;
                    return __generator(this, function(n3) {
                      switch (n3.label) {
                        case 0:
                          return dr.Kn() ? (e3 = t5 + "main", [4, dr.delete(e3)]) : [2, Promise.resolve()];
                        case 1:
                          return n3.sent(), [2];
                      }
                    });
                  });
                }(Xi(t4.I_, t4.w_))];
              case 1:
                return r2.sent(), n2.resolve(), [3, 3];
              case 2:
                return e2 = r2.sent(), n2.reject(e2), [3, 3];
              case 3:
                return [2];
            }
          });
        });
      }), n2.promise;
    }(t3.d_);
  }, t2;
}();
var Nc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, n2) || this).Rd = r2, i.INTERNAL = {
      delete: function() {
        return i.terminate();
      }
    }, e2 instanceof I2 || (i.Pd = e2), i;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "I_", {
    get: function() {
      return this.d_.I_;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.settings = function(t3) {
    t3.merge && delete (t3 = Object.assign(Object.assign({}, this.d_.V_()), t3)).merge, this.d_.g_(t3);
  }, e.prototype.useEmulator = function(t3, e2) {
    !function(t4, e3, n2) {
      var r2 = (t4 = Ls(t4, qs)).V_();
      r2.host !== "firestore.googleapis.com" && r2.host !== e3 && D2("Host has been set in both settings() and useEmulator(), emulator host will be used"), t4.g_(Object.assign(Object.assign({}, r2), {
        host: e3 + ":" + n2,
        ssl: false
      }));
    }(this.d_, t3, e2);
  }, e.prototype.enableNetwork = function() {
    return function(t3) {
      var e2 = this;
      return t3._s.enqueue(function() {
        return __awaiter(e2, void 0, void 0, function() {
          var e3, n2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return [4, Da2(t3)];
              case 1:
                return e3 = r2.sent(), [4, xa(t3)];
              case 2:
                return n2 = r2.sent(), [2, (e3.yo(true), function(t4) {
                  var e4 = O2(t4);
                  return e4.Nh.delete(0), Jo(e4);
                }(n2))];
            }
          });
        });
      });
    }(qa2(Ls(this.d_, Ma2)));
  }, e.prototype.disableNetwork = function() {
    return function(t3) {
      var e2 = this;
      return t3._s.enqueue(function() {
        return __awaiter(e2, void 0, void 0, function() {
          var e3, n2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return [4, Da2(t3)];
              case 1:
                return e3 = r2.sent(), [4, xa(t3)];
              case 2:
                return n2 = r2.sent(), [2, (e3.yo(false), function(t4) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e4;
                    return __generator(this, function(n3) {
                      switch (n3.label) {
                        case 0:
                          return (e4 = O2(t4)).Nh.add(0), [4, $o(e4)];
                        case 1:
                          return n3.sent(), e4.Oh.set("Offline"), [2];
                      }
                    });
                  });
                }(n2))];
            }
          });
        });
      });
    }(qa2(Ls(this.d_, Ma2)));
  }, e.prototype.enablePersistence = function(t3) {
    var e2 = false, n2 = false;
    return t3 && Os("synchronizeTabs", e2 = !!t3.synchronizeTabs, "experimentalForceOwningTab", n2 = !!t3.experimentalForceOwningTab), e2 ? this.Rd.enableMultiTabIndexedDbPersistence(this) : this.Rd.enableIndexedDbPersistence(this, n2);
  }, e.prototype.clearPersistence = function() {
    return this.Rd.clearIndexedDbPersistence(this);
  }, e.prototype.terminate = function() {
    return this.Pd && (this.Pd._removeServiceInstance("firestore"), this.Pd._removeServiceInstance("firestore-exp")), this.d_._delete();
  }, e.prototype.waitForPendingWrites = function() {
    return function(t3) {
      var e2 = this, n2 = new fr();
      return t3._s.Ps(function() {
        return __awaiter(e2, void 0, void 0, function() {
          var e3;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return e3 = Wu, [4, ka2(t3)];
              case 1:
                return [2, e3.apply(void 0, [r2.sent(), n2])];
            }
          });
        });
      }), n2.promise;
    }(qa2(Ls(this.d_, Ma2)));
  }, e.prototype.onSnapshotsInSync = function(t3) {
    return function(t4, e2) {
      return function(t5, e3) {
        var n2 = this, r2 = new Ts(e3);
        return t5._s.Ps(function() {
          return __awaiter(n2, void 0, void 0, function() {
            var e4;
            return __generator(this, function(n3) {
              switch (n3.label) {
                case 0:
                  return e4 = function(t6, e5) {
                    O2(t6).Wh.add(e5), e5.next();
                  }, [4, Oa(t5)];
                case 1:
                  return [2, e4.apply(void 0, [n3.sent(), r2])];
              }
            });
          });
        }), function() {
          r2.i_(), t5._s.Ps(function() {
            return __awaiter(n2, void 0, void 0, function() {
              var e4;
              return __generator(this, function(n3) {
                switch (n3.label) {
                  case 0:
                    return e4 = function(t6, e5) {
                      O2(t6).Wh.delete(e5);
                    }, [4, Oa(t5)];
                  case 1:
                    return [2, e4.apply(void 0, [n3.sent(), r2])];
                }
              });
            });
          });
        };
      }(qa2(t4 = Ls(t4, Ma2)), La2(e2) ? e2 : {
        next: e2
      });
    }(this.d_, t3);
  }, Object.defineProperty(e.prototype, "app", {
    get: function() {
      if (!this.Pd)
        throw new q2(M2.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this.Pd;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.collection = function(t3) {
    try {
      return new Fc2(this, Gs(this.d_, t3));
    } catch (t4) {
      throw Pc2(t4, "collection()", "Firestore.collection()");
    }
  }, e.prototype.doc = function(t3) {
    try {
      return new Oc2(this, Bs(this.d_, t3));
    } catch (t4) {
      throw Pc2(t4, "doc()", "Firestore.doc()");
    }
  }, e.prototype.collectionGroup = function(t3) {
    try {
      return new Uc2(this, function(t4, e2) {
        if (t4 = Ls(t4, qs), xs("collectionGroup", "collection id", e2), e2.indexOf("/") >= 0)
          throw new q2(M2.INVALID_ARGUMENT, "Invalid collection ID '" + e2 + "' passed to function collectionGroup(). Collection IDs must not contain '/'.");
        return new js(t4, null, function(t5) {
          return new ee(Z2.ct(), t5);
        }(e2));
      }(this.d_, t3));
    } catch (t4) {
      throw Pc2(t4, "collectionGroup()", "Firestore.collectionGroup()");
    }
  }, e.prototype.runTransaction = function(t3) {
    var e2 = this;
    return function(t4, e3) {
      return function(t5, e4) {
        var n2 = this, r2 = new fr();
        return t5._s.Ps(function() {
          return __awaiter(n2, void 0, void 0, function() {
            var n3;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return [4, function(t6) {
                    return Aa2(t6).then(function(t7) {
                      return t7.Sh;
                    });
                  }(t5)];
                case 1:
                  return n3 = i.sent(), new _a(t5._s, n3, e4, r2).run(), [2];
              }
            });
          });
        }), r2.promise;
      }(qa2(t4), function(n2) {
        return e3(new bc2(t4, n2));
      });
    }(this.d_, function(n2) {
      return t3(new Sc2(e2, n2));
    });
  }, e.prototype.batch = function() {
    var t3 = this;
    return qa2(this.d_), new xc(new gc2(this.d_, function(e2) {
      return yc2(t3.d_, e2);
    }));
  }, e.prototype.loadBundle = function(t3) {
    throw new q2(M2.FAILED_PRECONDITION, '"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, e.prototype.namedQuery = function(t3) {
    throw new q2(M2.FAILED_PRECONDITION, '"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, e;
}(Ss);
var Ac2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  return __extends(e, t2), e.prototype.Wf = function(t3) {
    return new Ec2(new F2(t3));
  }, e.prototype.jf = function(t3) {
    var e2 = this.Jf(t3, this.firestore.I_);
    return Oc2.yd(e2, this.firestore, null);
  }, e;
}(Ga2);
function Dc2(t2) {
  var e;
  e = t2, E2.setLogLevel(e);
}
var Sc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).Yf = e2, r2.Xf = new Ac2(e2), r2;
  }
  return __extends(e, t2), e.prototype.get = function(t3) {
    var e2 = this, n2 = jc2(t3);
    return this.d_.get(n2).then(function(t4) {
      return new Lc2(e2.Yf, new ac2(e2.Yf.d_, e2.Xf, t4.S_, t4.Zf, t4.metadata, n2.v_));
    });
  }, e.prototype.set = function(t3, e2, n2) {
    var r2 = jc2(t3);
    return n2 ? (ks("Transaction.set", n2), this.d_.set(r2, e2, n2)) : this.d_.set(r2, e2), this;
  }, e.prototype.update = function(t3, e2, n2) {
    for (var r2, i = [], o = 3; o < arguments.length; o++)
      i[o - 3] = arguments[o];
    var u = jc2(t3);
    return arguments.length === 2 ? this.d_.update(u, e2) : (r2 = this.d_).update.apply(r2, __spreadArrays([u, e2, n2], i)), this;
  }, e.prototype.delete = function(t3) {
    var e2 = jc2(t3);
    return this.d_.delete(e2), this;
  }, e;
}(Ss);
var xc = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.set = function(t3, e2, n2) {
    var r2 = jc2(t3);
    return n2 ? (ks("WriteBatch.set", n2), this.d_.set(r2, e2, n2)) : this.d_.set(r2, e2), this;
  }, e.prototype.update = function(t3, e2, n2) {
    for (var r2, i = [], o = 3; o < arguments.length; o++)
      i[o - 3] = arguments[o];
    var u = jc2(t3);
    return arguments.length === 2 ? this.d_.update(u, e2) : (r2 = this.d_).update.apply(r2, __spreadArrays([u, e2, n2], i)), this;
  }, e.prototype.delete = function(t3) {
    var e2 = jc2(t3);
    return this.d_.delete(e2), this;
  }, e.prototype.commit = function() {
    return this.d_.commit();
  }, e;
}(Ss);
var kc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, r2) || this).Yf = e2, i.Xf = n2, i;
  }
  return __extends(e, t2), e.prototype.fromFirestore = function(t3, e2) {
    var n2 = new cc2(this.Yf.d_, this.Xf, t3.S_, t3.Zf, t3.metadata, null);
    return this.d_.fromFirestore(new Rc2(this.Yf, n2), e2 != null ? e2 : {});
  }, e.prototype.toFirestore = function(t3, e2) {
    return e2 ? this.d_.toFirestore(t3, e2) : this.d_.toFirestore(t3);
  }, e.gd = function(t3, n2) {
    var r2 = e.Vd, i = r2.get(t3);
    i || (i = new WeakMap(), r2.set(t3, i));
    var o = i.get(n2);
    return o || (o = new e(t3, new Ac2(t3), n2), i.set(n2, o)), o;
  }, e;
}(Ss);
kc2.Vd = new WeakMap();
var Oc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).firestore = e2, r2.Xf = new Ac2(e2), r2;
  }
  return __extends(e, t2), e.pd = function(t3, n2, r2) {
    if (t3.length % 2 != 0)
      throw new q2(M2.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + t3.rt() + " has " + t3.length);
    return new e(n2, new Fs(n2.d_, r2, new tt(t3)));
  }, e.yd = function(t3, n2, r2) {
    return new e(n2, new Fs(n2.d_, r2, t3));
  }, Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this.d_.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      return new Fc2(this.firestore, this.d_.parent);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this.d_.path;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.collection = function(t3) {
    try {
      return new Fc2(this.firestore, Gs(this.d_, t3));
    } catch (t4) {
      throw Pc2(t4, "collection()", "DocumentReference.collection()");
    }
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof Ss && (t3 = t3.d_), t3 instanceof Fs && Qs(this.d_, t3);
  }, e.prototype.set = function(t3, e2) {
    e2 = ks("DocumentReference.set", e2);
    try {
      return function(t4, e3, n2) {
        t4 = Ls(t4, Fs);
        var r2 = Ls(t4.firestore, Ma2), i = oc2(t4.v_, e3, n2);
        return yc2(r2, [ea2(ta2(r2), "setDoc", t4.S_, i, t4.v_ !== null, n2).F_(t4.S_, Re.Kt())]);
      }(this.d_, t3, e2);
    } catch (t4) {
      throw Pc2(t4, "setDoc()", "DocumentReference.set()");
    }
  }, e.prototype.update = function(t3, e2) {
    for (var n2 = [], r2 = 2; r2 < arguments.length; r2++)
      n2[r2 - 2] = arguments[r2];
    try {
      return arguments.length === 1 ? dc2(this.d_, t3) : dc2.apply(void 0, __spreadArrays([this.d_, t3, e2], n2));
    } catch (t4) {
      throw Pc2(t4, "updateDoc()", "DocumentReference.update()");
    }
  }, e.prototype.delete = function() {
    return yc2(Ls((t3 = this.d_).firestore, Ma2), [new Je(t3.S_, Re.Kt())]);
    var t3;
  }, e.prototype.onSnapshot = function() {
    for (var t3 = this, e2 = [], n2 = 0; n2 < arguments.length; n2++)
      e2[n2] = arguments[n2];
    var r2 = Vc2(e2), i = Cc2(e2, function(e3) {
      return new Lc2(t3.firestore, new ac2(t3.firestore.d_, t3.Xf, e3.S_, e3.Zf, e3.metadata, t3.d_.v_));
    });
    return vc2(this.d_, r2, i);
  }, e.prototype.get = function(t3) {
    var e2 = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Ls(t4, Fs);
      var e3 = Ls(t4.firestore, Ma2), n2 = qa2(e3), r2 = new pc2(e3);
      return function(t5, e4) {
        var n3 = this, r3 = new fr();
        return t5._s.Ps(function() {
          return __awaiter(n3, void 0, void 0, function() {
            var n4;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return n4 = function(t6, e5, n5) {
                    return __awaiter(this, void 0, void 0, function() {
                      var r4, i2;
                      return __generator(this, function(o) {
                        switch (o.label) {
                          case 0:
                            return o.trys.push([0, 2, , 3]), [4, function(t7, e6) {
                              var n6 = O2(t7);
                              return n6.persistence.runTransaction("read document", "readonly", function(t8) {
                                return n6.Tc.Ho(t8, e6);
                              });
                            }(t6, e5)];
                          case 1:
                            return (i2 = o.sent()) instanceof Pt ? n5.resolve(i2) : i2 instanceof Vt ? n5.resolve(null) : n5.reject(new q2(M2.UNAVAILABLE, "Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")), [3, 3];
                          case 2:
                            return r4 = o.sent(), i2 = Er(r4, "Failed to get document '" + e5 + " from cache"), n5.reject(i2), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, [4, Sa(t5)];
                case 1:
                  return [2, n4.apply(void 0, [i.sent(), e4, r3])];
              }
            });
          });
        }), r3.promise;
      }(n2, t4.S_).then(function(n3) {
        return new ac2(e3, r2, t4.S_, n3, new sc2(n3 instanceof Pt && n3.Vt, true), t4.v_);
      });
    }(this.d_) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Ls(t4, Fs);
      var e3 = Ls(t4.firestore, Ma2);
      return Pa(qa2(e3), t4.S_, {
        source: "server"
      }).then(function(n2) {
        return mc2(e3, t4, n2);
      });
    }(this.d_) : function(t4) {
      t4 = Ls(t4, Fs);
      var e3 = Ls(t4.firestore, Ma2);
      return Pa(qa2(e3), t4.S_).then(function(n2) {
        return mc2(e3, t4, n2);
      });
    }(this.d_)).then(function(t4) {
      return new Lc2(e2.firestore, new ac2(e2.firestore.d_, e2.Xf, t4.S_, t4.Zf, t4.metadata, e2.d_.v_));
    });
  }, e.prototype.withConverter = function(t3) {
    return new e(this.firestore, this.d_.withConverter(kc2.gd(this.firestore, t3)));
  }, e;
}(Ss);
function Pc2(t2, e, n2) {
  return t2.message = t2.message.replace(e, n2), t2;
}
function Vc2(t2) {
  for (var e = 0, n2 = t2; e < n2.length; e++) {
    var r2 = n2[e];
    if (typeof r2 == "object" && !La2(r2))
      return r2;
  }
  return {};
}
function Cc2(t2, e) {
  var n2, r2, i;
  return {
    next: function(t3) {
      i.next && i.next(e(t3));
    },
    error: (n2 = (i = La2(t2[0]) ? t2[0] : La2(t2[1]) ? t2[1] : typeof t2[0] == "function" ? {
      next: t2[0],
      error: t2[1],
      complete: t2[2]
    } : {
      next: t2[1],
      error: t2[2],
      complete: t2[3]
    }).error) === null || n2 === void 0 ? void 0 : n2.bind(i),
    complete: (r2 = i.complete) === null || r2 === void 0 ? void 0 : r2.bind(i)
  };
}
var Lc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).Yf = e2, r2;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "ref", {
    get: function() {
      return new Oc2(this.Yf, this.d_.ref);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this.d_.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "metadata", {
    get: function() {
      return this.d_.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "exists", {
    get: function() {
      return this.d_.exists();
    },
    enumerable: false,
    configurable: true
  }), e.prototype.data = function(t3) {
    return this.d_.data(t3);
  }, e.prototype.get = function(t3, e2) {
    return this.d_.get(t3, e2);
  }, e.prototype.isEqual = function(t3) {
    return lc2(this.d_, t3.d_);
  }, e;
}(Ss);
var Rc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.prototype.data = function(t3) {
    return this.d_.data(t3);
  }, e;
}(Lc2);
var Uc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).firestore = e2, r2.Xf = new Ac2(e2), r2;
  }
  return __extends(e, t2), e.prototype.where = function(t3, n2, r2) {
    try {
      return new e(this.firestore, Xa2(this.d_, function(t4, e2, n3) {
        var r3 = e2, i = Ya2("where", t4);
        return new Wa2(i, r3, n3);
      }(t3, n2, r2)));
    } catch (t4) {
      throw Pc2(t4, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, e.prototype.orderBy = function(t3, n2) {
    try {
      return new e(this.firestore, Xa2(this.d_, function(t4, e2) {
        e2 === void 0 && (e2 = "asc");
        var n3 = e2, r2 = Ya2("orderBy", t4);
        return new Za2(r2, n3);
      }(t3, n2)));
    } catch (t4) {
      throw Pc2(t4, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, e.prototype.limit = function(t3) {
    try {
      return new e(this.firestore, Xa2(this.d_, function(t4) {
        return Rs("limit", t4), new Ja2("limit", t4, "F");
      }(t3)));
    } catch (t4) {
      throw Pc2(t4, "limit()", "Query.limit()");
    }
  }, e.prototype.limitToLast = function(t3) {
    try {
      return new e(this.firestore, Xa2(this.d_, function(t4) {
        return Rs("limitToLast", t4), new Ja2("limitToLast", t4, "L");
      }(t3)));
    } catch (t4) {
      throw Pc2(t4, "limitToLast()", "Query.limitToLast()");
    }
  }, e.prototype.startAt = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, Xa2(this.d_, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new $a2("startAt", t4, true);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Pc2(t4, "startAt()", "Query.startAt()");
    }
  }, e.prototype.startAfter = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, Xa2(this.d_, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new $a2("startAfter", t4, false);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Pc2(t4, "startAfter()", "Query.startAfter()");
    }
  }, e.prototype.endBefore = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, Xa2(this.d_, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new tc("endBefore", t4, true);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Pc2(t4, "endBefore()", "Query.endBefore()");
    }
  }, e.prototype.endAt = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, Xa2(this.d_, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new tc("endAt", t4, false);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Pc2(t4, "endAt()", "Query.endAt()");
    }
  }, e.prototype.isEqual = function(t3) {
    return Ys(this.d_, t3.d_);
  }, e.prototype.get = function(t3) {
    var e2 = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Ls(t4, js);
      var e3 = Ls(t4.firestore, Ma2), n2 = qa2(e3), r2 = new pc2(e3);
      return function(t5, e4) {
        var n3 = this, r3 = new fr();
        return t5._s.Ps(function() {
          return __awaiter(n3, void 0, void 0, function() {
            var n4;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return n4 = function(t6, e5, n5) {
                    return __awaiter(this, void 0, void 0, function() {
                      var r4, i2, o, u, s;
                      return __generator(this, function(a) {
                        switch (a.label) {
                          case 0:
                            return a.trys.push([0, 2, , 3]), [4, ho(t6, e5, true)];
                          case 1:
                            return s = a.sent(), r4 = new Uu(e5, s.Rc), i2 = r4.fl(s.documents), o = r4.wi(i2, false), n5.resolve(o.snapshot), [3, 3];
                          case 2:
                            return u = a.sent(), s = Er(u, "Failed to execute query '" + e5 + " against cache"), n5.reject(s), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, [4, Sa(t5)];
                case 1:
                  return [2, n4.apply(void 0, [i.sent(), e4, r3])];
              }
            });
          });
        }), r3.promise;
      }(n2, t4.C_).then(function(n3) {
        return new hc2(e3, r2, t4, n3);
      });
    }(this.d_) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Ls(t4, js);
      var e3 = Ls(t4.firestore, Ma2), n2 = qa2(e3), r2 = new pc2(e3);
      return Va2(n2, t4.C_, {
        source: "server"
      }).then(function(n3) {
        return new hc2(e3, r2, t4, n3);
      });
    }(this.d_) : function(t4) {
      t4 = Ls(t4, js);
      var e3 = Ls(t4.firestore, Ma2), n2 = qa2(e3), r2 = new pc2(e3);
      return Ha2(t4.C_), Va2(n2, t4.C_).then(function(n3) {
        return new hc2(e3, r2, t4, n3);
      });
    }(this.d_)).then(function(t4) {
      return new qc2(e2.firestore, new hc2(e2.firestore.d_, e2.Xf, e2.d_, t4._d));
    });
  }, e.prototype.onSnapshot = function() {
    for (var t3 = this, e2 = [], n2 = 0; n2 < arguments.length; n2++)
      e2[n2] = arguments[n2];
    var r2 = Vc2(e2), i = Cc2(e2, function(e3) {
      return new qc2(t3.firestore, new hc2(t3.firestore.d_, t3.Xf, t3.d_, e3._d));
    });
    return vc2(this.d_, r2, i);
  }, e.prototype.withConverter = function(t3) {
    return new e(this.firestore, this.d_.withConverter(kc2.gd(this.firestore, t3)));
  }, e;
}(Ss);
var Mc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).Yf = e2, r2;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "type", {
    get: function() {
      return this.d_.type;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "doc", {
    get: function() {
      return new Rc2(this.Yf, this.d_.doc);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "oldIndex", {
    get: function() {
      return this.d_.oldIndex;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "newIndex", {
    get: function() {
      return this.d_.newIndex;
    },
    enumerable: false,
    configurable: true
  }), e;
}(Ss);
var qc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).Yf = e2, r2;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "query", {
    get: function() {
      return new Uc2(this.Yf, this.d_.query);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "metadata", {
    get: function() {
      return this.d_.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "size", {
    get: function() {
      return this.d_.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "empty", {
    get: function() {
      return this.d_.empty;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "docs", {
    get: function() {
      var t3 = this;
      return this.d_.docs.map(function(e2) {
        return new Rc2(t3.Yf, e2);
      });
    },
    enumerable: false,
    configurable: true
  }), e.prototype.docChanges = function(t3) {
    var e2 = this;
    return this.d_.docChanges(t3).map(function(t4) {
      return new Mc2(e2.Yf, t4);
    });
  }, e.prototype.forEach = function(t3, e2) {
    var n2 = this;
    this.d_.forEach(function(r2) {
      t3.call(e2, new Rc2(n2.Yf, r2));
    });
  }, e.prototype.isEqual = function(t3) {
    return lc2(this.d_, t3.d_);
  }, e;
}(Ss);
var Fc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this).firestore = e2, r2.d_ = n2, r2;
  }
  return __extends(e, t2), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this.d_.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this.d_.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      var t3 = this.d_.parent;
      return t3 ? new Oc2(this.firestore, t3) : null;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.doc = function(t3) {
    try {
      return new Oc2(this.firestore, t3 === void 0 ? Bs(this.d_) : Bs(this.d_, t3));
    } catch (t4) {
      throw Pc2(t4, "doc()", "CollectionReference.doc()");
    }
  }, e.prototype.add = function(t3) {
    var e2 = this;
    return function(t4, e3) {
      var n2 = Ls(t4.firestore, Ma2), r2 = Bs(t4), i = oc2(t4.v_, e3);
      return yc2(n2, [ea2(ta2(t4.firestore), "addDoc", r2.S_, i, t4.v_ !== null, {}).F_(r2.S_, Re.exists(false))]).then(function() {
        return r2;
      });
    }(this.d_, t3).then(function(t4) {
      return new Oc2(e2.firestore, t4);
    });
  }, e.prototype.isEqual = function(t3) {
    return Qs(this.d_, t3.d_);
  }, e.prototype.withConverter = function(t3) {
    return new e(this.firestore, this.d_.withConverter(kc2.gd(this.firestore, t3)));
  }, e;
}(Uc2);
function jc2(t2) {
  return t2 instanceof Ss && (t2 = t2.d_), Ls(t2, Fs);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var zc2 = function(t2) {
  function e() {
    for (var e2 = [], n2 = 0; n2 < arguments.length; n2++)
      e2[n2] = arguments[n2];
    return t2.call(this, new (As.bind.apply(As, __spreadArrays([void 0], e2)))()) || this;
  }
  return __extends(e, t2), e.documentId = function() {
    return new e($.ht().rt());
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof Ss && (t3 = t3.d_), t3 instanceof As && this.d_.f_.isEqual(t3.f_);
  }, e;
}(Ss);
var Gc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  return __extends(e, t2), e.serverTimestamp = function() {
    var t3 = new ia("serverTimestamp");
    return t3._methodName = "FieldValue.serverTimestamp", new e(t3);
  }, e.delete = function() {
    var t3 = new na2("deleteField");
    return t3._methodName = "FieldValue.delete", new e(t3);
  }, e.arrayUnion = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    var r2 = function() {
      for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
        t4[e2] = arguments[e2];
      return new oa2("arrayUnion", t4);
    }.apply(void 0, t3);
    return r2._methodName = "FieldValue.arrayUnion", new e(r2);
  }, e.arrayRemove = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    var r2 = function() {
      for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
        t4[e2] = arguments[e2];
      return new ua2("arrayRemove", t4);
    }.apply(void 0, t3);
    return r2._methodName = "FieldValue.arrayRemove", new e(r2);
  }, e.increment = function(t3) {
    var n2 = function(t4) {
      return new sa2("increment", t4);
    }(t3);
    return n2._methodName = "FieldValue.increment", new e(n2);
  }, e.prototype.isEqual = function(t3) {
    return this.d_.isEqual(t3.d_);
  }, e;
}(Ss);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// node_modules/@firebase/firestore/dist/esm5/index.js
var I3 = {
  Firestore: Nc2,
  GeoPoint: Hs,
  Timestamp: K2,
  Blob: Ec2,
  Transaction: Sc2,
  WriteBatch: xc,
  DocumentReference: Oc2,
  DocumentSnapshot: Lc2,
  Query: Uc2,
  QueryDocumentSnapshot: Rc2,
  QuerySnapshot: qc2,
  CollectionReference: Fc2,
  FieldPath: zc2,
  FieldValue: Gc2,
  setLogLevel: Dc2,
  CACHE_SIZE_UNLIMITED: Ua2
};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function L3(e) {
  !function(e2, r2) {
    e2.INTERNAL.registerComponent(new Component("firestore", function(e3) {
      var t2 = e3.getProvider("app").getImmediate();
      return r2(t2, e3.getProvider("auth-internal"));
    }, "PUBLIC").setServiceProps(Object.assign({}, I3)));
  }(e, function(e2, s) {
    return new Nc2(e2, new Ma2(e2, s), new Tc2());
  }), e.registerVersion("@firebase/firestore", "2.1.7");
}
L3(index_esm_default);
//# sourceMappingURL=firebase_firestore.js.map
